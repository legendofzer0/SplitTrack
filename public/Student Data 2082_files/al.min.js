!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).augLoop=e()}}((function(){return function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,(function(e){return r(t[s][1][e]||e)}),c,c.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";var o=e(30).default;Object.defineProperty(n,"__esModule",{value:!0}),n.CategoryLogger=void 0;var r=o(e(22)),i=o(e(24)),s=e(8),a=e(13);n.CategoryLogger=function(){return(0,i.default)((function e(t){(0,r.default)(this,e),this.category=t}),[{key:"info",value:function(e,t){for(var n=arguments.length,o=new Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];a.ULS.sendTraceTag(e,this.category,s.TraceLevel.Info,this.messageToLog(t,o))}},{key:"warn",value:function(e,t){for(var n=arguments.length,o=new Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];a.ULS.sendTraceTag(e,this.category,s.TraceLevel.Warning,this.messageToLog(t,o))}},{key:"error",value:function(e,t){for(var n=arguments.length,o=new Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];a.ULS.sendTraceTag(e,this.category,s.TraceLevel.Error,this.messageToLog(t,o))}},{key:"messageToLog",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(!n.length)return e;var r=n.map((function(e){return JSON.stringify(e)})).join(", ");return"".concat(e,": ").concat(r)}}])}()},{13:13,22:22,24:24,30:30,8:8}],2:[function(e,t,n){"use strict";var o=e(30).default;Object.defineProperty(n,"__esModule",{value:!0}),n.ConsoleLogger=void 0;var r=o(e(22)),i=o(e(24)),s=e(8),a=e(5),u=n.ConsoleLogger=function(){function e(){(0,r.default)(this,e),this.correlationId=""}return(0,i.default)(e,[{key:"getLogMessage",value:function(t,n,o){var r="tag_".concat(e.tagIntToString(t)," [").concat(a.LogCategory[n],"] ").concat(o);return this.correlationId&&""!==this.correlationId&&(r+="\t\t".concat(this.correlationId)),r}},{key:"sendTraceTag",value:function(e,t,n,o){var r=this.logMessage;switch(n){case s.TraceLevel.Error:r=this.logError;break;case s.TraceLevel.Warning:r=this.logWarning;break;case s.TraceLevel.Info:r=this.logInfo;break;case s.TraceLevel.Verbose:r=this.logVerbose;break;case s.TraceLevel.Spam:default:r=this.logMessage}try{r(this.getLogMessage(e,t,o))}catch(e){var i="undefined"!=typeof navigator?navigator:void 0;if(i&&!/rv:11.0/i.test(i.userAgent))throw e}}},{key:"shipAssertTag",value:function(e,t,n,o){console.assert(n,this.getLogMessage(e,t,o))}},{key:"debugAssertTag",value:function(e,t,n,o){this.shipAssertTag(e,t,n,o)}},{key:"setCorrelationId",value:function(e){this.correlationId=e}},{key:"logMessage",value:function(e){"log"in console&&console.log(e)}},{key:"logError",value:function(e){"error"in console&&console.error(e)}},{key:"logWarning",value:function(e){"warn"in console&&console.warn(e)}},{key:"logInfo",value:function(e){"info"in console&&console.info(e)}},{key:"logVerbose",value:function(e){"debug"in console&&console.debug(e)}}],[{key:"tagIntToString",value:function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)}}])}();u.maxNumericTag=65535,u.minOldSchemeHighByteValue=36,u.map="abcdefghijklmnopqrstuvwxyz0123456789"},{22:22,24:24,30:30,5:5,8:8}],3:[function(e,t,n){"use strict";var o=e(30).default;Object.defineProperty(n,"__esModule",{value:!0}),n.NoopLogger=void 0;var r=o(e(22)),i=o(e(24));n.NoopLogger=function(){return(0,i.default)((function e(){(0,r.default)(this,e)}),[{key:"sendTraceTag",value:function(){}},{key:"shipAssertTag",value:function(){}},{key:"debugAssertTag",value:function(){}},{key:"setCorrelationId",value:function(){}}])}()},{22:22,24:24,30:30}],4:[function(e,t,n){"use strict";var o=e(30).default;Object.defineProperty(n,"__esModule",{value:!0}),n.UnitTestLogger=void 0;var r=o(e(24)),i=o(e(22)),s=o(e(21)),a=o(e(29)),u=e(3);n.UnitTestLogger=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,t,arguments)}return(0,a.default)(t,e),(0,r.default)(t)}(u.NoopLogger)},{21:21,22:22,24:24,29:29,3:3,30:30}],5:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=void 0,function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_MSOSP_AddInCommands=220]="msoulscat_MSOSP_AddInCommands",e[e.msoulscat_MSOSP_OTelJS=225]="msoulscat_MSOSP_OTelJS",e[e.msoulscat_MSOSP_OTelJSInWebWoker=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.msoulscat_MSOSP_OTelJSWebWorkerPrototype=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WacFeedback=356]="msoulscat_Wac_WacFeedback",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptGc2General=835]="msoulscat_Wac_PptGc2General",e[e.msoulscat_Wac_PptGc2GraphicHost=836]="msoulscat_Wac_PptGc2GraphicHost",e[e.msoulscat_Wac_PptGc2Operation=837]="msoulscat_Wac_PptGc2Operation",e[e.msoulscat_Wac_PptGc2EditCanvas=852]="msoulscat_Wac_PptGc2EditCanvas",e[e.msoulscat_Wac_PptDataSync=844]="msoulscat_Wac_PptDataSync",e[e.msoulscat_Wac_PptFluidRuntime=848]="msoulscat_Wac_PptFluidRuntime",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_PptView=822]="msoulscat_Wac_PptView",e[e.msoulscat_Wac_PptVideos=846]="msoulscat_Wac_PptVideos",e[e.msoulscat_Uci_Insights=1303]="msoulscat_Uci_Insights",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_OAuth=3e3]="msoulscat_Wac_OAuth",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_WordDesigner=3016]="msoulscat_Wac_WordDesigner",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker",e[e.msoulscat_Wac_UnifiedUiHost=3027]="msoulscat_Wac_UnifiedUiHost",e[e.msoulscat_Wac_EquationTools=3033]="msoulscat_Wac_EquationTools",e[e.msoulscat_Osf_Latency=1401]="msoulscat_Osf_Latency",e[e.msoulscat_Osf_Notification=1402]="msoulscat_Osf_Notification",e[e.msoulscat_Osf_Runtime=1403]="msoulscat_Osf_Runtime",e[e.msoulscat_Wac_AiMaker=3041]="msoulscat_Wac_AiMaker",e[e.msoulscat_Wac_AiRewrite=3043]="msoulscat_Wac_AiRewrite",e[e.msoulscat_Wac_AiInsert=3044]="msoulscat_Wac_AiInsert",e[e.msoulscat_Wac_AiSummarize=3047]="msoulscat_Wac_AiSummarize",e[e.msoulscat_Wac_CopilotCompose=3048]="msoulscat_Wac_CopilotCompose",e[e.msoulscat_Wac_Skittles=3049]="msoulscat_Wac_Skittles",e[e.msoulscat_Wac_CopilotChat=3050]="msoulscat_Wac_CopilotChat",e[e.msoulscat_Wac_Syntex=3051]="msoulscat_Wac_Syntex",e[e.msoulscat_Wac_WireGraph=3052]="msoulscat_Wac_WireGraph",e[e.msoulscat_Wac_CshCopilot=3053]="msoulscat_Wac_CshCopilot",e[e.msoulscat_Wac_CopilotProactiveSummary=3055]="msoulscat_Wac_CopilotProactiveSummary",e[e.msoulscat_Wac_CopilotProactiveShared=3056]="msoulscat_Wac_CopilotProactiveShared",e[e.msoulscat_Wac_CopilotCursor=3057]="msoulscat_Wac_CopilotCursor",e[e.msoulscat_Wac_WasmGeneral=3059]="msoulscat_Wac_WasmGeneral",e[e.msoulscat_Wac_WasmTextLayout=3060]="msoulscat_Wac_WasmTextLayout",e[e.msoulscat_Wac_WasmSmartArt=3061]="msoulscat_Wac_WasmSmartArt",e[e.msoulscat_Wac_WasmClient=3062]="msoulscat_Wac_WasmClient",e[e.msoulscat_Wac_WasmNative=3063]="msoulscat_Wac_WasmNative"}(o||(n.LogCategory=o={}))},{}],6:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LogType=void 0,function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(o||(n.LogType=o={}))},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],8:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.TraceLevel=void 0,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Important=20]="Important",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(o||(n.TraceLevel=o={}))},{}],9:[function(e,t,n){(function(t){(function(){"use strict";var o=e(30).default;Object.defineProperty(n,"__esModule",{value:!0}),n.RemoteUlsLogger=void 0,n.getUlsLogger=function(e,t){return new l(e,t)},n.getUlsLoggerDeprecated=function(e,t){var n=new a.bUlsCache(e,t);return{sendTraceTag:function(e,t,o,r){return c(n,e,t,o,r,"")},shipAssertTag:function(e,t,o,r){o&&c(n,e,t,u.TraceLevel.Error,r,"")},debugAssertTag:function(){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:n.flush,flushOnClose:n.flushOnClose,setCorrelationId:function(){}}};var r=o(e(22)),i=o(e(24)),s=e(6),a=e(10),u=e(8),l=n.RemoteUlsLogger=function(){return(0,i.default)((function e(t,n,o){(0,r.default)(this,e),this.correlationId="",this.cache=new a.bUlsCache(t,n,o)}),[{key:"setCorrelationId",value:function(e){this.correlationId=e}},{key:"sendTraceTag",value:function(e,t,n,o){c(this.cache,e,t,n,o,this.correlationId)}},{key:"debugAssertTag",value:function(e,t,n,o){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")}},{key:"shipAssertTag",value:function(e,t,n,o){n&&c(this.cache,e,t,u.TraceLevel.Error,o,this.correlationId)}},{key:"flush",value:function(){this.cache.flush()}},{key:"flushOnClose",value:function(){this.cache.flushOnClose}}])}();function c(e,n,o,r,i,a){if(!(r>("production"!==t.env.NODE_ENV?u.TraceLevel.Verbose:u.TraceLevel.Info))){var l={timestamp:Date.now(),category:o,tag:n,level:r,type:s.LogType.Trace,message:i,correlationId:a};e.handleTrace(l)}}}).call(this)}).call(this,{env:{NODE_ENV:"production"}})},{10:10,22:22,24:24,30:30,6:6,8:8}],10:[function(e,t,n){"use strict";var o=e(30).default;Object.defineProperty(n,"__esModule",{value:!0}),n.bUlsCache=void 0;var r=o(e(22)),i=o(e(24)),s=e(12),a=e(11),u=e(8),l=n.bUlsCache=function(){function e(t,n,o){var i=this;(0,r.default)(this,e),this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){i.triggerUpload(!1,!1)},this.flush=function(){i.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return i.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(t,n){if(window.clearTimeout(i.timeoutId),i.logCache.length>0){i.uploadId+=1;var o=(0,a.formatForUpload)(i.logCache,i.userSessionId,i.uploadId,i.timestampBase);(0,s.uploadLogs)(o,i.remoteUrlEndpoint,n),i.logCache=[],i.timestampBase=Date.now()}t&&(i.timeoutId=window.setTimeout(i.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t;var u=n+"?usid="+t;void 0!==o&&o.forEach((function(e,t){u+="&"+t+"="+e})),this.remoteUrlEndpoint=u,window.setTimeout((function(){return i.triggerUpload(!0,!0)}),0)}return(0,i.default)(e,[{key:"handleTrace",value:function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimmedMessage.length)+e.trimmedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===u.TraceLevel.Error)&&this.triggerUploadAsync()}}])}();l.messageMaxChars=3072,l.uploadCadenceInMsSec=3e4,l.uploadTriggerSize=30,l.trimmedMessage="... [Trimmed]"},{11:11,12:12,22:22,24:24,30:30,8:8}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.formatForUpload=function(e,t,n,o){var r=[],i=e.map((function(e){return function(e,t,n){var o={};if(o.G=e.tag,o.T=e.timestamp-t,o.M=e.message,o.C=e.category,e.correlationId){var r=n.findIndex((function(t){return t===e.correlationId}));r<0&&(r=n.push(e.correlationId)-1),o.I=r}var i=1e3*e.type+e.level;return o.D=i,o}(e,o,r)})),s=function(e,t,n,o,r){var i={};i.T=e,i.L=t,i.S=n,i.I=o,r&&r.length>0&&(i.W=r);return i.V=1,i}(o,i,t,n,r);return JSON.stringify(s)}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uploadLogs=function(e,t,n){if(!t)return;var o=window.navigator;if(o&&o.sendBeacon)try{return void o.sendBeacon(t,e)}catch(e){}!function(e,t,n){var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,n),o.send(e))}(e,t,n)}},{}],13:[function(e,t,n){(function(t){(function(){"use strict";var o=e(30).default;Object.defineProperty(n,"__esModule",{value:!0}),n.UlsLoggerWrapper=n.ULS=void 0,n.initializeLogger=function(e){if(!e)throw new Error("The 'logger' argument is missing");l.setLogger(e)};var r=o(e(22)),i=o(e(24)),s=e(3),a=e(2),u=n.UlsLoggerWrapper=function(){return(0,i.default)((function e(){(0,r.default)(this,e),this.externalLogger="production"!==t.env.NODE_ENV?new a.ConsoleLogger:new s.NoopLogger}),[{key:"setCorrelationId",value:function(e){this.externalLogger.setCorrelationId(e)}},{key:"setLogger",value:function(e){this.externalLogger=e}},{key:"sendTraceTag",value:function(e,t,n,o){this.externalLogger.sendTraceTag(e,t,n,o)}},{key:"debugAssertTag",value:function(e,t,n,o){this.externalLogger.debugAssertTag(e,t,n,o)}},{key:"shipAssertTag",value:function(e,t,n,o){this.externalLogger.shipAssertTag(e,t,n,o)}}])}(),l=n.ULS=new u}).call(this)}).call(this,{env:{NODE_ENV:"production"}})},{2:2,22:22,24:24,3:3,30:30}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e(13);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===o[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}}))}));var r=e(9);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===r[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=e(11);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===i[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}}))}));var s=e(12);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===s[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}}))}));var a=e(5);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===a[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}}))}));var u=e(7);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===u[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}}))}));var l=e(6);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===l[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=e(8);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===c[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=e(4);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===d[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return d[e]}}))}));var f=e(2);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===f[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return f[e]}}))}));var p=e(1);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===p[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return p[e]}}))}));var g=e(3);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===g[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return g[e]}}))}))},{1:1,11:11,12:12,13:13,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9}],15:[function(e,t,n){t.exports=function(e,t){this.v=e,this.k=t},t.exports.__esModule=!0,t.exports.default=t.exports},{}],16:[function(e,t,n){t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o},t.exports.__esModule=!0,t.exports.default=t.exports},{}],17:[function(e,t,n){t.exports=function(e){if(Array.isArray(e))return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],18:[function(e,t,n){var o=e(16);t.exports=function(e){if(Array.isArray(e))return o(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{16:16}],19:[function(e,t,n){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],20:[function(e,t,n){function o(e,t,n,o,r,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(o,r)}t.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){o(s,r,i,a,u,"next",e)}function u(e){o(s,r,i,a,u,"throw",e)}a(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],21:[function(e,t,n){var o=e(28),r=e(32),i=e(38);t.exports=function(e,t,n){return t=o(t),i(e,r()?Reflect.construct(t,n||[],o(e).constructor):t.apply(e,n))},t.exports.__esModule=!0,t.exports.default=t.exports},{28:28,32:32,38:38}],22:[function(e,t,n){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],23:[function(e,t,n){var o=e(32),r=e(47);t.exports=function(e,t,n){if(o())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var s=new(e.bind.apply(e,i));return n&&r(s,n.prototype),s},t.exports.__esModule=!0,t.exports.default=t.exports},{32:32,47:47}],24:[function(e,t,n){var o=e(53);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}t.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},t.exports.__esModule=!0,t.exports.default=t.exports},{53:53}],25:[function(e,t,n){var o=e(55);t.exports=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}},t.exports.__esModule=!0,t.exports.default=t.exports},{55:55}],26:[function(e,t,n){var o=e(53);t.exports=function(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},t.exports.__esModule=!0,t.exports.default=t.exports},{53:53}],27:[function(e,t,n){var o=e(49);function r(){return t.exports=r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=o(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},t.exports.__esModule=!0,t.exports.default=t.exports,r.apply(null,arguments)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},{49:49}],28:[function(e,t,n){function o(e){return t.exports=o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],29:[function(e,t,n){var o=e(47);t.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{47:47}],30:[function(e,t,n){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],31:[function(e,t,n){t.exports=function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],32:[function(e,t,n){function o(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(t.exports=o=function(){return!!e},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],33:[function(e,t,n){t.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{}],34:[function(e,t,n){t.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,s,a=[],u=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=i.call(n)).done)&&(a.push(o.value),a.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return a}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],35:[function(e,t,n){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],36:[function(e,t,n){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],37:[function(e,t,n){var o=e(26);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}t.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},t.exports.__esModule=!0,t.exports.default=t.exports},{26:26}],38:[function(e,t,n){var o=e(54).default,r=e(19);t.exports=function(e,t){if(t&&("object"==o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return r(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{19:19,54:54}],39:[function(e,t,n){var o=e(43);function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,n,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function u(t,r,i,s){var a=r&&r.prototype instanceof c?r:c,u=Object.create(a.prototype);return o(u,"_invoke",function(t,o,r){var i,s,a,u=0,c=r||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,a=e,f.n=n,l}};function p(t,o){for(s=t,a=o,n=0;!d&&u&&!r&&n<c.length;n++){var r,i=c[n],p=f.p,g=i[2];t>3?(r=g===o)&&(a=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((r=t<2&&p<i[1])?(s=0,f.v=o,f.n=i[1]):p<g&&(r=t<3||i[0]>o||o>g)&&(i[4]=t,i[5]=o,f.n=g,s=0))}if(r||t>1)return l;throw d=!0,o}return function(r,c,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&p(c,g),s=c,a=g;(n=s<2?e:a)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,a)):f.n=a:f.v=a);try{if(u=2,i){if(s||(r="next"),n=i[r]){if(!(n=n.call(i,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,s<2&&(s=0)}else 1===s&&(n=i.return)&&n.call(i),s<2&&(a=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=e}else if((n=(d=f.n<0)?a:t.call(o,f))!==l)break}catch(t){i=e,s=1,a=t}finally{u=1}}return{value:n,done:d}}}(t,i,s),!0),u}var l={};function c(){}function d(){}function f(){}n=Object.getPrototypeOf;var p=[][s]?n(n([][s]())):(o(n={},s,(function(){return this})),n),g=f.prototype=c.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(g),e}return d.prototype=f,o(g,"constructor",f),o(f,"constructor",d),d.displayName="GeneratorFunction",o(f,a,"GeneratorFunction"),o(g),o(g,a,"Generator"),o(g,s,(function(){return this})),o(g,"toString",(function(){return"[object Generator]"})),(t.exports=r=function(){return{w:u,m:h}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},{43:43}],40:[function(e,t,n){var o=e(41);t.exports=function(e,t,n,r,i){var s=o(e,t,n,r,i);return s.next().then((function(e){return e.done?e.value:s.next()}))},t.exports.__esModule=!0,t.exports.default=t.exports},{41:41}],41:[function(e,t,n){var o=e(39),r=e(42);t.exports=function(e,t,n,i,s){return new r(o().w(e,t,n,i),s||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},{39:39,42:42}],42:[function(e,t,n){var o=e(15),r=e(43);t.exports=function e(t,n){function i(e,r,s,a){try{var u=t[e](r),l=u.value;return l instanceof o?n.resolve(l.v).then((function(e){i("next",e,s,a)}),(function(e){i("throw",e,s,a)})):n.resolve(l).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,a)}))}catch(e){a(e)}}var s;this.next||(r(e.prototype),r(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),r(this,"_invoke",(function(e,t,o){function r(){return new n((function(t,n){i(e,o,t,n)}))}return s=s?s.then(r,r):r()}),!0)},t.exports.__esModule=!0,t.exports.default=t.exports},{15:15,43:43}],43:[function(e,t,n){function o(e,n,r,i){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}t.exports=o=function(e,t,n,r){if(t)s?s(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var i=function(t,n){o(e,t,(function(e){return this._invoke(t,n,e)}))};i("next",0),i("throw",1),i("return",2)}},t.exports.__esModule=!0,t.exports.default=t.exports,o(e,n,r,i)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],44:[function(e,t,n){t.exports=function(e){var t=Object(e),n=[];for(var o in t)n.unshift(o);return function e(){for(;n.length;)if((o=n.pop())in t)return e.value=o,e.done=!1,e;return e.done=!0,e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],45:[function(e,t,n){var o=e(15),r=e(39),i=e(40),s=e(41),a=e(42),u=e(44),l=e(46);function c(){"use strict";var e=r(),n=e.m(c),d=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function f(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))}var p={throw:1,return:2,break:3,continue:3};function g(e){var t,n;return function(o){t||(t={stop:function(){return n(o.a,2)},catch:function(){return o.v},abrupt:function(e,t){return n(o.a,p[e],t)},delegateYield:function(e,r,i){return t.resultName=r,n(o.d,l(e),i)},finish:function(e){return n(o.f,e)}},n=function(e,n,r){o.p=t.prev,o.n=t.next;try{return e(n,r)}finally{t.next=o.n}}),t.resultName&&(t[t.resultName]=o.v,t.resultName=void 0),t.sent=o.v,t.next=o.n;try{return e.call(this,t)}finally{o.p=t.prev,o.n=t.next}}}return(t.exports=c=function(){return{wrap:function(t,n,o,r){return e.w(g(t),n,o,r&&r.reverse())},isGeneratorFunction:f,mark:e.m,awrap:function(e,t){return new o(e,t)},AsyncIterator:a,async:function(e,t,n,o,r){return(f(t)?s:i)(g(e),t,n,o,r)},keys:u,values:l}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},{15:15,39:39,40:40,41:41,42:42,44:44,46:46}],46:[function(e,t,n){var o=e(54).default;t.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(o(e)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},{54:54}],47:[function(e,t,n){function o(e,n){return t.exports=o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},t.exports.__esModule=!0,t.exports.default=t.exports,o(e,n)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],48:[function(e,t,n){var o=e(17),r=e(34),i=e(55),s=e(35);t.exports=function(e,t){return o(e)||r(e,t)||i(e,t)||s()},t.exports.__esModule=!0,t.exports.default=t.exports},{17:17,34:34,35:35,55:55}],49:[function(e,t,n){var o=e(28);t.exports=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e},t.exports.__esModule=!0,t.exports.default=t.exports},{28:28}],50:[function(e,t,n){var o=e(17),r=e(33),i=e(55),s=e(35);t.exports=function(e){return o(e)||r(e)||i(e)||s()},t.exports.__esModule=!0,t.exports.default=t.exports},{17:17,33:33,35:35,55:55}],51:[function(e,t,n){var o=e(18),r=e(33),i=e(55),s=e(36);t.exports=function(e){return o(e)||r(e)||i(e)||s()},t.exports.__esModule=!0,t.exports.default=t.exports},{18:18,33:33,36:36,55:55}],52:[function(e,t,n){var o=e(54).default;t.exports=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{54:54}],53:[function(e,t,n){var o=e(54).default,r=e(52);t.exports=function(e){var t=r(e,"string");return"symbol"==o(t)?t:t+""},t.exports.__esModule=!0,t.exports.default=t.exports},{52:52,54:54}],54:[function(e,t,n){function o(e){return t.exports=o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],55:[function(e,t,n){var o=e(16);t.exports=function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},{16:16}],56:[function(e,t,n){var o=e(28),r=e(47),i=e(31),s=e(23);function a(e){var n="function"==typeof Map?new Map:void 0;return t.exports=a=function(e){if(null===e||!i(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return s(e,arguments,o(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports,a(e)}t.exports=a,t.exports.__esModule=!0,t.exports.default=t.exports},{23:23,28:28,31:31,47:47}],57:[function(e,t,n){var o="undefined"!=typeof self?self:this,r=function(){function e(){this.fetch=!1,this.DOMException=o.DOMException}return e.prototype=o,new e}();!function(e){!function(t){var n="URLSearchParams"in e,o="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function g(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function h(e){var t=new FileReader,n=g(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&r&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var e,t,n,o=p(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=g(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(e,t){e=l(e),t=c(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},f.prototype.delete=function(e){delete this.map[l(e)]},f.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},f.prototype.set=function(e,t){this.map[l(e)]=c(t)},f.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},f.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),d(e)},f.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),d(e)},f.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),d(e)},o&&(f.prototype[Symbol.iterator]=f.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function k(e,t){var n,o,r=(t=t||{}).body;if(e instanceof k){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(n=t.method||this.method||"GET",o=n.toUpperCase(),m.indexOf(o)>-1?o:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function T(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(r))}})),t}function S(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})},v.call(k.prototype),v.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},S.error=function(){var e=new S(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];S.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new S(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function C(e,n){return new Promise((function(o,i){var s=new k(e,n);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),o=n.shift().trim();if(o){var r=n.join(":").trim();t.append(o,r)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;o(new S(r,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",u)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}C.polyfill=!0,e.fetch||(e.fetch=C,e.Headers=f,e.Request=k,e.Response=S),t.Headers=f,t.Request=k,t.Response=S,t.fetch=C,Object.defineProperty(t,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;(n=i.fetch).default=i.fetch,n.fetch=i.fetch,n.Headers=i.Headers,n.Request=i.Request,n.Response=i.Response,t.exports=n},{}],58:[function(e,t,n){"use strict";function o(e){if(this._capacity=i(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,o=this._capacity,r=0;r<e;++r)t[r]=this[n+r&o-1];return t},o.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var o=this._capacity;if(n+t>o){for(var r=0;r<t;++r){this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n}return n}for(var i=this._front,r=0;r<t;++r)this[i+n&o-1]=arguments[r],i++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},o.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var o=n-1;o>=0;o--){this._checkCapacity(t+1);var r=this._capacity;this[s=(this._front-1&r-1^r)-r]=arguments[o],t++,this._length=t,this._front=s}return t}var i=this._front;for(o=n-1;o>=0;o--){var s;this[s=(i-1&r-1^r)-r]=arguments[o],i=s}return this._front=i,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);r=this._capacity;return this[o=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,o=0;o<e;++o)this[t+o&n-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(i(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length;n+o>t&&function(e,t,n,o,r){for(var i=0;i<r;++i)n[i+o]=e[i+t],e[i+t]=void 0}(this,0,this,t,n+o&t-1)};var r=Array.isArray;function i(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}t.exports=o},{}],59:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,o||e,i),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},l.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,o,i,s){var a=r?r+e:e;if(!this._events[a])return!1;var u,l,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,i),!0;case 6:return c.fn.call(c.context,t,n,o,i,s),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,o);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||u(this,i);else{for(var a=0,l=[],c=s.length;a<c;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&l.push(s[a]);l.length?this._events[i]=1===l.length?l[0]:l:u(this,i)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,void 0!==t&&(t.exports=l)},{}],60:[function(e,t,n){"use strict";t.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var o,r,i;if(Array.isArray(t)){if((o=t.length)!=n.length)return!1;for(r=o;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((o=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=o;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=o;0!=r--;){var s=i[r];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n}},{}],61:[function(e,t,n){(function(e){(function(){!function(e){function t(){}function n(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===r.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function o(e){for(var t=0,n=Math.min(65536,e.length+1),o=new Uint16Array(n),r=[],i=0;;){var s=t<e.length;if(!s||i>=n-1){if(r.push(String.fromCharCode.apply(null,o.subarray(0,i))),!s)return r.join("");e=e.subarray(t),i=t=0}if(0==(128&(s=e[t++])))o[i++]=s;else if(192==(224&s)){var a=63&e[t++];o[i++]=(31&s)<<6|a}else if(224==(240&s)){a=63&e[t++];var u=63&e[t++];o[i++]=(31&s)<<12|a<<6|u}else if(240==(248&s)){65535<(s=(7&s)<<18|(a=63&e[t++])<<12|(u=63&e[t++])<<6|63&e[t++])&&(s-=65536,o[i++]=s>>>10&1023|55296,s=56320|1023&s),o[i++]=s}}}if(e.TextEncoder&&e.TextDecoder)return!1;var r=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,o=0,r=Math.max(32,n+(n>>>1)+7),i=new Uint8Array(r>>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(o+4>i.length&&(r+=8,r=(r*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(r)).set(i),i=a),0==(4294967168&s))i[o++]=s;else{if(0==(4294965248&s))i[o++]=s>>>6&31|192;else if(0==(4294901760&s))i[o++]=s>>>12&15|224,i[o++]=s>>>6&63|128;else{if(0!=(4292870144&s))continue;i[o++]=s>>>18&7|240,i[o++]=s>>>12&63|128,i[o++]=s>>>6&63|128}i[o++]=63&s|128}}return i.slice?i.slice(0,o):i.subarray(0,o)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1});var i=o;"function"==typeof Buffer&&Buffer.from?i=function(e){return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(i=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return o(e)}finally{URL.revokeObjectURL(t)}}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),i(e)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],62:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(37)),i=o(e(45)),s=o(e(20));Object.defineProperty(n,"__esModule",{value:!0});var a=e(63);var u=["get","getKey","getAll","getAllKeys","count"],l=["put","add","delete","clear"],c=new Map;function d(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(c.get(t))return c.get(t);var n=t.replace(/FromIndex$/,""),o=t!==n,r=l.indexOf(n)>=0;if(n in(o?IDBIndex:IDBObjectStore).prototype&&(r||u.indexOf(n)>=0)){var a=function(){var e=(0,s.default)((0,i.default)().mark((function e(t){var s,a,u,l,c,d,f=arguments;return(0,i.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=this.transaction(t,r?"readwrite":"readonly"),u=a.store,l=f.length,c=new Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=f[d];return o&&(u=u.index(c.shift())),e.next=6,Promise.all([(s=u)[n].apply(s,c),r&&a.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return c.set(t,a),a}}}a.replaceTraps((function(e){return(0,r.default)((0,r.default)({},e),{},{get:function(t,n,o){return d(t,n)||e.get(t,n,o)},has:function(t,n){return!!d(t,n)||e.has(t,n)}})})),n.unwrap=a.unwrap,n.wrap=a.wrap,n.deleteDB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,o=indexedDB.deleteDatabase(e);return n&&o.addEventListener("blocked",(function(){return n()})),a.wrap(o).then((function(){}))},n.openDB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.blocked,r=n.upgrade,i=n.blocking,s=n.terminated,u=indexedDB.open(e,t),l=a.wrap(u);return r&&u.addEventListener("upgradeneeded",(function(e){r(a.wrap(u.result),e.oldVersion,e.newVersion,a.wrap(u.transaction))})),o&&u.addEventListener("blocked",(function(){return o()})),l.then((function(e){s&&e.addEventListener("close",(function(){return s()})),i&&e.addEventListener("versionchange",(function(){return i()}))})).catch((function(){})),l}},{20:20,30:30,37:37,45:45,63:63}],63:[function(e,t,n){"use strict";var o,r,i=function(e,t){return t.some((function(t){return e instanceof t}))};var s=new WeakMap,a=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap;var d={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).indexOf(e)>=0?function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.apply(h(this),n),g(s.get(this))}:function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return g(e.apply(h(this),n))}:function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];var i=e.call.apply(e,[h(this),t].concat(o));return u.set(i,t.sort?t.sort():[t]),g(i)}}function p(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(!a.has(e)){var t=new Promise((function(t,n){var o=function(){e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=function(){t(),o()},i=function(){n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));a.set(e,t)}}(e),i(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function g(e){if(e instanceof IDBRequest)return t=e,(n=new Promise((function(e,n){var o=function(){t.removeEventListener("success",r),t.removeEventListener("error",i)},r=function(){e(g(t.result)),o()},i=function(){n(t.error),o()};t.addEventListener("success",r),t.addEventListener("error",i)}))).then((function(e){e instanceof IDBCursor&&s.set(e,t)})).catch((function(){})),c.set(n,t),n;var t,n;if(l.has(e))return l.get(e);var o=p(e);return o!==e&&(l.set(e,o),c.set(o,e)),o}var h=function(e){return c.get(e)};n.instanceOfAny=i,n.replaceTraps=function(e){d=e(d)},n.reverseTransformCache=c,n.unwrap=h,n.wrap=g},{}],64:[function(e,t,n){(function(e){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=null;"undefined"!=typeof WebSocket?t=WebSocket:"undefined"!=typeof MozWebSocket?t=MozWebSocket:void 0!==e?t=e.WebSocket||e.MozWebSocket:"undefined"!=typeof window?t=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(t=self.WebSocket||self.MozWebSocket);n.default=t}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],65:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(66),n)},{66:66}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isStopWorkflowMessage=n.setStopAndFilterWorkflowMessage=n.setMessageException=n.getMessageExceptionType=n.getMessageExceptionDescription=n.filterWorkflowSchema=n.exceptionSchema=void 0;var o=e(190);n.exceptionSchema={category:o.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},n.filterWorkflowSchema={category:o.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}};n.getMessageExceptionDescription=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e)return"Invalid message passed";if(null==e.payload)return"".concat(o.ExceptionType[o.ExceptionType.NoOutput],": Payload is null");if(null==e.payload.exceptionType)return"Payload is not an exception";var n=o.ExceptionType[e.payload.exceptionType];return n+=e.payload.message?": ".concat(e.payload.message):": No description",n+=t&&e.payload.data?"\n".concat(e.payload.data.toString()):""};n.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?o.ExceptionType.Unknown:e.payload.exceptionType};n.setMessageException=function(e,t){if(null==e)throw new Error("Cannot set exception on null message");e.payload=t,e.payloadSchema=n.exceptionSchema,e.messageType=o.MessageType.Exception};n.setStopAndFilterWorkflowMessage=function(e,t){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:t};e.payload=r,e.payloadSchema=n.filterWorkflowSchema,e.messageType=o.MessageType.StopAndFilterWorkflow};n.isStopWorkflowMessage=function(e){return(e||{}).messageType==o.MessageType.StopAndFilterWorkflow}},{190:190}],67:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(72),n),o.__exportStar(e(73),n)},{72:72,73:73}],68:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ReduceTimerCache=void 0;var s=function(){return(0,i.default)((function e(){(0,r.default)(this,e),this.cache=new Map}),[{key:"setReduceTimer",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return!1},s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5e3;this.cache.has(e)||this.cache.set(e,new Map);var a=this.cache.get(e);a.has(t)&&clearTimeout(a.get(t).timer);var u=function(){var u=a.get(t),l=Date.now()-u.start;i()&&l<s?u.timer=setTimeout(u.timerCallback,Math.min(r,s-l)):(a.size>1?a.delete(t):o.cache.delete(e),n())};a.set(t,{start:Date.now(),timerCallback:u,timer:setTimeout(u,r)})}},{key:"clear",value:function(e,t){this.cache.forEach((function(n,o){e&&e!==o||n.forEach((function(e,n){t&&t!==n||clearTimeout(e.timer)}))})),this.cache.clear()}}])}();n.ReduceTimerCache=s},{22:22,24:24,30:30}],69:[function(e,t,n){"use strict";var o=(0,e(30).default)(e(25));Object.defineProperty(n,"__esModule",{value:!0}),n.executeRemoteLambda=n.clearTokenCache=void 0;var r,i=e(105),s=e(156),a=e(190),u=e(75);n.clearTokenCache=function(){r=new u.TokenCache},(0,n.clearTokenCache)();var l=function e(t,n,u,l,c,d,f,p,g,h){var y={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":c},body:JSON.stringify({payload:n.payload,payloadSchema:u,requestedSchema:l,clientMetadata:d,tokens:r.getAuthTokenEntries(f,g.docId)})};(0,s.internalFetch)(t,y,(function(s,y){s?h(new Error("Fetch error in remote lambda request to ".concat(t,": ").concat(s))):401===y.status?p>0?(i.Log.info(572838109,i.LogCategory.CoreDefault,"Auth token required for remote lambda request"),y.json().then((function(e){return r.updateAuthToken(f,{Tickets:[e],DocId:g.docId})})).then((function(){e(t,n,u,l,c,d,f,p-1,g,h)})).catch((function(e){h({exceptionType:a.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:a.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):y.ok?y.json().then((function(e){if(Array.isArray(e))if(e.length>0){var t,r=0,i=(0,o.default)(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;n.moreResults=++r<e.length,h(null,s)}}catch(e){i.e(e)}finally{i.f()}}else h(new Error("No output"));else h(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){h({exceptionType:a.ExceptionType.LambdaThrow,message:e.message})})):h(new Error("Remote lambda request failed with status ".concat(y.status)))}))};n.executeRemoteLambda=function(e,t,n,o,i,s,u,c,d){Array.isArray(c.authTickets)?r.updateAuthToken(u,{Tickets:c.authTickets,DocId:c.docId}).then((function(){l(e,t,n,o,i.id,s,u,1,c,d)})).catch((function(e){d({exceptionType:a.ExceptionType.Authentication,message:e.message})})):l(e,t,n,o,i.id,s,u,1,c,d)}},{105:105,156:156,190:190,25:25,30:30,75:75}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.testWebSocketConnection=n.executeRemoteLambda=n.clearTokenCache=void 0;var o,r=e(105),i=e(77),s=e(190),a=e(75),u=e(76);n.clearTokenCache=function(){o=new a.TokenCache},(0,n.clearTokenCache)();var l=new u.WebSocketRequestManager(3e4,(function(){return new i.WebSocketWorker}),50),c=function e(t,n,i,a,u,c,d,f,p,g){var h={payload:n.payload,payloadSchema:i,requestedSchema:a,clientMetadata:c,tokens:o.getAuthTokenEntries(d,p.docId)},y="";a&&a.schema&&(y=a.schema.name);var v=!1;l.addRequest(t,h,u,y,(function(l,h,y){if(!v)if(v=!0,null!=h)if(h.exceptionType===s.ExceptionType.Authentication)try{var m=JSON.parse(h.data);f>0?(r.Log.info(572838108,r.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),o.updateAuthToken(d,{Tickets:[m],DocId:p.docId}).then((function(){e(t,n,i,a,u,c,d,f-1,p,g)})).catch((function(e){g({exceptionType:s.ExceptionType.Authentication,message:e.message})}))):g({exceptionType:s.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){g({exceptionType:s.ExceptionType.Authentication,message:e.message})}else g(new Error("Error in remote lambda WebSocket request to ".concat(t,": ").concat(h)));else n.moreResults=!1,g(null,l)}))};n.executeRemoteLambda=function(e,t,n,r,i,a,u,l,d){Array.isArray(l.authTickets)?o.updateAuthToken(u,{Tickets:l.authTickets,DocId:l.docId}).then((function(){c(e,t,n,r,i.id,a,u,1,l,d)})).catch((function(e){d({exceptionType:s.ExceptionType.Authentication,message:e.message})})):c(e,t,n,r,i.id,a,u,1,l,d)};n.testWebSocketConnection=function(e,t){return l.testConnection(e,t)}},{105:105,190:190,75:75,76:76,77:77}],71:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ResultCache=void 0;var s=function(){return(0,i.default)((function e(){(0,r.default)(this,e),this.cache=new Map,this.bucketSizes=new Map}),[{key:"setBucketSize",value:function(e,t){this.bucketSizes.set(e,t)}},{key:"setResult",value:function(e,t,n){if(t.primary){var o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));var r=o.get(t.primary);if(r||(r=t.secondary?new Map:[],o.set(t.primary,r)),t.secondary){r.set(t.secondary,n)}else{var i=r;i.length==this.getBucketSize(e)&&i.shift(),i.push(n)}}}},{key:"getResults",value:function(e,t){var n=this.cache.get(e);if(n){var o=n.get(t.primary);if(o){if(!t.secondary)return o;var r=Array.from(o.values());if(r.length>0)return r}}return[]}},{key:"clear",value:function(e,t){t?this.cache.forEach((function(n,o){if(!e||e===o)if(t.secondary){var r=n.get(t.primary);r&&r.delete(t.secondary)}else n.delete(t.primary)})):e?this.cache.delete(e):this.cache.clear()}},{key:"getBucketSize",value:function(e){return this.bucketSizes.get(e)||10}}])}();n.ResultCache=s},{22:22,24:24,30:30}],72:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(54)),i=o(e(51)),s=o(e(25)),a=o(e(22)),u=o(e(24)),l=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.runtimeALv1=n.ClientRuntimeALv1=n.getTypeFromSchema=n.Workflow=void 0;var c,d=e(65),f=e(105),p=e(156),g=e(190),h=e(245),y=e(250),v=e(68),m=l.__importStar(e(69)),k=l.__importStar(e(70)),T=e(71),S=e(73),b=e(74);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(c||(c={}));var C=function(){function e(){(0,a.default)(this,e),this.canaryTextTileEventSubmittedByDocSessionId=new Set,this.stateByDocSessionId=new Map,this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map}return(0,u.default)(e,[{key:"getOutputSchema",value:function(){return this.lambdas[this.lambdas.length-1].outputSchema}},{key:"scheduleExecution",value:function(e,t){var n=this.docSessionIdExtractor?this.docSessionIdExtractor(e):void 0,o=this.getStateForDocSessionId(n);if(o===c.Restricted){var r=this.getExecutionQueueForDocSessionId(n);r.push(t),1===r.length&&t()}else o===c.Unrestricted?t():c.Suppressed}},{key:"onStart",value:function(e){this.incrementExecutionCountForDocSessionId(e)}},{key:"onFinish",value:function(e,t){if(this.decrementExecutionCountForDocSessionId(e),t===g.ExceptionType.Authentication)this.stateByDocSessionId.set(e,c.Suppressed),this.executionQueueByDocSessionId.delete(e);else if(this.stateByDocSessionId.get(e)===c.Restricted){var n=this.getExecutionQueueForDocSessionId(e);if(n.shift(),void 0===t){this.stateByDocSessionId.set(e,c.Unrestricted),this.executionQueueByDocSessionId.delete(e);var o,r=(0,s.default)(n);try{for(r.s();!(o=r.n()).done;){(0,o.value)()}}catch(e){r.e(e)}finally{r.f()}}else if(n.length>0){(0,n[0])()}}}},{key:"onRefresh",value:function(e){this.stateByDocSessionId=new Map,this.triggerOnRefresh&&(e?(this.executionQueueByDocSessionId.delete(e),this.executionCountByDocSessionId.delete(e)):(this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map)),this.canaryTextTileEventSubmittedByDocSessionId.delete(e)}},{key:"getStateForDocSessionId",value:function(t){var n=this.stateByDocSessionId.get(t);return void 0===n&&(n=e.executionQueuesEnabled?c.Restricted:c.Unrestricted,this.stateByDocSessionId.set(t,n)),n}},{key:"getExecutionQueueForDocSessionId",value:function(e){var t=this.executionQueueByDocSessionId.get(e);return void 0===t&&(t=[],this.executionQueueByDocSessionId.set(e,t)),t}},{key:"incrementExecutionCountForDocSessionId",value:function(e){var t=this.executionCountByDocSessionId.get(e)||0;this.executionCountByDocSessionId.set(e,t+1)}},{key:"decrementExecutionCountForDocSessionId",value:function(e){var t=this.executionCountByDocSessionId.get(e)||0;t<=1?this.executionCountByDocSessionId.delete(e):this.executionCountByDocSessionId.set(e,t-1)}}])}();n.Workflow=C,C.executionQueuesEnabled=!0;n.getTypeFromSchema=function(e){return{category:g.TypeCategory.Schema,schema:{name:e}}};var w="Tiling.TextTileEvent",_=function(e,t){return e===w&&t&&t.type==g.Tiling.TextTileEventType.Refresh},M=function(e,t){return"ClpSlideTile"===e&&t&&t.eventType==g.Ppt.SlideTileEventType.Refresh},A=function(e,t){return _(e,t)||M(e,t)},O=function(e,t){var n,o;return e===w?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.docSessionId:"ClpSlideTile"===e?t.docId:void 0},I=function(e){return{type:e.type,tile:{metadata:{docSessionId:e.tile.metadata.docSessionId,docId:e.tile.metadata.docId,seqnoCLPRefresh:e.tile.metadata.seqnoCLPRefresh,tileId:"A56B3127DBDFD0D6"},elements:[{text:"B91153AE828B4E48"}]}}},x=function(){return(0,u.default)((function e(){(0,a.default)(this,e),this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new T.ResultCache,this.reduceTimerCache=new v.ReduceTimerCache,this.lookupTableCache=new Map,this.throttling=new b.ExecutionWithThrottling,this.lastTileRefreshSeq=-1,this.lastTileRefreshSeqByDocSessionId=new Map,this.tileRefreshByDocSessionIdEnabled=!0}),[{key:"init",value:function(e,t,n){var o=this,r=new f.Operation({operationName:"InitRuntimeALv1",resourceId:(0,p.scrubEuiiInUrl)(e)});r.start(),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,p.getVersion)(),this.clientMetadata.flights&&(this.clientMetadata.flights=(0,y.removeDuplicateFlights)(this.clientMetadata.flights))),this.hostCallbacks=n;var i=[];return i.push(this.isFeatureEnabled("DisableWebSocket").then((function(n){if(!!n)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf("".concat(t.appName," ").concat(t.appPlatform))>=0)||k.testWebSocketConnection(p.Utils.convertServiceUrlToWebSocket(e),o.clientMetadata)})).then((function(t){e&&(o.serviceUrl=t?p.Utils.convertServiceUrlToWebSocket(e):e,o.executeRemoteLambda=t?k.executeRemoteLambda:m.executeRemoteLambda,o.clearRemoteLambdaTokenCache=t?k.clearTokenCache:m.clearTokenCache,o.serviceProtocol=o.serviceUrl.split(":")[0].toLowerCase())}))),i.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){C.executionQueuesEnabled=!e}))),i.push(this.isFeatureEnabled("TileRefreshByDocSessionIdDisabled").then((function(e){o.tileRefreshByDocSessionIdEnabled=!e}))),Promise.all(i).then((function(){o.logOperation(r,!0)})).catch((function(e){o.logOperation(r,!1,"Error",e?e.message:"(no error)")}))}},{key:"getServiceProtocol",value:function(){return this.serviceProtocol}},{key:"registerSchemas",value:function(e,t){return Promise.resolve()}},{key:"registerSimpleLocalWorkflow",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultWorkflowOptions;return t.source=t.source||S.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,n)}},{key:"registerSimpleRemoteWorkflow",value:function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.defaultWorkflowOptions,i=[];return t&&(t.source=S.LambdaSource.Custom,i.push(t)),n.source=n.func?S.LambdaSource.Custom:S.LambdaSource.Remote,i.push(n),o&&(o.source=S.LambdaSource.Custom,i.push(o)),this.registerHardcodedWorkflow(e,i,this.inputSchemasToWorkflows,r)}},{key:"registerMultipleLambdasWorkflow",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultWorkflowOptions;return this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,n)}},{key:"registerReduceWorkflow",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.defaultWorkflowOptions;return this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,n),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||S.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)}},{key:"registerMultipleLambdasReduceWorkflow",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.defaultWorkflowOptions;return this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,n),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)}},{key:"submit",value:function(e,t,n){this.submitToWorkflows(e,t,n,this.inputSchemasToWorkflows)}},{key:"getGroupingKey",value:function(e,t,n){var o=this.reduceWorkflowsGroupingKeyExtractors.get(n);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)}},{key:"submitToWorkflows",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.inputSchemasToWorkflows;if(this.hostCallbacks){var r;r=n?f.CorrelationVector.fromString(n):new f.CorrelationVector,this.handleTileRefresh(e,t,r);var i,a=o.get(e)||[],u=(0,s.default)(a);try{for(u.s();!(i=u.n()).done;){var l=i.value;A(e,t)&&!l.triggerOnRefresh||(l.useCanaryTextTile&&e===w&&!l.canaryTextTileEventSubmittedByDocSessionId.has(O(e,t))&&(this.submitToWorkflow(w,I(t),r,l,o),l.canaryTextTileEventSubmittedByDocSessionId.add(O(e,t))),this.submitToWorkflow(e,t,r,l,o))}}catch(e){u.e(e)}finally{u.f()}}}},{key:"submitToWorkflow",value:function(e,t,o,r,i){var s=this,a={messageType:g.MessageType.Input,correlationVector:o.newChild(),payload:t,payloadSchema:(0,n.getTypeFromSchema)(r.lambdas[0].inputSchema),clientMetadata:this.clientMetadata},u=new f.Operation({cv:a.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:r.name});u.setClientMetadata(this.clientMetadata),u.start(),r.scheduleExecution(t,(function(){try{if(a.payload&&a.payload.tile&&a.payload.tile.metadata&&a.payload.tile.metadata.tileId){var n=a.payload.tile.metadata.tileId;s.throttling.execute(n,r,(function(){return s.executeWorkflow(u,a,t,r,e,i)}))}else s.executeWorkflow(u,a,t,r,e,i)}catch(e){u.success=!1,u.resultSignature="ExecuteException",u.resultDescription=e?e.message:"(no error)",f.Log.error(559290447,f.LogCategory.CoreDefault,u.stop())}}))}},{key:"handleTileRefresh",value:function(e,t,n){var o=this;if(A(e,t)){var r=this.tileRefreshByDocSessionIdEnabled?O(e,t):void 0,s=function(e,t){var n,o;return _(e,t)?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.seqnoCLPRefresh:(M(e,t),-1)}(e,t);if(this.tileRefreshByDocSessionIdEnabled){var a=this.lastTileRefreshSeqByDocSessionId.get(r);if(a>=0&&s<=a)return}else if(s<=this.lastTileRefreshSeq)return;var u=new f.Operation({cv:n.toString(),operationName:"TileRefresh",resultDescription:"",success:!0});if(u.start(),this.tileRefreshByDocSessionIdEnabled&&!r)return u.success=!1,u.resultDescription="NoDocSessionId",void f.Log.info(559290448,f.LogCategory.CoreDefault,u.stop());this.inputSchemasToReduceWorkflows.forEach((function(e,t){e.some((function(e){return e.triggerOnRefresh}))&&(o.tileRefreshByDocSessionIdEnabled?(o.resultCache.clear(t,{primary:r}),o.resultCache.clear(o.getForcedDocLevelSchema(t),{primary:r}),o.reduceTimerCache.clear(t,r)):(o.resultCache.clear(t),o.resultCache.clear(o.getForcedDocLevelSchema(t)),o.reduceTimerCache.clear(t)),e.some((function(e){return!e.triggerOnRefresh}))&&(u.resultDescription+="X_"),u.resultDescription+=t+" ")})),this.clearRemoteLambdaTokenCache();var l=[];this.inputSchemasToWorkflows.forEach((function(e){return l.push.apply(l,(0,i.default)(e))})),this.inputSchemasToReduceWorkflows.forEach((function(e){return l.push.apply(l,(0,i.default)(e))}));for(var c=0,d=l;c<d.length;c++){var p=d[c];this.tileRefreshByDocSessionIdEnabled?p.onRefresh(r):p.onRefresh()}this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.set(r,s):this.lastTileRefreshSeq=s,f.Log.info(559290449,f.LogCategory.CoreDefault,u.stop())}}},{key:"executeWorkflow",value:function(e,t,n,o,r,i){var s=this,a=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,u=o.docSessionIdExtractor(n),l=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(u):this.lastTileRefreshSeq;o.onStart(u);var c=function(t){var a=s.tileRefreshByDocSessionIdEnabled?s.lastTileRefreshSeqByDocSessionId.get(u):s.lastTileRefreshSeq;if(o.triggerOnRefresh&&a!==l)return e.success=!0,e.resultSignature="TileRefreshIgnore",void f.Log.info(559290450,f.LogCategory.CoreDefault,e.stop());var c=t.messageType==g.MessageType.Exception&&t.payload.exceptionType==g.ExceptionType.NoOutput,p=c&&o.canProduceNullResult,h=p?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,y=p?null:t.payload;t.messageType===g.MessageType.Input||p?(o.shouldSendResultsToHost&&(i===s.inputSchemasToReduceWorkflows?s.hostCallbacks.onResult("Reduce.Input",n,h,y):s.hostCallbacks.onResult(r,n,h,y)),e.success=!0,e.resultSignature=c?"NoOutput":"ValidOutput"):c?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=(0,d.getMessageExceptionDescription)(t)),i!==s.inputSchemasToReduceWorkflows&&s.updateResultCacheForReduceWorkflows(r,n,h,y,t.correlationVector.toString()),t.moreResults||(e.stop(),f.Log.info(559290451,f.LogCategory.CoreDefault,e),o.onFinish(u,t.payload&&t.payload.exceptionType?(0,d.getMessageExceptionType)(t):void 0))};o.preExecutionPromise.then((function(){for(var e={lookupTable:s.lookupTableCache.get(o.name),docId:a,docSessionId:u},n=c,r=o.lambdas.length-1;r>=0;r--)n=s.createLambdaExecutionStep(o.name,o.lambdas[r],e,n,c);n(t)}))}},{key:"getForcedDocLevelSchema",value:function(e){return"~".concat(e)}},{key:"updateResultCacheForReduceWorkflows",value:function(e,t,n,o,s){var a=this,u=this.inputSchemasToReduceWorkflows.get(n);if(u){var l;"docSessionId"===e?(l=this.getGroupingKey(e,t,n),this.resultCache.setResult(this.getForcedDocLevelSchema(n),l,o),l.secondary="*"):(l=this.getGroupingKey(e,t,n),!function(e,t){return e===w&&t&&t.type==g.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==g.Ppt.SlideTileEventType.Delete}(e,t)||null==l.primary||null==l.secondary?this.resultCache.setResult(n,l,o):this.resultCache.clear(void 0,l));var c=u.some((function(e){return e.deferReduceUntilIdle})),d=[];this.inputSchemasToWorkflows.forEach((function(e){return d.push.apply(d,(0,i.default)(e.filter((function(e){return e.getOutputSchema()===n}))))}));var p=u.map((function(e){return e.deferReduceUntilIdleMaxDelayMs||0})).reduce((function(e,t){return Math.max(e,t)}));this.reduceTimerCache.setReduceTimer(n,l.primary,(function(){var e=a.resultCache.getResults(n,l);if(e.push.apply(e,(0,i.default)(a.resultCache.getResults(a.getForcedDocLevelSchema(n),{primary:l.primary}))),Array.isArray(e)){var t={id:l.primary,values:e,isReduceInput:!0};a.submitToWorkflows(n,t,s,a.inputSchemasToReduceWorkflows)}else f.Log.error(559290452,f.LogCategory.CoreDefault,'Cached results have unexpected type "'.concat((0,r.default)(e),'"'))}),500,(function(){return c&&d.some((function(e){return e.executionCountByDocSessionId.get(l.primary)>0}))}),p)}}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"None";return this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)}},{key:"areLicenseFeaturesEnabled",value:function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)}},{key:"isWorkflowEnabled",value:function(e,t,n,o,r){var i,s=this;if(t.some((function(e){return e.source===S.LambdaSource.Remote||e.source===S.LambdaSource.BatchedRemote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return(e.source===S.LambdaSource.Remote||e.source===S.LambdaSource.BatchedRemote)&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,r.resultDescription="Enabled by default due to platform name"),i=o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e),i.then((function(t){return t?s.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!n||s.areLicenseFeaturesEnabled(n).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))}},{key:"registerHardcodedWorkflow",value:function(e,t){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.inputSchemasToWorkflows,i=arguments.length>3?arguments[3]:void 0;if(!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");r.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var s=new f.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return s.setClientMetadata(this.clientMetadata),s.start(),this.isWorkflowEnabled(e,t,i.licenseFeatures,i.enabledByDefault,s).then((function(a){if(s.resultSignature=a?"Enabled":"Disabled",s.stop(),f.Log.info(559290453,f.LogCategory.CoreDefault,s),a){var u=t[0].inputSchema,l=r.get(u);l||(l=[],r.set(u,l));var c=Promise.resolve();i.lookupTableLambda&&(c=new Promise((function(t,r){var s=new f.CorrelationVector,a={messageType:g.MessageType.Input,correlationVector:s,payloadSchema:(0,n.getTypeFromSchema)(i.lookupTableLambda.inputSchema),clientMetadata:o.clientMetadata,payload:{}},u=function(n){n.messageType===g.MessageType.Input&&n.payload&&o.lookupTableCache.set(e,n.payload),t()};o.createLambdaExecutionStep("",i.lookupTableLambda,{},u,u)(a)})));var d=new C;d.name=e,d.lambdas=t,d.canProduceNullResult=i.canProduceNullResult,d.shouldSendResultsToHost=i.shouldSendResultsToHost,d.triggerOnRefresh=i.triggerOnRefresh,d.throttleSettings=i.throttleSettings||o.defaultWorkflowOptions.throttleSettings,d.docIdExtractor=i.docIdExtractor,d.docSessionIdExtractor=function(e){return e.isReduceInput?e.id:O(u,e)},d.deferReduceUntilIdle=i.deferReduceUntilIdle,d.deferReduceUntilIdleMaxDelayMs=i.deferReduceUntilIdleMaxDelayMs,d.useCanaryTextTile=i.useCanaryTextTile,d.preExecutionPromise=c,l.push(d)}}))}},{key:"logOperation",value:function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,f.Log.info(559290454,f.LogCategory.CoreDefault,e)}},{key:"handleLambdaError",value:function(e,t,n,o,r){null!=e.exceptionType?(0,d.setMessageException)(t,e):e instanceof Error?(0,d.setMessageException)(t,{exceptionType:o,message:e.message}):(0,d.setMessageException)(t,{exceptionType:g.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(n,!1,"Exception",(0,d.getMessageExceptionDescription)(t)),r(t)}},{key:"handleLambdaOutput",value:function(e,t,o,r,i,s){e&&e.exceptionType!==g.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,t,o,e.exceptionType,s):e instanceof Error?this.handleLambdaError(e,t,o,g.ExceptionType.LambdaErrorCallback,s):(t.payload=e,t.payloadSchema=(0,n.getTypeFromSchema)(r),this.logOperation(o,!0),i(t)):((0,d.setMessageException)(t,{exceptionType:g.ExceptionType.NoOutput}),this.logOperation(o,!0,"NoOutput"),s(t))}},{key:"executeCustomLambdaStep",value:function(e,t,n,o,r,i){var s=this;if(null==n.func)(0,d.setMessageException)(e,{exceptionType:g.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",(0,d.getMessageExceptionDescription)(e)),i(e);else{try{n.func(e.payload,n.config,o,(function(o){s.handleLambdaOutput(o,e,t,n.outputSchema,r,i)}),(function(n,o){s.handleLambdaOutput(n,e,t,o,i,i)}))}catch(n){this.handleLambdaError(n,e,t,g.ExceptionType.LambdaThrow,i)}}}},{key:"executeLocalLambdaStep",value:function(e,t,n,o,r){var i=this;null==this.hostCallbacks.executeLocalLambda?((0,d.setMessageException)(e,{exceptionType:g.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",(0,d.getMessageExceptionDescription)(e)),r(e)):this.hostCallbacks.executeLocalLambda(n.inputSchema,e.payload,n.outputSchema).then((function(s){i.handleLambdaOutput(s,e,t,n.outputSchema,o,r)})).catch((function(n){i.handleLambdaError(n,e,t,g.ExceptionType.LambdaThrow,r)}))}},{key:"executeRemoteLambdaStep",value:function(e,t,o,r,i,s){var a=this;if(this.serviceUrl){t.resourceId+=".".concat(this.serviceProtocol);var u=function(n,r){n?a.handleLambdaError(n,e,t,n.exceptionType||g.ExceptionType.LambdaErrorCallback,s):a.handleLambdaOutput(r,e,t,o.outputSchema,i,s)};if(r.authTickets=o.authTickets,o.source===S.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,(0,n.getTypeFromSchema)(o.inputSchema),(0,n.getTypeFromSchema)(o.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,u);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new p.BatchManager((function(e,t,o){var r=t.context,i=r.remoteLambda,s=r.lambdaContext;a.executeRemoteLambda(a.serviceUrl,{messageType:g.MessageType.Input,correlationVector:{id:t.cv},payload:e,payloadSchema:(0,n.getTypeFromSchema)(i.inputSchema),clientMetadata:a.clientMetadata},(0,n.getTypeFromSchema)(i.remoteInputSchema),(0,n.getTypeFromSchema)(i.remoteOutputSchema),{id:t.cv},a.clientMetadata,a.hostCallbacks,s,o)}),!1,!1,(function(e,t,n){var o,r=n.lambdaContext;a.updateResultCacheForReduceWorkflows("docSessionId",null!==(o=r.docSessionId)&&void 0!==o?o:r.docId,e,t)})));var l=o.batchOptions,c=this.normalizeBatchOptions(l),f=c.groupingKeyExtractor;c.groupingKeyExtractor=function(e){return"".concat(o.name,"-").concat(f(e))};var h={name:o.name,remoteLambda:o,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,c,h,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,void 0,u)}}else(0,d.setMessageException)(e,{exceptionType:g.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(t,!1,"Error",(0,d.getMessageExceptionDescription)(e)),s(e)}},{key:"createLambdaExecutionStep",value:function(e,t,n,o,r){var i=this;return function(s){var a=new f.Operation({cv:s.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});a.start(),t.source===S.LambdaSource.Custom?i.executeCustomLambdaStep(s,a,t,n,o,r):t.source===S.LambdaSource.Local?i.executeLocalLambdaStep(s,a,t,o,r):t.source===S.LambdaSource.Remote||t.source===S.LambdaSource.BatchedRemote?i.executeRemoteLambdaStep(s,a,t,n,o,r):((0,d.setMessageException)(s,{exceptionType:g.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),i.logOperation(a,!1,"Error",(0,d.getMessageExceptionDescription)(s)),r(s))}}},{key:"normalizeBatchOptions",value:function(e){if(!e)throw new Error("Expected batchConfig");var t=Object.assign({},e);return e.estimateSize||(t.estimateSize=h.estimateSize),t}}])}();n.ClientRuntimeALv1=x,n.runtimeALv1=new x},{105:105,156:156,190:190,22:22,24:24,245:245,25:25,250:250,30:30,51:51,54:54,65:65,68:68,69:69,70:70,71:71,73:73,74:74}],73:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(o||(n.LambdaSource=o={}))},{}],74:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionWithThrottling=void 0;var s=e(156),a=function(){return(0,i.default)((function e(){(0,r.default)(this,e),this.throttleInfoMap=new Map}),[{key:"execute",value:function(e,t,n){var o=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var r=this.getWorkflowThrottleInfo(t.name);if(null==r.currentTileId)r.currentTileId=e,r.timeOfPreviousStartedEvent=s.Utils.getCurrentTimeMs(),n();else if(r.currentTileId===e){var i=s.Utils.getCurrentTimeMs(),a=this.delayTime(r,i,t.throttleSettings.throttlingInterval);a>0?(r.latestCallback=n,null==r.lastTimeout&&(r.lastTimeout=setTimeout((function(){var e=o.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=s.Utils.getCurrentTimeMs(),e.latestCallback()}),a))):(r.timeOfPreviousStartedEvent=i,n())}else null!=r.lastTimeout&&(clearTimeout(r.lastTimeout),r.latestCallback(),r.lastTimeout=void 0),r.currentTileId=e,r.timeOfPreviousStartedEvent=s.Utils.getCurrentTimeMs(),n()}else n()}},{key:"delayTime",value:function(e,t,n){var o=t-e.timeOfPreviousStartedEvent;return Math.max(n-o,0)}},{key:"getWorkflowThrottleInfo",value:function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t}}])}();n.ExecutionWithThrottling=a},{156:156,22:22,24:24,30:30}],75:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(24)),i=o(e(22));Object.defineProperty(n,"__esModule",{value:!0}),n.TokenCache=void 0;var s=e(156),a=function(){return(0,r.default)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:33e5;(0,i.default)(this,e),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=t}),[{key:"updateAuthToken",value:function(e,t){var n=this,o=JSON.stringify(t),r=this.requestRecordMap.get(o);return(void 0===r||this.isTokenExpired(r))&&(r={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request ".concat(o));n.tokenCache.set(o,e.Token)})),requestTime:s.Utils.getCurrentTimeMs()},this.requestRecordMap.set(o,r)),r.requestPromise}},{key:"getAuthTokenEntries",value:function(e,t){var n=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=n.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),n.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var n=e.request;return!t||n.DocId===t})).map((function(t){var o=t.requestKey,r=t.request;return n.isTokenExpired(n.requestRecordMap.get(o))&&n.updateAuthToken(e,r),{ticket:r.Tickets[0],token:n.tokenCache.get(o)}}))}},{key:"isTokenExpired",value:function(e){return s.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs}}])}();n.TokenCache=a},{156:156,22:22,24:24,30:30}],76:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketRequestManager=void 0;var a=e(105),u=e(156),l=function(){return(0,s.default)((function e(t,n,o,r,s,a){(0,i.default)(this,e),this.requestId=t,this.correlationId=n,this.schemaName=o,this.data=r,this.callback=s,this.requestTimeoutInMs=a,this.ended=!1,this.startTime=0}),[{key:"startRequest",value:function(){this.startTime=u.Utils.getCurrentTimeMs()}},{key:"getMsUntilTimeout",value:function(){var e=u.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e}},{key:"endRequest",value:function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)}},{key:"addResponseData",value:function(e){this.invokeCallback(e,null,!1)}},{key:"invokeCallback",value:function(e,t,n){var o=this;new Promise((function(){return o.callback(e,t,n)})).catch((function(e){}))}}])}(),c=function(){return(0,s.default)((function e(t,n,o){(0,i.default)(this,e),this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=t,this.workerFactory=n,this.maxActiveRequests=o}),[{key:"testConnection",value:function(e,t){var n=this,o=!1,r=new a.Operation({cv:(new a.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:(0,u.scrubEuiiInUrl)(e),success:!0}).start();return new Promise((function(i){var s=u.Utils.createHealthCheckRequest(t);e?n.addRequest(e,s,r.cv,"HealthCheckRequest",(function(e,t,n){t&&(r.success=!1,r.resultSignature="Error",r.resultDescription=t.message||t),e&&"OK"===e.status&&(o=!0),n&&(r.success&&!o&&(r.success=!1,r.resultSignature="NoResponseData"),a.Log.info(556617949,a.LogCategory.CoreDefault,r.stop()),i(r.success))})):(r.success=!1,r.resultSignature="EmptyUrl",a.Log.info(557641870,a.LogCategory.CoreDefault,r.stop()),i(r.success))}))}},{key:"addRequest",value:function(e,t,n,o,r){var i=(this.requestCounter++).toString(),s=new l(i,n,o,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(s),this.egressPendingRequests()}},{key:"egressPendingRequests",value:function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress({obj:this.createRequestMessage(e.data,e.requestId,e.correlationId)})}}},{key:"createRequestMessage",value:function(e,t,n){return JSON.stringify({correlationId:n,requestId:t,body:e})}},{key:"onTimeout",value:function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var n=new Error("Request timed out");e.endRequest(n),this.activeRequests.shift(),this.egressPendingRequests()}}},{key:"onMessage",value:function(e){try{for(var t=JSON.parse(e),n=0;n<this.activeRequests.length;n++){var o=this.activeRequests[n];if(o.requestId===t.requestId){t.end?(this.activeRequests.splice(n,1),o.endRequest(t.error),this.egressPendingRequests()):t.body&&o.addResponseData(t.body);break}}}catch(e){a.Log.error(557641871,a.LogCategory.CoreDefault,e)}}},{key:"onClose",value:function(e){var t,n=new Error("Connection closed: ".concat(e)),o=(0,r.default)(this.activeRequests);try{for(o.s();!(t=o.n()).done;){t.value.endRequest(n)}}catch(e){o.e(e)}finally{o.f()}this.activeRequests=[];var i,s=(0,r.default)(this.pendingRequests);try{for(s.s();!(i=s.n()).done;){i.value.endRequest(n)}}catch(e){s.e(e)}finally{s.f()}this.pendingRequests=[],this.worker=void 0}},{key:"getWorker",value:function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),(function(){}),this.onClose.bind(this))),this.worker}}])}();n.WebSocketRequestManager=c},{105:105,156:156,22:22,24:24,25:25,30:30}],77:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24)),s=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorker=void 0;var a=s.__importDefault(e(64)),u=e(105),l=e(156),c=function(){function e(){(0,r.default)(this,e),this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.egressMessageCount=0,this.egressByteCount=0,this.isClosing=!1,this.pendingEgress=[]}return(0,i.default)(e,[{key:"init",value:function(t,n,o,r){var i=this;this.ws=new a.default(t),this.logOp=new u.Operation({operationName:e.className,success:!0,dimension1:"V1"}).start(),this.egressTimer=Date.now(),this.egressMessageCountOp=new u.Operation({operationName:"WSEgressMessageCount",success:!0,dimension1:"V1"}),this.egressByteCountOp=new u.Operation({operationName:"WSEgressByteOrderOfMagnitude",success:!0,dimension1:"V1"}),this.ingressByteCountOp=new u.Operation({operationName:"WSIngressByteOrderOfMagnitude",success:!0,dimension1:"V1"});var s=function(e){i.logPingLatencyOp&&(i.logPingLatencyOp.success=e,u.Log.info(507789790,u.LogCategory.CoreDefault,i.logPingLatencyOp.stop()),i.logPingLatencyOp=void 0)};this.ws.addEventListener("open",(function(t){o(),e.logCountLimiter.log((function(){i.logOp.resourceId="OnOpen",i.logOp.resultDescription="",i.logOp.success=!0,i.logOp.dimension0=i.pendingEgress.length.toString(),u.Log.info(507789789,u.LogCategory.CoreDefault,i.logOp.stop())})),i.hasBeenOpened=!0,i.pendingEgress.forEach((function(e){i.egress({obj:e})})),i.pendingEgress=[],i.pingInterval=setInterval((function(){i.logPingLatencyOp&&(--i.remainingPingFailures,s(!1)),i.remainingPingFailures>0&&i.hasBeenOpened&&i.lastPongTime<i.lastEgressTime&&(i.logPingLatencyOp=new u.Operation({operationName:"Ping",success:!0,dimension0:i.ws.bufferedAmount>=0?i.ws.bufferedAmount.toString().length.toString():void 0,dimension1:"V1"}).start(),i.ws.send(e.pingPongMessage,(function(e){e&&(--i.remainingPingFailures,s(!1))})))}),3e4)})),this.ws.addEventListener("message",(function(t){i.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(s(!0),i.lastPongTime=Date.now()):(i.logIngressCount(t.data),n(t.data))})),this.ws.addEventListener("error",(function(t){i.errorMessage=t.message,e.logCountLimiter.log((function(){i.logOp.resourceId="OnError",i.logOp.resultDescription=i.errorMessage,i.logOp.success=!1,u.Log.info(507789788,u.LogCategory.CoreDefault,i.logOp.stop())})),i.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){i.logOp.resourceId="OnClose",i.logOp.resultDescription=t?"code: ".concat(t.code,". reason: ").concat(t.reason):"",i.logOp.success=!0,u.Log.info(507789787,u.LogCategory.CoreDefault,i.logOp.stop())})),i.pingInterval&&(clearInterval(i.pingInterval),i.pingInterval=void 0),r(i.errorMessage),i.isClosing=!1}))}},{key:"egress",value:function(t){var n=this,o=t.obj;this.logEgressCount(o instanceof ArrayBuffer||o instanceof Uint8Array?o.byteLength:o.length),this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(o,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnFirstEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,u.Log.info(507789786,u.LogCategory.CoreDefault,n.logOp.stop())})))})):this.pendingEgress.push(o)}},{key:"close",value:function(){this.isClosing||(this.isClosing=!0,this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close())}},{key:"logEgressCount",value:function(e){var t=Date.now(),n=t-this.egressTimer;n>1e3&&(this.egressMessageCount>50&&(this.egressMessageCountOp.start(),this.egressMessageCountOp.resultDescription="Egress message count: "+this.egressMessageCount.toString()+", Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+n.toString(),u.Log.info(507789785,u.LogCategory.CoreDefault,this.egressMessageCountOp.stop())),this.egressByteCount>1e5&&(this.egressByteCountOp.start(),this.egressByteCountOp.dimension2=this.egressByteCount.toString().length.toString(),this.egressMessageCountOp.resultDescription="Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+n.toString(),u.Log.info(507789784,u.LogCategory.CoreDefault,this.egressByteCountOp.stop())),this.egressTimer=t,this.egressMessageCount=0,this.egressByteCount=0),this.egressMessageCount++,this.egressByteCount+=null!=e?e:0}},{key:"logIngressCount",value:function(e){var t=e.length;t>1e5&&(this.ingressByteCountOp.start(),this.ingressByteCountOp.dimension2=t.toString().length.toString(),u.Log.info(507789783,u.LogCategory.CoreDefault,this.ingressByteCountOp.stop()))}}])}();n.WebSocketWorker=c,c.className="WebSocketWorker",c.logCountLimiter=new l.LogCountLimiter(c.className),c.pingPongMessage="~"},{105:105,156:156,22:22,24:24,30:30,64:64}],78:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.BufferingSequencer=void 0;var a=e(105),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,i.default)(this,e),this.prevSeq=-1,this.bufferingTimeMs=t,this.rejectOutdatedSequenceNumbers=n}return(0,s.default)(e,[{key:"sequence",value:function(t){var n=this;return new Promise((function(o,r){if(t<n.prevSeq){if(n.rejectOutdatedSequenceNumbers){var i=new Error("BufferingSequencer: Item out of order. Expecting seqId > ".concat(n.prevSeq,". Actual seqId ").concat(t));return i.name=e.Rejected,void r(i)}n.prevSeq=-1}t!=n.prevSeq+1&&a.Log.warn(542712385,a.LogCategory.CoreDefault,"BufferingSequencer: got out of order sequence number. Got ".concat(t,", expected ").concat(n.prevSeq+1));var s={seq:t,resolve:o};n.insertItem(s),n.runInOrder(s,!0,!1)}))}},{key:"insertItem",value:function(e){if(!this.firstQueueItem)return this.firstQueueItem=e,void(this.lastQueueItem=e);var t=this.lastQueueItem,n=null;do{if(e.seq>t.seq)return e.prev=t,t.next=e,void(n?(n.prev=e,e.next=n):this.lastQueueItem=e);n=t,t=t.prev}while(t);n&&(n.prev=e),e.next=n,this.firstQueueItem=e}},{key:"runInOrder",value:function(e,t,n){for(var o=this,i=this.prevSeq,s=!1,a=[];this.firstQueueItem;){var u=this.firstQueueItem;if(i+1!=u.seq&&(!n||u.seq>e.seq))break;i=u.seq,u.timeout&&clearTimeout(u.timeout),a.push(u),e==u&&(s=!0),this.firstQueueItem=this.firstQueueItem.next,this.firstQueueItem&&(this.firstQueueItem.prev=null)}a.length>0&&setTimeout((function(){var e,t=(0,r.default)(a);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.resolve(n.seq)}}catch(e){t.e(e)}finally{t.f()}}),0),this.prevSeq=i,!s&&t&&(e.timeout=setTimeout((function(){o.runInOrder(e,!1,!0)}),this.bufferingTimeMs))}}])}();n.BufferingSequencer=u,u.Rejected="SequenceItemRejected"},{105:105,22:22,24:24,25:25,30:30}],79:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(78),n)},{78:78}],80:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(83),n)},{83:83}],81:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(51)),s=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.formattedTextTileDeltaBuilderHandler=n.textTileDeltaBuilderHandler=void 0;var a=e(240),u=e(84),l=s.__importDefault(e(60)),c=/[ \u00a0\u2000-\u200a\u202f\u205f\u3000\t]/g,d=/[.!?]/g;function f(e,t){var n=e.content,o=t.content,r=(0,u.getMinimalDifferenceBounds)(n,o),i=r.firstDiffLeft,s=n.length-r.firstDiffRight,l=o.length-r.firstDiffRight,f=a.TextTileDeltaType.Update,p=void 0;if(n.length!==o.length)s===i?(f=a.TextTileDeltaType.Add,p=n[n.length-1]):l===i&&(f=a.TextTileDeltaType.Delete,p=o[o.length-1]);else if(n===o)return;var g,h=0;switch(f){case a.TextTileDeltaType.Update:h=s-i,g=o.substring(i,l);break;case a.TextTileDeltaType.Add:g=o.substring(i,l);break;case a.TextTileDeltaType.Delete:h=s-i,g=n.substring(i,s)}var y=function(e,t){var n=Array.from(e.matchAll(c));if(c.lastIndex=0,0===n.length)return a.TextTileDeltaUnit.Chars;if(1===n.length){if(0===n[0].index)return t&&d.test(t)?a.TextTileDeltaUnit.Sentence:t&&!c.test(t)?a.TextTileDeltaUnit.Word:a.TextTileDeltaUnit.Chars;if(n[0].index+1===e.length)return d.test(e[n[0].index-1])?a.TextTileDeltaUnit.Sentence:c.test(e[n[0].index-1])?a.TextTileDeltaUnit.Chars:a.TextTileDeltaUnit.Word;if(e[n[0].index-1]){var o=e[n[0].index-1];if(d.test(o))return a.TextTileDeltaUnit.Sentence;if(c.test(o))return a.TextTileDeltaUnit.Chars}return a.TextTileDeltaUnit.Word}var r=Array.from(e.matchAll(d));if(d.lastIndex=0,0===r.length)return a.TextTileDeltaUnit.PartialSentence;if(r.length>1)return a.TextTileDeltaUnit.Paragraph;if(r[0].index+1<=e.length)return c.test(e[r[0].index+1])?a.TextTileDeltaUnit.Sentence:a.TextTileDeltaUnit.Paragraph;return}(g,p);if(void 0!==y)return new a.FormattedTextTileDelta({content:f!==a.TextTileDeltaType.Delete?g:void 0,deltaType:f,unit:y,position:i,length:f!==a.TextTileDeltaType.Add?h:0})}n.textTileDeltaBuilderHandler=function(e,t){var n=[],o=f(e,t);return o&&n.push(o),n},n.formattedTextTileDeltaBuilderHandler=function(e,t){var n=[],o=f(e,t);o&&n.push(o);var s=function(e,t,n){var o,r,i,s,u,l,c=e,d=t;if((null==c?void 0:c.ipPosition)===(null==d?void 0:d.ipPosition)&&(null==c?void 0:c.isColdIp)===(null==d?void 0:d.isColdIp))return;if((null==c?void 0:c.isColdIp)===(null==d?void 0:d.isColdIp)&&n)if(n.deltaType===a.TextTileDeltaType.Add){if((null==d?void 0:d.ipPosition)===(null!==(o=n.position)&&void 0!==o?o:0)+(null!==(r=n.length)&&void 0!==r?r:0))return}else if(n.deltaType===a.TextTileDeltaType.Update){if((null==d?void 0:d.ipPosition)===(null!==(i=n.position)&&void 0!==i?i:0)+(null!==(u=null===(s=n.content)||void 0===s?void 0:s.length)&&void 0!==u?u:0))return}else if(n.deltaType===a.TextTileDeltaType.Delete&&(null==d?void 0:d.ipPosition)===(null!==(l=n.position)&&void 0!==l?l:0))return;return new a.FormattedTextTileDelta({deltaType:a.TextTileDeltaType.CursorUpdate,cursorData:{ipPosition:null==d?void 0:d.ipPosition,isColdIp:null==d?void 0:d.isColdIp}})}(e,t,o);s&&n.push(s);var u=function(e,t,n){var o,s,u,c,d,f,p,g=e,h=t;if((null===(o=h.formattedRanges)||void 0===o?void 0:o.length)<=(null===(s=g.formattedRanges)||void 0===s?void 0:s.length))if(n){var y=g.formattedRanges?(0,i.default)(g.formattedRanges):[],v=function(e,t,n){if(!e)return;if(t.deltaType===a.TextTileDeltaType.Add){var o=e.find((function(e){return e.start===n&&0===e.length}));if(o)return o;n=Math.max(n-1,0)}return e.find((function(e){return 0===e.length?e.start===n:e.start<=n&&n<e.start+e.length}))}(g.formattedRanges,n,n.position),m=v?y.indexOf(v):-1;if(-1!==m&&(n.position+(n.length||0)>v.start+v.length?v.length=n.position+(null!==(u=n.content)&&void 0!==u?u:"").length-v.start:v.length+=(null!==(c=n.content)&&void 0!==c?c:"").length-(n.length||0),y[m]=v),y.length>0){var k,T=(0,r.default)(y.slice(m+1));try{for(T.s();!(k=T.n()).done;){var S=k.value;S.start<n.position||(n.position+(n.length||0)>S.start?(S.length=S.start+S.length-(n.position+(n.length||0)),S.start=n.position+(null!==(d=n.content)&&void 0!==d?d:"").length):S.start+=(null!==(f=n.content)&&void 0!==f?f:"").length-(n.length||0))}}catch(e){T.e(e)}finally{T.f()}y=y.filter((function(e){return e.length>0}))}var b=null!==(p=null==h?void 0:h.formattedRanges)&&void 0!==p?p:[];if((0,l.default)(y,b)||0===y.length&&0===b.length)return}else if((0,l.default)(null==g?void 0:g.formattedRanges,null==h?void 0:h.formattedRanges))return;return new a.FormattedTextTileDelta({deltaType:a.TextTileDeltaType.FormattingUpdate,formattedRanges:null==h?void 0:h.formattedRanges})}(e,t,o);u&&n.push(u);var c=function(e,t,n){var o,i=e,s=t;if(!(null==i?void 0:i.attributionRanges)&&!s.attributionRanges&&!(null===(o=null==n?void 0:n.attributionData)||void 0===o?void 0:o.ranges)||(0,l.default)(null==i?void 0:i.attributionRanges,null==s?void 0:s.attributionRanges))return;if(i.attributionRanges&&s.attributionRanges){var u,c=[],d=(0,r.default)(s.attributionRanges);try{var f=function(){var e=u.value;i.attributionRanges.some((function(t){return(0,l.default)(t,e)}))||c.push(e)};for(d.s();!(u=d.n()).done;)f()}catch(e){d.e(e)}finally{d.f()}if(0===c.length)return;return new a.FormattedTextTileDelta({deltaType:a.TextTileDeltaType.AttributionUpdate,attributionData:{ranges:c}})}return new a.FormattedTextTileDelta({deltaType:a.TextTileDeltaType.AttributionUpdate,attributionData:{ranges:null==s?void 0:s.attributionRanges}})}(e,t,o);c&&n.push(c);var d=function(e,t){var n,o=e,r=t,i={},s=!1;for(n in r)-1===["ipPosition","isColdIp","content","formattedRanges","attributionRanges"].indexOf(n)&&((0,l.default)(r[n],o[n])||(s=!0,i[n]=r[n]));if(s)return new a.FormattedTextTileDelta({deltaType:a.TextTileDeltaType.OtherNonContentUpdate,otherNonContentData:i});return}(e,t);return d&&n.push(d),n}},{240:240,25:25,30:30,51:51,60:60,84:84}],82:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.DeltaBuilder=void 0;var s=e(240),a=e(81),u=function(){return(0,i.default)((function e(){(0,r.default)(this,e),this.deltaBuilderHandlers=new Map,this.registerDeltaBuilderHandler(s.TextTile.getTypeName(),a.textTileDeltaBuilderHandler),this.registerDeltaBuilderHandler(s.FormattedTextTile.getTypeName(),a.formattedTextTileDeltaBuilderHandler)}),[{key:"registerDeltaBuilderHandler",value:function(e,t){this.deltaBuilderHandlers.set(e,t)}},{key:"executeDeltaBuilderHandler",value:function(e,t,n){var o=this.deltaBuilderHandlers.get(e);return o?o(t,n):[]}}])}();n.DeltaBuilder=u},{22:22,24:24,240:240,30:30,81:81}],83:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(48)),i=o(e(25)),s=o(e(22)),a=o(e(24)),u=o(e(51));Object.defineProperty(n,"__esModule",{value:!0}),n.DeltaGenerator=void 0;var l=e(227),c=e(105),d=e(240),f=e(82),p=function(e,t){return t?g([].concat((0,u.default)(t),[e])):e},g=function(e){return e.join("\\")},h=function(){return(0,a.default)((function e(t){var n=this;(0,s.default)(this,e),this.createTextTileDeltasFromItem=function(e,t){var o,r=new c.Operation({operationName:"CreateTextTileDeltaFromItem",success:!0}).start();try{if(!e)return r.success=!1,r.resultDescription="Unable to create text tile delta, parent item is undefined",void c.Log.info(524883085,c.LogCategory.CoreDefault,r.stop());if(!e.body)return r.success=!1,r.resultDescription="Unable to create text tile delta, parent item has undefined body",void c.Log.info(524883086,c.LogCategory.CoreDefault,r.stop());var i=e.body;if(!d.TextTile.typeGuard(i))return r.success=!1,void(r.resultDescription="Unable to create text tile delta, parent item body is not proper type: expected ".concat(d.TextTile.getTypeName(),", received ").concat(l.SchemaObject.getTypeNameFor(i)));var s=p(e.id,t),a=null!==(o=n.lastSeenTileByTileId.get(s))&&void 0!==o?o:new d.TextTile({content:""}),u=n.createDeltas(a,i);return u&&0!==u.length?(r.dimension0=u.length.toString(),n.lastSeenTileByTileId.set(s,i)):(r.dimension0="0",r.resultDescription="No delta differences found"),c.Log.info(524883087,c.LogCategory.CoreDefault,r.stop()),u}catch(e){return r.success=!1,r.resultDescription="Error creating text tile delta: ".concat(e),void c.Log.info(524883088,c.LogCategory.CoreDefault,r.stop())}},this.lastSeenTileByTileId=null!=t?t:new Map,this.deltaBuilder=new f.DeltaBuilder}),[{key:"addItemToLocalMap",value:function(e,t){var n=p(e.id,t),o=e.body;d.TextTile.typeGuard(o)&&!this.lastSeenTileByTileId.has(n)&&this.lastSeenTileByTileId.set(n,o)}},{key:"deleteItemFromLocalMap",value:function(e,t){var n=p(e.id,t);this.lastSeenTileByTileId.has(n)&&this.lastSeenTileByTileId.delete(n)}},{key:"moveItemsInLocalMap",value:function(e,t,n){var o,s=new Set(n),a=g(t),u=g(e),l=[],c=function(e,t){return e.length>t.length?e.substring(t.length+"\\".length).split("\\")[0]:void 0},d=(0,i.default)(this.lastSeenTileByTileId);try{for(d.s();!(o=d.n()).done;){var f=(0,r.default)(o.value,2),p=f[0],h=f[1];if(p.startsWith(a)){var y=c(p,a);if(void 0===y||s.has(y)){var v=p.replace(a,u);l.push({item:h,newPathKey:v,prevPathKey:p})}}}}catch(e){d.e(e)}finally{d.f()}for(var m=0,k=l;m<k.length;m++){var T=k[m];this.lastSeenTileByTileId.delete(T.prevPathKey),this.lastSeenTileByTileId.set(T.newPathKey,T.item)}}},{key:"createDeltas",value:function(e,t){return this.deltaBuilder.executeDeltaBuilderHandler(l.SchemaObject.getTypeNameFor(t),e,t)}}])}();n.DeltaGenerator=h},{105:105,22:22,227:227,24:24,240:240,25:25,30:30,48:48,51:51,82:82}],84:[function(e,t,n){"use strict";function o(e,t,n){if(e.firstDiffLeft>0){var o=e.firstDiffLeft<t.length&&s(t,e.firstDiffLeft),r=e.firstDiffLeft<n.length&&s(n,e.firstDiffLeft);(o||r)&&(e.firstDiffLeft-=1)}if(e.firstDiffRight>1){var i=e.firstDiffRight<t.length&&s(t,t.length-e.firstDiffRight),a=e.firstDiffRight<n.length&&s(n,n.length-e.firstDiffRight);(i||a)&&(e.firstDiffRight-=1)}}function r(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={firstDiffLeft:0,firstDiffRight:t.length};for(n=0;n<e.length&&n<t.length;n+=1){var s=e.charCodeAt(n),a=t.charCodeAt(n);if(!(s===a||i(s,o)&&i(a,o)))break}for(r.firstDiffLeft=n,n=0;n<e.length&&n<t.length;n+=1){var u=e.charCodeAt(e.length-n-1),l=t.charCodeAt(t.length-n-1);if(!(u===l||i(u,o)&&i(l,o)))break}return r.firstDiffRight=n,r}function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case 12288:case 8197:case 32:case 11:case 9:case 160:return!0;case 13:case 10:case 65532:return!t}return!1}function s(e,t){return e.charCodeAt(t)>=56320&&e.charCodeAt(t)<=57343}Object.defineProperty(n,"__esModule",{value:!0}),n.getMinimalDifferenceBounds=void 0,n.getMinimalDifferenceBounds=function(e,t){var n,i,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a={firstDiffLeft:0,firstDiffRight:t.length};return e.length<t.length?(n=e,i=t):(n=t,i=e),0===i.indexOf(n)?(a.firstDiffLeft=n.length,a.firstDiffRight=0):i.endsWith(n)?(a.firstDiffLeft=0,a.firstDiffRight=n.length):(a=r(e,t,s)).firstDiffLeft+a.firstDiffRight>n.length&&(a.firstDiffRight=n.length-a.firstDiffLeft),o(a,e,t),a}},{}],85:[function(e,t,n){"use strict";var o,r,i,s,a;Object.defineProperty(n,"__esModule",{value:!0}),n.OAuth2V2LoginStatus=n.OAuth2GrantFlow=n.UserDataBoundaryType=n.UserType=n.AuthTokenType=void 0,function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacUserInfo=8]="WacUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege",e[e.AugLoopApp=18]="AugLoopApp",e[e.MeetingIntelligenceApp=19]="MeetingIntelligenceApp",e[e.GraphApp=20]="GraphApp",e[e.IceServicesApp=21]="IceServicesApp",e[e.AzureMapsApp=22]="AzureMapsApp",e[e.SpoApp=23]="SpoApp",e[e.OneDrive=24]="OneDrive",e[e.GoogleDrive=25]="GoogleDrive",e[e.GettyApp=26]="GettyApp",e[e.Dropbox=27]="Dropbox",e[e.GooglePhotos=28]="GooglePhotos",e[e.EditorApp=29]="EditorApp",e[e.AmazonKindle=30]="AmazonKindle",e[e.ShredderApp=31]="ShredderApp",e[e.FormsLowPrivilege=32]="FormsLowPrivilege",e[e.VivaSalesLowPrivilege=33]="VivaSalesLowPrivilege",e[e.IntentSvcApp=34]="IntentSvcApp",e[e.DcgLowPrivilege=35]="DcgLowPrivilege",e[e.CSALowPrivilege=36]="CSALowPrivilege",e[e.ConsumerSydneyLowPrivilege=37]="ConsumerSydneyLowPrivilege",e[e.CompliantSydneyApp=38]="CompliantSydneyApp",e[e.M365AdminApp=39]="M365AdminApp",e[e.MeetingArtifactsServiceLowPrivilege=40]="MeetingArtifactsServiceLowPrivilege",e[e.AlchemyApp=41]="AlchemyApp",e[e.M365Admin=42]="M365Admin",e[e.ConsumerShellApp=43]="ConsumerShellApp",e[e.PowerQueryLowPrivilege=44]="PowerQueryLowPrivilege",e[e.CIIApp=45]="CIIApp",e[e.ConsumerShell=46]="ConsumerShell",e[e.AssistCopilotLowPrivilege=47]="AssistCopilotLowPrivilege",e[e.Pva=48]="Pva",e[e.TeamsCopilotServiceLowPrivilege=49]="TeamsCopilotServiceLowPrivilege",e[e.CallAnalytics=50]="CallAnalytics",e[e.IncomingPFT=51]="IncomingPFT",e[e.GraphExchange=52]="GraphExchange",e[e.EXOAdmin=53]="EXOAdmin",e[e.InsightsServicesLowPrivilege=54]="InsightsServicesLowPrivilege",e[e.VivaServicesLowPrivilege=55]="VivaServicesLowPrivilege",e[e.EcsAppOnly=56]="EcsAppOnly",e[e.ShredderLowPrivilege=57]="ShredderLowPrivilege",e[e.SpoLowPrivilege=58]="SpoLowPrivilege",e[e.PromptValidationApp=59]="PromptValidationApp",e[e.CompliantSydneyLowPrivilege=60]="CompliantSydneyLowPrivilege",e[e.SubstrateTenantFeedbackApp=61]="SubstrateTenantFeedbackApp",e[e.MonitoringPlatform=62]="MonitoringPlatform",e[e.YammerLowPrivilege=63]="YammerLowPrivilege",e[e.VivaLearningLowPrivilege=64]="VivaLearningLowPrivilege",e[e.VivaInsightsLowPrivilege=65]="VivaInsightsLowPrivilege",e[e.ClientAugLoopApp=66]="ClientAugLoopApp",e[e.AssistAuthLowPrivilege=67]="AssistAuthLowPrivilege",e[e.VivaLearningSearchPreProdLowPrivilege=68]="VivaLearningSearchPreProdLowPrivilege",e[e.SubstrateSearchApp=69]="SubstrateSearchApp",e[e.SparkContentPlatformLowPrivilege=70]="SparkContentPlatformLowPrivilege",e[e.SparkContentPlatformPopApp=71]="SparkContentPlatformPopApp",e[e.ConsumerSydneyApp=72]="ConsumerSydneyApp",e[e.BusinessAssistAuthLowPrivilege=73]="BusinessAssistAuthLowPrivilege",e[e.AzureResourceManager=74]="AzureResourceManager",e[e.AlchemyPortal=75]="AlchemyPortal",e[e.VivaUserSkillsApp=76]="VivaUserSkillsApp",e[e.VivaEngageAppPop=77]="VivaEngageAppPop",e[e.SubstrateAppOnly=78]="SubstrateAppOnly",e[e.PowerAutomateFlowCreationLowPrivilege=79]="PowerAutomateFlowCreationLowPrivilege",e[e.PowerAutomateConnectionCreationLowPrivilege=80]="PowerAutomateConnectionCreationLowPrivilege",e[e.PowerAutomateAuthorizeConnectionLowPrivilege=81]="PowerAutomateAuthorizeConnectionLowPrivilege",e[e.TCAAppPop=82]="TCAAppPop",e[e.BusinessAssistAuthAppPop=83]="BusinessAssistAuthAppPop",e[e.HolmesApp=84]="HolmesApp",e[e.GraphAppOnly=85]="GraphAppOnly",e[e.SimsApp=86]="SimsApp",e[e.VivaOrgInsightsLowPrivilege=87]="VivaOrgInsightsLowPrivilege",e[e.VivaGoalsAppPop=88]="VivaGoalsAppPop",e[e.GCBotAppPop=89]="GCBotAppPop",e[e.ShredderV2App=90]="ShredderV2App",e[e.ShredderV2LowPrivilege=91]="ShredderV2LowPrivilege",e[e.AmplifyProfileService=92]="AmplifyProfileService",e[e.AzureDevopsLowPrivilege=93]="AzureDevopsLowPrivilege",e[e.CommuteServices=94]="CommuteServices",e[e.GCBotAppOnly=95]="GCBotAppOnly",e[e.TCAAppOnly=96]="TCAAppOnly",e[e.MavenAgentLowPrivilege=97]="MavenAgentLowPrivilege",e[e.VivaOrgInsightsAppPop=98]="VivaOrgInsightsAppPop",e[e.EduAssignmentsPftAtPop=99]="EduAssignmentsPftAtPop",e[e.AugloopAppPop=100]="AugloopAppPop",e[e.OneNoteLowPrivilege=101]="OneNoteLowPrivilege",e[e.TeamsAuthzSvcAppPop=102]="TeamsAuthzSvcAppPop",e[e.LoopAppPop=103]="LoopAppPop",e[e.LoopAppOnly=104]="LoopAppOnly",e[e.BapLowPrivilege=105]="BapLowPrivilege",e[e.IC3AppPop=106]="IC3AppPop",e[e.PowerPlatformApiGateway=107]="PowerPlatformApiGateway",e[e.OdspNotifyAppPop=108]="OdspNotifyAppPop",e[e.MIPSyncService=109]="MIPSyncService",e[e.RightsManagementServices=110]="RightsManagementServices",e[e.TCAV2AppPop=111]="TCAV2AppPop",e[e.SubstrateLLMLowPrivilege=112]="SubstrateLLMLowPrivilege",e[e.SubstrateSearchLowPrivilege=113]="SubstrateSearchLowPrivilege",e[e.CloudPolicyServiceAppPop=114]="CloudPolicyServiceAppPop",e[e.TCAV2LowPrivilege=115]="TCAV2LowPrivilege",e[e.AiHubServicesAppPop=116]="AiHubServicesAppPop",e[e.TMRAppOnly=117]="TMRAppOnly",e[e.PacmanAppPop=118]="PacmanAppPop",e[e.AugloopAlternativeIdentity=119]="AugloopAlternativeIdentity",e[e.SpoAppOnly=120]="SpoAppOnly",e[e.DataverseLowPrivilege=121]="DataverseLowPrivilege",e[e.SubstrateLLMApp=122]="SubstrateLLMApp",e[e.SimsAppOnly=123]="SimsAppOnly",e[e.PythonService=124]="PythonService",e[e.PythonServiceAppOnly=125]="PythonServiceAppOnly",e[e.DesignerAppServiceLowPrivilege=126]="DesignerAppServiceLowPrivilege",e[e.DesignerAppServiceAppPop=127]="DesignerAppServiceAppPop",e[e.AmplifyProfileServiceAppOnly=128]="AmplifyProfileServiceAppOnly",e[e.MARSAppPop=129]="MARSAppPop",e[e.PlannerAppPop=130]="PlannerAppPop",e[e.BingForBusinessLowPrivilege=131]="BingForBusinessLowPrivilege",e[e.OLS=132]="OLS",e[e.OLSAppPop=133]="OLSAppPop",e[e.GCS=134]="GCS",e[e.AugLoopConsumer=135]="AugLoopConsumer",e[e.ContentValidationServiceAppOnly=136]="ContentValidationServiceAppOnly",e[e.FabricLowPrivilege=137]="FabricLowPrivilege",e[e.FeatureAccessManagementAppPop=138]="FeatureAccessManagementAppPop",e[e.FireIntelligenceAppOnly=139]="FireIntelligenceAppOnly",e[e.MARSLowPrivilege=140]="MARSLowPrivilege",e[e.EXOAdminAppPop=141]="EXOAdminAppPop",e[e.IncomingAT=142]="IncomingAT",e[e.CopilotLabLowPrivilege=143]="CopilotLabLowPrivilege",e[e.VivaPulseLowPrivilege=144]="VivaPulseLowPrivilege",e[e.WacAppPop=145]="WacAppPop",e[e.PowerAppsAiBuilderLowPrivilege=146]="PowerAppsAiBuilderLowPrivilege",e[e.CognitiveApiAppOnly=147]="CognitiveApiAppOnly",e[e.CopilotMetricsAppOnly=148]="CopilotMetricsAppOnly",e[e.ShredderAppOnly=149]="ShredderAppOnly",e[e.TeamsAuthzSvcLowPrivilege=150]="TeamsAuthzSvcLowPrivilege",e[e.PlannerLowPrivilege=151]="PlannerLowPrivilege",e[e.VivaGlintLowPrivilege=152]="VivaGlintLowPrivilege",e[e.DiscoveryServiceAppPop=153]="DiscoveryServiceAppPop",e[e.PowerAppsOrchardLowPrivilege=154]="PowerAppsOrchardLowPrivilege",e[e.EduSkillingPlatformPftAtPop=155]="EduSkillingPlatformPftAtPop",e[e.IncomingPFTAppOnly=156]="IncomingPFTAppOnly",e[e.EduSkillingPlatformLowPrivilege=157]="EduSkillingPlatformLowPrivilege",e[e.MCPSAppOnly=158]="MCPSAppOnly",e[e.TeamsMiddleTierLowPrivilege=159]="TeamsMiddleTierLowPrivilege",e[e.SharePointESignatureAppPop=160]="SharePointESignatureAppPop",e[e.SparkContentPlatformAppOnly=161]="SparkContentPlatformAppOnly",e[e.LuminaLowPrivilege=162]="LuminaLowPrivilege",e[e.OfficeScriptsServiceAppPop=163]="OfficeScriptsServiceAppPop",e[e.OfficeScriptsServiceLowPrivilege=164]="OfficeScriptsServiceLowPrivilege",e[e.BingApisAppOnly=165]="BingApisAppOnly"}(o||(n.AuthTokenType=o={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(r||(n.UserType=r={})),function(e){e[e.Default=0]="Default",e[e.EDPSCompliant=1]="EDPSCompliant"}(i||(n.UserDataBoundaryType=i={})),function(e){e.AuthorizationCode="authorization_code",e.ClientCredentials="client_credentials",e.RefreshToken="refresh_token"}(s||(n.OAuth2GrantFlow=s={})),function(e){e[e.LoggedIn=0]="LoggedIn",e[e.LoggedOut=1]="LoggedOut"}(a||(n.OAuth2V2LoginStatus=a={}))},{}],86:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(85),n),o.__exportStar(e(87),n),o.__exportStar(e(88),n),o.__exportStar(e(89),n),o.__exportStar(e(90),n),o.__exportStar(e(91),n),o.__exportStar(e(92),n),o.__exportStar(e(93),n),o.__exportStar(e(94),n),o.__exportStar(e(95),n),o.__exportStar(e(96),n),o.__exportStar(e(97),n),o.__exportStar(e(98),n),o.__exportStar(e(100),n),o.__exportStar(e(99),n)},{100:100,85:85,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99}],87:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.Type=void 0,function(e){e[e.None=0]="None",e[e.Booleans=1]="Booleans",e[e.Float32s=2]="Float32s",e[e.Float64s=3]="Float64s",e[e.Int8s=4]="Int8s",e[e.Int16s=5]="Int16s",e[e.Int32s=6]="Int32s",e[e.Strings=7]="Strings",e[e.UnsignedInt8s=8]="UnsignedInt8s",e[e.UnsignedInt16s=9]="UnsignedInt16s",e[e.UnsignedInt32s=10]="UnsignedInt32s"}(o||(n.Type=o={}))},{}],88:[function(e,t,n){"use strict";var o=(0,e(30).default)(e(54));Object.defineProperty(n,"__esModule",{value:!0}),n.stringifyReplacer=void 0;n.stringifyReplacer=function(e,t){return"object"===(0,o.default)(t)&&null!==t&&0===Object.keys(t).length?void 0:t}},{30:30,54:54}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isExceptionMessage=void 0;var o=e(190);n.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==o.MessageType.Exception}},{190:190}],90:[function(e,t,n){"use strict";var o,r=e(30).default,i=r(e(24)),s=r(e(22)),a=r(e(21)),u=r(e(29)),l=r(e(56));Object.defineProperty(n,"__esModule",{value:!0}),n.ExpectedError=n.WorkflowDefinitionScope=void 0,function(e){e[e.JoinContext=0]="JoinContext",e[e.Session=1]="Session"}(o||(n.WorkflowDefinitionScope=o={}));var c=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ExpectedError";return(0,s.default)(this,t),(e=(0,a.default)(this,t,[n])).__proto__=t.prototype,e}return(0,u.default)(t,e),(0,i.default)(t)}((0,l.default)(Error));n.ExpectedError=c},{21:21,22:22,24:24,29:29,30:30,56:56}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.gatewayType=void 0,n.gatewayType="Gateway"},{}],92:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug",e[e.disabled=7]="disabled"}(o||(n.LoggingLevel=o={}))},{}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],94:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.EventStatus=void 0,function(e){e[e.Active=0]="Active",e[e.Stopped=1]="Stopped",e[e.Paused=2]="Paused"}(o||(n.EventStatus=o={}))},{}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],96:[function(e,t,n){"use strict";var o,r;Object.defineProperty(n,"__esModule",{value:!0}),n.DiagnosticLevel=n.DataCategories=void 0,function(e){e[e.ProductServiceUsage=2]="ProductServiceUsage",e[e.ProductServicePerformance=4]="ProductServicePerformance"}(o||(n.DataCategories=o={})),function(e){e[e.BasicEvent=10]="BasicEvent",e[e.FullEvent=100]="FullEvent",e[e.RequiredServiceDataEvent=110]="RequiredServiceDataEvent"}(r||(n.DiagnosticLevel=r={}))},{}],97:[function(e,t,n){"use strict";var o,r,i,s,a,u,l,c,d,f,p,g;Object.defineProperty(n,"__esModule",{value:!0}),n.PrefilterActionType=n.PrefilterType=n.UnitType=n.TriggerCondition=n.InputStage=n.ProducerWaitPolicy=n.RequestedContextCardinality=n.ActivationTier=n.WorkflowVisibility=n.DlpPolicyScope=n.BillingDomain=n.WorkflowKind=void 0,function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid",e[e.DynamicText=3]="DynamicText",e[e.Join=4]="Join",e[e.Generic=5]="Generic"}(o||(n.WorkflowKind=o={})),function(e){e.Default="Default",e.Copilot="Copilot"}(r||(n.BillingDomain=r={})),function(e){e[e.None=0]="None",e[e.ContentFiltering_M365Copilot=1]="ContentFiltering_M365Copilot"}(i||(n.DlpPolicyScope=i={})),function(e){e[e.Default=0]="Default",e[e.LocalOnly=1]="LocalOnly",e[e.Exclusive=2]="Exclusive"}(s||(n.WorkflowVisibility=s={})),function(e){e[e.PreActivate=0]="PreActivate",e[e.Default=1]="Default",e[e.DelayActivate=1]="DelayActivate",e[e.NeverActivate=2]="NeverActivate"}(a||(n.ActivationTier=a={})),function(e){e[e.Required=-3]="Required",e[e.Optional=-1]="Optional"}(u||(n.RequestedContextCardinality=u={})),function(e){e[e.Never=0]="Never",e[e.Always=1]="Always"}(l||(n.ProducerWaitPolicy=l={})),function(e){e[e.PreSeed=1]="PreSeed",e[e.OnSeed=2]="OnSeed",e[e.PostSeed=4]="PostSeed",e[e.All=5]="All"}(c||(n.InputStage=c={})),function(e){e[e.UpstreamWorkflowsReady=0]="UpstreamWorkflowsReady",e[e.AnnotationMetadataUpdated=1]="AnnotationMetadataUpdated",e[e.DeltaUpdate=2]="DeltaUpdate",e[e.NonExclusiveTriggerSignals=3]="NonExclusiveTriggerSignals"}(d||(n.TriggerCondition=d={})),function(e){e[e.Character=1]="Character",e[e.Paragraph=2]="Paragraph"}(f||(n.UnitType=f={})),function(e){e.Input="Input",e.Delta="Delta",e.UILanguage="UILanguage",e.MaxInputCount="MaxInputCount",e.ExtensionLimits="ExtensionLimits"}(p||(n.PrefilterType=p={})),function(e){e.SetPredefinedAnnotation="SetPredefinedAnnotation",e.ClearAnnotations="ClearAnnotations"}(g||(n.PrefilterActionType=g={}))},{}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],100:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(24)),i=o(e(22)),s=o(e(21)),a=o(e(29)),u=o(e(56));Object.defineProperty(n,"__esModule",{value:!0}),n.CoherencyError=void 0;var l=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CoherencyError";return(0,i.default)(this,t),(e=(0,s.default)(this,t,[n])).__proto__=t.prototype,e}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.CoherencyError=l},{21:21,22:22,24:24,29:29,30:30,56:56}],101:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.AugLoopTextDecoder=n.AugLoopTextEncoder=void 0;o=function(){if("undefined"==typeof TextEncoder||"undefined"==typeof TextDecoder){e(61);var t={AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder};return TextEncoder=void 0,TextDecoder=void 0,t}return{AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder}}(),n.AugLoopTextEncoder=o.AugLoopTextEncoder,n.AugLoopTextDecoder=o.AugLoopTextDecoder},{61:61}],102:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(103),n)},{103:103}],103:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(54)),i=o(e(26)),s=o(e(45)),a=o(e(22)),u=o(e(24)),l=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.JSOND=void 0;var c=e(101),d=function(){function e(){(0,a.default)(this,e)}return(0,u.default)(e,null,[{key:"extractFragments",value:function(t){if(t[0]!==e.IDENTIFIERBYTE)throw new Error("Invalid Binary: Incorrect Identifier");for(var n=1,o=[],r=new DataView(t.buffer,t.byteOffset,t.byteLength);n<t.byteLength;){if(n+4>t.byteLength)throw new Error("Invalid Binary: Error reading fragment length");var i=r.getUint32(n);if(n+i+4>t.byteLength)throw new Error("Invalid Binary: Fragment out of range");"undefined"!=typeof Buffer&&Buffer.from?o.push(Buffer.from(t.buffer,t.byteOffset+n+4,i)):o.push(new Uint8Array(t.buffer,t.byteOffset+n+4,i)),n+=4+i}if(o.length<1)throw new Error("Invalid Binary: No fragments found");return o}},{key:"deserialize",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},o=e.extractFragments(t),r=e.textDecoder.decode(o[0]),i=function(t,r){if("string"==typeof r){if(r.substring(0,e.BINARYKEYWORD.length)===e.BINARYKEYWORD){var i=parseInt(r.substring(e.BINARYKEYWORD.length),10);if("number"!=typeof i||i>=o.length-1)throw new Error("Invalid Binary: Binary index out of range");return n(o[i+1])}if(r.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD)return r.substring(e.ESCAPEKEYWORD.length)}return r};return JSON.parse(r,i)}},{key:"deserializeAsync",value:function(t){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return l.__awaiter(n,void 0,void 0,(0,s.default)().mark((function t(){return(0,s.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}}),t)})))};return l.__awaiter(this,void 0,void 0,(0,s.default)().mark((function n(){var a,u,l,c,d,f,p,g;return(0,s.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.extractFragments(t),u=e.textDecoder.decode(a[0]),l=[],c=function(e){var t=(0,i.default)((0,i.default)({},f,!0),"value",void 0);return e.then((function(e){t.value=e})),t},d=function(t,n){if("string"==typeof n){if(n.startsWith(e.BINARYKEYWORD)){var r=parseInt(n.substring(e.BINARYKEYWORD.length),10);if("number"!=typeof r||r>=a.length-1)throw new Error("Invalid Binary: Binary index out of range");var i=o(a[r+1]);return l.push(i),c(i)}if(n.startsWith(e.ESCAPEKEYWORD))return n.substring(e.ESCAPEKEYWORD.length)}return n},f=Symbol("placeholder"),p=function e(t){if(Array.isArray(t)){for(var n=0;n<t.length;n++)t[n]=e(t[n]);return t}if(null!==t&&"object"===(0,r.default)(t)){if(t[f])return t.value;for(var o=0,i=Object.keys(t);o<i.length;o++){var s=i[o];t[s]=e(t[s])}return t}return t},g=JSON.parse(u,d),n.next=10,Promise.all(l);case 10:return n.next=12,p(g);case 12:return g=n.sent,n.abrupt("return",g);case 14:case"end":return n.stop()}}),n)})))}},{key:"serializeInternal",value:function(t){var n=[void 0],o=JSON.stringify(t,(function(t,o){return ArrayBuffer.isView(o)?(n.push(o),"".concat(e.BINARYKEYWORD).concat(n.length-2)):o&&"Buffer"===o.type&&Array.isArray(o.data)?(n.push(new Uint8Array(o.data)),"".concat(e.BINARYKEYWORD).concat(n.length-2)):"string"==typeof o&&o.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD?e.ESCAPEKEYWORD+o:o}));n[0]=e.textEncoder.encode(o);var r=n.reduce((function(e,t){return e+4+t.byteLength}),0),i=new Uint8Array(r+1);i[0]=e.IDENTIFIERBYTE;for(var s=1,a=new DataView(i.buffer,i.byteOffset,i.byteLength),u=0,l=n;u<l.length;u++){var c=l[u];a.setUint32(s,c.byteLength),i.set(c,s+4),s+=4+c.byteLength}return i}},{key:"serialize",value:function(t){return e.serializeInternal(t)}},{key:"serializeAsync",value:function(t){return l.__awaiter(this,void 0,void 0,(0,s.default)().mark((function n(){return(0,s.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,o){try{n(e.serializeInternal(t))}catch(e){o(e)}})));case 1:case"end":return n.stop()}}),n)})))}}])}();n.JSOND=d,d.IDENTIFIERBYTE=3,d.BINARYKEYWORD=":b",d.ESCAPEKEYWORD=":",d.textDecoder=new c.AugLoopTextDecoder,d.textEncoder=new c.AugLoopTextEncoder},{101:101,22:22,24:24,26:26,30:30,45:45,54:54}],104:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(24)),i=o(e(22)),s=o(e(21)),a=o(e(29));Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationMetaDataChange=void 0;var u=function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,s.default)(this,t,[e])).eventName="AnnotationMetaDataChange",n}return(0,a.default)(t,e),(0,r.default)(t)}(e(218).AnnotationMetaDataChangeEvent);n.AnnotationMetaDataChange=u},{21:21,218:218,22:22,24:24,29:29,30:30}],105:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.SessionHealthSource=n.SessionHealthReason=n.SessionHealthImpact=n.SessionHealthEvent=void 0,o.__exportStar(e(104),n),o.__exportStar(e(106),n),o.__exportStar(e(108),n),o.__exportStar(e(107),n),o.__exportStar(e(109),n),o.__exportStar(e(110),n);var r=e(112);Object.defineProperty(n,"SessionHealthEvent",{enumerable:!0,get:function(){return r.SessionHealth}}),Object.defineProperty(n,"SessionHealthImpact",{enumerable:!0,get:function(){return r.SessionHealthImpact}}),Object.defineProperty(n,"SessionHealthReason",{enumerable:!0,get:function(){return r.SessionHealthReason}}),Object.defineProperty(n,"SessionHealthSource",{enumerable:!0,get:function(){return r.SessionHealthSource}})},{104:104,106:106,107:107,108:108,109:109,110:110,112:112}],106:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.CorrelationVector=void 0;var s=function(){function e(t){(0,r.default)(this,e),this.childCount=0,this.id=t||function(){for(var e=0;e<22;e++)u[e]=a[Math.floor(Math.random()*a.length)];return u.join("")}()}return(0,i.default)(e,[{key:"newChild",value:function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())}},{key:"toString",value:function(){return this.id.length>127?this.id.substring(0,127)+"!":this.id}}],[{key:"fromString",value:function(t,n){if(!t)throw new Error("Received invalid correlation vector string");var o;return o=t.endsWith(".0")?new e(t.substring(0,t.length-2)):new e(t),n&&(o.childCount=n),o}}])}();n.CorrelationVector=s;var a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],u=new Array(22)},{22:22,24:24,30:30}],107:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(24)),s=o(e(22));Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingAggregator=void 0;var a=/\|\~/g,u=(0,i.default)((function e(){(0,s.default)(this,e),this.count=0,this.measureSums=new Map})),l=(0,i.default)((function e(t,n,o,i,l){var c=this;(0,s.default)(this,e),this.buckets=new Map,this.init=function(e){c.log=e},this.add=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c.condition||!c.condition(e))return!0===t&&c.log(e,!1),!1;var n,o=[],i=(0,r.default)(c.dimensions);try{for(i.s();!(n=i.n()).done;){var s=n.value;if(void 0===e[s]||null===e[s])o.push(null);else{var l="";"boolean"==typeof e[s]?l="b~":"number"==typeof e[s]&&(l="n~"),o.push("".concat(l).concat(e[s].toString().replace(a,"_")))}}}catch(e){i.e(e)}finally{i.f()}var d=o.join("|"),f=c.buckets.get(d);if(!f){(f=new u).traceLevel=e.traceLevel;var p,g=(0,r.default)(c.avgMeasures);try{for(g.s();!(p=g.n()).done;){var h=p.value;f.measureSums.set(h,0)}}catch(e){g.e(e)}finally{g.f()}c.buckets.set(d,f)}f.count++;var y,v=(0,r.default)(c.avgMeasures);try{for(v.s();!(y=v.n()).done;){var m=y.value;e[m]&&f.measureSums.set(m,f.measureSums.get(m)+e[m])}}catch(e){v.e(e)}finally{v.f()}return!0},this.flush=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c.buckets.forEach((function(e,t){for(var n={traceLevel:e.traceLevel,eventName:c.eventName,count:e.count},o=t.split("|"),i=0;i<c.dimensions.length;i++){var s=c.dimensions[i],a=o[i];0===a.indexOf("b~")?n[s]="b~true"===a:0===a.indexOf("n~")?n[s]=parseInt(a.slice("n~".length),10):n[s]=a}var u,l=(0,r.default)(c.avgMeasures);try{for(l.s();!(u=l.n()).done;){var d=u.value;n[d]=Math.round(e.measureSums.get(d)/e.count)}}catch(e){l.e(e)}finally{l.f()}c.log(n,!0)})),c.buckets.clear(),e&&(c.condition=null,clearInterval(c.interval))},this.eventName=t,this.condition=n,this.dimensions=o,this.avgMeasures=i,l>0&&(this.interval=setInterval(this.flush,1e3*l))}));n.LoggingAggregator=l},{22:22,24:24,25:25,30:30}],108:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(24)),i=o(e(22)),s=o(e(25)),a=o(e(54));Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=n.tagIdToString=n.getNumLoggers=n.logCategoryToString=n.argsToString=n.Log=void 0;var u,l,c,d=e(86),f=e(111),p="undefined"!=typeof process&&process.env?process.env.SERVICE_NAME:"client",g="abcdefghijklmnopqrstuvwxyz0123456789",h={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},y=[],v=[],m=function(e){return null},k=function(e){},T=new Map,S=new Map,b=new Map,C=new Map;!function(e){e.Default="",e.EDPSCompliant="edps"}(l||(l={})),function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){y=[],v=[],S.clear(),b.clear()},e.clearAggregators=function(){T.clear()},e.addLogger=function(e){-1===y.indexOf(e)&&(y.push(e),w(S,e))},e.addDecidingLogger=function(e){-1===v.indexOf(e)&&(v.push(e),w(b,e))},e.setCorrelationContextCallback=function(e){u=e},e.setStartPerformanceEventCallback=function(e){m=e},e.setStopPerformanceEventCallback=function(e){k=e},e.addAggregator=function(e){e.init((function(e,t){P(e,t)})),T.has(e.eventName)?T.get(e.eventName).push(e):T.set(e.eventName,[e])},e.flushAggregators=function(e){T.forEach((function(t){t.forEach((function(t){return t.flush(e)}))}))},e.setTagLevelOverride=function(e,t){var n=R(e);C.set(n,t)},e.resetTagLevelOverrides=function(){C.clear()},e.error=function(e,t,n,o,r,i,s,a,u,l){x(e,t,d.LoggingLevel.error,n,o,r,i,s,a,u,l)},e.warn=function(e,t,n,o,r,i,s,a,u,l){x(e,t,d.LoggingLevel.warn,n,o,r,i,s,a,u,l)},e.info=function(e,t,n,o,r,i,s,a,u,l){x(e,t,d.LoggingLevel.info,n,o,r,i,s,a,u,l)},e.verbose=function(e,t,n,o,r,i,s,a,u,l){x(e,t,d.LoggingLevel.verbose,n,o,r,i,s,a,u,l)},e.debug=function(e,t,n,o,r,i,s,a,u,l){x(e,t,d.LoggingLevel.debug,n,o,r,i,s,a,u,l)},e.metric=function(e,t,n,o,r,i,s,a,u,l){x(e,t,d.LoggingLevel.metric,n,o,r,i,s,a,u,l)},e.formatMetric=function(e,t,n,o){var r={};return r[e]={dimensionNames:n,dimensionValues:o,value:t},r},e.dynamic=function(e){P(e)}}(c||(n.Log=c={}));var w=function(e,t){var n=t.level;Object.keys(d.LoggingLevel).map((function(e){return d.LoggingLevel[e]})).filter((function(e){return"string"!=typeof e})).filter((function(e){return e<=n})).forEach((function(n){e.has(n)?e.get(n).push(t):e.set(n,[t])}))};n.argsToString=function(e){if("string"==typeof e)return e;for(var t="",n=0;n<e.length;n++){n>0&&(t+=" ");var o=e[n];o instanceof Error?t+=JSON.stringify({message:o.message,name:o.name,stack:o.stack}):"object"===(0,a.default)(o)?t+=JSON.stringify(o):t+=o}return t};n.logCategoryToString=function(e){return"".concat(e.root,".").concat(e.name)};var _=[],M=["Level","Tag"],A=["Level","Tag","Workflow"];n.getNumLoggers=function(e){return O(e).length};var O=function(e){return void 0!==e?S.get(e)||_:y},I=function(e,t){return(void 0!==e?b.get(e)||[]:v).filter((function(e){return e.shouldLog(t)}))},x=function(e,t,o,r,i,s,l,c,d,p,g){o=C.get(e)||o;var h=O(o),y=I(o,r);if(0!=h.length||0!=y.length){var v=m(f.PerformanceEventType.Log),S=(0,n.tagIdToString)(e),b=function(e,t,n,o,r,i,s,u){if(void 0===t&&("string"==typeof e||"object"===(0,a.default)(e)))return e;if(void 0===t&&"function"==typeof e)return e();for(var l=[],c=0,d=[e,t,n,o,r,i,s,u];c<d.length;c++){var f=d[c];void 0!==f&&l.push("function"==typeof f?f():f)}return l}(r,i,s,l,c,d,p,g);if(L(t))E(b)&&P({eventName:"Metrics",tagId:S,category:(0,n.logCategoryToString)(t),traceLevel:o,message:"",getMetrics:function(){return b}},!1,h,y);else if(E(b)){var w=b;w.tagId=S,w.category=(0,n.logCategoryToString)(t),"Operation"===w.eventName&&"Workflow"===t.root&&(w.eventName="WorkflowOperation",u&&(w.joinContextId=u().joinContextId,w.workflow=u().workflow)),w.traceLevel=o;var _=T.get(w.eventName);if(_)for(var x=0;x<_.length;++x){var D=_[x];if(D&&D.add(w,x===_.length-1))break}else P(w,!1,h,y)}else{P({eventName:"Log",tagId:S,category:(0,n.logCategoryToString)(t),traceLevel:o,message:(0,n.argsToString)(b),getMetrics:function(){var e;return"Core"===t.root?{TraceEventV2:{dimensionNames:function(){return M},dimensionValues:[String(o),S],value:1}}:{WorkflowTraceEvent:{dimensionNames:function(){return A},dimensionValues:[String(o),S,u?null===(e=u())||void 0===e?void 0:e.workflow:""],value:1}}}},!1,h,y)}k(v)}},P=function(e){var t,n,o,r,i,a,l,c,d,f,g,h,y,v,m,k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;if(null==T&&(T=O(e.traceLevel)),S=S||_,T.length>0||S.length>0){if(e.serviceName=p,!k&&u){var b=u();b&&(m={disableLogging:b.disableLogging,userDataBoundaryType:null===(n=null===(t=b.sessionDescriptor)||void 0===t?void 0:t.userContext)||void 0===n?void 0:n.userDataBoundaryType},e.cv=e.cv?e.cv:b.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:b.sessionKey,e.userTenantId=e.userTenantId?e.userTenantId:b.userTenantId,e.workflow=e.workflow?e.workflow:b.workflow,e.clientAppName=e.clientAppName?e.clientAppName:null===(o=b.clientMetadata)||void 0===o?void 0:o.appName,e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:null===(r=b.clientMetadata)||void 0===r?void 0:r.appPlatform,e.clientAppVersion=e.clientAppVersion?e.clientAppVersion:null===(i=b.clientMetadata)||void 0===i?void 0:i.appVersion,e.clientDocSessionId=e.clientDocSessionId?e.clientDocSessionId:null===(a=b.clientMetadata)||void 0===a?void 0:a.docSessionId,e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:null===(l=b.clientMetadata)||void 0===l?void 0:l.releaseAudienceGroup,e.clientReleaseChannel=e.clientReleaseChannel?e.clientReleaseChannel:null===(c=b.clientMetadata)||void 0===c?void 0:c.releaseChannel,e.clientReleaseFork=e.clientReleaseFork?e.clientReleaseFork:null===(d=b.clientMetadata)||void 0===d?void 0:d.releaseFork,e.clientRuntimeVersion=e.clientRuntimeVersion?e.clientRuntimeVersion:null===(f=b.clientMetadata)||void 0===f?void 0:f.runtimeVersion,e.clientSessionId=e.clientSessionId?e.clientSessionId:null===(g=b.clientMetadata)||void 0===g?void 0:g.sessionId,e.clientUserAgent=e.clientUserAgent?e.clientUserAgent:null===(h=b.clientMetadata)||void 0===h?void 0:h.userAgent,e.traceId=e.traceId||b.traceId,e.isClientTelemetrySampled=e.isClientTelemetrySampled?e.isClientTelemetrySampled:null===(y=b.clientMetadata)||void 0===y?void 0:y.isClientTelemetrySampled,e.userDataBoundaryType=D(m),e.ecsConfigIDs=null===(v=b.ecsConfigIDsManager)||void 0===v?void 0:v.getAllConfigIDsString())}var C,w=(0,s.default)(T);try{for(w.s();!(C=w.n()).done;){var M=C.value;M.log(e,m)}}catch(e){w.e(e)}finally{w.f()}var A,I=(0,s.default)(S);try{for(I.s();!(A=I.n()).done;){var x=A.value;x.log(e)}}catch(e){I.e(e)}finally{I.f()}}},L=function(e){return e.name===N.WorkflowMetricsOnly.name&&e.root===N.WorkflowMetricsOnly.root},E=function(e){return!Array.isArray(e)&&"object"===(0,a.default)(e)},D=function(e){switch(null==e?void 0:e.userDataBoundaryType){case d.UserDataBoundaryType.EDPSCompliant:return l.EDPSCompliant;default:return l.Default}};n.tagIdToString=function(e){return g[e>>24&63]+g[e>>18&63]+g[e>>12&63]+g[e>>6&63]+g[e>>0&63]};var R=function(e){return e&&5===e.length?h[e.charCodeAt(0)]<<24|h[e.charCodeAt(1)]<<18|h[e.charCodeAt(2)]<<12|h[e.charCodeAt(3)]<<6|h[e.charCodeAt(4)]:-1},N=(0,r.default)((function e(){(0,i.default)(this,e)}));n.LogCategory=N,N.CoreDefault=c.defineCoreLogCategory("Default"),N.CoreSystem=c.defineCoreLogCategory("System"),N.CoreUnsampled=c.defineCoreLogCategory("Unsampled"),N.WorkflowDefault=c.defineWorkflowLogCategory("Default"),N.WorkflowUnsampled=c.defineWorkflowLogCategory("Unsampled"),N.WorkflowMetricsOnly=c.defineWorkflowLogCategory("MetricsOnly"),N.PrivacyGuardEvent=c.defineCoreLogCategory("PrivacyGuardEvent")},{111:111,22:22,24:24,25:25,30:30,54:54,86:86}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.nowMicroSeconds=n.now=void 0;n.now="undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()},n.nowMicroSeconds="undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e6*e[0]+e[1]/1e3}:"undefined"!=typeof performance&&performance.now?function(){return Math.round(1e3*performance.now())}:function(){return 1e3*Date.now()}},{}],110:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(51)),s=o(e(22)),a=o(e(24)),u=o(e(21)),l=o(e(29));Object.defineProperty(n,"__esModule",{value:!0}),n.Operation=void 0;var c=e(218),d=e(109),f=Symbol("dataFieldsObject"),p=Symbol("dataFieldsAreDirty"),g=Symbol("_dataFields"),h=function(e){function t(e,n){var o;return(0,s.default)(this,t),(o=(0,u.default)(this,t,[e])).eventName="Operation",o.options=n,o.durationMs=null==e?void 0:e.durationMs,e&&null!=e.count||(o.count=1),(null==e?void 0:e.dataFields)&&(o.dataFields=e.dataFields),o}return(0,l.default)(t,e),(0,a.default)(t,[{key:"setClientMetadata",value:function(e,t){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,null!=t&&t||(this.clientFlights=e.flights),this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDocSessionId=e.docSessionId,this.clientUserAgent=e.userAgent),this}},{key:"setUserContext",value:function(e){return e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString(),this.userTenantId=e.tid),this}},{key:"setMetricCustomDimensions",value:function(e,t){if(!this.options)throw new Error("Attempting to set custom dimensions ".concat(e," to operation ").concat(this.operationName," without activating MetricCount or MetricDuration"));this.options.metricCustomDimensions=this.options.metricCustomDimensions||{},this.options.metricCustomDimensions[e]=t}},{key:"setDataField",value:function(e,t){this[f]||(this[f]={}),this[f][e]=t,this[p]=!0}},{key:"setDataFields",value:function(e){this[f]||(this[f]={}),this[f]=Object.assign(Object.assign({},this[f]),e),this[p]=!0}},{key:"start",value:function(){return this.startTime=(0,d.now)(),this}},{key:"recordStep",value:function(e){return this.setDataField(e,Math.floor((0,d.now)()-this.startTime)),this}},{key:"stop",value:function(){var e=(0,d.now)();return this.durationMs=Math.round(e-this.startTime),this}},{key:"addCustomMetric",value:function(e){void 0===this.customMetrics&&(this.customMetrics=[]),this.customMetrics.push(e)}},{key:"getCustomMetrics",value:function(){var e=this,t=[];if(void 0!==this.customMetrics){var n,o=(0,r.default)(this.customMetrics);try{var s=function(){var o=n.value,r={};r["".concat(e.operationName,".").concat(o.nameSuffix)]={dimensionNames:function(){return function(t){return[].concat((0,i.default)(e.getDimensionNames()),(0,i.default)(t.extraDimensions.map((function(e){return e.name}))))}(o)},dimensionValues:[].concat((0,i.default)(e.getDimensionValues()),(0,i.default)(o.extraDimensions.map((function(e){return e.value})))),value:o.value},t.push(r)};for(o.s();!(n=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}}return t}},{key:"getMetrics",value:function(e){var n,o,r={};if(this.operationName)switch(this.operationName){case"SessionHealthOrphanedEventsWithoutProperSessionKey":case"SessionHealthOrphanedSessions":case"WorkflowActivationState":r[this.operationName+".CountV2"]={dimensionNames:t.getOrphanedSessionHealthDimensionNames.bind(t),dimensionValues:this.getOrphanedSessionHealthDimensionValues(),value:this.count};break;case"MarkUnhealthySession":case"MarkHealthWarningSession":r[this.operationName+".Reason"]={dimensionNames:t.getSessionHealthDimensionNames.bind(t),dimensionValues:this.getSessionHealthDimensionValues(),value:1};break;default:if("matchmaker_timer"===this.operationName&&(r["Workflow.DurationMs"]={dimensionNames:t.getWorkflowDimensionNames.bind(t),dimensionValues:this.getWorkflowDimensionValues(),value:this.durationMs||0},r["Workflow.Count"]={dimensionNames:t.getWorkflowDimensionNames.bind(t),dimensionValues:this.getWorkflowDimensionValues(),value:1}),void 0!==this.durationMs){var i="".concat(this.operationName,".DurationMsV2");((null===(n=this.options)||void 0===n?void 0:n.metricDuration)||e.indexOf(i)>=0)&&(r[i]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues(),value:this.durationMs})}var s="".concat(this.operationName,".CountV2");((null===(o=this.options)||void 0===o?void 0:o.metricCount)||e.indexOf(s)>=0)&&(r[s]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues(),value:this.count})}return r}},{key:"getDimensionNames",value:function(){var e,n,o=t.dimensionNames;if(null===(e=this.options)||void 0===e?void 0:e.metricCustomDimensions)for(var r in o=o.slice(),null===(n=this.options)||void 0===n?void 0:n.metricCustomDimensions)o.push(r);return o}},{key:"getDimensionValues",value:function(){var e,t,n=[this.success,this.clientAppName,this.clientAppPlatform,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3];if(null===(e=this.options)||void 0===e?void 0:e.metricCustomDimensions)for(var o in null===(t=this.options)||void 0===t?void 0:t.metricCustomDimensions)n.push(this.options.metricCustomDimensions[o]);return n}},{key:"getOrphanedSessionHealthDimensionValues",value:function(){return[this.success,this.clientAppName,this.clientAppPlatform,this.clientReleaseAudienceGroup,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}},{key:"getSessionHealthDimensionValues",value:function(){return[this.resultSignature,this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}},{key:"getWorkflowDimensionValues",value:function(){return[this.resultSignature,this.resourceId,this.resourceId,this.success]}}],[{key:"getOrphanedSessionHealthDimensionNames",value:function(){return this.orphanedSessionHealthDimensionNames}},{key:"getSessionHealthDimensionNames",value:function(){return this.sessionHealthDimensionNames}},{key:"getWorkflowDimensionNames",value:function(){return this.workflowDimensionNames}}])}(c.OperationEvent);n.Operation=h,h.dimensionNames=["Success","ClientAppName","ClientAppPlatform","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],h.orphanedSessionHealthDimensionNames=["Success","ClientAppName","ClientAppPlatform","ClientReleaseAudienceGroup","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],h.sessionHealthDimensionNames=["Reason","ClientAppName","ClientAppPlatform","ClientAppVersion","Dimension0","Dimension1","Dimension2","Dimension3"],h.workflowDimensionNames=["ResultSignature","WorkflowId","ResourceId","Success"],Object.defineProperty(h.prototype,"dataFields",{get:function(){var e,t;return this[p]&&(this[g]=JSON.stringify(null!==(e=this[f])&&void 0!==e?e:{}),this[p]=!1),void 0!==this[p]?this[g]:null!==(t=this[g])&&void 0!==t?t:""},set:function(e){this[f]=e&&""!==e?JSON.parse(e):{},this[g]=e,this[p]=!1},enumerable:!0,configurable:!0})},{109:109,21:21,218:218,22:22,24:24,25:25,29:29,30:30,51:51}],111:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.PerformanceEventType=void 0,function(e){e.Log="Log"}(o||(n.PerformanceEventType=o={}))},{}],112:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24)),s=o(e(21)),a=o(e(29));Object.defineProperty(n,"__esModule",{value:!0}),n.SessionHealth=n.SessionHealthImpact=n.SessionHealthReason=n.SessionHealthSource=void 0;var u,l,c,d=e(218),f=e(109);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(u||(n.SessionHealthSource=u={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(l||(n.SessionHealthReason=l={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(c||(n.SessionHealthImpact=c={}));var p=function(e){function t(e,n){var o,i,a;return(0,r.default)(this,t),(o=(0,s.default)(this,t,[{source:u[e.source],reason:l[e.reason],reasonDependency:e.reasonDependency,subReason:e.subReason,sessionHealthEventName:e.sessionHealthEventName,impact:c[e.impact],success:e.success,durationMs:null!==(i=e.durationMs)&&void 0!==i?i:0,count:"number"==typeof e.count?e.count:1,message:e.message,affectedWorkflows:(null!==(a=e.affectedWorkflows)&&void 0!==a?a:[]).join(","),resourceId:e.resourceId,dimension0:e.dimension0,dimension1:e.dimension1,dimension2:e.dimension2,dimension3:e.dimension3,cv:e.cv,resultSignature:e.resultSignature,resultDescription:e.resultDescription,joinContextId:e.joinContextId}])).eventName="SessionHealth",o.aggregationEnabled=!1,n&&o.setClientMetadata(n,!0),o.metricCount=e.metricCount,o.metricDuration=e.metricDuration,o}return(0,a.default)(t,e),(0,i.default)(t,[{key:"getMetrics",value:function(){var e={};return(void 0===this.metricCount||this.metricCount)&&(e["".concat(this.sessionHealthEventName,".CountV2")]={dimensionNames:function(){return t.dimensionNames},dimensionValues:this.getDimensionValues(),value:this.count}),(void 0===this.metricDuration||this.metricDuration)&&(e["".concat(this.sessionHealthEventName,".DurationMsV2")]={dimensionNames:function(){return t.dimensionNames},dimensionValues:this.getDimensionValues(),value:this.durationMs}),e}},{key:"setClientMetadata",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDocSessionId=e.docSessionId,this.clientUserAgent=e.userAgent,t&&(this.clientFlights=e.flights)),this}},{key:"setUserContext",value:function(e){return e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString(),this.userTenantId=e.tid),this}},{key:"setReason",value:function(e){return this.reason=l[e],this}},{key:"setSource",value:function(e){return this.source=u[e],this}},{key:"setImpact",value:function(e){return this.impact=c[e],this}},{key:"setAffectedWorkflows",value:function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this}},{key:"getAffectedWorkflows",value:function(){return this.affectedWorkflows.split(",")}},{key:"enableAggregation",value:function(){return this.aggregationEnabled=!0,this}},{key:"shouldBeAggregated",value:function(){return this.aggregationEnabled}},{key:"start",value:function(){return this.startTime=(0,f.now)(),this}},{key:"stop",value:function(){var e=(0,f.now)();return this.durationMs=Math.round(e-this.startTime),this}},{key:"getDimensionValues",value:function(){var e;return[this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.success?"1":"0","".concat(this.reason,"_").concat(this.reasonDependency),this.impact,null!==(e=this.getAffectedWorkflows()[0])&&void 0!==e?e:"",this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}}])}(d.SessionHealthEvent);n.SessionHealth=p,p.dimensionNames=["ClientAppName","ClientAppPlatform","ClientAppVersion","Success","Reason","Impact","FirstAffectedWorkflow","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"]},{109:109,21:21,218:218,22:22,24:24,29:29,30:30}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.acceptsSeedingStatusChangeMessages=n.acceptsClaimsChallengeMessages=void 0,n.acceptsClaimsChallengeMessages="_acceptsClaimsChallengeMessages",n.acceptsSeedingStatusChangeMessages="_acceptsSeedingStatusChangeMessages"},{}],114:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(113),n),o.__exportStar(e(115),n),o.__exportStar(e(116),n),o.__exportStar(e(117),n),o.__exportStar(e(119),n),o.__exportStar(e(120),n),o.__exportStar(e(121),n)},{113:113,115:115,116:116,117:117,119:119,120:120,121:121}],115:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionState=n.ContextIdManager=n.supportedOperationSet=n.RuntimeKind=void 0;var a,u=e(227),l=e(105),c=e(119);!function(e){e.JsClient="C",e.Server="S"}(a||(n.RuntimeKind=a={})),n.supportedOperationSet=new Set([u.AddOperation.getTypeName(),u.UpdateOperation.getTypeName(),u.SignalOperation.getTypeName(),u.DeltaUpdateOperation.getTypeName()]);var d,f=function(){return(0,s.default)((function e(t,n){(0,i.default)(this,e),this.nextId=1,this.runtimeKind=t,this.workflowGraph=n}),[{key:"applyContextIdOnOperations",value:function(e){var t,n=(0,r.default)(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,i=u.SchemaObject.getTypeNameFor(o);if(this.isSupportedOperation(i)){var s,a=(0,r.default)(o.items);try{for(a.s();!(s=a.n()).done;){var c=s.value;c.contextId?c.source&&this.workflowGraph.getWorkflow(c.source,!1)?c.contextId=this.addNewContextId(c.contextId):this.tryLogMessage(new l.Operation({operationName:"ApplyContextIdOnOperations",success:!0}).start(),"Item with a contextId but without a workflow source atribute"):c.contextId=this.addNewContextId()}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"addNewContextId",value:function(e){var t="".concat(this.runtimeKind).concat(this.nextId++);return e?"".concat(e,".").concat(t):t}},{key:"isSupportedOperation",value:function(e){return n.supportedOperationSet.has(e)}},{key:"tryLogMessage",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&(e.success=n,e.resultDescription=t,l.Log.verbose(527308633,l.LogCategory.CoreDefault,e.stop()))}}],[{key:"isParentContextId",value:function(e,t){return(0,c.isParentContextId)(e,t)}}])}();n.ContextIdManager=f,function(e){e[e.Idle=1]="Idle",e[e.Pending=2]="Pending",e[e.Running=3]="Running",e[e.Executed=4]="Executed"}(d||(n.ExecutionState=d={}))},{105:105,119:119,22:22,227:227,24:24,25:25,30:30}],116:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(51));Object.defineProperty(n,"__esModule",{value:!0}),n.findRangeForDeltaType=n.applyFormattedTextTileDelta=n.applyTextTileDelta=void 0;var s=e(105),a=e(227),u=e(240),l=[u.TextTileDeltaType.CursorUpdate,u.TextTileDeltaType.FormattingUpdate,u.TextTileDeltaType.OtherNonContentUpdate,u.TextTileDeltaType.AttributionUpdate];function c(e,t){var n,o,s,a,l,c=(null===(n=t.attributionData)||void 0===n?void 0:n.ranges)||t.attributionRanges;if((null===(o=t.attributionData)||void 0===o?void 0:o.isFullUpdate)||t.deltaType!==u.TextTileDeltaType.AttributionUpdate&&void 0!==c)return c;if(!(null===(s=e.attributionRanges)||void 0===s?void 0:s.length)&&!c||t.deltaType===u.TextTileDeltaType.Update&&0===t.length)return e.attributionRanges;var f=e.attributionRanges?(0,i.default)(e.attributionRanges):[];if(t.deltaType!==u.TextTileDeltaType.AttributionUpdate){var p=d(e.attributionRanges,t.deltaType,t.position),g=p?f.indexOf(p):-1;-1!==g&&(p.length=t.position-p.start);var h,y=(null!==(a=t.content)&&void 0!==a?a:"").length,v=null!==(l=t.length)&&void 0!==l?l:0,m=t.position+v,k=t.position+y,T=(0,r.default)(f.slice(g+1));try{for(T.s();!(h=T.n()).done;){var S=h.value;if(!(S.start<t.position)){var b=S.start+S.length;m>S.start&&(S.length=b-m),S.start=Math.max(S.start+y-v,k)}}}catch(e){T.e(e)}finally{T.f()}return f=f.filter((function(e){return e.length>0}))}var C,w=[],_=(0,r.default)(c);try{for(_.s();!(C=_.n()).done;){var M=C.value;0!==w.length?w[w.length-1].start+w[w.length-1].length>=M.start?w[w.length-1].length=M.start+M.length-w[w.length-1].start:w.push({start:M.start,length:M.length}):w.push({start:M.start,length:M.length})}}catch(e){_.e(e)}finally{_.f()}f=f.filter((function(e){return e.length>0&&!function(e){for(var t=0,n=w;t<n.length;t++){var o=n[t];if(o.start<=e.start&&o.start+o.length>=e.start+e.length)return!0}return!1}(e)})),null==c||c.forEach((function(e){f.push(e)})),f.sort((function(e,t){return e.start-t.start}));var A,O,I,x=[],P=(0,r.default)(f);try{for(P.s();!(A=P.n()).done;){var L=A.value,E=x.length>0?x[x.length-1]:void 0;E&&E.start+E.length>L.start&&(E.length=Math.max(L.start-E.start,0)),!E||(I=L,(O=E).attribution.userId!==I.attribution.userId||O.attribution.timestamp!==I.attribution.timestamp||O.attribution.dataSource!==I.attribution.dataSource)||L.start>E.start+E.length?x.push(L):E.length+=Math.max(L.start+L.length-(E.start+E.length),0)}}catch(e){P.e(e)}finally{P.f()}return x}function d(e,t,n){var o=new s.Operation({operationName:"FindRangeForDelta",success:!0});if(o.start(),!e)return o.resultDescription="No formatted ranges found within the tile, skipping.",void s.Log.info(538798212,s.LogCategory.CoreDefault,o.stop());if(t===u.TextTileDeltaType.Add){var r=e.find((function(e){return e.start===n&&0===e.length}));if(r)return o.resultDescription="Found a zero-length formatted range for add operation with start ".concat(r.start,"."),s.Log.info(538798213,s.LogCategory.CoreDefault,o.stop()),r;n=Math.max(n-1,0)}var i=e.find((function(e){return 0===e.length?e.start===n:e.start<=n&&n<e.start+e.length}));return i?(o.resultDescription="Updating formatted range for operation with start: ".concat(i.start," and length: ").concat(i.length),s.Log.info(538798214,s.LogCategory.CoreDefault,o.stop())):(o.resultDescription="Unable to find formatted range for operation at position ".concat(n,", skipping."),s.Log.info(538798215,s.LogCategory.CoreDefault,o.stop())),i}function f(e){return-1!==l.indexOf(e)}function p(e){return f(e)||u.TextTileDeltaType.Delete===e}n.applyTextTileDelta=function(e,t,n){var o=new s.Operation({operationName:"ApplyTextTileDeltaForLocalWorkflows",dimension0:"0",success:!0}).start();try{if(!t)return o.success=!1,o.resultDescription="Unable to apply text tile delta, parent tile is undefined",void s.Log.info(538798173,s.LogCategory.CoreDefault,o.stop());if(a.SchemaObject.getTypeNameFor(t)!==u.TextTile.getTypeName())return o.success=!1,o.resultDescription="Unable to apply text tile delta, parent tile is not proper type: expected ".concat(u.TextTileDelta.getTypeName(),", received ").concat(a.SchemaObject.getTypeNameFor(t)),void s.Log.info(538798174,s.LogCategory.CoreDefault,o.stop());var r=e,i=t.content,l="";if(void 0===r.position||r.position<0)return o.success=!1,o.resultDescription="Unable to apply text tile delta, invalid text tile position",void s.Log.info(538798175,s.LogCategory.CoreDefault,o.stop());switch(r.deltaType){case u.TextTileDeltaType.Add:l=r.position<i.length?"".concat(i.slice(0,r.position)).concat(r.content).concat(i.slice(r.position,i.length)):i+r.content;break;case u.TextTileDeltaType.Update:r.content||r.unit!==u.TextTileDeltaUnit.Sentence||(o.dimension0="1"),l="".concat(i.slice(0,r.position)).concat(r.content).concat(i.slice(r.position+(r.length||0),i.length));break;case u.TextTileDeltaType.Delete:l="".concat(i.slice(0,r.position)).concat(i.slice(r.position+(r.length||0),i.length))}return s.Log.info(538837071,s.LogCategory.CoreDefault,o.stop()),new u.TextTile({content:l})}catch(e){return o.success=!1,o.resultDescription="Error applying text tile delta: ".concat(e),void s.Log.info(538798176,s.LogCategory.CoreDefault,o.stop())}},n.applyFormattedTextTileDelta=function(e,t,n){var o,l,g,h,y=new s.Operation({operationName:"ApplyFormattedTextTileDeltaForLocalWorkflows",dimension0:"0",success:!0}).start();y.clientFlights=n;try{if(!t)return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, parent tile is undefined",void s.Log.info(538798177,s.LogCategory.CoreDefault,y.stop());if(a.SchemaObject.getTypeNameFor(t)!==u.FormattedTextTile.getTypeName())return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, parent tile is not proper type: expected ".concat(u.FormattedTextTile.getTypeName(),", received ").concat(a.SchemaObject.getTypeNameFor(t)),void s.Log.info(538798178,s.LogCategory.CoreDefault,y.stop());var v=t,m=e,k=v.content,T="";if((void 0===m.position||m.position<0)&&!p(m.deltaType))return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, invalid text tile position",void s.Log.info(538798179,s.LogCategory.CoreDefault,y.stop());if(void 0===m.content&&!p(m.deltaType))return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, non-delete, non-formatting, non-other-non-content-update and non-cursor-update operation without content defined",void s.Log.info(538798208,s.LogCategory.CoreDefault,y.stop());if(m.deltaType===u.TextTileDeltaType.Add&&0!==m.length?s.Log.info(538798209,s.LogCategory.CoreDefault,new s.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta add operation with delta length, expected length 0",success:!0})):p(m.deltaType)&&void 0!==m.content&&s.Log.info(538798210,s.LogCategory.CoreDefault,new s.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta delete or non-content related operation with content defined, expected undefined",success:!0})),!f(m.deltaType)){var S=function(e,t){var n,o,s,a,u=d(e.formattedRanges,t.deltaType,t.position),l=e.formattedRanges?(0,i.default)(e.formattedRanges):[],c=u?l.indexOf(u):-1;-1!==c&&(t.position+(t.length||0)>u.start+u.length?u.length=t.position+(null!==(n=t.content)&&void 0!==n?n:"").length-u.start:u.length+=(null!==(o=t.content)&&void 0!==o?o:"").length-(t.length||0),l[c]=u);var f,p=(0,r.default)(l.slice(c+1));try{for(p.s();!(f=p.n()).done;){var g=f.value;g.start<t.position||(t.position+(t.length||0)>g.start?(g.length=g.start+g.length-(t.position+(t.length||0)),g.start=t.position+(null!==(s=t.content)&&void 0!==s?s:"").length):g.start+=(null!==(a=t.content)&&void 0!==a?a:"").length-(t.length||0))}}catch(e){p.e(e)}finally{p.f()}return l=l.filter((function(e){return e.length>0}))}(v,m),b=c(v,m),C=v.ipPosition;switch(m.deltaType){case u.TextTileDeltaType.Add:T=m.position<k.length?"".concat(k.slice(0,m.position)).concat(m.content).concat(k.slice(m.position,k.length)):k+m.content,C=m.position+m.length;break;case u.TextTileDeltaType.Update:m.content||m.unit!==u.TextTileDeltaUnit.Sentence||(y.dimension0="1"),T="".concat(k.slice(0,m.position)).concat(m.content).concat(k.slice(m.position+(null!==(o=m.length)&&void 0!==o?o:0),k.length)),C=m.position+m.content.length;break;case u.TextTileDeltaType.Delete:T="".concat(k.slice(0,m.position)).concat(k.slice(m.position+(null!==(l=m.length)&&void 0!==l?l:0),k.length)),C=m.position}var w=new u.FormattedTextTile(Object.assign(Object.assign({},v),{ipPosition:C,content:T,formattedRanges:S,attributionRanges:b,queryRange:m.queryRange}));return s.Log.info(538837073,s.LogCategory.CoreDefault,y.stop()),w}if(m.deltaType===u.TextTileDeltaType.CursorUpdate)return new u.FormattedTextTile(Object.assign(Object.assign({},v),{ipPosition:null===(g=m.cursorData)||void 0===g?void 0:g.ipPosition,isColdIp:null===(h=m.cursorData)||void 0===h?void 0:h.isColdIp}));if(m.deltaType===u.TextTileDeltaType.FormattingUpdate)return new u.FormattedTextTile(Object.assign(Object.assign({},v),{formattedRanges:m.formattedRanges}));if(m.deltaType===u.TextTileDeltaType.OtherNonContentUpdate){var _,M={};for(_ in m.otherNonContentData)M[_]=m.otherNonContentData[_];return new u.FormattedTextTile(Object.assign(Object.assign({},v),M))}return m.deltaType===u.TextTileDeltaType.AttributionUpdate?new u.FormattedTextTile(Object.assign(Object.assign({},v),{attributionRanges:c(v,m)})):void 0}catch(e){return y.success=!1,y.resultDescription="Error applying formatted text tile delta: ".concat(e),void s.Log.info(538798211,s.LogCategory.CoreDefault,y.stop())}},n.findRangeForDeltaType=d},{105:105,227:227,240:240,25:25,30:30,51:51}],117:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.DynamicWorkflowDefinitionManager=void 0;var s=e(119),a=function(){function e(){(0,r.default)(this,e),this.workflowDefByWorkflowAndContextId=new Map,this.workflowDefByWorkflow=new Map}return(0,i.default)(e,[{key:"mergeWorkflowDefinition",value:function(t,n,o){if(o){var r=(0,s.getOrSetDefaultValue)(this.workflowDefByWorkflowAndContextId,t.id,(function(){return new Map}));r.set(o,e.mergeDefinitions(t,r.get(o),n))}else this.workflowDefByWorkflow.set(t.id,e.mergeDefinitions(t,this.workflowDefByWorkflow.get(t.id),n))}},{key:"getWorkflowDefinition",value:function(e,t){var n,o;return t&&(o=null===(n=this.workflowDefByWorkflowAndContextId.get(e.id))||void 0===n?void 0:n.get(t)),o||(o=this.workflowDefByWorkflow.get(e.id)),o||(o=e),o}},{key:"deleteWorkflowDefinition",value:function(e,t){var n=this.workflowDefByWorkflowAndContextId.get(e.id);n&&(n.delete(t),0===n.size&&this.workflowDefByWorkflowAndContextId.delete(e.id))}}],[{key:"mergeDefinitions",value:function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}}])}();n.DynamicWorkflowDefinitionManager=a},{119:119,22:22,24:24,30:30}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createBlobStorageContainerOnSessionInit=n.maxAdditionalItemsAllowedForGridNeighborhoodWorkflow=n.gridWorkflowRecommendedInitialGridHeights=n.gridWorkflowCellsInGridLimit=n.workflowOrchestrationFrameworkEnabledRegularPath=n.workflowOrchestrationFrameworkEnabled=n.logGetAnnotationsRequestError=n.createSessionNodeOnSessionInit=void 0;var o=e(211);n.createSessionNodeOnSessionInit=new o.SettingInstance("createSessionNodeOnSessionInit",!0),n.logGetAnnotationsRequestError=new o.SettingInstance("logGetAnnotationsRequestError",!1),n.workflowOrchestrationFrameworkEnabled=new o.SettingInstance("workflowOrchestrationFrameworkEnabled",!0),n.workflowOrchestrationFrameworkEnabledRegularPath=new o.SettingInstance("workflowOrchestrationFrameworkEnabledRegularPath",!1),n.gridWorkflowCellsInGridLimit=new o.SettingInstance("gridWorkflowCellsInGridLimit",8e3),n.gridWorkflowRecommendedInitialGridHeights=new o.SettingInstance("gridWorkflowRecommendedInitialGridHeights",[2e3,1e3,500,100,20,10,5]),n.maxAdditionalItemsAllowedForGridNeighborhoodWorkflow=new o.SettingInstance("workflowMaxItems",1e3),n.createBlobStorageContainerOnSessionInit=new o.SettingInstance("createBlobStorageContainerOnSessionInit",!1)},{211:211}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getWorkflowCollectionScopeTypesOrDefault=n.isBlobLocationItemValid=n.getRichContentContextForWorkflowExecution=n.isWaitingForUpstreamWorkflows=n.isWorkflowWithDelay=n.isWorkflowTriggeredByNonExclusiveSignals=n.isSignalTriggeredWorkflow=n.isParentContextId=n.compareRevisions=n.isHybridWorkflow=n.getWorkflowDefinitionBase=n.getOrSetDefaultValue=void 0;var o=e(86),r=e(211),i=e(227),s=e(118),a=new r.SettingInstance("enableRichContentApis",!1);n.getOrSetDefaultValue=function(e,t,n){var o=e.get(t);return o||(o=n(),e.set(t,o)),o};n.getWorkflowDefinitionBase=function(e){return{id:e.id,kind:e.kind,visibility:e.visibility,collectionScopeType:e.collectionScopeType,inputTypes:e.inputTypes,outputTypes:e.outputTypes,correlatedSignals:e.correlatedSignals}};n.isHybridWorkflow=function(e){return Array.isArray(e.correlatedSignals)&&e.correlatedSignals.length>0};n.compareRevisions=function(e,t){return e.revId&&t.revId&&e.revId!==t.revId?parseInt(e.revId,10)>parseInt(t.revId,10)?1:-1:0};n.isParentContextId=function(e,t){return null!=e&&(null!=t&&(e.length>0&&(e===t||0===t.indexOf(e)&&"."===t.charAt(e.length))))};n.isSignalTriggeredWorkflow=function(e){return Array.isArray(e.triggerSignals)&&e.triggerSignals.length>0};n.isWorkflowTriggeredByNonExclusiveSignals=function(e){var t,n;return null!==(n=null===(t=e.triggerConditions)||void 0===t?void 0:t.indexOf(o.TriggerCondition.NonExclusiveTriggerSignals)>=0)&&void 0!==n&&n};n.isWorkflowWithDelay=function(e){return!(void 0===e.minDelayMs&&void 0===e.maxDelayMs)};n.isWaitingForUpstreamWorkflows=function(e){var t;return null===(t=e.triggerConditions)||void 0===t?void 0:t.indexOf(o.TriggerCondition.UpstreamWorkflowsReady)>=0};n.getRichContentContextForWorkflowExecution=function(e){if(a.getValue()){if(!(0,r.ChangeGate)("EnableMultiBlobStorage")){var t=e.getItem(["session","filesBlobLocation"]),i=null==t?void 0:t.body;return(0,n.isBlobLocationItemValid)(i)?{codedLocation:i.dataPointer.value}:void 0}var s=e.tryGetItem(["session",o.blobContainerNodeName,o.RichContentBlobNodeName.FileParts]),u=e.tryGetItem(["session",o.blobContainerNodeName,o.RichContentBlobNodeName.FullFile]),l=null==s?void 0:s.body,c=null==u?void 0:u.body;return(0,n.isBlobLocationItemValid)(l)||(0,n.isBlobLocationItemValid)(c)?{codedLocations:Object.assign(Object.assign({},(0,n.isBlobLocationItemValid)(l)&&{fileParts:l.dataPointer.value}),(0,n.isBlobLocationItemValid)(c)&&{fullFile:c.dataPointer.value})}:void 0}};n.isBlobLocationItemValid=function(e){var t;return void 0!==(null===(t=null==e?void 0:e.dataPointer)||void 0===t?void 0:t.value)};n.getWorkflowCollectionScopeTypesOrDefault=function(e){return s.createSessionNodeOnSessionInit.getValue()?e.collectionScopeType?[e.collectionScopeType]:[void 0,i.Session.getTypeName()]:[e.collectionScopeType]}},{118:118,211:211,227:227,86:86}],120:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(51)),i=o(e(25)),s=o(e(22)),a=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.GraphNode=n.WorkflowGraph=n.Location=void 0;var u,l=e(86),c=e(105);!function(e){e[e.Local=0]="Local",e[e.External=1]="External"}(u||(n.Location=u={}));var d=function(){return(0,a.default)((function e(){(0,s.default)(this,e),this.graphNodeByLocationAndWorkflowId=new Map}),[{key:"getWorkflow",value:function(e,t){var n,o=this.getLocation(t);return null===(n=this.graphNodeByLocationAndWorkflowId.get(o))||void 0===n?void 0:n.get(e)}},{key:"addWorkflow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.getWorkflow(e.id,t)){var n=new c.Operation({operationName:"AddWorkflowToGraphFailure",success:!1,resourceId:e.id,resultDescription:"Adding a new with workflow with a duplicated workflowId: ".concat(t)}).start();c.Log.error(524300630,c.LogCategory.CoreDefault,n.stop())}else{var o=this.getLocation(t),r=new f(e,o);this.addWorkflowAsDependency(r);var i=this.graphNodeByLocationAndWorkflowId.get(o);i||(i=new Map,this.graphNodeByLocationAndWorkflowId.set(o,i)),i.set(e.id,r)}}},{key:"getUpstreamRuntimeVisibleWorkflows",value:function(){var e,t=[],n=(0,i.default)(this.graphNodeByLocationAndWorkflowId.values()||[]);try{for(n.s();!(e=n.n()).done;){var o,s=e.value,a=(0,i.default)(s.values()||[]);try{for(a.s();!(o=a.n()).done;){var u,c=o.value,d=this.createWorkflowDefinition(c.workflow);if(c.workflow.visibility===l.WorkflowVisibility.LocalOnly)this.compressDownstreamWorkflows(d,c);else(u=d.outputTypes).push.apply(u,(0,r.default)(c.workflow.outputTypes));0!==d.inputTypes.length&&t.push(d)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"removeWorkflows",value:function(e){for(var t=this.getLocation(e),n=this.graphNodeByLocationAndWorkflowId.get(t),o=0,r=Array.from((null==n?void 0:n.values())||[]);o<r.length;o++){var s,a=r[o],u=(0,i.default)(a.upstreamWorkflows.values());try{for(u.s();!(s=u.n()).done;){s.value.downstreamWorkflows.delete(a)}}catch(e){u.e(e)}finally{u.f()}var l,c=(0,i.default)(a.downstreamWorkflows.values());try{for(c.s();!(l=c.n()).done;){l.value.upstreamWorkflows.delete(a)}}catch(e){c.e(e)}finally{c.f()}n.delete(a.workflow.id)}}},{key:"getWorkflowsDefinitions",value:function(){var e,t=[],n=(0,i.default)(this.graphNodeByLocationAndWorkflowId.values()||[]);try{for(n.s();!(e=n.n()).done;){var o,r=e.value,s=(0,i.default)(r.values()||[]);try{for(s.s();!(o=s.n()).done;){var a=o.value;t.push(a.workflow)}}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getWorkflowNodes",value:function(e){var t,n=[],o=(0,i.default)(this.graphNodeByLocationAndWorkflowId.values());try{for(o.s();!(t=o.n()).done;){var r,s=t.value,a=(0,i.default)(s.values());try{for(a.s();!(r=a.n()).done;){var u=r.value;n.push(u)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"getLocation",value:function(e){return e?u.External:u.Local}},{key:"createWorkflowDefinition",value:function(e){return Object.assign(Object.assign({},e),{outputTypes:[]})}},{key:"compressDownstreamWorkflows",value:function(e,t){var n,o=(0,i.default)(t.downstreamWorkflows);try{for(o.s();!(n=o.n()).done;){var r=n.value;if(r.workflow.visibility!==l.WorkflowVisibility.LocalOnly){if(r.workflow.kind!==l.WorkflowKind.Join||-1!==e.inputTypes.indexOf(r.workflow.collectionScopeType)){var s,a=(0,i.default)(r.workflow.outputTypes);try{for(a.s();!(s=a.n()).done;){var u=s.value;-1===e.outputTypes.indexOf(u)&&e.outputTypes.push(u)}}catch(e){a.e(e)}finally{a.f()}}}else this.compressDownstreamWorkflows(e,r)}}catch(e){o.e(e)}finally{o.f()}}},{key:"addWorkflowAsDependency",value:function(e){var t,n=(0,i.default)(this.graphNodeByLocationAndWorkflowId.values());try{for(n.s();!(t=n.n()).done;){var o,r=t.value,s=(0,i.default)(r.values());try{for(s.s();!(o=s.n()).done;){var a,u=o.value,l=(0,i.default)(u.workflow.inputTypes);try{for(l.s();!(a=l.n()).done;){var c=a.value;-1!==e.workflow.outputTypes.indexOf(c)&&this.addWorkflowChain(e,u)}}catch(e){l.e(e)}finally{l.f()}var d,f=(0,i.default)(u.workflow.outputTypes);try{for(f.s();!(d=f.n()).done;){var p=d.value;-1!==e.workflow.inputTypes.indexOf(p)&&this.addWorkflowChain(u,e)}}catch(e){f.e(e)}finally{f.f()}}}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"addWorkflowChain",value:function(e,t){e.downstreamWorkflows.add(t),t.upstreamWorkflows.add(e)}}])}();n.WorkflowGraph=d;var f=(0,a.default)((function e(t,n){(0,s.default)(this,e),this.isActivated=!0,this.upstreamWorkflows=new Set,this.downstreamWorkflows=new Set,this.location=n,this.workflow=Object.assign(Object.assign({},t),{inputTypes:Array.isArray(t.inputTypes)?t.inputTypes:[],outputTypes:Array.isArray(t.outputTypes)?t.outputTypes:[]})}));n.GraphNode=f},{105:105,22:22,24:24,25:25,30:30,51:51,86:86}],121:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(48)),i=o(e(25)),s=o(e(51)),a=o(e(22)),u=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowItemStorage=void 0;var l=e(105),c=e(119),d=e(197),f=function(){return(0,u.default)((function e(t){(0,a.default)(this,e),this.scopeItemsByContextId=new Map,this.itemsByWorkflowAndContextId=new Map,this.workflowDefinitionManager=t}),[{key:"setScopeItem",value:function(e,t){var n,o=e.contextId;if(o)if(this.itemsByWorkflowAndContextId.has(t.id)||this.itemsByWorkflowAndContextId.set(t.id,new Map),this.itemsByWorkflowAndContextId.get(t.id).set(o,[]),this.scopeItemsByContextId.has(o)){if(null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.has(o)){var r=new l.Operation({resultDescription:"Trying to set new scope item: ".concat(e.id," with already existing contextId ").concat(o," for workflow ").concat(t.id),operationName:"WIS.setScopeItem",resourceId:t.id,success:!0}).start();l.Log.verbose(527291288,l.LogCategory.CoreDefault,r.stop())}}else this.scopeItemsByContextId.set(o,e)}},{key:"updateScopeItemPath",value:function(e,t,n){var o,r;if(e){var i=this.scopeItemsByContextId.get(e);if(i){var a=i.parentPath;this.scopeItemsByContextId.set(e,(0,d.shallowCloneItemWithPath)(t,i));for(var u=null!==(r=null===(o=this.itemsByWorkflowAndContextId.get(n.id))||void 0===o?void 0:o.get(e))&&void 0!==r?r:[],l=0;l<u.length;l++)u[l]=(0,d.shallowCloneItemWithPath)([].concat((0,s.default)(t),(0,s.default)(u[l].parentPath.slice(0,a.length))),u[l])}}}},{key:"getScopeItem",value:function(e,t){var n,o,r=(0,i.default)((null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.keys())||[]);try{for(r.s();!(o=r.n()).done;){var s=o.value;if((0,c.isParentContextId)(s,e))return this.scopeItemsByContextId.get(s)}}catch(e){r.e(e)}finally{r.f()}}},{key:"addItemToWorkflowList",value:function(e,t){var n=e.contextId;if(n){var o=this.itemsByWorkflowAndContextId.get(t.id);if(o){var s,a=(0,i.default)(o);try{for(a.s();!(s=a.n()).done;){var u=(0,r.default)(s.value,2),d=u[0],f=u[1];if((0,c.isParentContextId)(d,n)){f.push(e);var p=new l.Operation({resultDescription:"Items for contextId ".concat(d,": [").concat(f.map((function(e){return e.id})).join(","),"]"),operationName:"WIS.addItemOnContextIdList",resourceId:t.id,success:!0}).start();l.Log.info(526403808,l.LogCategory.CoreDefault,p.stop())}}}catch(e){a.e(e)}finally{a.f()}}}}},{key:"isWorkflowReady",value:function(e,t){var n=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.getGeneratedItems(e,t).length>=n}},{key:"getItemsToExecute",value:function(e,t){var n=this.getGeneratedItems(e,t);return this.itemsByWorkflowAndContextId.get(t.id).delete(e),n}},{key:"onWorkflowExecuted",value:function(e,t){var n=e.contextId,o=this.itemsByWorkflowAndContextId.get(t.id);o&&(o.delete(n),0===o.size&&this.itemsByWorkflowAndContextId.delete(t.id)),this.hasWorkflowsAwaitingExecution(n)||this.scopeItemsByContextId.delete(n)}},{key:"getGeneratedItems",value:function(e,t){var n;if(!(null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.get(e)))return[];var o=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.itemsByWorkflowAndContextId.get(t.id).get(e).slice(0,o)}},{key:"hasWorkflowsAwaitingExecution",value:function(e){var t,n=(0,i.default)(this.itemsByWorkflowAndContextId.values());try{for(n.s();!(t=n.n()).done;){var o,r=t.value,s=(0,i.default)(r.keys());try{for(s.s();!(o=s.n()).done;){if(o.value===e)return!0}}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}return!1}}])}();n.WorkflowItemStorage=f},{105:105,119:119,197:197,22:22,24:24,25:25,30:30,48:48,51:51}],122:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(123),n)},{123:123}],123:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ModelDownloader=void 0;var a,u=e(105),l=e(62),c=e(57);!function(e){e.URL="URL",e.ArrayBuffer="ArrayBuffer"}(a||(a={}));var d=function(){return(0,s.default)((function e(t,n,o,r){var s=this;(0,i.default)(this,e),this.dbName="ALModels_db",this.osName="ALModels_os",this.dbVersion=2,this.modelPathsCache=new Map,this.isPolymerSupported=Boolean(o),this.baseURL="https://".concat(n,"/web/").concat(t),this.polymerBaseURL=this.isPolymerSupported?"https://".concat(o):"",this.fetchResource=null!=r?r:"undefined"!=typeof fetch?fetch:c.fetch;var a=new u.Operation({operationName:"CreateModelDownloader",success:!0,resultDescription:""});a.start(),this.isBrowserIdbCompatible().then((function(e){if(e){var t,n=0,o=0,r=0,i=new Promise((function(e,n){t=setTimeout((function(){n(new Error("Took longer than ".concat(1e4," ms")))}),1e4)})),l=s.accessDB().then((function(e){var t=e.transaction(s.osName,"readwrite");return t.objectStore(s.osName).openCursor().then((function e(i){if(r++,i){var s,a=i.value;return a.timesSinceUsage||(a.timesSinceUsage=0),a.timesSinceUsage++,a.timesSinceUsage>5?(o++,s=i.delete()):(n++,s=i.update(a)),s.then((function(){return i.continue()})).then(e)}return t.done}))}));s.initPromise=Promise.race([i,l]).catch((function(e){a.success=!1,a.resultDescription+="".concat(e.message," ")})).then((function(){a.dimension0="".concat(r),a.dimension1="".concat(n),a.dimension2="".concat(o),clearTimeout(t),s.closeDBAndEndLog(a,"initializing idb storage")}))}else a.resultDescription="Incompatible browser for IDB",u.Log.info(538706242,u.LogCategory.CoreDefault,a.stop())})).catch((function(){a.resultDescription="Issue determining idb compatibility",u.Log.info(536966936,u.LogCategory.CoreDefault,a.stop())}))}),[{key:"getResourceAsArrayBuffer",value:function(e,t,n){var o=new u.Operation({operationName:"GetResource",success:!0,resultDescription:"",dimension0:a.ArrayBuffer,dimension1:e,dimension2:t});o.start();var r={};return this.getResource(e,t,n,a.ArrayBuffer,o,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){var n=e.get(t);return n.arrayBuffer?n.arrayBuffer().then((function(e){r[t]=e})):new Promise((function(e,o){var i=new FileReader;i.readAsArrayBuffer(n),i.onload=function(n){var i=n.target.result;i instanceof ArrayBuffer?(r[t]=i,e()):o(new Error("Unable to obtain ArrayBuffer"))}}))})))})).then((function(){return r}))}},{key:"getKey",value:function(e,t,n){return n?"".concat(e,"_").concat(t,"_").concat(JSON.stringify(Array.from(n.entries()))):"".concat(e,"_").concat(t)}},{key:"updateCache",value:function(e,t,n,o){this.modelPathsCache.set(this.getKey(e,t,n),o)}},{key:"getCache",value:function(e,t,n){return this.modelPathsCache.get(this.getKey(e,t,n))}},{key:"getResourceAsURL",value:function(e,t,n){var o=this,r=new u.Operation({operationName:"GetResource",success:!0,resultDescription:"",dimension0:a.URL,dimension1:e,dimension2:t});r.start();var i={},s=this.getCache(e,t,n);return s?Promise.resolve(s):this.getResource(e,t,n,a.URL,r,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){i[t]=URL.createObjectURL(e.get(t))})))})).then((function(){var r=o.getCache(e,t,n);return r||(o.updateCache(e,t,n,i),i)}))}},{key:"getResource",value:function(e,t,n,o,r,i){var s=this;return this.getFiles(e,t,n,r).then((function(e){return i(e)})).then((function(){s.closeDBAndEndLog(r,"retrieving ".concat(e))})).catch((function(t){throw r.resultDescription.indexOf(t.message)>=0&&(r.success=!1,r.resultDescription+="".concat(t.message," ")),r.resultSignature="Issue retrieving from CDN or translating to ".concat(o),s.closeDBAndEndLog(r,"retrieving ".concat(e)),t}))}},{key:"checkFirefoxCompatibility",value:function(e){var t=globalThis.navigator.userAgent.substring(e+8,e+11);return t.replace(".",""),parseInt(t,10)<=70?new Promise((function(e,t){var n=globalThis.indexedDB.open(this.dbName,this.dbVersion);n.onsuccess=function(){e(!0)},n.onerror=function(e){return t(e),!0}})):Promise.resolve(!0)}},{key:"isBrowserIdbCompatible",value:function(){var e,t;return"undefined"==typeof Array||void 0===Array.from||"undefined"==typeof Proxy||"undefined"==typeof URL||void 0===URL.createObjectURL?Promise.resolve(!1):"undefined"!=typeof globalThis&&(null===(e=globalThis.navigator)||void 0===e?void 0:e.userAgent)?globalThis.navigator.userAgent.toLowerCase().indexOf("firefox")>-1?globalThis.indexedDB?this.checkFirefoxCompatibility(globalThis.navigator.userAgent.toLowerCase().indexOf("firefox")):Promise.resolve(!1):globalThis.navigator.userAgent.toLowerCase().indexOf("safari")>-1&&globalThis.navigator.userAgent.toLowerCase().indexOf("chrome")<=-1?(null===(t=globalThis.document)||void 0===t?void 0:t.hasStorageAccess)?globalThis.document.hasStorageAccess().then((function(){return!0})).catch((function(){return!1})):Promise.resolve(!1):Promise.resolve(!0):Promise.resolve(!1)}},{key:"accessDB",value:function(){var e=this;return this.accessDBPromise?this.accessDBPromise.then((function(t){return t.transaction(e.osName).done})).then((function(){return e.accessDBPromise})).catch((function(){return e.callOpenDB()})):this.callOpenDB()}},{key:"callOpenDB",value:function(){var e=this;return this.accessDBPromise=(0,l.openDB)(this.dbName,this.dbVersion,{upgrade:function(t){t.objectStoreNames.contains(e.osName)&&t.deleteObjectStore(e.osName),t.createObjectStore(e.osName,{keyPath:"id",autoIncrement:!0})}})}},{key:"endLog",value:function(e,t){e.success?(e.resultDescription="Success ".concat(t),u.Log.info(573329487,u.LogCategory.CoreDefault,e.stop())):(e.resultDescription+="error ".concat(t),u.Log.error(573329488,u.LogCategory.CoreDefault,e.stop()))}},{key:"closeDBAndEndLog",value:function(e,t){var n=this;this.accessDBPromise?this.accessDBPromise.then((function(e){e.close()})).catch((function(t){e.resultDescription.indexOf(t.message)>=0&&(e.success=!1,e.resultDescription+="".concat(t.message?t.message:"Error closing db"," "),e.resultSignature="Issue closing db")})).then((function(){n.accessDBPromise=void 0,n.endLog(e,t)})):this.endLog(e,t)}},{key:"getFiles",value:function(e,t,n,o){var r=this;return this.isBrowserIdbCompatible().catch((function(e){return o.success=!1,o.resultDescription+="".concat(e.message," "),o.resultSignature="Issue determining idb compatibility",!1})).then((function(i){var s=function(){if(n){if(r.isPolymerSupported)return r.downloadFiles1CDN(e,t,n,o,i);throw new Error("Missing polymerBaseURL provided at host level for queries with modelFilters")}return r.downloadFiles(e,t,o,i)};return i?r.getFilesFromIDB(e,t,n,o).catch((function(e){return e&&(o.resultDescription.indexOf(e.message)>=0&&(o.success=!1,o.resultDescription+="".concat(e.message," ")),o.resultSignature="Issue retrieving from DB"),s()})):s()}))}},{key:"getFilesFromIDB",value:function(e,t,n,o){var i=this;return this.initPromise.catch((function(e){o.success=!1,o.resultDescription+="".concat(e.message," "),o.resultSignature="Issue initializing"})).then((function(){return i.getModelOptions(e)})).then((function(s){var a,u=(0,r.default)(s);try{for(u.s();!(a=u.n()).done;){var l=a.value;if(l&&l.model&&l.version==t){if(!i.checkModelFiltersPass(n,l.filters))continue;return i.putModel(e,l.model,t,l.filters,o,l.id),Promise.resolve(l.model)}}}catch(e){u.e(e)}finally{u.f()}return Promise.reject()}))}},{key:"checkModelFiltersPass",value:function(e,t){var n,o,i=(0,r.default)(e);try{for(i.s();!(o=i.n()).done;){var s=o.value,a=null===(n=t.get(s[0]))||void 0===n?void 0:n.map((function(e){return e.toLocaleLowerCase()}));if(!a)throw new Error("Expected filter ".concat(s[0]," to exist in metadata file"));if(a.indexOf(s[1].toLocaleLowerCase())<0)return!1}}catch(e){i.e(e)}finally{i.f()}return!0}},{key:"downloadFiles1CDN",value:function(e,t,n,o,i){var s,a=this;return o.dimension3="Polymer",n||(n=new Map),this.fetchResource("".concat(this.polymerBaseURL,"/").concat(e,"/").concat(t,"/metadata.json")).then((function(e){if(e.ok)return e.text();throw new Error("CDN download response status: ".concat(e.status))})).then((function(i){var u,l,c=JSON.parse(i);if(c.name!==e||c.version!==t)throw new Error("Expected: ".concat(e," version ").concat(t,", received: ").concat(c.name," version ").concat(c.version));var d,f=(0,r.default)(c.variants);try{for(f.s();!(d=f.n()).done;){var p=d.value;if(s=new Map(Object.entries(p)),a.checkModelFiltersPass(n,s))return(c.catalog?n.size+2:n.size+1!==s.size)&&(o.success=!1,o.resultDescription+="Expected ".concat(null===(u=s.keys)||void 0===u?void 0:u.length," # of filters, received ").concat(null===(l=n.keys)||void 0===l?void 0:l.length)),p.model_files}}catch(e){f.e(e)}finally{f.f()}throw new Error("No model found with given filters")})).then((function(n){return Promise.all(n.map((function(n){return a.fetchResource("".concat(a.polymerBaseURL,"/").concat(e,"/").concat(t,"/").concat(n)).then((function(e){if(e.ok)return e.blob();throw new Error("CDN download response status: ".concat(e.status))})).then((function(e){return[n,e]}))})))})).then((function(n){var r=new Map(n);return i?a.putModel(e,r,t,s,o):r}))}},{key:"downloadFiles",value:function(e,t,n,o){var r=this;return n.dimension3="FS",this.fetchResource("".concat(this.baseURL,"/catalog_").concat(e,"_").concat(t,".json")).then((function(e){if(e.ok)return e.text();throw new Error("CDN download response status: ".concat(e.status))})).then((function(n){var o=JSON.parse(n),i="".concat(o.MajorVersion,".").concat(o.MinorVersion,"/ModelResources"),s="".concat(e,"/").concat(t,"/");return Promise.all(o.Resources.map((function(e){return e.Name.length>s.length&&e.Name.substring(0,s.length)===s&&(e.Name=e.Name.substring(s.length)),r.fetchResource("".concat(r.baseURL,"/").concat(i,"/").concat(s).concat(e.Name,".").concat(e.Type)).then((function(e){if(e.ok)return e.blob();throw new Error("CDN download response status: ".concat(e.status))})).then((function(t){return["".concat(e.Name,".").concat(e.Type),t]}))})))})).then((function(i){var s=new Map(i);return o?r.putModel(e,s,t,new Map,n):s}))}},{key:"getModelOptions",value:function(e){var t=this;return this.accessDB().then((function(n){var o=[],r=n.transaction(t.osName,"readonly");return r.objectStore(t.osName).openCursor().then((function t(n){if(n){var i=n.value;return i.modelId==e&&o.push(i),n.continue().then(t)}return r.done})).then((function(){return o}))}))}},{key:"putModel",value:function(e,t,n,o,r,i){var s=this;return o||(o=new Map),this.accessDB().then((function(r){return r.put(s.osName,{modelId:e,model:t,version:n,filters:o,timesSinceUsage:0},i)})).catch((function(e){r.resultDescription.indexOf(e.message)>=0&&(r.success=!1,r.resultDescription+="".concat(e.message," ")),r.resultSignature="Issue adding to DB"})).then((function(){return t}))}}])}();n.ModelDownloader=d},{105:105,22:22,24:24,25:25,30:30,57:57,62:62}],124:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ALFactoryGlobal=n.AugLoopFactory=void 0;var s=e(125),a=e(156),u=function(){return(0,i.default)((function e(){(0,r.default)(this,e),this._augLoopRuntimeManager=new s.AugLoopRuntimeManager}),[{key:"getAugLoopRuntimeManager",value:function(){return this._augLoopRuntimeManager}},{key:"createSingleItemWorkflow",value:function(e){return a.SingleItemWorkflow.create(e)}},{key:"createChatHelper",value:function(e){return this.getAugLoopRuntimeManager().getSession().then((function(t){return a.ChatHelper.create(Object.assign({session:t},e))}))}},{key:"createAugLoopRuntimeManager",value:function(){return new s.AugLoopRuntimeManager}}])}();n.AugLoopFactory=u,n.ALFactoryGlobal=new u},{125:125,156:156,22:22,24:24,30:30}],125:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(26)),s=o(e(45)),a=o(e(22)),u=o(e(24)),l=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.AugLoopRuntimeManager=n.AuthTokenResponseError=n.ServerAuthenticationState=n.IdentityProvider=n.AsyncClientRequestBuilder=void 0;var c=e(156);Object.defineProperty(n,"AsyncClientRequestBuilder",{enumerable:!0,get:function(){return c.AsyncClientRequestBuilder}});var d=e(67),f=e(86),p=e(122),g=e(126),h=e(190);Object.defineProperty(n,"AuthTokenResponseError",{enumerable:!0,get:function(){return h.AuthTokenResponseError}}),Object.defineProperty(n,"IdentityProvider",{enumerable:!0,get:function(){return h.IdentityProvider}});var y=e(204);Object.defineProperty(n,"ServerAuthenticationState",{enumerable:!0,get:function(){return y.ServerAuthenticationState}});var v=e(200),m=e(227),k=e(132),T=e(14),S=e(130),b=function(e,t){for(var n,o=[],r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];if(void 0!==e[s]&&null!==e[s]){var a={name:t?"".concat(t,".").concat(s):s,dataType:(n=e[s],"string"==typeof n?0:"boolean"==typeof n?1:"number"==typeof n?2:void T.ULS.sendTraceTag(572838285,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Warning,"Unsupported data field type")),value:e[s],classification:4};o.push(a)}}return o},C=function(e){return Promise.resolve(!1)},w=function(){return(0,u.default)((function e(){var t=this;(0,a.default)(this,e),this._telemetryAggregationIntervalSec=30,this._eventHandlerDictionary={},this._changeGateEnabledCallback=void 0,this._bridge=null,this._bridgeInterceptor=null,this._sessionCloseReason=null,this._isSessionClosed=null,this._isSessionConnected=null,this._sessionConnectParams=null,this._serverAuthenticationState=y.ServerAuthenticationState.NotAuthenticated,this._connectCallbacks=new Map,this._connectionStateCallbackToken=0,this._claimsChallengeCallbacks=[],this._seedingStatusChangeCallbacks=[],this._bridgeMessageSequenceId=0,this._runtimeClientBridge=void 0,this._useBridgePackage=void 0,this._isMessageReceivedCallbackRegistered=!1,this.initialize=function(e){if(t._runtimeInitPromise)T.ULS.sendTraceTag(572838286,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Runtime already initialized");else{T.ULS.sendTraceTag(572838287,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Start and initialize augloop runtime ..."),t.checkParametersAndThrow("initialize",e);var n=[];n.push(t.isFeatureEnabled("Microsoft.Office.AugLoop.UseBridgePackage","None").then((function(e){t._useBridgePackage=e,T.ULS.sendTraceTag(505419218,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Use bridge package: ".concat(e))}))),n.push(t.isFeatureEnabled("ModelDownloaderEbrake","None").then((function(n){n?T.ULS.sendTraceTag(556376070,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Resource downloader not created due to feature gate"):t.modelDownloaderFromCDN=e.appName&&e.downloadBaseUrl||e.downloadPolymerBaseUrl?new p.ModelDownloader(e.appName,e.downloadBaseUrl,e.downloadPolymerBaseUrl):void 0}))),t.inferenceServiceFactory=e.appName&&e.inferenceServiceVersion?g.OnnxInferenceService.createFactory(e.appName,e.inferenceServiceVersion):void 0,t.powerpointParameters=e.powerpoint;var o={appName:e.appName,appPlatform:"Web",appVersion:e.appVersion,uiLanguage:e.uiLanguage,releaseAudienceGroup:e.releaseAudienceGroup,releaseChannel:e.releaseChannel,releaseCustomAudience:e.releaseCustomAudience,releaseFork:e.releaseFork,sessionId:e.sessionId,flights:e.flights,privateMode:e.privateMode,disabledServiceGroups:e.disabledServiceGroups,userSystemTimezone:e.userSystemTimezone,isClientTelemetrySampled:e.isClientTelemetrySampled},r={onResult:t.onResult.bind(t),onAnnotationResult:t.onAnnotationResult.bind(t),sendTelemetryEvent:t.sendTelemetryEvent.bind(t),sendDiagnosticTrace:t.sendDiagnosticTrace.bind(t),requestAuthToken:t.requestAuthToken.bind(t),isFeatureEnabled:t.isFeatureEnabled.bind(t),isChangeGateEnabled:t.isChangeGateEnabled.bind(t),setSessionData:t.setSessionData.bind(t),areLicenseFeaturesEnabled:C,onInitSession:t.onInitSession.bind(t),overrideSessionInitMessage:t.overrideSessionInitMessage.bind(t)},i=Promise.all(n).then((function(){return c.runtime.init(e.serviceUrl,o,r,{telemetryAggregationIntervalSec:t._telemetryAggregationIntervalSec,modelDownloader:t.modelDownloaderFromCDN,inferenceServiceFactory:t.inferenceServiceFactory,isDeltaGeneratorEnabled:e.isDeltaGeneratorEnabled,disableSyncDeltaSending:e.disableSyncDeltaSending,syncDeltaTimeout:e.syncDeltaTimeout})})).then((function(){return d.runtimeALv1.init(e.serviceUrl,o,r)}));t.createSession=function(){t._runtimeInitPromise=i.then((function(){var n=e.sessionCreationOptions;if(n||(n={}),t._useBridgePackage){if(t._runtimeClientBridge=new k.RuntimeClientBridge,t._bridge){var o={sendDiagnosticTrace:function(e,t,n){var o=function(){switch(t){case f.LoggingLevel.error:return T.TraceLevel.Error;case f.LoggingLevel.warn:return T.TraceLevel.Warning;case f.LoggingLevel.info:return T.TraceLevel.Info;case f.LoggingLevel.verbose:case f.LoggingLevel.debug:return T.TraceLevel.Verbose;default:return T.TraceLevel.Info}}();T.ULS.sendTraceTag(e,T.LogCategory.msoulscat_Wac_BrowserGeneral,o,n)},sendTelemetryEvent:function(e,t,n,o,r,i,s,a){throw new Error("Method not implemented.")}};t._runtimeClientBridge.initialize({messageBridge:t._bridge,getSessionCallback:t.getSessionCallback.bind(t),hostTelemetryCallbacks:o,changeGateFeatureGateCallbacks:{isFeatureEnabled:t.isFeatureEnabled.bind(t),isChangeGateEnabled:t.isChangeGateEnabled.bind(t)}})}else T.ULS.sendTraceTag(505415107,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,"bridge is not set, cannot initialize RuntimeClientBridge");t._bridgeInterceptor&&t._runtimeClientBridge.setInterceptor(t._bridgeInterceptor)}else{t._bridge&&!t._isMessageReceivedCallbackRegistered&&t._bridge.registerMessageReceivedCallback(t.onBridgeMessage.bind(t)),t._bridgeInterceptor&&!t._isMessageReceivedCallbackRegistered&&t._bridgeInterceptor.registerMessageReceivedCallback(t.onBridgeMessageFromInterceptor.bind(t)),t._isMessageReceivedCallbackRegistered=!0;var r=n.onServerAuthenticationStateChangeCallback;n.onServerAuthenticationStateChangeCallback=function(e){t._serverAuthenticationState=e,r&&r(e),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new y.ServerAuthenticationStateChangeMessage({serverAuthenticationState:e})})};var i=n.onSessionClose;n.onSessionClose=function(e){t._sessionCloseReason=e.reason,t._isSessionClosed=!0,i&&i(e),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:e})};var s=n.onSessionReconnect;n.onSessionReconnect=function(){s&&s(),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new y.SessionReconnectMessage})};var a=n.onSessionDisconnect;n.onSessionDisconnect=function(e){t._isSessionConnected=!1,a&&a(e),t._bridge&&(t._sessionConnectParams=void 0,t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new y.SessionDisconnectMessage({error:e})}))}}var u=n.onSessionConnect;n.onSessionConnect=function(e,n,o,r,i,s){t._isSessionConnected=!0,t._isSessionClosed=!1,u&&u(e,n,o,r,i,s),t._connectCallbacks.forEach((function(t,a){t(e,n,o,r,i,s)})),t._bridge&&!t._useBridgePackage&&(t._sessionConnectParams||(t._sessionConnectParams={authToken:r,isSeedingRequired:e,sessionUrl:n,origin:o,routingSessionKey:i,blobFileId:s},t.sendSessionInitResponseToBridge("*","*")),t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new y.SessionConnectMessage({isSeedingRequired:e,sessionUrl:n,origin:o,authToken:r,routingSessionKey:i,blobFileId:s})}))};var l=n.onClaimsChallengeCallback;n.onClaimsChallengeCallback=function(e){l&&l(e),t._claimsChallengeCallbacks.forEach((function(t){t(e)}))};var d=n.onSeedingStatusChangeCallback;n.onSeedingStatusChangeCallback=function(e){d&&d(e),t._seedingStatusChangeCallbacks.forEach((function(t){t(e)}))};var p=n&&n.docSessionId||e.sessionId;return c.runtime.createSession(Object.assign(Object.assign({},n),{docSessionId:p}))}))},t.createSession()}},this.getSession=function(){return t._runtimeInitPromise},this.setULSLogger=function(e){t.checkParametersAndThrow("setULSLogger",e&&e.ulsLogger),T.ULS.setLogger(e.ulsLogger)},this.setSendOTelEventCallback=function(e){t.checkParametersAndPropertyAndThrow("setSendOTelEventCallback",e&&e.sendOTelEvent,t._sendOTelEventCallback),t._sendOTelEventCallback=e.sendOTelEvent},this.setSendDiagnosticTraceCallback=function(e){t.checkParametersAndPropertyAndThrow("setSendDiagnosticTraceCallback",e&&e.sendDiagnosticTraceCallback,t._sendDiagnosticTraceCallback),t._sendDiagnosticTraceCallback=e.sendDiagnosticTraceCallback},this.setRequestAuthTokenCallback=function(e){t.checkParametersAndPropertyAndThrow("setRequestAuthTokenCallback",e&&e.requestAuthTokenCallback,t._requestAuthTokenCallback),t._requestAuthTokenCallback=e.requestAuthTokenCallback},this.setIsFeatureEnabledCallback=function(e){t.checkParametersAndPropertyAndThrow("setIsFeatureEnabledCallback",e&&e.featureEnabledCallback,t._featureEnabledCallback),t._featureEnabledCallback=e.featureEnabledCallback},this.setIsChangeGateEnabledCallback=function(e){t.checkParametersAndPropertyAndThrow("setIsChangeGateEnabledCallback",e&&e.changeGateEnabledCallback,t._changeGateEnabledCallback),t._changeGateEnabledCallback=e.changeGateEnabledCallback},this.registerLocalWorkflow=function(e){t.checkParametersAndThrow("registerLocalWorkflow",e&&e.workflow),t.checkRuntimeInitAndThrow("registerLocalWorkflow"),t._runtimeInitPromise.then((function(t){t.registerLocalWorkflow(e.workflow)}))},this.activateAnnotation=function(e){var n=t.checkParameters("activateAnnotation",e&&e.annotationType)||t.checkRuntimeInit("activateAnnotation");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){var n;return(e.config||e.handler||e.stateUpdateHandler)&&(n={config:e.config,callback:e.handler,apologyCallback:e.apologyHandler,stateUpdateCallback:e.stateUpdateHandler,forceReturnCachedAnnotations:e.forceReturnCachedAnnotations}),t.activateAnnotation(e.annotationType,n)}))},this.updateAnnotationConfig=function(e){var n=t.checkParameters("updateAnnotationConfig",e&&e.token&&e.config)||t.checkRuntimeInit("updateAnnotationConfig");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){t.updateAnnotationConfig(e.token,e.config)}))},this.releaseAnnotation=function(e){var n=t.checkParameters("releaseAnnotation",e&&e.token)||t.checkRuntimeInit("releaseAnnotation");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){return t.releaseAnnotation(e.token)}))},this.submitOperation=function(e){t.checkParametersAndThrow("submitOperation",e&&e.operation),t.checkRuntimeInit("submitOperation"),t._runtimeInitPromise.then((function(t){t.submitOperation(e.operation,e.cv)}))},this.setSessionDataCallback=function(e){t.checkParametersAndPropertyAndThrow("setSessionDataCallback",e&&(e.sessionDataCallback||e.handler),t._setSessionDataCallback),e.sessionDataCallback?t._setSessionDataCallback=e.sessionDataCallback:e.handler&&(t._setSessionDataCallback=function(t,n,o){return e.handler(t,n)})},this.setAnnotationResultCallback=function(e){if(t.checkParametersAndThrow("setAnnotationResultCallback",e&&e.handler),t._annotationResultCallback){var n="".concat("setAnnotationResultCallback"," already called");T.ULS.sendTraceTag(537401028,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,n)}t._annotationResultCallback=e.handler},this.setAnnotationState=function(e){t.checkParametersAndThrow("setAnnotationState",e&&e.parentPath&&e.id&&e.value),t.checkRuntimeInitAndThrow("setAnnotationState"),t._runtimeInitPromise.then((function(t){t.setAnnotationState(e.parentPath,e.id,e.value)}))},this.setAnnotationMetadata=function(e){t.checkParametersAndThrow("setAnnotationMetadata",e&&e.parentPath&&e.id&&e.value),t.checkRuntimeInitAndThrow("setAnnotationMetadata"),t._runtimeInitPromise.then((function(t){t.setAnnotationMetadata(e.parentPath,e.id,e.value)}))},this.setInitSessionCallback=function(e){t.checkParametersAndPropertyAndThrow("setInitSessionCallback",e&&e.initSessionCallback,t._initSessionCallback),t._initSessionCallback=e.initSessionCallback},this.setSessionInitOverrideCallback=function(e){t.checkParametersAndPropertyAndThrow("setSessionInitOverrideCallback",e&&e.handler,t._sessionInitOverrideCallback),t._sessionInitOverrideCallback=e.handler},this.setMessageBridge=function(e){t.checkParametersAndPropertyAndThrow("setMessageBridge",e&&e.bridge,t._bridge),t._bridge=e.bridge},this.setMessageBridgeToALInterceptor=function(e){t.checkParametersAndPropertyAndThrow("setMessageBridgeToALInterceptor",e&&e.bridge,t._bridgeInterceptor),t._bridgeInterceptor=e.bridge},this.forceReconnectSession=function(e){var n=t.checkParameters("forceReconnectSession",e)||t.checkRuntimeInit("forceReconnectSession");return n?Promise.reject(n):t._runtimeInitPromise.then((function(e){return e.forceReconnect()}))},this.setSessionCloseCallback=function(e){var n=t.checkParameters("setSessionCloseCallback",e&&e.callback)||t.checkRuntimeInit("setSessionCloseCallback");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){t.setSessionCloseCallback(e.callback)}))},this.setConnectCallback=function(e){var n=t.getSessionStateCallbackToken("connect");return e.callback&&t._connectCallbacks.set(n,e.callback),n},this.removeConnectionStateCallback=function(e){return!!t._connectCallbacks.has(e.token)&&(t._connectCallbacks.delete(e.token),!0)},this.setSeedingStatusChangeCallback=function(e){t._seedingStatusChangeCallbacks.push(e.callback)},this.submitCustomMessage=function(e){var n=t.checkParameters("submitCustomMessage",e&&e.message)||t.checkRuntimeInit("submitCustomMessage");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){return t.submitCustomMessage(e.message)}))},this.submitLargeBinaryDataMessage=function(e){var n="submitLargeBinaryDataMessage",o=t.checkParameters(n,e&&e.message)||t.checkRuntimeInit(n);return o?Promise.reject(o):y.MicroSyncMessage.typeGuard(e.message)?t._runtimeInitPromise.then((function(t){return t.submitLargeBinaryDataMessage(e.message)})):Promise.reject("".concat(n," only supports MicroSyncMessage"))},this.requestBinaryDataForBlob=function(e){var n=t.checkParameters("requestBinaryDataForBlob",e&&e.blob)||t.checkRuntimeInit("requestBinaryDataForBlob");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){return t.requestBinaryDataForBlob(e.blob)}))},this.closeSession=function(){var e=t.checkRuntimeInit("closeSession");return e?Promise.reject(e):t._runtimeInitPromise.then((function(e){e.close()}))},this.startNewSession=function(){if(!t.createSession){var e="startNewSession called before runtime init";throw T.ULS.sendTraceTag(537408074,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,e),new Error(e)}t.createSession(),t._sessionCloseReason=null,t._sessionConnectParams=null},this.authenticateInteractive=function(){var e=t.checkRuntimeInit("authenticateInteractive");return e?Promise.reject(e):t._runtimeInitPromise.then((function(e){return e.authenticateInteractive()}))},this.getAnnotations=function(e){var n=t.checkParameters("getAnnotations",e&&e.request),o=t.checkRuntimeInit("getAnnotations"),r=n||o;return r?Promise.resolve((0,i.default)({},Symbol.asyncIterator,(function(){return l.__asyncGenerator(this,arguments,(0,s.default)().mark((function e(){var t;return(0,s.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n?y.GetAnnotationsClientErrorCode.InvalidRequest:y.GetAnnotationsClientErrorCode.RuntimeNotInitialized,T.ULS.sendTraceTag(505952348,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,"ClientError. Code: ".concat(t,", Error: ").concat(null==r?void 0:r.message)),e.next=4,l.__await({content:void 0,error:{clientError:{code:t,error:null==r?void 0:r.message}}});case 4:return e.next=6,e.sent;case 6:case"end":return e.stop()}}),e)})))}))):t._runtimeInitPromise.then((function(t){return t.getAnnotations(e.request,e.cancellationToken)}))},this.getAsyncClient=function(e){var n=t.checkRuntimeInit("getAsyncClient");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){return c.AsyncClient.create({session:t,scheduler:e.scheduler})}))},this.submit=function(e){t.checkParametersAndThrow("submit",e&&e.inputSchema&&e.input),t.checkRuntimeInitAndThrow("submit"),t._runtimeInitPromise.then((function(){d.runtimeALv1.submit(e.inputSchema,e.input,e.correlationVector)}))},this.addEventHandler=function(e){t.checkParametersAndThrow("addEventHandler",e&&e.schemaName&&e.handler);var n=t._eventHandlerDictionary[e.schemaName]||[];n.push(e.handler),t._eventHandlerDictionary[e.schemaName]=n},this.removeEventHandler=function(e){t.checkParametersAndThrow("removeEventHandler",e&&e.schemaName&&e.handler);var n=t._eventHandlerDictionary[e.schemaName];if(Array.isArray(n)){var o=n.indexOf(e.handler);o>=0&&n.splice(o,1)}},this.registerSimpleRemoteWorkflow=function(e){var n=t.checkParameters("registerSimpleRemoteWorkflow",e&&e.name&&e.lambdaRemote)||t.checkRuntimeInit("registerSimpleRemoteWorkflow");return n?Promise.reject(n):t._runtimeInitPromise.then((function(){return d.runtimeALv1.registerSimpleRemoteWorkflow(e.name,e.lambdaBefore,e.lambdaRemote,e.lambdaAfter)}))},this.registerSimpleLocalWorkflow=function(e){var n=t.checkParameters("registerSimpleLocalWorkflow",e&&e.name&&e.lambda)||t.checkRuntimeInit("registerSimpleLocalWorkflow");return n?Promise.reject(n):t._runtimeInitPromise.then((function(){return d.runtimeALv1.registerSimpleLocalWorkflow(e.name,e.lambda)}))},this.registerReduceWorkflow=function(e){return Promise.resolve()},this.registerSchemas=function(e){return Promise.resolve()},this.onResult=function(e,n,o,i){var s=t._eventHandlerDictionary[o];if(s){var a,u=(0,r.default)(s);try{for(u.s();!(a=u.n()).done;){var l=a.value;if(l)l({inputSchema:e,input:n,outputSchema:o,output:i})}}catch(e){u.e(e)}finally{u.f()}}},this.onAnnotationResult=function(e,n){t._annotationResultCallback&&t._annotationResultCallback(e,n)},this.requestAuthToken=function(e){return t._requestAuthTokenCallback?(t._requestAuthTokenCallback(e)||Promise.resolve("")).then((function(e){var t=e||"";return Promise.resolve({Token:t})})):Promise.resolve({Token:""})},this.sendTelemetryEvent=function(e,n,o,r,i,s,a,u){t._sendOTelEventCallback&&t._sendOTelEventCallback(function(e,t,n,o,r,i,s){var a={telemetryProperties:{ariaTenantToken:e,nexusTenantToken:-1},eventName:t.split("_").join("."),dataFields:b(n),eventFlags:{dataCategories:i,diagnosticLevel:s,samplingPolicy:1}};return o&&(a.eventContract={name:o,dataFields:b(r,o.split(".").slice(-1)[0])}),a}(e,n,o,r,i,a,u))},this.sendDiagnosticTrace=function(e,n,o){t._sendDiagnosticTraceCallback&&t._sendDiagnosticTraceCallback(e,n,o)},this.isFeatureEnabled=function(e,n){if(!e)return Promise.resolve(!1);var o="Microsoft.Office.AugLoop.";if(0===e.indexOf(o)&&t._featureEnabledCallback){var r=e.slice(o.length);return Promise.resolve(t._featureEnabledCallback(r)||t._featureEnabledCallback(e))}return Promise.resolve(!1)},this.isChangeGateEnabled=function(e){return e&&t._changeGateEnabledCallback?Promise.resolve(t._changeGateEnabledCallback(e)):Promise.resolve(!1)},this.setSessionData=function(e,n,o){t._setSessionDataCallback&&t._setSessionDataCallback(e,n,o)},this.overrideSessionInitMessage=function(e){return t._sessionInitOverrideCallback?t._sessionInitOverrideCallback(e):0===e.clientMetadata.appName.indexOf("PowerPoint")&&t.powerpointParameters?t.overridePowerPointSessionInitMessage(e):e},this.overridePowerPointSessionInitMessage=function(e){for(var n={downloadUrl:t.powerpointParameters.downloadUrl,getItemsEndPoint:t.powerpointParameters.getItemsEndPoint,documentOpenType:t.powerpointParameters.documentOpenType},o=0,r=Object.keys(e);o<r.length;o++){var i=r[o];n[i]=e[i]}return new S.PowerPointSessionInitMessage(n)},this.onInitSession=function(){return t._initSessionCallback?t._initSessionCallback():Promise.resolve()},this.checkParameters=function(e,t){if(!t){var n="".concat(e," called with invalid parameters");return T.ULS.sendTraceTag(537408075,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,n),new Error(n)}},this.checkParametersAndThrow=function(e,n){var o=t.checkParameters(e,n);if(o)throw o},this.checkParametersAndPropertyAndThrow=function(e,n,o){if(t.checkParametersAndThrow(e,n),o){var r="".concat(e," already called");throw T.ULS.sendTraceTag(537408076,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,r),new Error(r)}},this.checkRuntimeInit=function(e){if(!t._runtimeInitPromise){var n="".concat(e," called before runtime init");return T.ULS.sendTraceTag(537408077,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,n),new Error(n)}},this.checkRuntimeInitAndThrow=function(e){var n=t.checkRuntimeInit(e);if(n)throw n},this.sendBridgeMessage=function(e){t._bridge&&(e.seq=t._bridgeMessageSequenceId++,t._bridge.sendMessage(JSON.stringify(new y.BridgeMessage(e))))},this.onBridgeMessage=function(e){null!=t._bridgeInterceptor?t._bridgeInterceptor.sendMessage(e):t.handleReceivedBridgeMessage(e)},this.sendSessionInitResponseToBridge=function(e,n){if(t._sessionConnectParams){var o=t._sessionConnectParams.sessionUrl;t.sendBridgeMessage({bridgeId:e,docSessionId:n,message:new y.SessionInitResponse({origin:t._sessionConnectParams.origin,sessionKey:o.split("/").pop(),sessionUrlBase:o.split("/").slice(0,-1).join("/"),anonymousToken:t._sessionConnectParams.authToken,routingSessionKey:t._sessionConnectParams.routingSessionKey,blobFileId:t._sessionConnectParams.blobFileId})})}},this.handleReceivedBridgeMessage=function(e){try{var n=JSON.parse(e),o=n.bridgeId,i=n.docSessionId,s=n.message,a=m.SchemaObject.getTypeNameFor(s);if(T.ULS.sendTraceTag(509092291,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Received ".concat(a)),null!=t._sessionCloseReason&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new y.SessionCloseMessage({reason:t._sessionCloseReason})}),y.GetHostBridgeSessionRequestMessage.typeGuard(s)){T.ULS.sendTraceTag(505448338,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Sending GetHostBridgeSessionResponse to bridge with docSessionId ".concat(i));var u=t.checkRuntimeInit("GetHostBridgeSessionRequestMessage");u?t.sendBridgeMessage({bridgeId:o,docSessionId:i,response:new y.ErrorResponse({messageId:s.messageId,error:u.message})}):t.sendBridgeMessage({bridgeId:o,docSessionId:i,response:new y.GetHostBridgeSessionResponse({messageId:s.messageId,isConnected:t._isSessionConnected,isClosed:t._isSessionClosed})})}else if(y.AnnotationActivationMessage.typeGuard(s)){var l=function(e,n){t.sendBridgeMessage({bridgeId:o,docSessionId:i,message:new y.AnnotationResultsMessage({annotationType:s.annotationType,areApologies:!0,ops:[e],cv:n})})}.bind(t),c=t.activateAnnotation({annotationType:s.annotationType,config:s.config,handler:function(e,n){t.sendBridgeMessage({bridgeId:o,docSessionId:i,message:new y.AnnotationResultsMessage({annotationType:s.annotationType,ops:[e],cv:n})})},apologyHandler:s.sendApologies?l:void 0,forceReturnCachedAnnotations:s.forceReturnCachedAnnotations}).then((function(e){return new y.AnnotationActivationResponse({messageId:s.messageId,token:e.token})}));t.sendResponseAcrossBridge(c,s,o,i)}else if(v.GetAnnotationsRequestMessage.typeGuard(s))t.handleGetAnnotationsRequestMessage(o,i,s);else if(y.SyncMessage.typeGuard(s)){var d,f=(0,r.default)(s.ops);try{for(f.s();!(d=f.n()).done;){var p=d.value;t.submitOperation({operation:p,cv:s.cv})}}catch(e){f.e(e)}finally{f.f()}t.sendBridgeMessage({bridgeId:o,docSessionId:i,response:new y.Response({messageId:s.messageId})}),T.ULS.sendTraceTag(509092288,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Responded to ".concat(a))}else if(y.AnnotationReleaseMessage.typeGuard(s)){var g=t.releaseAnnotation({token:s.token}).then((function(e){return new y.AnnotationReleaseResponse({messageId:s.messageId,lastRelease:e})}));t.sendResponseAcrossBridge(g,s,o,i)}else if(y.SubmittedCustomMessage.typeGuard(s))t.submitCustomMessage({message:s.customMessage}).then((function(e){y.Response.typeGuard(e)?(e.messageId=s.messageId,T.ULS.sendTraceTag(508432467,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Responded to ".concat(a))):T.ULS.sendTraceTag(508420946,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,"Unexpeced response type from SubmitCustomMessage"),t.sendBridgeMessage({bridgeId:o,docSessionId:i,response:e})})).catch((function(e){T.ULS.sendTraceTag(508436636,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,e.message),t.sendBridgeMessage({bridgeId:o,docSessionId:i,response:new y.ErrorResponse({messageId:s.messageId,error:e.message})})}));else if(y.SessionInitMessage.typeGuard(s))t.sendSessionInitResponseToBridge(o,i),t.sendBridgeMessage({bridgeId:o,docSessionId:i,message:new y.ServerAuthenticationStateChangeMessage({serverAuthenticationState:t._serverAuthenticationState})});else if(m.SchemaObject.matchesTypesFor(s,[y.InteractiveAuthMessage.getTypeName()])){var h=t._runtimeInitPromise.then((function(e){return e.authenticateInteractive()})).then((function(){return new y.Response({messageId:s.messageId})}));t.sendResponseAcrossBridge(h,s,o,i)}else if(m.SchemaObject.matchesTypesFor(s,[y.SetSeedingStatusChangeCallbackMessage.getTypeName()])){var k=function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:i,message:new y.FireSeedingStatusChangeCallbackResponse({messageId:s.messageId,seedingStatusChangeMessage:e})})}.bind(t);t._runtimeInitPromise.then((function(e){e.setSeedingStatusChangeCallback(k)})).catch((function(e){T.ULS.sendTraceTag(506474634,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Warning,"RuntimeInitPromiseException for message with Id ".concat(s.messageId))}))}else if(m.SchemaObject.matchesTypesFor(s,[y.SetClaimsChallengeCallbackMessage.getTypeName()])){var S=function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:i,message:new y.FireClaimsChallengeCallbackResponse({messageId:s.messageId,claimsChallengeMessage:e})})}.bind(t);t._runtimeInitPromise.then((function(e){e.setClaimsChallengeCallback(S)})).catch((function(e){T.ULS.sendTraceTag(506987159,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Warning,"RuntimeInitPromiseException for message with Id ".concat(s.messageId))}))}else T.ULS.sendTraceTag(509092259,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Warning,"Did not respond to ".concat(a," with Id ").concat(s.messageId)),t.sendBridgeMessage({bridgeId:o,docSessionId:i,response:new y.ErrorResponse({messageId:s.messageId,error:"Unknown message type to handle"})})}catch(e){T.ULS.sendTraceTag(509092363,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,e.message),t.sendBridgeMessage({bridgeId:"unknown",docSessionId:"unknown",response:new y.ErrorResponse({messageId:"unknown",error:e.message})})}},this.handleGetAnnotationsRequestMessage=function(e,n,o){var r={request:{annotationType:o.annotationTypes,sourceInfo:o.sourceInfo,configs:o.configs,transientItems:o.transientItems,maxDelayMs:o.maxDelayMs,tryResolveUpstreamDependencies:o.tryResolveUpstreamDependencies,cv:o.cv}};t.getAnnotations(r).then((function(r){var i,a,u;return l.__awaiter(t,void 0,void 0,(0,s.default)().mark((function t(){var c,d,f,p,g,h,m,k,T,S;return(0,s.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,i=!0,a=l.__asyncValues(r);case 2:return t.next=4,a.next();case 4:if(u=t.sent,c=u.done){t.next=16;break}p=u.value,i=!1,k=p,T=new v.GetAnnotationsResponseMessage({content:k.content,errorInfo:null===(g=k.error)||void 0===g?void 0:g.serviceError,warningInfo:null===(h=k.warning)||void 0===h?void 0:h.serviceError}),S=new y.GetAnnotationsResponseBridgeMessage({messageId:o.messageId,serverResponse:JSON.stringify(T),clientError:null===(m=k.error)||void 0===m?void 0:m.clientError,finalResponse:k.finalResponse}),this.sendResponseAcrossBridge(Promise.resolve(S),o,e,n);case 13:i=!0,t.next=2;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),d={error:t.t0};case 21:if(t.prev=21,t.prev=22,i||c||!(f=a.return)){t.next=26;break}return t.next=26,f.call(a);case 26:if(t.prev=26,!d){t.next=29;break}throw d.error;case 29:return t.finish(26);case 30:return t.finish(21);case 31:case"end":return t.stop()}}),t,this,[[0,18,21,31],[22,,26,30]])})))}))},this.sendResponseAcrossBridge=function(e,n,o,r){e.catch((function(e){return new y.ErrorResponse({messageId:n.messageId,error:e.message})})).then((function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:e}),T.ULS.sendTraceTag(508937624,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Info,"Responded to ".concat(m.SchemaObject.getTypeNameFor(n)))})).catch((function(e){T.ULS.sendTraceTag(508937623,T.LogCategory.msoulscat_Wac_BrowserGeneral,T.TraceLevel.Error,e.message)}))},this.onBridgeMessageFromInterceptor=function(e){t.handleReceivedBridgeMessage(e)},this.getSessionCallback=function(e){return t._runtimeInitPromise}}),[{key:"getSessionStateCallbackToken",value:function(e){return e+"-callback-"+this._connectionStateCallbackToken++}}])}();n.AugLoopRuntimeManager=w},{122:122,126:126,130:130,132:132,14:14,156:156,190:190,200:200,204:204,22:22,227:227,24:24,25:25,26:26,30:30,45:45,67:67,86:86}],126:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(128),n)},{128:128}],127:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.Inputs=n.Model=n.lackingPromiseOrWasmSupport=void 0;var u=e(86),l=e(105);n.lackingPromiseOrWasmSupport=function(e){var t="";if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent;!n.indexOf||n.indexOf("MSIE ")>0||n.indexOf("Trident/")>0?t="Error: IE lacks necessary support":"undefined"==typeof Promise?t="Error: Promise is not supported":"undefined"==typeof WebAssembly&&(t="Error: WASM is not supported")}else t="Error: No window userAgent";return""!=t&&(e.resultDescription=t,l.Log.info(540406806,l.LogCategory.CoreDefault,e.stop()),!0)};var c=function(){function e(t,n,o){(0,i.default)(this,e),this.session=t,this.onnxObject=o,this.modelName=n}return(0,s.default)(e,[{key:"run",value:function(e){var t;return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function n(){var o,i,s,a=this;return(0,r.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((o=new l.Operation({operationName:"RunModelForInferencing",success:!0,resourceId:this.modelName})).start(),!(null===(t=this.onnxObject)||void 0===t?void 0:t.Tensor)){n.next=9;break}return i=e.getInputs(),s={},Object.keys(i).forEach((function(e){var t=i[e];if(Array.isArray(t.values)&&t.values.length>0&&"boolean"==typeof t.values[0]){var n=new Uint8Array(t.values);s[e]=new a.onnxObject.Tensor(n,t.dimensions)}else s[e]=new a.onnxObject.Tensor(t.values,t.dimensions)})),n.abrupt("return",this.session.run(s).then((function(e){return l.Log.info(540406809,l.LogCategory.CoreDefault,o.stop()),new f(e)})).catch((function(e){o.resultDescription="Problem running model. ".concat(e.message),l.Log.info(540406810,l.LogCategory.CoreDefault,o.stop())})));case 9:throw o.resultDescription="Unable to run model. Tensor not defined",l.Log.info(540406811,l.LogCategory.CoreDefault,o.stop()),new Error("Tensor is not defined");case 12:case"end":return n.stop()}}),n,this)})))}}],[{key:"create",value:function(t,n,o){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function i(){var s;return(0,r.default)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((s=new l.Operation({operationName:"CreateModelForInferencing",success:!0,resourceId:n})).start(),!o[t]){r.next=8;break}return s.resultDescription="Model already existed",l.Log.info(509699716,l.LogCategory.CoreDefault,s.stop()),r.abrupt("return",o[t]);case 8:return r.abrupt("return",o[t]=this.getInferenceSession(o).create(t).then((function(t){return l.Log.info(540406807,l.LogCategory.CoreDefault,s.stop()),new e(t,n,o)})).catch((function(e){throw s.resultDescription="Error: ".concat(e),l.Log.info(540406808,l.LogCategory.CoreDefault,s.stop()),e})));case 9:case"end":return r.stop()}}),i,this)})))}},{key:"getInferenceSession",value:function(e){if(null==e?void 0:e.InferenceSession)return e.InferenceSession;throw new Error("InferenceSession is not defined")}}])}();n.Model=c;var d=function(){function e(){(0,i.default)(this,e),this.map={}}return(0,s.default)(e,[{key:"getInputs",value:function(){return this.map}},{key:"add",value:function(e,t,n){return this.map[e]={dimensions:t,values:n},this}}],[{key:"create",value:function(){return new e}}])}();n.Inputs=d;var f=(0,s.default)((function e(t){(0,i.default)(this,e);for(var n=0,o=Object.keys(t);n<o.length;n++){var r=o[n];this[r]=new p(r,t[r])}})),p=function(){return(0,s.default)((function e(t,n){(0,i.default)(this,e),this.resultName=t,this.result=n}),[{key:"name",value:function(){return this.resultName}},{key:"outputType",value:function(){switch(this.result.type){case"string":return u.Type.Strings;case"int8":return u.Type.Int8s;case"int16":return u.Type.Int16s;case"int32":return u.Type.Int32s;case"bool":return u.Type.Booleans;case"uint8":return u.Type.UnsignedInt8s;case"uint16":return u.Type.UnsignedInt16s;case"uint32":return u.Type.UnsignedInt32s;case"float32":return u.Type.Float32s;case"float64":return u.Type.Float64s;default:throw new Error("The output type ".concat(this.result.type," is not supported."))}}},{key:"dimensions",value:function(){return this.result.dims}},{key:"asBooleans",value:function(){if(this.outputType()===u.Type.Booleans)return this.result.data.map((function(e){return!!e}));throw new Error("asBooleans() was called; however, outputType() is ".concat(this.outputType(),", not Type.Booleans."))}},{key:"asFloat32s",value:function(){if(this.outputType()===u.Type.Float32s)return this.result.data;throw new Error("asFloat32s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Float32s."))}},{key:"asFloat64s",value:function(){if(this.outputType()===u.Type.Float64s)return this.result.data;throw new Error("asFloat64s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Float64s."))}},{key:"asInt8s",value:function(){if(this.outputType()===u.Type.Int8s)return this.result.data;throw new Error("asInt8s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Int8s."))}},{key:"asInt16s",value:function(){if(this.outputType()===u.Type.Int16s)return this.result.data;throw new Error("asInt16s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Int16s."))}},{key:"asInt32s",value:function(){if(this.outputType()===u.Type.Int32s)return this.result.data;throw new Error("asInt32s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Int32s."))}},{key:"asStrings",value:function(){if(this.outputType()===u.Type.Strings)return this.result.data;throw new Error("asStrings() was called; however, outputType() is ".concat(this.outputType(),", not Type.Strings."))}},{key:"asUnsignedInt8s",value:function(){if(this.outputType()===u.Type.UnsignedInt8s)return this.result.data;throw new Error("asUnsignedInt8s() was called; however, outputType() is ".concat(this.outputType(),", not Type.UnsignedInt8s."))}},{key:"asUnsignedInt16s",value:function(){if(this.outputType()===u.Type.UnsignedInt16s)return this.result.data;throw new Error("asUnsignedInt16s() was called; however, outputType() is ".concat(this.outputType(),", not Type.UnsignedInt16s."))}},{key:"asUnsignedInt32s",value:function(){if(this.outputType()===u.Type.UnsignedInt32s)return this.result.data;throw new Error("asUnsignedInt32s() was called; however, outputType() is ".concat(this.outputType(),", not Type.UnsignedInt32s."))}}])}()},{105:105,22:22,24:24,30:30,45:45,86:86}],128:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.OnnxInferenceService=void 0;var s=e(129),a=function(){function e(t){(0,r.default)(this,e),this.getCache=null,this.getCache=t}return(0,i.default)(e,[{key:"createModel",value:function(e,t){var n,o=null===(n=this.getCache())||void 0===n?void 0:n.ort;return(0,s.createModel)(e,t||"",o)}},{key:"createInputs",value:function(){return(0,s.createInputs)()}}],[{key:"createFactory",value:function(t,n,o,r,i){var a=this;return function(u){var l,c=r||s.getDefaultCache;return!e.onnxRetrievalPromise||u?t&&n?((null===(l=c())||void 0===l?void 0:l.ort)&&!u?Promise.resolve():(0,s.loadOnnx)(a.createCdnUrl(t,n),c,"ort",o,i)).then((function(){e.onnxRetrievalPromise=Promise.resolve(new e(c))})).catch((function(t){e.onnxRetrievalPromise=Promise.reject(t)})).then((function(){return e.onnxRetrievalPromise})):Promise.reject(new Error("Error: appName and/or version not provided")):e.onnxRetrievalPromise}}},{key:"createCdnUrl",value:function(e,t){return"https://".concat(e).concat(t)}}])}();n.OnnxInferenceService=a},{129:129,22:22,24:24,30:30}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createInputs=n.createModel=n.loadOnnx=n.setScriptSrcDefault=n.getDefaultCache=void 0;var o=e(105),r=e(127);function i(e,t){e.src=t}function s(e,t){var n=globalThis[t];if(n&&n.InferenceSession&&n.Tensor){var o=e();return o&&!o[t]&&(o[t]=n),!0}return!1}n.getDefaultCache=function(){return globalThis&&!globalThis.top&&(globalThis.top={}),null===globalThis||void 0===globalThis?void 0:globalThis.top},n.setScriptSrcDefault=i,n.loadOnnx=function(e,t,n,a,u){var l=new o.Operation({operationName:"CreateOnnxInferenceService",success:!0,resultDescription:""});if(l.start(),(0,r.lackingPromiseOrWasmSupport)(l)){var c="Browser lacks necessary support for inference service";return l.success=!1,l.resultDescription=c,o.Log.info(540406803,o.LogCategory.CoreDefault,l.stop()),Promise.reject(new Error(c))}return new Promise((function(o,r){if("undefined"!=typeof document){var l=document.createElement("script");(u||i)(l,e),l.onload=function(){s(t,n)?(a&&(t()[n].env.wasm.wasmPaths=a),o()):(l.remove(),r(new Error("ort.Tensor and/or ort.InferenceSession are undefined")))},l.onerror=r,document.body.appendChild(l)}else globalThis.importScripts?(globalThis.importScripts(e),globalThis[n]=self[n],s(t,n)?(a&&(t()[n].env.wasm.wasmPaths=a),o()):r(new Error("ort.Tensor and/or ort.InferenceSession are undefined"))):r(new Error("Unexpected lack of document and importScripts"))})).then((function(){o.Log.info(540406804,o.LogCategory.CoreDefault,l.stop())})).catch((function(e){throw l.success=!1,l.resultDescription=e.message,o.Log.info(509871835,o.LogCategory.CoreDefault,l.stop()),e}))},n.createModel=function(e,t,n){return r.Model.create(e,t,n)},n.createInputs=function(){return r.Inputs.create()}},{105:105,127:127}],130:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(131),n)},{131:131}],131:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.PowerPointSessionExtensionConfig=n.PowerPointSessionInitMessage=void 0;var s=e(227),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.PowerPointSessionInitMessage=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionExtensionConfig"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.PowerPointSessionExtensionConfig=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},{22:22,227:227,24:24,30:30}],132:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(133),n),o.__exportStar(e(134),n)},{133:133,134:134}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],134:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(25)),s=o(e(22)),a=o(e(24)),u=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.RuntimeClientBridge=void 0;var l=e(86),c=e(204),d=e(200),f=e(227),p=function(){return(0,a.default)((function e(){var t=this;(0,s.default)(this,e),this.bridgeMessageSequenceId=0,this.sessionCloseReasonMap=new Map,this.addCallbacksAlreadySet=new Set,this.sendBridgeMessage=function(e){t.messageBridge&&(e.seq=t.bridgeMessageSequenceId++,t.messageBridge.sendMessage(JSON.stringify(new c.BridgeMessage(e))))},this.sendResponseAcrossBridge=function(e,n,o,r){e.catch((function(e){return t.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message),new c.ErrorResponse({messageId:n.messageId,error:e.message})})).then((function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:e})})).catch((function(e){t.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}}),[{key:"initialize",value:function(e){this.messageBridge=e.messageBridge,this.getSessionCallback=e.getSessionCallback,this.hostTelemetryCallbacks=e.hostTelemetryCallbacks,this.messageBridge.registerMessageReceivedCallback(this.onBridgeMessageReceived.bind(this))}},{key:"setInterceptor",value:function(e){this.interceptorBridge=e,this.interceptorBridge.registerMessageReceivedCallback(this.onBridgeMessageReceivedFromInterceptor.bind(this))}},{key:"onBridgeMessageReceived",value:function(e){null!=this.interceptorBridge?this.interceptorBridge.sendMessage(e):this.handleBridgeMessage(e)}},{key:"onBridgeMessageReceivedFromInterceptor",value:function(e){this.handleBridgeMessage(e)}},{key:"handleBridgeMessage",value:function(e){var t=this;try{var n=JSON.parse(e),o=n.bridgeId,r=n.docSessionId,s=n.message,a=f.SchemaObject.getTypeNameFor(s);this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Received message with messageTypeName ".concat(a," on bridgeId ").concat(o," and docSessionId ").concat(r));var u=this.getSessionCallback(r);if(this.sessionCloseReasonMap.has(r)){var p=this.sessionCloseReasonMap.get(r);this.sendBridgeMessage({bridgeId:o,docSessionId:r,message:new c.SessionCloseMessage({reason:p})}),this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Session whose doc session id is ".concat(r," is close due to ").concat(p))}if(c.GetHostBridgeSessionRequestMessage.typeGuard(s))if(this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Sending GetHostBridgeSessionResponse to bridge with docSessionId ".concat(r)),u)u.then((function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:new c.GetHostBridgeSessionResponse({messageId:s.messageId,isConnected:e.isConnected,isClosed:e.isClosed})})})).catch((function(e){t.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e),t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:new c.ErrorResponse({messageId:s.messageId,error:e})})}));else{var g="GetHostBridgeSessionRequestMessage called before session init";this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,g),this.sendBridgeMessage({bridgeId:o,docSessionId:r,response:new c.ErrorResponse({messageId:s.messageId,error:g})})}else if(c.AnnotationActivationMessage.typeGuard(s))this.handleAnnotationActivationMessage(s,o,r,u);else if(d.GetAnnotationsRequestMessage.typeGuard(s))this.handleGetAnnotationRequestBridgeMessage(s,o,r,u);else if(c.SyncMessage.typeGuard(s)){this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Receiving Sync Message");var h,y=(0,i.default)(s.ops);try{var v=function(){var e=h.value;u.then((function(t){t.submitOperation(e,s.cv)})).catch((function(e){t.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))};for(y.s();!(h=y.n()).done;)v()}catch(e){y.e(e)}finally{y.f()}this.sendBridgeMessage({bridgeId:o,docSessionId:r,response:new c.Response({messageId:s.messageId})})}else if(c.AnnotationReleaseMessage.typeGuard(s)){this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Releasing Annotation Activation token = ".concat(s.token));var m=u.then((function(e){return e.releaseAnnotation(s.token).then((function(e){return t.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Sending Annotation Activation token = ".concat(s.token)),new c.AnnotationReleaseResponse({messageId:s.messageId,lastRelease:e})}))}));this.sendResponseAcrossBridge(m,s,o,r)}else if(c.SubmittedCustomMessage.typeGuard(s))this.handleSubmittedCustomMessage(s,o,r,u);else if(c.SessionInitMessage.typeGuard(s))this.handleSessionInitMessage(o,r,u);else if(f.SchemaObject.matchesTypesFor(s,[c.InteractiveAuthMessage.getTypeName()]))this.handleInteractiveAuthMessage(s,o,r,u);else if(f.SchemaObject.matchesTypesFor(s,[c.SetSeedingStatusChangeCallbackMessage.getTypeName()])){this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Setting seeding status change callback");var k=function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:r,message:new c.FireSeedingStatusChangeCallbackResponse({messageId:s.messageId,seedingStatusChangeMessage:e})})}.bind(this);u.then((function(e){e.setSeedingStatusChangeCallback(k)})).catch((function(e){t.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}else if(f.SchemaObject.matchesTypesFor(s,[c.SetClaimsChallengeCallbackMessage.getTypeName()])){this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Setting claims challenge callback");var T=function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:r,message:new c.FireClaimsChallengeCallbackResponse({messageId:s.messageId,claimsChallengeMessage:e})})}.bind(this);u.then((function(e){e.setClaimsChallengeCallback(T)})).catch((function(e){t.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}else this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,"Did not respond to ".concat(a," with Id ").concat(s.messageId)),this.sendBridgeMessage({bridgeId:o,docSessionId:r,response:new c.ErrorResponse({messageId:s.messageId,error:"Unknown message type to handle"})})}catch(e){this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message),this.sendBridgeMessage({bridgeId:"unknown",docSessionId:"unknown",response:new c.ErrorResponse({messageId:"unknown",error:e.message})})}}},{key:"addBridgeCallbacksForSession",value:function(e,t){var n=this;e.then((function(e){e.setServerAuthenticationStateChangeCallback((function(e){n.sendBridgeMessage({bridgeId:"*",docSessionId:t,message:new c.ServerAuthenticationStateChangeMessage({serverAuthenticationState:e})})})),e.setSessionCloseCallback((function(e){n.sessionCloseReasonMap.set(t,e.reason),n.sendBridgeMessage({bridgeId:"*",docSessionId:t,message:e})})),e.setConnectCallback((function(e,o,r,i,s,a){n.sendBridgeMessage({bridgeId:"*",docSessionId:t,message:new c.SessionInitResponse({origin:r,sessionKey:o.split("/").pop(),sessionUrlBase:o.split("/").slice(0,-1).join("/"),anonymousToken:i,routingSessionKey:s,blobFileId:a})}),n.sendBridgeMessage({bridgeId:"*",docSessionId:t,message:new c.SessionConnectMessage({isSeedingRequired:e,sessionUrl:o,origin:r,authToken:i,routingSessionKey:s,blobFileId:a})})})),e.setReconnectCallback((function(){n.sendBridgeMessage({bridgeId:"*",docSessionId:t,message:new c.SessionReconnectMessage})})),e.setDisconnectCallback((function(e){n.sendBridgeMessage({bridgeId:"*",docSessionId:t,message:new c.SessionDisconnectMessage({error:e})})}))})).catch((function(e){n.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}},{key:"handleAnnotationActivationMessage",value:function(e,t,n,o){var r=this;this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Activate Annotation of type = ".concat(e.annotationType," token = ").concat(e.token));var i=function(o,i){r.sendBridgeMessage({bridgeId:t,docSessionId:n,message:new c.AnnotationResultsMessage({annotationType:e.annotationType,areApologies:!0,ops:[o],cv:i})})}.bind(this),s=o.then((function(o){return o.activateAnnotation(e.annotationType,{config:e.config,callback:function(o,i){r.sendBridgeMessage({bridgeId:t,docSessionId:n,message:new c.AnnotationResultsMessage({annotationType:e.annotationType,ops:[o],cv:i})})},apologyCallback:e.sendApologies?i:void 0,forceReturnCachedAnnotations:e.forceReturnCachedAnnotations}).then((function(t){return r.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Annotation Activation Response Recieved with token = ".concat(t.token)),new c.AnnotationActivationResponse({messageId:e.messageId,token:t.token})}))}));this.sendResponseAcrossBridge(s,e,t,n)}},{key:"handleSessionInitMessage",value:function(e,t,n){var o=this;this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Initing session with doc session id ".concat(t)),this.addCallbacksAlreadySet.has(t)||(this.addBridgeCallbacksForSession(n,t),this.addCallbacksAlreadySet.add(t)),n.then((function(n){var r=n.getConnectParams();if(void 0!==r){var i=r.sessionUrl;o.sendBridgeMessage({bridgeId:e,docSessionId:t,message:new c.SessionInitResponse({origin:r.origin,sessionKey:i.split("/").pop(),sessionUrlBase:i.split("/").slice(0,-1).join("/"),anonymousToken:r.authToken,routingSessionKey:r.routingSessionKey,blobFileId:r.blobFileId})}),o.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Inited session with doc session id ".concat(t)),o.sendBridgeMessage({bridgeId:e,docSessionId:t,message:new c.ServerAuthenticationStateChangeMessage({serverAuthenticationState:n.getServerAuthenticationState()})})}})).catch((function(e){o.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}},{key:"handleGetAnnotationRequestBridgeMessage",value:function(e,t,n,o){var i=this;this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Sending Get Annotation request");var s=o.then((function(t){return t.getAnnotations({annotationType:e.annotationTypes,sourceInfo:e.sourceInfo,configs:e.configs,transientItems:e.transientItems,maxDelayMs:e.maxDelayMs,tryResolveUpstreamDependencies:e.tryResolveUpstreamDependencies,cv:e.cv})}));Promise.resolve(s).then((function(o){var s,a,f;return u.__awaiter(i,void 0,void 0,(0,r.default)().mark((function i(){var p,g,h,y,v,m,k,T,S,b;return(0,r.default)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,s=!0,a=u.__asyncValues(o);case 2:return r.next=4,a.next();case 4:if(f=r.sent,p=f.done){r.next=17;break}y=f.value,s=!1,T=y,this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Receiving Get Annotation request"),S=new d.GetAnnotationsResponseMessage({content:T.content,errorInfo:null===(v=T.error)||void 0===v?void 0:v.serviceError,warningInfo:null===(m=T.warning)||void 0===m?void 0:m.serviceError}),b=new c.GetAnnotationsResponseBridgeMessage({messageId:e.messageId,serverResponse:JSON.stringify(S),clientError:null===(k=T.error)||void 0===k?void 0:k.clientError,finalResponse:T.finalResponse}),this.sendBridgeMessage({bridgeId:t,docSessionId:n,response:b});case 14:s=!0,r.next=2;break;case 17:r.next=22;break;case 19:r.prev=19,r.t0=r.catch(0),g={error:r.t0};case 22:if(r.prev=22,r.prev=23,s||p||!(h=a.return)){r.next=27;break}return r.next=27,h.call(a);case 27:if(r.prev=27,!g){r.next=30;break}throw g.error;case 30:return r.finish(27);case 31:return r.finish(22);case 32:case"end":return r.stop()}}),i,this,[[0,19,22,32],[23,,27,31]])})))})).catch((function(e){i.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}},{key:"handleSubmittedCustomMessage",value:function(e,t,n,o){var r=this;this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Receiving SubmittedCustomMessage via message ".concat(e.messageId)),o.then((function(o){o.submitCustomMessage(e.customMessage).then((function(o){c.Response.typeGuard(o)?o.messageId=e.messageId:r.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,"Unexpeced response type from SubmitCustomMessage"),r.sendBridgeMessage({bridgeId:t,docSessionId:n,response:o})})).catch((function(o){r.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,o.message),r.sendBridgeMessage({bridgeId:t,docSessionId:n,response:new c.ErrorResponse({messageId:e.messageId,error:o.message})})}))})).catch((function(e){r.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}},{key:"handleInteractiveAuthMessage",value:function(e,t,n,o){var r,i=this;this.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Interactive auth requested via message ".concat(e.messageId)),o.then((function(o){o.authenticateInteractive().then((function(){i.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.info,"Interactive auth succeeded for message ".concat(e.messageId)),r=new c.Response({messageId:e.messageId})})).catch((function(t){i.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,"Interactive auth failed for message ".concat(e.messageId)),r=new c.ErrorResponse({messageId:e.messageId,error:t.message})})).finally((function(){i.sendBridgeMessage({bridgeId:t,docSessionId:n,response:r})}))})).catch((function(e){i.hostTelemetryCallbacks.sendDiagnosticTrace(0,l.LoggingLevel.error,e.message)}))}}])}();n.RuntimeClientBridge=p},{200:200,204:204,22:22,227:227,24:24,25:25,30:30,45:45,86:86}],135:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationActivationTracker=void 0;var s=e(204),a=function(){return(0,i.default)((function e(t,n,o,i){(0,r.default)(this,e),this.sendMessage=t,this.annotationType=n,this.options=o,this.token="".concat(n,"-").concat(e.nextActivationResultBatchId++),this.annotationDoesNotExistOnServiceEnabled=i}),[{key:"activate",value:function(e,t,n){var o=this;return new Promise((function(r,i){o.sendMessage(new s.AnnotationActivationMessage({annotationType:o.annotationType,token:o.token,config:o.options?o.options.config:void 0,ignoreExistingAnnotations:e,sendStateUpdates:o.options?!!o.options.stateUpdateCallback:void 0,forceReturnCachedAnnotations:o.options?o.options.forceReturnCachedAnnotations:void 0,returnAnnotationDoesNotExist:o.annotationDoesNotExistOnServiceEnabled||!1,sendApologies:n}),(function(e,t){e?i(new Error(e.error)):(s.AnnotationActivationResponse.typeGuard(t)&&o.annotationDoesNotExistOnServiceEnabled&&(o.annotationDoesNotExistOnService=t.annotationNotExists),r({token:o.token}))}),t)}))}},{key:"release",value:function(){var e=this;return new Promise((function(t,n){e.annotationDoesNotExistOnService&&e.annotationDoesNotExistOnServiceEnabled?t(!1):e.sendMessage(new s.AnnotationReleaseMessage({token:e.token}),(function(e,o){e?n(new Error(e.error)):t(o.lastRelease)}))}))}}])}();n.AnnotationActivationTracker=a,a.nextActivationResultBatchId=1},{204:204,22:22,24:24,30:30}],136:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.OrderedAnnotationResultsProcessor=void 0;var a=e(137),u=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.annotationSequencer=null!=t?t:new a.AnnotationSequencer}),[{key:"process",value:function(e,t,n,o){var i,s=this,a=[],u=(0,r.default)(e.ops);try{var l=function(){var o=i.value,u=[];if(null==o?void 0:o.items){var l,c=(0,r.default)(o.items);try{var d=function(){var e=l.value,n=s.annotationSequencer.sequence(e.body).then((function(){t(o,e)}));u.push(n)};for(c.s();!(l=c.n()).done;)d()}catch(e){c.e(e)}finally{c.f()}}a.push(Promise.all(u).then((function(){n(o,e.cv)})))};for(u.s();!(i=u.n()).done;)l()}catch(e){u.e(e)}finally{u.f()}Promise.all(a).then((function(){return o(e)}))}}])}();n.OrderedAnnotationResultsProcessor=u},{137:137,22:22,24:24,25:25,30:30}],137:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationSequencer=void 0;var u=e(138),l=function(){return(0,s.default)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,n=arguments.length>1?arguments[1]:void 0;(0,i.default)(this,e),this.sequencerFactory=null!=n?n:new u.BufferingSequencerFactory(t)}),[{key:"sequence",value:function(e){var t;return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function n(){var o;return(0,r.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(null===(t=null==e?void 0:e.M_)||void 0===t?void 0:t.seq)){n.next=3;break}return n.abrupt("return");case 3:if(o=this.sequencerFactory.create(e)){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,o.sequence(e.M_.seq);case 8:case"end":return n.stop()}}),n,this)})))}}])}();n.AnnotationSequencer=l},{138:138,22:22,24:24,30:30,45:45}],138:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.BufferingSequencerFactory=void 0;var s=e(79),a=function(){return(0,i.default)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;(0,r.default)(this,e),this.bufferingTimeMs=500,this.workflowIdToSequencersMap=new Map,this.bufferingTimeMs=t}),[{key:"create",value:function(e){if(!e.ownerId)return null;var t=this.workflowIdToSequencersMap.get(e.ownerId);return t||(t=new s.BufferingSequencer(this.bufferingTimeMs),this.workflowIdToSequencersMap.set(e.ownerId,t)),t}}])}();n.BufferingSequencerFactory=a},{22:22,24:24,30:30,79:79}],139:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.RoutingAnnotationResultsProcessor=void 0;var s=e(136),a=e(140),u=function(){return(0,i.default)((function e(t,n,o){(0,r.default)(this,e),this.isOrderingEnabled=t,this.orderedAnnotationResultsProcessor=null!=n?n:new s.OrderedAnnotationResultsProcessor,this.unorderedAnnotationResultsProcessor=null!=o?o:new a.UnorderedAnnotationResultsProcessor}),[{key:"process",value:function(e,t,n,o){this.isOrderingEnabled()?this.orderedAnnotationResultsProcessor.process(e,t,n,o):this.unorderedAnnotationResultsProcessor.process(e,t,n,o)}}])}();n.RoutingAnnotationResultsProcessor=u},{136:136,140:140,22:22,24:24,30:30}],140:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.UnorderedAnnotationResultsProcessor=void 0;var a=function(){return(0,s.default)((function e(){(0,i.default)(this,e)}),[{key:"process",value:function(e,t,n,o){var i,s=(0,r.default)(e.ops);try{for(s.s();!(i=s.n()).done;){var a=i.value;if(null==a?void 0:a.items){var u,l=(0,r.default)(a.items);try{for(l.s();!(u=l.n()).done;){t(a,u.value)}}catch(e){l.e(e)}finally{l.f()}}n(a,e.cv)}}catch(e){s.e(e)}finally{s.f()}o(e)}}])}();n.UnorderedAnnotationResultsProcessor=a},{22:22,24:24,25:25,30:30}],141:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.RequestType=void 0,function(e){e[e.SingleAnnotation=0]="SingleAnnotation",e[e.Streaming=1]="Streaming",e[e.CustomMessage=2]="CustomMessage"}(o||(n.RequestType=o={}))},{}],142:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.AsyncClient=void 0;var s=e(149),a=e(141),u=e(148),l=e(147),c=e(150),d=e(105),f=function(){function e(t,n){(0,r.default)(this,e),this.session=t,this.scheduler=n}return(0,i.default)(e,[{key:"execute",value:function(e,t){return this.createExecutor(e,t).execute()}},{key:"createExecutor",value:function(e,t){var n=new d.Operation({operationName:"AsyncClientExecute",success:!0}).setClientMetadata(this.session.getClientMetadata()).start();switch(e.type){case a.RequestType.SingleAnnotation:return n.resourceId="SingleAnnotationRequest",new u.SingleAnnotationExecutor(this.session,e,t,this.scheduler,n);case a.RequestType.Streaming:return n.resourceId="StreamingRequest",new s.StreamingExecutor(this.session,e,t,this.scheduler,n);case a.RequestType.CustomMessage:return n.resourceId="CustomMessageRequest",new l.CustomMessageExecutor(this.session,e,t,this.scheduler,n);default:throw new Error("Request Type not supported")}}}],[{key:"create",value:function(t){var n;return new e(t.session,null!==(n=t.scheduler)&&void 0!==n?n:new c.DefaultTimeoutScheduler)}}])}();n.AsyncClient=f},{105:105,141:141,147:147,148:148,149:149,150:150,22:22,24:24,30:30}],143:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.BlockingQueue=n.EventEntry=void 0;var u=e(151),l=function(){function e(t,n){(0,i.default)(this,e),this.value=null,this.error=null,this.value=t,this.error=n}return(0,s.default)(e,[{key:"isError",value:function(){return null!==this.error}}],[{key:"createValue",value:function(t){return new e(t,null)}},{key:"createError",value:function(t){return new e(null,t)}}])}();n.EventEntry=l;var c=function(){return(0,s.default)((function e(){(0,i.default)(this,e),this.items=[],this.pendingDequeuePromise=null}),[{key:"enqueue",value:function(e){var t;this.items.push(l.createValue(e)),null===(t=this.pendingDequeuePromise)||void 0===t||t.resolve()}},{key:"enqueueError",value:function(e){var t;this.items.push(l.createError(e)),null===(t=this.pendingDequeuePromise)||void 0===t||t.resolve()}},{key:"dequeue",value:function(e){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.items.length){t.next=10;break}if(!this.pendingDequeuePromise){t.next=3;break}throw new Error("Cannot have simultaneous dequeues");case 3:return this.pendingDequeuePromise=new u.ControlledPromise,t.prev=4,t.next=7,Promise.race([this.pendingDequeuePromise.completion,e.rejectWhenCancellationRequested()]);case 7:return t.prev=7,this.pendingDequeuePromise=null,t.finish(7);case 10:return t.abrupt("return",this.items.shift());case 11:case"end":return t.stop()}}),t,this,[[4,,7,10]])})))}},{key:"empty",value:function(){return 0===this.items.length}}])}();n.BlockingQueue=c},{151:151,22:22,24:24,30:30,45:45}],144:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.CancelStrategy=void 0;var u=e(154),l=e(145),c=function(){return(0,s.default)((function e(t,n,o){(0,i.default)(this,e),this.scheduler=t,this.callerCancelToken=n,this.timeoutMs=o}),[{key:"runWithCombinedToken",value:function(e){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function t(){var n,o;return(0,r.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new u.TimeoutCancellationToken(this.scheduler),o=new u.LinkedCancellationToken(this.callerCancelToken,n.token),t.prev=2,void 0!==this.timeoutMs&&n.cancelAfter(this.timeoutMs),t.next=6,e(o.token);case 6:return t.abrupt("return",t.sent);case 9:if(t.prev=9,t.t0=t.catch(2),!(t.t0 instanceof l.CancelTokenError&&!this.callerCancelToken.IsCancellationRequested&&n.token.IsCancellationRequested)){t.next=13;break}throw new l.AsyncClientTimeoutError("strategy timeout: ".concat(this.timeoutMs));case 13:throw t.t0;case 14:return t.prev=14,o.dispose(),n.dispose(),t.finish(14);case 18:case"end":return t.stop()}}),t,this,[[2,9,14,18]])})))}}])}();n.CancelStrategy=c},{145:145,154:154,22:22,24:24,30:30,45:45}],145:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(24)),i=o(e(22)),s=o(e(21)),a=o(e(29)),u=o(e(56));Object.defineProperty(n,"__esModule",{value:!0}),n.AsyncClientInternalError=n.NotSingleAnnotationError=n.AsyncClientTypeError=n.InternalGetAnnotationsError=n.AsyncClientTimeoutError=n.CancelTokenError=void 0;var l=function(e){function t(e){var n;return(0,i.default)(this,t),n=(0,s.default)(this,t,[e]),Object.setPrototypeOf(n,t.prototype),n}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.CancelTokenError=l;var c=function(e){function t(e){var n;return(0,i.default)(this,t),n=(0,s.default)(this,t,[e]),Object.setPrototypeOf(n,t.prototype),n}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.AsyncClientTimeoutError=c;var d=function(e){function t(e,n){var o;return(0,i.default)(this,t),o=(0,s.default)(this,t,[e]),Object.setPrototypeOf(o,t.prototype),o.erroInfo=n,o}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.InternalGetAnnotationsError=d;var f=function(e){function t(e){var n;return(0,i.default)(this,t),n=(0,s.default)(this,t,[e]),Object.setPrototypeOf(n,t.prototype),n}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.AsyncClientTypeError=f;var p=function(e){function t(e){var n;return(0,i.default)(this,t),n=(0,s.default)(this,t,[e]),Object.setPrototypeOf(n,t.prototype),n}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.NotSingleAnnotationError=p;var g=function(e){function t(e){var n;return(0,i.default)(this,t),n=(0,s.default)(this,t,[e]),Object.setPrototypeOf(n,t.prototype),n}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.AsyncClientInternalError=g},{21:21,22:22,24:24,29:29,30:30,56:56}],146:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.MessageRequestBuilder=n.OperationRequestBuilder=n.AsyncClientRequestBuilder=void 0;var s=e(149),a=e(148),u=e(147),l=function(){return(0,i.default)((function e(){(0,r.default)(this,e)}),null,[{key:"forOperation",value:function(e,t){return new c(e,t)}},{key:"forMessage",value:function(e){return new d(e)}}])}();n.AsyncClientRequestBuilder=l;var c=function(){return(0,i.default)((function e(t,n){(0,r.default)(this,e),this.op=t,this.cv=n}),[{key:"withSingleAnnotation",value:function(e,t){return new a.SingleAnnotationRequestBuilder(this.op,e,t,this.cv)}},{key:"withStreaming",value:function(e,t){return new s.StreamingRequestBuilder(this.op,e,t,this.cv)}}])}();n.OperationRequestBuilder=c;var d=function(){return(0,i.default)((function e(t){(0,r.default)(this,e),this.message=t}),[{key:"withResponse",value:function(e,t){return new u.CustomMessageRequestBuilder(this.message,e,t)}}])}();n.MessageRequestBuilder=d},{147:147,148:148,149:149,22:22,24:24,30:30}],147:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.CustomMessageExecutor=n.CustomMessageRequestBuilder=void 0;var u=e(141),l=e(227),c=e(145),d=e(144),f=e(105),p=function(){return(0,s.default)((function e(t,n,o){(0,i.default)(this,e),this.message=t,this.responseType=n,this.timeoutMs=o}),[{key:"build",value:function(){return{type:u.RequestType.CustomMessage,message:this.message,responseType:this.responseType,timeoutMs:this.timeoutMs}}}])}();n.CustomMessageRequestBuilder=p;var g=function(){return(0,s.default)((function e(t,n,o,r,s){(0,i.default)(this,e),this.session=t,this.request=n,this.cancelToken=o,this.scheduler=r,this.logOp=s,this.logOp.resourceId="CustomMessageRequest"}),[{key:"execute",value:function(){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function e(){var t;return(0,r.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new d.CancelStrategy(this.scheduler,this.cancelToken,this.request.timeoutMs),e.next=4,t.runWithCombinedToken(this.executeOnAnnotation.bind(this));case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),this.logOp.success=!1,this.logOp.resultDescription="[name, message, stack]: [".concat(e.t0.name,", ").concat(e.t0.message,", ").concat(e.t0.stack,"]"),e.t0;case 12:return e.prev=12,f.Log.info(505427164,f.LogCategory.CoreDefault,this.logOp.stop()),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,7,12,15]])})))}},{key:"executeOnAnnotation",value:function(e){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.race([this.submitRequest(),e.rejectWhenCancellationRequested()]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"submitRequest",value:function(){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function e(){var t;return(0,r.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.session.submitCustomMessage(this.request.message);case 2:if(t=e.sent,this.request.responseType.typeGuard(t)){e.next=5;break}throw new c.AsyncClientTypeError("Response type do not match. Actual: ".concat(l.SchemaObject.getTypeNameFor(t),", Expected: ").concat(this.request.responseType));case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})))}}])}();n.CustomMessageExecutor=g},{105:105,141:141,144:144,145:145,22:22,227:227,24:24,30:30,45:45}],148:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.SingleAnnotationExecutor=n.SingleAnnotationRequestBuilder=void 0;var u=e(141),l=e(227),c=e(151),d=e(144),f=e(145),p=e(105),g=function(){return(0,s.default)((function e(t,n,o,r){(0,i.default)(this,e),this.operation=t,this.annotation=n,this.timeoutMs=o,this.cv=r}),[{key:"build",value:function(){return{type:u.RequestType.SingleAnnotation,operation:this.operation,cv:this.cv,annotation:this.annotation,timeoutMs:this.timeoutMs}}}])}();n.SingleAnnotationRequestBuilder=g;var h=function(){return(0,s.default)((function e(t,n,o,r,s){(0,i.default)(this,e),this.session=t,this.request=n,this.cancelToken=o,this.scheduler=r,this.logOp=s,this.completionPromise=new c.ControlledPromise,this.logOp.resourceId="SingleAnnotationRequest"}),[{key:"execute",value:function(){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function e(){var t;return(0,r.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new d.CancelStrategy(this.scheduler,this.cancelToken,this.request.timeoutMs),e.next=4,t.runWithCombinedToken(this.executeOnAnnotation.bind(this));case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),this.logOp.success=!1,this.logOp.resultDescription="[name, message, stack]: [".concat(e.t0.name,", ").concat(e.t0.message,", ").concat(e.t0.stack,"]"),e.t0;case 12:return e.prev=12,p.Log.info(505427166,p.LogCategory.CoreDefault,this.logOp.stop()),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,7,12,15]])})))}},{key:"executeOnAnnotation",value:function(e){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function t(){var n,o,i=this;return(0,r.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n={annotationType:[this.request.annotation.getTypeName()],transientItems:this.request.operation.items.map((function(e){return Object.assign(Object.assign({},e),{parentPath:i.request.operation.parentPath})})),maxDelayMs:this.request.timeoutMs,sourceInfo:{}},o=this.session.getAnnotations(n,e),t.next=5,Promise.race([this.subscribeAnnotations(o),e.rejectWhenCancellationRequested()]);case 5:return t.abrupt("return",t.sent);case 8:throw t.prev=8,t.t0=t.catch(0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[0,8]])})))}},{key:"subscribeAnnotations",value:function(e){var t,n,o,i,s,u,c;return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function d(){var p,g;return(0,r.default)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,t=!0,n=a.__asyncValues(e);case 2:return r.next=4,n.next();case 4:if(o=r.sent,i=o.done){r.next=19;break}if(c=o.value,t=!1,!(p=c).error){r.next=13;break}return this.completionPromise.reject(new f.InternalGetAnnotationsError(JSON.stringify(p.error),p.error)),r.abrupt("break",19);case 13:return 1==(g=p.content.map((function(e){return e.body}))).length?this.request.annotation.typeGuard(g[0])?this.completionPromise.resolve(g[0]):this.completionPromise.reject(new f.AsyncClientTypeError("(SingleAnnotation) expect: ".concat(this.request.annotation.getTypeName(),", received: ").concat(l.SchemaObject.getTypeNameFor(g[0])))):this.completionPromise.reject(new f.NotSingleAnnotationError("Number of annotations received: ".concat(g.length))),r.abrupt("break",19);case 16:t=!0,r.next=2;break;case 19:r.next=24;break;case 21:r.prev=21,r.t0=r.catch(0),s={error:r.t0};case 24:if(r.prev=24,r.prev=25,t||i||!(u=n.return)){r.next=29;break}return r.next=29,u.call(n);case 29:if(r.prev=29,!s){r.next=32;break}throw s.error;case 32:return r.finish(29);case 33:return r.finish(24);case 34:return r.abrupt("return",this.completionPromise.completion);case 35:case"end":return r.stop()}}),d,this,[[0,21,24,34],[25,,29,33]])})))}}])}();n.SingleAnnotationExecutor=h},{105:105,141:141,144:144,145:145,151:151,22:22,227:227,24:24,30:30,45:45}],149:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(45)),s=o(e(22)),a=o(e(24)),u=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationsStream=n.StreamingExecutor=n.StreamingRequestBuilder=void 0;var l=e(141),c=e(227),d=e(151),f=e(144),p=e(143),g=e(145),h=e(105),y=function(){return(0,a.default)((function e(t,n,o,r){(0,s.default)(this,e),this.operation=t,this.params=n,this.timeout=o,this.cv=r}),[{key:"build",value:function(){var e;return{type:l.RequestType.Streaming,operation:this.operation,cv:this.cv,firstAnnotationTimeoutMs:null!==(e=this.timeout.firstAnnotationTimeoutMs)&&void 0!==e?e:void 0,perAnnotationTimeoutMs:this.timeout.perAnnotationTimeoutMs,chunks:this.params.chunks,completion:this.params.completion}}}])}();n.StreamingRequestBuilder=y;var v=function(){return(0,a.default)((function e(t,n,o,r,i){(0,s.default)(this,e),this.session=t,this.request=n,this.cancelToken=o,this.scheduler=r,this.logOp=i,this.logOp.resourceId="StreamingRequest"}),[{key:"execute",value:function(){return u.__awaiter(this,void 0,void 0,(0,i.default)().mark((function e(){var t,n,o,r,s,a,u=this;return(0,i.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.request.firstAnnotationTimeoutMs?Math.min(this.request.firstAnnotationTimeoutMs,this.request.perAnnotationTimeoutMs):this.request.perAnnotationTimeoutMs,n=[this.request.chunks.getTypeName(),this.request.completion.getTypeName()],o={annotationType:n,transientItems:this.request.operation.items.map((function(e){return Object.assign(Object.assign({},e),{parentPath:u.request.operation.parentPath})})),maxDelayMs:t,sourceInfo:{}},r=this.session.getAnnotations(o,this.cancelToken),s=new p.BlockingQueue,(a=new m(r,this.scheduler,this.cancelToken,this.request,s,this.logOp)).initialize().catch((function(e){s.enqueueError(e)})),e.abrupt("return",Promise.resolve(a));case 8:case"end":return e.stop()}}),e,this)})))}}])}();n.StreamingExecutor=v;var m=function(){return(0,a.default)((function e(t,n,o,r,i,a){(0,s.default)(this,e),this.iterable=t,this.scheduler=n,this.cancelToken=o,this.request=r,this.queue=i,this.logOp=a,this.completionPromise=new d.ControlledPromise,this.complete=!1,this.isFirstAnnotation=!0}),[{key:"subscribeResults",value:function(e){var t,n,o,r,s,a,l;return u.__awaiter(this,void 0,void 0,(0,i.default)().mark((function c(){var d;return(0,i.default)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:i.prev=0,i.prev=1,t=!0,n=u.__asyncValues(e);case 3:return i.next=5,n.next();case 5:if(o=i.sent,r=o.done){i.next=17;break}if(l=o.value,t=!1,d=l,!this.completionPromise.fulfilled){i.next=13;break}return i.abrupt("break",17);case 13:this.onGetAnnotationResponse(d);case 14:t=!0,i.next=3;break;case 17:i.next=22;break;case 19:i.prev=19,i.t0=i.catch(1),s={error:i.t0};case 22:if(i.prev=22,i.prev=23,t||r||!(a=n.return)){i.next=27;break}return i.next=27,a.call(n);case 27:if(i.prev=27,!s){i.next=30;break}throw s.error;case 30:return i.finish(27);case 31:return i.finish(22);case 32:i.next=37;break;case 34:i.prev=34,i.t1=i.catch(0),this.queue.enqueueError(i.t1);case 37:case"end":return i.stop()}}),c,this,[[0,34],[1,19,22,32],[23,,27,31]])})))}},{key:"initialize",value:function(){return u.__awaiter(this,void 0,void 0,(0,i.default)().mark((function e(){return(0,i.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.subscribeResults(this.iterable));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"onGetAnnotationResponse",value:function(e){if(e.error)throw new g.InternalGetAnnotationsError(JSON.stringify(e.error),e.error);var t,n=e.content.map((function(e){return e.body})),o=(0,r.default)(n);try{for(o.s();!(t=o.n()).done;){var i=t.value;this.isFirstAnnotation&&(this.isFirstAnnotation=!1),this.queue.enqueue(i)}}catch(e){o.e(e)}finally{o.f()}e.finalResponse&&(this.complete=!0)}},{key:Symbol.asyncIterator,value:function(){return this}},{key:"chunks",get:function(){return this}},{key:"completion",get:function(){return this.completionPromise.completion}},{key:"next",value:function(){return u.__awaiter(this,void 0,void 0,(0,i.default)().mark((function e(){var t,n,o,r;return(0,i.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.request.firstAnnotationTimeoutMs&&this.request.firstAnnotationTimeoutMs?this.request.firstAnnotationTimeoutMs:this.request.perAnnotationTimeoutMs,n=new f.CancelStrategy(this.scheduler,this.cancelToken,t),e.next=5,n.runWithCombinedToken(this.waitForNextEvent.bind(this));case 5:if(o=e.sent,r=o.value,!o.isError()){e.next=9;break}return e.abrupt("return",this.handleError(o.error));case 9:if(!this.complete||!this.queue.empty()){e.next=14;break}if(this.request.completion.typeGuard(r)){e.next=12;break}return e.abrupt("return",this.handleError(new g.AsyncClientTypeError("(Streaming completion) expect: ".concat(this.request.completion.getTypeName(),", received: ").concat(c.SchemaObject.getTypeNameFor(r)))));case 12:return this.completionPromise.resolve(r),e.abrupt("return",this.handleFinalResult(r));case 14:if(this.request.chunks.typeGuard(r)){e.next=16;break}return e.abrupt("return",this.handleError(new g.AsyncClientTypeError("(Streaming chunks) expect: ".concat(this.request.chunks.getTypeName(),", received: ").concat(c.SchemaObject.getTypeNameFor(r)))));case 16:return e.abrupt("return",{done:!1,value:r});case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",this.handleError(e.t0));case 22:case"end":return e.stop()}}),e,this,[[0,19]])})))}},{key:"handleError",value:function(e){return this.completionPromise.reject(e),this.logOp.success=!1,this.logOp.resultDescription="[name, message, stack]: [".concat(e.name,", ").concat(e.message,", ").concat(e.stack,"]"),this.handleFinalResult(e)}},{key:"handleFinalResult",value:function(e){return h.Log.info(505427165,h.LogCategory.CoreDefault,this.logOp.stop()),{done:!0,value:e}}},{key:"waitForNextEvent",value:function(e){return u.__awaiter(this,void 0,void 0,(0,i.default)().mark((function t(){return(0,i.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.queue.dequeue(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}}])}();n.AnnotationsStream=m},{105:105,141:141,143:143,144:144,145:145,151:151,22:22,227:227,24:24,25:25,30:30,45:45}],150:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultTimeoutScheduler=void 0;var s=function(){return(0,i.default)((function e(){(0,r.default)(this,e)}),[{key:"executeAfter",value:function(e,t){var n=setTimeout((function(){n=null,e()}),t);return function(){null!==n&&(clearTimeout(n),n=null)}}}])}();n.DefaultTimeoutScheduler=s},{22:22,24:24,30:30}],151:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ControlledPromise=void 0;var s=function(){return(0,i.default)((function e(){var t=this;(0,r.default)(this,e),this._fulfilled=!1,this.completion=new Promise((function(e,n){t.onResolve=e,t.onReject=n}))}),[{key:"resolve",value:function(e){this._fulfilled=!0,this.onResolve(e)}},{key:"reject",value:function(e){this._fulfilled=!0,this.onReject(e)}},{key:"fulfilled",get:function(){return this._fulfilled}}])}();n.ControlledPromise=s},{22:22,24:24,30:30}],152:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(48)),i=o(e(25)),s=o(e(51)),a=o(e(22)),u=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.BatchManager=void 0;var l,c=e(105),d=e(190),f=e(227);!function(e){e[e.ExceedingMaxSize=0]="ExceedingMaxSize",e[e.GroupComplete=1]="GroupComplete",e[e.BatchIntervalElapsed=2]="BatchIntervalElapsed"}(l||(l={}));var p=function(){return(0,u.default)((function e(t,n,o,r,i){(0,a.default)(this,e),this.batchesByGroupingKey=new Map,this.getOrderOfMagnitudeDimension=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude ".concat(e.toString().length)},this.submit=t,this.onSummary=r,this.reduceBatchOperationsEnabled=n,this.batchMessagesEnabled=o,this.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled=i}),[{key:"addBatchItem",value:function(e,t,n,o,r,i){var a=this,u=t.delayMs,d=t.delayMsMax,f=t.maxInputSize,p=t.estimateSize,g=t.groupingKeyExtractor,h=p(e),y=g(e);if(t.split&&h>f){var v;try{v=t.split(e)}catch(e){var m=new Error("Split error: "+e.message);return void(i?i(m):c.Log.error(573366352,c.LogCategory.CoreDefault,m))}if(v&&Array.isArray(v.inputs)&&v.inputs.length>1){for(var k,T=[],S=i?function(e,t){if(k=k||e,T.push(t),T.length===v.inputs.length){var n;try{n=v.join(T)}catch(e){return void i(new Error("Join error: "+e.message))}i(k,n)}}:void 0,b=0;b<v.inputs.length;b++){var C=v.inputs[b];this.addBatchItem(C,t,n,o,r&&b===v.inputs.length-1,S)}return}}var w=this.batchesByGroupingKey.get(y);if(w&&w.size+h>f&&(this.executeBatch(y,w,t,l.ExceedingMaxSize),w=void 0),w||(w={items:[],size:0,hasItemsWithCallbacks:!1,context:n,creationTime:Date.now()},this.batchesByGroupingKey.set(y,w)),this.batchMessagesEnabled){var _=w.items[w.items.length-1];_&&_.cv===o&&_.callback===i?(_.input=[].concat((0,s.default)(_.input),(0,s.default)(e)),_.size+=h):w.items.push({input:e,size:h,cv:o,callback:i,creationTime:Date.now()})}else w.items.push({input:e,size:h,callback:i,creationTime:Date.now()});w.size+=h,w.hasItemsWithCallbacks=w.hasItemsWithCallbacks||!!i,this.batchMessagesEnabled||(w.cv=o),w.groupComplete=r,w.groupComplete?this.executeBatch(y,w,t,l.GroupComplete):(Date.now()-w.creationTime+u<d&&(clearTimeout(w.timeout),w.timeout=void 0),w.timeout||(w.timeout=setTimeout((function(){a.executeBatch(y,w,t,l.BatchIntervalElapsed)}),u)))}},{key:"removeAllBatchedItems",value:function(){this.batchesByGroupingKey.forEach((function(e){e.timeout&&clearTimeout(e.timeout)})),this.batchesByGroupingKey.clear()}},{key:"close",value:function(){var e,t=(0,i.default)(this.batchesByGroupingKey);try{for(t.s();!(e=t.n()).done;){var n=(0,r.default)(e.value,2),o=n[0],s=n[1];void 0!==s.creationTime&&void 0!==s.timeout&&void 0!==s.timeoutDuration&&Date.now()-s.creationTime>s.timeoutDuration+1e3&&c.Log.info(504690067,c.LogCategory.CoreDefault,{operationName:"BatchStillPendingAfterTimeout",resourceId:s.context.name,resultDescription:'Batch with groupingKey "'.concat(o,'" still pending after timeout. Items: ').concat(s.items.length,", Size: ").concat(s.size),dimension0:s.items.length>0?"LastItemAge: ".concat(Date.now()-s.items[s.items.length-1].creationTime,"ms"):"No items in batch"})}}catch(e){t.e(e)}finally{t.f()}}},{key:"reduceBatchOperations",value:function(e){var t,n=new c.Operation({operationName:"ReduceBatchOperations"}).start(),o=0,r=0,s=0,a=new Set,u=[],l=function(e,t){return e.parentPath.toString()+"/"+e.parentRevId+"/"+t.id},d=(0,i.default)(e.input.reverse());try{for(d.s();!(t=d.n()).done;){var p,g=t.value,h=[],y=(0,i.default)(g.input.reverse());try{for(y.s();!(p=y.n()).done;){var v=p.value;if(f.UpdateOperation.typeGuard(v)){var m,k=[],T=(0,i.default)(v.items);try{for(T.s();!(m=T.n()).done;){var S=m.value;s++;var b=l(v,S);a.has(b)?r++:(k.push(S),a.add(b),o++)}}catch(e){T.e(e)}finally{T.f()}0!==k.length&&(v.items=k,h.push(v))}else if(f.AddOperation.typeGuard(v)){var C,w=(0,i.default)(v.items);try{for(w.s();!(C=w.n()).done;){var _=l(v,C.value);a.delete(_)}}catch(e){w.e(e)}finally{w.f()}h.push(v)}else h.push(v)}}catch(e){y.e(e)}finally{y.f()}0!==h.length&&u.push({input:h.reverse(),size:g.size,cv:g.cv,callback:g.callback,creationTime:g.creationTime})}}catch(e){d.e(e)}finally{d.f()}e.input=u.reverse(),0!=s&&(n.dimension0="".concat(this.getOrderOfMagnitudeDimension(r)),n.dimension1="noOp: ".concat(0===r)),n.success=s-r==o,c.Log.info(507839488,c.LogCategory.CoreDefault,n.stop())}},{key:"maxNumberOfDeltaUpdateOpsPerItemPerBatch",value:function(e){var t,n=function(e,t){return e.parentPath.toString()+"/"+t.id},o=0,r=new Map,s=(0,i.default)(e.input);try{for(s.s();!(t=s.n()).done;){var a=t.value;if(f.DeltaUpdateOperation.typeGuard(a)){var u,l=(0,i.default)(a.items);try{for(l.s();!(u=l.n()).done;){var c=n(a,u.value);r.has(c)||r.set(c,0),r.set(c,r.get(c)+1),o=Math.max(o,r.get(c))}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){s.e(e)}finally{s.f()}return o}},{key:"executeBatch",value:function(e,t,n,o){var s=this;clearTimeout(t.timeout),t.timeout=void 0,this.batchesByGroupingKey.delete(e);var a,u=t.items,l=new c.Operation({operationName:"ExecuteBatch",cv:this.batchMessagesEnabled?"":t.cv,resourceId:t.context.name,resultDescription:"batching duration: ".concat(Date.now()-t.creationTime,"ms"),dimension0:"".concat(this.batchMessagesEnabled?"Batched items count":"Batched ops count:"," ").concat(this.getOrderOfMagnitudeDimension(u.length)),dimension1:"Size ".concat(this.getOrderOfMagnitudeDimension(t.size)),dimension2:o.toString()}).start(),f=function(e,n,o){var r;if(n&&n.exceptionType===d.ExceptionType.NoOutput)l.success=!0,c.Log.info(573366353,c.LogCategory.CoreDefault,l.stop());else{var s="".concat(e," error: ").concat(n?n.message||n:"Unknown error");r=n||new Error(s),l.success=!1,l.resultDescription="Batch of ".concat(u.length," items of size ").concat(t.size," with ").concat(s),l.resultSignature="".concat(e," Error"),c.Log.error(573366354,c.LogCategory.CoreDefault,l.stop())}if(t.hasItemsWithCallbacks){var a,f=(0,i.default)(u);try{for(f.s();!(a=f.n()).done;){var p=a.value;p.callback&&p.callback(r,o)}}catch(n){f.e(n)}finally{f.f()}}};try{a=n.multiplex(this.batchMessagesEnabled?u:u.map((function(e){return e.input})))}catch(e){return void f("Multiplex",e)}this.reduceBatchOperationsEnabled&&this.batchMessagesEnabled&&"operations"==e&&this.reduceBatchOperations(a),!this.batchMessagesEnabled&&"operations"==e&&this.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled&&(l.dimension3=this.getOrderOfMagnitudeDimension(this.maxNumberOfDeltaUpdateOpsPerItemPerBatch(a))),this.submit(a.input,t,(function(e,o){if(e||o&&("exceptionType"in o||o instanceof Error))f("Submit",e||o,o);else if(t.hasItemsWithCallbacks||n.summaryExtractor){var i,d,p;if(t.hasItemsWithCallbacks)try{if((i=a.demultiplex(o)).length!==u.length)throw new Error("Mismatched output length")}catch(e){return void f("Demultiplex",e)}if(n.summaryExtractor)try{var g=n.summaryExtractor(o),h=(0,r.default)(g,2);p=h[0],d=h[1]}catch(e){return void f("SummaryExtractor",e)}if(l.success=!0,c.Log.info(573366342,c.LogCategory.CoreDefault,l.stop()),t.hasItemsWithCallbacks)for(var y=0;y<u.length;y++)u[y].callback&&u[y].callback(void 0,i[y]);d&&s.onSummary(p,d,t.context)}else l.success=!0,c.Log.info(573366343,c.LogCategory.CoreDefault,l.stop())}))}}])}();n.BatchManager=p},{105:105,190:190,22:22,227:227,24:24,25:25,30:30,48:48,51:51}],153:[function(e,t,n){"use strict";var o=(0,e(30).default)(e(45)),r=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.fetchBlobFromRef=n.sendBinaryStreamUploadMessage=n.sendLargeBinaryDataMessage=void 0;var i=e(227),s=e(105),a=e(57),u=e(102),l=e(204);function c(e,t){return r.__awaiter(this,void 0,void 0,(0,o.default)().mark((function n(){var r,i,s,u,l,c,d,f;return(0,o.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.authToken,i=e.origin,s=e.sessionUrl,u=t.body,l=t.cv,c=t.method,d=t.requestUrl,n.next=4,(0,a.fetch)(d||s,{method:c,headers:Object.assign({Authorization:"Bearer ".concat(r),"x-origin":i,"x-correlationid":l},t.headers),body:u});case 4:if(200===(f=n.sent).status){n.next=7;break}throw new Error("Unexpected status code: ".concat(f.status));case 7:return n.abrupt("return",f);case 8:case"end":return n.stop()}}),n)})))}var d=function(e,t){t?(e.resultDescription=t,e.success=!1,s.Log.error(507646878,s.LogCategory.CoreDefault,e.stop())):s.Log.info(507646877,s.LogCategory.CoreDefault,e.stop())};n.sendLargeBinaryDataMessage=function(e,t,n,o){var r;c(e,{headers:{"Content-Type":"application/jsond"},body:u.JSOND.serialize(t),cv:n.cv,method:"POST"}).then((function(e){return e.json()})).catch((function(e){r=new l.ErrorResponse({messageId:t.messageId,error:e.message})})).then((function(e){d(n,r?r.error:void 0),o(r,e)}))},n.sendBinaryStreamUploadMessage=function(e,t,n,o){var r;c(e,{headers:{"Content-Type":"application/octet-stream"},body:t,cv:n.cv,method:"POST",requestUrl:"".concat(e.sessionUrl,"/blob")}).then((function(e){return e.json()})).catch((function(e){r=new l.ErrorResponse({error:e.message})})).then((function(e){d(n,r?r.error:void 0),o(r,e)}))},n.fetchBlobFromRef=function(e,t,n,o){var r,s=e.sessionUrl;c(e,{cv:o.cv,method:"GET",requestUrl:t.refType===i.BlobRefType.AlCodedLocation?"".concat(s,"/blob/").concat(t.value):t.value}).then((function(e){return e.arrayBuffer()})).then((function(e){return new Uint8Array(e)})).catch((function(e){r=e})).then((function(e){d(o,r?r.message:void 0),n(r,e)}))}},{102:102,105:105,204:204,227:227,30:30,45:45,57:57}],154:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.LinkedCancellationToken=n.TimeoutCancellationToken=n.CancellationToken=void 0;var a=e(145),u=new(e(150).DefaultTimeoutScheduler),l=function(){return(0,s.default)((function e(){(0,i.default)(this,e),this._isCancellationRequested=!1,this.onCancelCallbacks=[]}),[{key:"cancel",value:function(){if(!this._isCancellationRequested){this._isCancellationRequested=!0;var e,t=(0,r.default)(this.onCancelCallbacks);try{for(t.s();!(e=t.n()).done;){(0,e.value)(this)}}catch(e){t.e(e)}finally{t.f()}this.onCancelCallbacks=[]}}},{key:"IsCancellationRequested",get:function(){return this._isCancellationRequested}},{key:"onCancel",value:function(e){this._isCancellationRequested?e(this):this.onCancelCallbacks.push(e)}},{key:"rejectWhenCancellationRequested",value:function(){var e=this;return new Promise((function(t,n){e.onCancel((function(){return n(new a.CancelTokenError("Token cancelled"))}))}))}},{key:"removeCancelCallback",value:function(e){var t=this.onCancelCallbacks.indexOf(e);t>-1&&this.onCancelCallbacks.splice(t,1)}},{key:"dispose",value:function(){this.onCancelCallbacks=[]}}])}();n.CancellationToken=l;var c=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.internalToken=new l,this.clearScheduledCancel=null,this.scheduler=null!=t?t:u}),[{key:"token",get:function(){return this.internalToken}},{key:"cancel",value:function(){var e;this.internalToken.IsCancellationRequested||(this.internalToken.cancel(),null===(e=this.clearScheduledCancel)||void 0===e||e.call(this))}},{key:"cancelAfter",value:function(e){var t,n=this;if(!this.token.IsCancellationRequested){if(e<0)throw new Error("Duration can not be negative");null===(t=this.clearScheduledCancel)||void 0===t||t.call(this);var o=this.scheduler.executeAfter((function(){n.cancel(),n.clearScheduledCancel=null}),e);this.clearScheduledCancel=function(){o(),n.clearScheduledCancel=null}}}},{key:"dispose",value:function(){var e;this.internalToken&&(null===(e=this.clearScheduledCancel)||void 0===e||e.call(this),this.internalToken.dispose(),this.internalToken=null)}}])}();n.TimeoutCancellationToken=c;var d=function(){return(0,s.default)((function e(){var t=this;(0,i.default)(this,e),this.innerCancelSource=new c,this.unsubscribeFromTokens=null,this.onLinkedTokenCancelled=function(){var e;t.innerCancelSource.cancel(),null===(e=t.unsubscribeFromTokens)||void 0===e||e.call(t)};for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];this.subscribeToTokens(o)}),[{key:"token",get:function(){return this.innerCancelSource.token}},{key:"dispose",value:function(){var e;null===(e=this.unsubscribeFromTokens)||void 0===e||e.call(this)}},{key:"subscribeToTokens",value:function(e){var t=this;e.some((function(e){return e.IsCancellationRequested}))?this.innerCancelSource.cancel():(e.forEach((function(e){return e.onCancel(t.onLinkedTokenCancelled)})),this.unsubscribeFromTokens=function(){t.unsubscribeFromTokens=null,e.forEach((function(e){return e.removeCancelCallback(t.onLinkedTokenCancelled)}))})}}])}();n.LinkedCancellationToken=d},{145:145,150:150,22:22,24:24,25:25,30:30}],155:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(51)),s=o(e(22)),a=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ChatHelper=void 0;var u=e(223),l=e(227),c=e(245),d=function(){function e(t){(0,s.default)(this,e),this.config=t,this.nextMessageId=0,this.responseCallbacks=new Map;var n=["session","chats"],o=(0,c.v4)(),r=[].concat(n,[o]);this.messagesPath=[].concat((0,i.default)(r),["messages"]),this.config.session.submitOperations([new l.AddOperation({parentPath:n,items:[{id:o,body:t.chat}]}),new l.AddOperation({parentPath:r,items:[{id:"messages",body:new u.MessagesHolder}]})])}return(0,a.default)(e,[{key:"send",value:function(e,t){var n="".concat(this.nextMessageId++);this.responseCallbacks.set(n,t),this.config.session.submitOperations([new l.AddOperation({parentPath:this.messagesPath,items:[{id:n,body:e}]})])}},{key:"close",value:function(){return this.config.session.releaseAnnotation(this.activatedAnnotationToken)}},{key:"activateAnnotation",value:function(e){var t=this;return this.config.session.activateAnnotation(e,{callback:function(e){if(l.AddOperation.typeGuard(e)&&t.isUnderSubtree(e.parentPath,t.messagesPath)){var n,o=(0,r.default)(e.items);try{for(o.s();!(n=o.n()).done;){var i=n.value,s=e.parentPath[e.parentPath.length-1],a=t.responseCallbacks.get(s);a&&(a(i.body),t.responseCallbacks.delete(s))}}catch(e){o.e(e)}finally{o.f()}}}}).then((function(e){var n=e.token;t.activatedAnnotationToken=n}))}},{key:"isUnderSubtree",value:function(e,t){if(e.length<t.length)return!1;for(var n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}}],[{key:"create",value:function(t){var n=new e(t);return n.activateAnnotation(t.responseType).then((function(){return n}))}}])}();n.ChatHelper=d},{22:22,223:223,227:227,24:24,245:245,25:25,30:30,51:51}],156:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(141),n),o.__exportStar(e(142),n),o.__exportStar(e(146),n),o.__exportStar(e(152),n),o.__exportStar(e(153),n),o.__exportStar(e(155),n),o.__exportStar(e(157),n),o.__exportStar(e(159),n),o.__exportStar(e(160),n),o.__exportStar(e(161),n),o.__exportStar(e(163),n),o.__exportStar(e(169),n),o.__exportStar(e(181),n),o.__exportStar(e(184),n),o.__exportStar(e(185),n),o.__exportStar(e(187),n)},{141:141,142:142,146:146,152:152,153:153,155:155,157:157,159:159,160:160,161:161,163:163,169:169,181:181,184:184,185:185,187:187}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.asyncFetchWithTimeout=n.internalFetch=n.timeoutErrorString=void 0;var o=e(182),r=e(57);n.timeoutErrorString="Request timed out",n.internalFetch=function(e,t,n){var o=new r.Request(e,t);return i.add(o,n)};var i=new o.SequentialFetchQueue(r.fetch,2e4,12e4);n.asyncFetchWithTimeout=function(e,t,o){return new Promise((function(i,s){var a=setTimeout((function(){s(new Error(n.timeoutErrorString))}),t);(0,r.fetch)(e,o||{}).then((function(e){clearTimeout(a),i(e)})).catch((function(e){clearTimeout(a),s(e)}))}))}},{182:182,57:57}],158:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.GateUtils=void 0;var u=e(105),l=function(){return(0,s.default)((function e(t,n){(0,i.default)(this,e),this.changeGatesInitialized=!1,this.hostCallbacks=t,this.changeGateMap=n||new Map}),[{key:"init",value:function(){return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function e(){var t,n=this;return(0,r.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.hostCallbacks&&this.hostCallbacks.isChangeGateEnabled&&this.changeGateMap.forEach((function(e,o){t.push(n.hostCallbacks.isChangeGateEnabled(o).then((function(e){n.changeGateMap.set(o,e)})))})),e.next=4,Promise.all(t).then((function(){n.changeGatesInitialized=!0})).catch((function(e){}));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"None";return this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled(e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)}},{key:"isChangeGateEnabled",value:function(e){var t;return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function n(){return(0,r.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.changeGateMap){n.next=2;break}return n.abrupt("return",!0);case 2:if(!this.changeGatesInitialized||!this.changeGateMap.has(e)){n.next=4;break}return n.abrupt("return",this.changeGateMap.get(e));case 4:if(this.changeGatesInitialized||!(null===(t=this.hostCallbacks)||void 0===t?void 0:t.isChangeGateEnabled)){n.next=8;break}return n.next=7,this.hostCallbacks.isChangeGateEnabled(e);case 7:return n.abrupt("return",n.sent);case 8:return n.abrupt("return",!0);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"isChangeGateEnabledSync",value:function(e){var t;if(!this.changeGatesInitialized&&(null===(t=this.hostCallbacks)||void 0===t?void 0:t.isChangeGateEnabled)){var n=new u.Operation({operationName:"GateUtilsNotInitialized",success:!1,resultDescription:"".concat(e)});u.Log.error(505529628,u.LogCategory.CoreDefault,n)}return!this.changeGateMap||(!this.changeGatesInitialized||!this.changeGateMap.has(e)||this.changeGateMap.get(e))}},{key:"isChangeGatesInitialized",value:function(){return this.changeGatesInitialized}},{key:"getChangeGateMap",value:function(){return this.changeGateMap}}])}();n.GateUtils=l},{105:105,22:22,24:24,30:30,45:45}],159:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],160:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],161:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],162:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.LocalWorkflowContext=void 0;var s=e(250),a=function(){return(0,i.default)((function e(t){(0,r.default)(this,e),this.model=t.model,this.clientMetadata=t.clientMetadata,this.userContext=t.userContext,this.site=t.site,this.getTokenCallback=t.getTokenCallback}),[{key:"flights",get:function(){var e;return null!==(e=this._flights)&&void 0!==e||(this._flights=(0,s.parseFlights)(this.clientMetadata.flights)),this._flights}},{key:"getToken",value:function(e,t){return this.getTokenCallback(e,t)}},{key:"getTokenAsync",value:function(e){var t=this;return new Promise((function(n,o){t.getToken(e,(function(e,t,r){e?o(e):n(Object.assign(Object.assign({},r),{token:t}))}))}))}}])}();n.LocalWorkflowContext=a},{22:22,24:24,250:250,30:30}],163:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(51)),s=o(e(48)),a=o(e(22)),u=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.LocalWorkflowExecutionManager=void 0;var l,c=e(227),d=e(86),f=e(105),p=e(204),g=e(200),h=e(183),y=e(188),v=e(185),m=e(114),k=e(162),T=e(252),S=e(240),b=e(197),C=e(164);!function(e){e.Unknown="",e.InputReceived="input",e.JoinMaxAnnnotation="maxAnnotation",e.JoinMaxTimeout="maxTimeout",e.JoinEarlyCompletion="earlyCompletion"}(l||(l={}));var w=function(){function e(t,n,o){var r=this;(0,a.default)(this,e),this.executionTrackersByWorkflowNameBySession=new Map,this.workflowsWithSessionAffinity=new Map,this.workflowDefinitionsWithSessionAffinity=[],this.workflowsWithoutSessionAffinity=[],this.pendingScopeExecutionNotificationsByWorkflow=new Map,this.sweepIntervalMs=200,this.sweepTimers=new Map,this.getResourceAsArrayBuffer=function(e,t,n){return r.modelDownloader?r.modelDownloader.getResourceAsArrayBuffer(e,t,n):Promise.reject(new Error("Resource Downloader never created"))},this.getResourceAsURL=function(e,t,n){return r.modelDownloader?r.modelDownloader.getResourceAsURL(e,t,n):Promise.reject(new Error("Resource Downloader never created"))},this.createModel=function(e){return!r.inferenceService&&r.inferenceServiceFactory&&(r.inferenceService=r.inferenceServiceFactory()),r.inferenceService?r.inferenceService.then((function(t){return t.createModel(e)})):Promise.reject(new Error("Inference Service never created"))},this.createModelInputs=function(){if(!r.inferenceService&&r.inferenceServiceFactory&&(r.inferenceService=r.inferenceServiceFactory()),r.inferenceService)return r.inferenceService.then((function(e){return e.createInputs()}));throw new Error("Inference Service never created")},this.nextAnnotationId=1,this.nextSignalId=1,this.modelDownloader=t,this.inferenceServiceFactory=n,o.enableDeltas&&(this.deltaHandlers=(new Map).set(c.SchemaObject.getTypeNameFor(S.TextTileDelta),m.applyTextTileDelta).set(c.SchemaObject.getTypeNameFor(S.FormattedTextTileDelta),m.applyFormattedTextTileDelta),this.itemsForDelta=new Map),this.enableEarlyJoin=o.enableEarlyJoin||!1,this.site={getResourceAsArrayBuffer:this.getResourceAsArrayBuffer,getResourceAsURL:this.getResourceAsURL,createModel:this.createModel,createModelInputs:this.createModelInputs}}return(0,u.default)(e,[{key:"getNextClientAnnotationId",value:function(){return"#AC"+this.nextAnnotationId++}},{key:"getNextClientSignalId",value:function(){return"#SC"+this.nextSignalId++}},{key:"registerLocalWorkflow",value:function(e,t){var n=this,o=new f.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");t?(this.workflowsWithSessionAffinity.get(t).push(this.createWorkflowImplementation(e,t)),t.registerContextTypes((0,T.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=(0,s.default)(e,2),n=t[0];t[1];return n}))),t.attachToWorkflowGraph(e),o.setClientMetadata(t.getClientMetadata())):(e.isStateful?(this.workflowDefinitionsWithSessionAffinity.push(e),this.workflowsWithSessionAffinity.forEach((function(t,o){t.push(n.createWorkflowImplementation(e,o))}))):this.workflowsWithoutSessionAffinity.push(this.createWorkflowImplementation(e)),this.workflowsWithSessionAffinity.forEach((function(t,n){n.registerContextTypes((0,T.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=(0,s.default)(e,2),n=t[0];t[1];return n}))),n.attachToWorkflowGraph(e)}))),o.success=!0,f.Log.info(572838110,f.LogCategory.CoreDefault,o.stop())}},{key:"getAllRegisteredWorkflowsFromSession",value:function(e){var t=[];return t.push.apply(t,(0,i.default)(this.workflowsWithoutSessionAffinity||[])),t.push.apply(t,(0,i.default)(this.workflowsWithSessionAffinity.get(e)||[])),t.map((function(e){return e.workflow}))}},{key:"getWorkflowDefinitionsByName",value:function(e){var t,n=new Map;return null===(t=this.workflowsWithSessionAffinity.get(e))||void 0===t||t.forEach((function(e){return n.set(e.workflow.id,e.workflow)})),n}},{key:"getWorkflowDefinitionsWithSessionAffinity",value:function(){return this.workflowDefinitionsWithSessionAffinity}},{key:"attachExecutionTrackerToEachWorkflow",value:function(e,t,n){var o=this,i=e.getWorkflowNodes(),s=this.executionTrackersByWorkflowNameBySession.get(t),a=function(e,i){if(n&&n(e,i),o.enableEarlyJoin){(function(){var e,n,s=(0,r.default)((null===(e=o.executionTrackersByWorkflowNameBySession.get(t))||void 0===e?void 0:e.values())||[]);try{for(s.s();!(n=s.n()).done;){var a=n.value;if(a.graphNode.workflow.kind===d.WorkflowKind.Join){var u,l=(0,r.default)(a.getExecutionState().keys());try{for(l.s();!(u=l.n()).done;){var c=u.value;if(m.ContextIdManager.isParentContextId(c,i))return!0}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){s.e(e)}finally{s.f()}return!1})()&&(o.cancelSweepTimer(t),o.ensureSweepTimer(t),o.sweepScopeExecutionNotifications())}};if(s){var u,l=(0,r.default)(i);try{for(l.s();!(u=l.n()).done;){var c=u.value,f=s.get(c.workflow.id),p=new C.WorkflowExecutionTracker(c,a.bind(this),f);s.set(c.workflow.id,p)}}catch(e){l.e(e)}finally{l.f()}var g,h=(0,r.default)(s.values());try{for(h.s();!(g=h.n()).done;){var y=g.value;this.setDownstreamWorkflowExecutionTrackers(y,s),this.setUpstreamWorkflowExecutionTrackers(y,s)}}catch(e){h.e(e)}finally{h.f()}}}},{key:"canActivateWorkflow",value:function(e,t){var n;return e.location===m.Location.Local||!!t.hasConnected&&!((null===(n=e.workflow.requiredTokenTypes)||void 0===n?void 0:n.length)>0&&t.getServerAuthenticationState()===p.ServerAuthenticationState.NotAuthenticated)}},{key:"setDownstreamWorkflowExecutionTrackers",value:function(e,t){if(void 0===e.downstreamWorkflowExecutionTrackers){e.downstreamWorkflowExecutionTrackers=new Set;var n,o=e.graphNode,i=(0,r.default)(o.downstreamWorkflows||[]);try{for(i.s();!(n=i.n()).done;){var s=n.value,a=t.get(s.workflow.id);this.setDownstreamWorkflowExecutionTrackers(a,t),e.downstreamWorkflowExecutionTrackers.add(a)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"setUpstreamWorkflowExecutionTrackers",value:function(e,t){if(void 0===e.upstreamWorkflowExecutionTrackers){e.upstreamWorkflowExecutionTrackers=new Set;var n,o=e.graphNode,i=(0,r.default)(o.upstreamWorkflows||[]);try{for(i.s();!(n=i.n()).done;){var s=n.value,a=t.get(s.workflow.id);this.setUpstreamWorkflowExecutionTrackers(a,t),e.upstreamWorkflowExecutionTrackers.add(a)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"deactivateServerWorkflow",value:function(e,t){var n,o;e.location!==m.Location.Local&&(null===(o=null===(n=this.executionTrackersByWorkflowNameBySession.get(t))||void 0===n?void 0:n.get(e.workflow.id))||void 0===o||o.clearWorkflowExecutions(),e.isActivated=!1)}},{key:"addSession",value:function(e){this.isWorkflowTrackingEnabled(e)&&this.executionTrackersByWorkflowNameBySession.set(e,new Map);var t,n=[],o=(0,r.default)(this.workflowDefinitionsWithSessionAffinity);try{for(o.s();!(t=o.n()).done;){var i=t.value;n.push(this.createWorkflowImplementation(i)),e.attachToWorkflowGraph(i)}}catch(e){o.e(e)}finally{o.f()}this.workflowsWithSessionAffinity.set(e,n);var s,a=(0,r.default)(this.workflowsWithoutSessionAffinity);try{for(a.s();!(s=a.n()).done;){var u=s.value;e.attachToWorkflowGraph(u.workflow)}}catch(e){a.e(e)}finally{a.f()}}},{key:"isWorkflowTrackingEnabled",value:function(e){return this.enableEarlyJoin||e.enabledRemoteExecutionNotification()}},{key:"closeSession",value:function(e){this.cancelSweepTimer(e);var t,n=(0,r.default)(this.workflowsWithSessionAffinity.get(e)||[]);try{for(n.s();!(t=n.n()).done;){t.value.workflowLambda.dispose()}}catch(e){n.e(e)}finally{n.f()}this.workflowsWithSessionAffinity.delete(e),this.isWorkflowTrackingEnabled(e)&&this.executionTrackersByWorkflowNameBySession.delete(e)}},{key:"setTokenCallback",value:function(e){this.getAuthTokenCallback=e}},{key:"preProcessItemToWorkflow",value:function(e,t,n){var o,r=null===(o=this.executionTrackersByWorkflowNameBySession.get(n))||void 0===o?void 0:o.get(e.id);r&&(e.kind===d.WorkflowKind.Join&&c.SchemaObject.matchesTypesFor(t.body,e.inputTypes)&&r.addInputItemToProcess(t.contextId),(e.kind===d.WorkflowKind.SingleItem&&c.SchemaObject.matchesTypesFor(t.body,e.inputTypes)||e.kind===d.WorkflowKind.Join&&c.SchemaObject.matchesTypesFor(t.body,[e.collectionScopeType]))&&r.beforeWorkflowExecution(t.contextId))}},{key:"isReadyToEarlyJoin",value:function(e,t,n){var o=this;if(!e)return!1;var r=function(r){var i,s=Array.from(null!==(i=r.states)&&void 0!==i?i:[]).map((function(e){return"".concat(e[0],": ").concat(e[1].map((function(e){return e.join()})))})).join(),a=new f.Operation({operationName:"EarlyJoinCompletion",resourceId:e.graphNode.workflow.id,joinContextId:t,success:!0}).start();a.setClientMetadata(n),a.resultDescription="isReadyToEarlyJoin (".concat(o.enableEarlyJoin,") -> hasProcessedAllInputItems: ").concat(r.hasProcessedAllInputItems,", allUpstreamComplete: ").concat(r.allUpstreamComplete,", states: ").concat(s),f.Log.info(512550800,f.LogCategory.CoreDefault,a.stop())},i=0===e.countItemsToProcess(t);if(!i)return this.enableEarlyJoin||r({hasProcessedAllInputItems:i}),!1;var s=this.areAllUpstreamWorkflowComplete(e,t),a=s.allUpstreamComplete,u=s.states;return this.enableEarlyJoin?a:(r({hasProcessedAllInputItems:i,allUpstreamComplete:a,states:u}),!1)}},{key:"areAllUpstreamWorkflowComplete",value:function(e,t){var n,o=new Map,i=(0,r.default)(e.upstreamWorkflowExecutionTrackers);try{for(i.s();!(n=i.n()).done;){var a,u=n.value,l=[],c=(0,r.default)(u.getExecutionState());try{for(c.s();!(a=c.n()).done;){var d=(0,s.default)(a.value,2),f=d[0],p=d[1];if(l.push([f,p]),m.ContextIdManager.isParentContextId(t,f))return o.set(u.graphNode.workflow.id,l),{allUpstreamComplete:!1,states:o}}}catch(e){c.e(e)}finally{c.f()}l.length>0&&o.set(u.graphNode.workflow.id,l)}}catch(e){i.e(e)}finally{i.f()}return{allUpstreamComplete:!0,states:o}}},{key:"runLocalWorkflows",value:function(e,t){var n,o,a,u=this,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=function(e,n,o){var a,p,g=t.getWorkflowItemStorage(),y=e.workflow,v=null===(a=u.executionTrackersByWorkflowNameBySession.get(t))||void 0===a?void 0:a.get(y.id),m=y.inputTypes.concat(y.kind===d.WorkflowKind.Join?y.collectionScopeType:[]),k=new f.Operation({operationName:"RunLocalWorkflows",success:!0,resourceId:y.id,joinContextId:n.contextId}).start();if(k.setClientMetadata(t.getClientMetadata()),c.SchemaObject.matchesTypesFor(n.body,m)){var T=(0,b.shallowCloneItemWithPath)(o.parentPath,n);if(y.kind===d.WorkflowKind.Join){if(c.SchemaObject.matchesTypesFor(T.body,[y.collectionScopeType]))return g.setScopeItem(T,y),k.resultDescription="Scope item: ".concat(n.id," (").concat(c.SchemaObject.getTypeNameFor(n.body),")"),f.Log.info(524126153,f.LogCategory.CoreDefault,k.stop()),void u.setScopeExecutionNotification(t,e,T);null==v||v.removeProcessedInputItem(T.contextId);var S=g.getScopeItem(T.contextId,y);if(!S)return k.resultDescription="Filtered out join invalidation: out of scope type (".concat(y.collectionScopeType,"), item id: ").concat(T.id),void f.Log.info(541173894,f.LogCategory.CoreDefault,k.stop());g.addItemToWorkflowList(T,y),k.joinContextId=S.contextId,k.resultDescription="Input item: ".concat(n.id," (").concat(c.SchemaObject.getTypeNameFor(n.body),")")}if(c.SchemaObject.getBaseTypesFor(T.body).indexOf(c.ContextHolder.getTypeName())>=0){var C,w=[].concat((0,i.default)(T.parentPath),[T.id]),_=!0,M=(0,r.default)(null!==(p=y.outputTypes)&&void 0!==p?p:[]);try{for(M.s();!(C=M.n()).done;){var A=C.value;if(!t.getContextAnnotations(A,h.AnnotationSource.LocalWorkflow,w,y.id)){_=!1;break}}}catch(e){M.e(e)}finally{M.f()}if(_)return}!function o(){var r,i=t.resolveRequestedContexts(y),a=(0,s.default)(i,2),c=a[0],p=a[1];if(!c)return k.resultDescription="Required contexts are not ready for ".concat(y.id,". Retrying execution in ").concat(500," milliseconds..."),f.Log.info(545837259,f.LogCategory.CoreDefault,k.stop()),void setTimeout(o,500);if(y.kind===d.WorkflowKind.SingleItem)u.queueWorkflow({workflowInfo:e,scopeItem:T,inputItems:[T],requestedContexts:p,session:t,triggerReason:l.InputReceived,onCompleteCallback:u.onWorkflowExecuted.bind(u,T,y,t)}).then((function(){f.Log.info(509154263,f.LogCategory.WorkflowDefault,k.stop())})).catch((function(e){k.resultDescription=e,f.Log.error(572838111,f.LogCategory.CoreDefault,k.stop())}));else if(y.kind===d.WorkflowKind.Join){var h=n.contextId,m=g.getScopeItem(h,e.workflow);if(!m)return k.resultDescription="No scope item for ".concat(y.id," workflow from contextId ").concat(h),void f.Log.info(526758475,f.LogCategory.CoreDefault,k.stop());var S=u.isReadyToEarlyJoin(v,m.contextId,t.getClientMetadata()),b=S?l.JoinEarlyCompletion:l.JoinMaxAnnnotation;if(g.isWorkflowReady(m.contextId,y)||S){if(!(null===(r=u.pendingScopeExecutionNotificationsByWorkflow.get(y.id))||void 0===r?void 0:r.get(m.contextId)))return k.resultDescription="Workflow ".concat(y.id,", contextId ").concat(m.contextId,", already queued, skipping new scope execution"),void f.Log.info(528048977,f.LogCategory.CoreDefault,k.stop());var C=g.getItemsToExecute(m.contextId,y);u.queueWorkflow({workflowInfo:e,scopeItem:m,inputItems:C,requestedContexts:p,session:t,triggerReason:b,onCompleteCallback:u.onWorkflowExecuted.bind(u,m,y,t)}).then((function(){f.Log.info(509154262,f.LogCategory.WorkflowDefault,k.stop())})).catch((function(e){k.resultDescription=e,f.Log.error(541173895,f.LogCategory.CoreDefault,k.stop())})),u.pendingScopeExecutionNotificationsByWorkflow.get(y.id).delete(m.contextId),0===u.pendingScopeExecutionNotificationsByWorkflow.get(y.id).size&&u.pendingScopeExecutionNotificationsByWorkflow.delete(y.id)}}}()}},y=e;p&&(y=[new c.AddOperation({parentPath:["session"],items:[{id:"#userContext#",body:new c.UserContextHolder}]}),new c.AddOperation({parentPath:["session"],items:[{id:"#tenantContext#",body:new c.TenantContextHolder}]})],t.getContextIdManager().applyContextIdOnOperations(y),y=y.concat(e));var v,m=(0,r.default)(y);try{for(m.s();!(v=m.n()).done;){var k,T=v.value,S=c.SchemaObject.getTypeNameFor(T),C=(0,r.default)(T.items);try{for(C.s();!(k=C.n()).done;){var w=k.value;if(t.applyOperationForContext(T,w,h.AnnotationSource.Submitted),S!==c.DeleteOperation.getTypeName()){if(w.body)if(S===c.DeltaUpdateOperation.getTypeName()&&this.deltaHandlers&&this.itemsForDelta)this.handleLocalDeltaUpdate(w,T,t);else{null===(o=this.itemsForDelta)||void 0===o||o.set(T.parentPath.concat(w.id).toString(),w);var _,M=(0,r.default)(this.workflowsWithoutSessionAffinity);try{for(M.s();!(_=M.n()).done;){var A=_.value;g(A,w,T)}}catch(e){M.e(e)}finally{M.f()}var O,I=(0,r.default)(null!==(a=this.workflowsWithSessionAffinity.get(t))&&void 0!==a?a:[]);try{for(I.s();!(O=I.n()).done;){var x=O.value;g(x,w,T)}}catch(e){I.e(e)}finally{I.f()}}}else null===(n=this.itemsForDelta)||void 0===n||n.delete(T.parentPath.concat(w.id).toString())}}catch(e){C.e(e)}finally{C.f()}}}catch(e){m.e(e)}finally{m.f()}}},{key:"handleLocalDeltaUpdate",value:function(e,t,n){var o=new f.Operation({operationName:"LocalDeltaUpdate",dimension0:c.SchemaObject.getTypeNameFor(e.body),success:!0});o.start();try{var r=this.deltaHandlers.get(c.SchemaObject.getTypeNameFor(e.body)),i=this.itemsForDelta.get(t.parentPath.toString());if(r&&i){var s=t.parentPath.length>0?t.parentPath.slice(0,t.parentPath.length-1):t.parentPath,a=r(e.body,i.body);if(a){var u={id:i.id,revId:e.revId,body:a,parentPath:s,delta:e.body,contextId:e.contextId},l=new c.Operation({parentPath:u.parentPath,items:[u]});f.Log.info(539637591,f.LogCategory.CoreDefault,o.stop()),this.runLocalWorkflows([l],n)}else o.success=!1,o.resultDescription="Failed because the handler did not produce valid updated item",f.Log.info(539637592,f.LogCategory.CoreDefault,o.stop())}else o.success=!1,o.resultDescription="Failed due to lack of handler or parent item",f.Log.info(539637593,f.LogCategory.CoreDefault,o.stop())}catch(e){o.success=!1,o.resultDescription="Failed to apply delta, error: ".concat(e),f.Log.info(539637594,f.LogCategory.CoreDefault,o.stop())}}},{key:"createWorkflowImplementation",value:function(e,t){var n=e.factory();return{workflow:e,workflowLambda:n,initPromise:this.initWorkflow(e.kind,n,t)}}},{key:"initWorkflow",value:function(e,t,n){var o=new k.LocalWorkflowContext({model:void 0,clientMetadata:n?n.getClientMetadata():void 0,userContext:n?n.getUserContext():void 0,site:this.site,getTokenCallback:this.getAuthTokenCallback});return e===d.WorkflowKind.SingleItem||e===d.WorkflowKind.Join?t.init(this.site,o):Promise.resolve()}},{key:"queueWorkflow",value:function(e){var t,n,o=this;return null===(n=null===(t=this.executionTrackersByWorkflowNameBySession.get(e.session))||void 0===t?void 0:t.get(e.workflowInfo.workflow.id))||void 0===n||n.setExecutionState(e.scopeItem.contextId,m.ExecutionState.Running),this.executeLocalWorkflow(e.workflowInfo,e.scopeItem,e.inputItems,e.session,e.requestedContexts,e.triggerReason).then((function(t){o.processAnnotationResults(t,e.session),e.onCompleteCallback()})).catch((function(t){throw e.onCompleteCallback(),t}))}},{key:"processAnnotationResults",value:function(e,t){var n,o=(0,r.default)(e);try{for(o.s();!(n=o.n()).done;){var i=n.value;t.onAnnotationResults(i,h.AnnotationSource.LocalWorkflow,(function(){}))}}catch(e){o.e(e)}finally{o.f()}}},{key:"executeLocalWorkflow",value:function(t,n,o,i,s,a){var u=this;return new Promise((function(l,v){var m,T,S,b=[],C=t.workflow,w=new f.Operation({operationName:"ExecuteWorkflow",resourceId:C.id,joinContextId:null!==(m=null==n?void 0:n.contextId)&&void 0!==m?m:"",resultDescription:null!=a?a:"",success:!0}).setClientMetadata(i.getClientMetadata());w.start();var _=null!==(T=null==n?void 0:n.contextId)&&void 0!==T?T:o[0].contextId,M=null!==(S=null==n?void 0:n.revId)&&void 0!==S?S:o[0].revId,A=function(){var e=new Map;if(n&&(n.parentPath||f.Log.error(525382231,f.LogCategory.CoreDefault,"Missing scope item parent. Workflow: ".concat(C.id,". Type: ").concat(c.SchemaObject.getTypeNameFor(n.body))),e.set(n.body,n)),Array.isArray(o)){var t,i=(0,r.default)(o);try{for(i.s();!(t=i.n()).done;){var s=t.value;s&&s.body&&(s.parentPath||f.Log.error(525382232,f.LogCategory.CoreDefault,"Missing parent. Workflow: ".concat(C.id,". Type: ").concat(c.SchemaObject.getTypeNameFor(s.body))),e.set(s.body,s))}}catch(e){i.e(e)}finally{i.f()}}return e}(),O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w;if(e)return t.success=!1,t.resultDescription+="string"==typeof e?e:e.message,t.resultSignature="Exception",f.Log.error(572838112,f.LogCategory.CoreDefault,t.stop()),"string"==typeof e?new Error(e):e;f.Log.info(572838113,f.LogCategory.CoreDefault,t.stop())},I=new k.LocalWorkflowContext({model:new y.WorkflowModel(o[0],s),clientMetadata:i.getClientMetadata(),userContext:i.getUserContext(),site:u.site,getTokenCallback:u.getAuthTokenCallback}),x=function(e){O(e?e.message:void 0),e?v(e):l(b)},P={setAnnotations:function(e,s,a,l){var g,y=new f.Operation({operationName:"SetAnnotations",resourceId:s,joinContextId:null!==(g=null==n?void 0:n.contextId)&&void 0!==g?g:"",success:!0}).setClientMetadata(i.getClientMetadata());y.start();var m,k=function(e){f.Log.info(555866112,f.LogCategory.CoreDefault,new f.AnnotationMetaDataChange({annotationType:s,annotationState:e,workflowId:t.workflow.id}))},T=(0,r.default)(a);try{for(T.s();!(m=T.n()).done;){var S=m.value;S.metadata=Object.assign(Object.assign({},S.metadata),{state:c.AnnotationState.Created}),k(c.AnnotationState.Created)}}catch(e){T.e(e)}finally{T.f()}var w=A.get(e),I=c.SchemaObject.getTypeNameFor(w.body),x=function(){var t,n,g;if(C.kind===d.WorkflowKind.SingleItem&&o[0].body!==e){var m="Expected obj to be ".concat(o[0].body," but instead it was ").concat(e);return O(m,y),void v(O(m))}if(Array.isArray(a))if(!C.outputTypes||C.outputTypes.indexOf(s)<0)n="Workflow said it would output one of [".concat(C.outputTypes,"] but instead output ").concat(s);else if(w){var T,S=(0,r.default)(a);try{for(S.s();!(T=S.n()).done;){var b=T.value;c.SchemaObject.matchesTypesFor(b,[c.Annotation.getTypeName()])?c.SchemaObject.getTypeNameFor(b)!==s&&(n="Workflow produced inconsistent annotation types in setAnnotations call (".concat(c.SchemaObject.getTypeNameFor(b)," did not match expected ").concat(s,")")):n="Workflow produced an output that is not an annotation ".concat(c.SchemaObject.getTypeNameFor(b))}}catch(m){S.e(m)}finally{S.f()}}else n="No item provided";else n="Workflow produced an invalid annotation array";if(n)return O(n,y),void v(O(n));g=l&&l.isSessionAnnotation?["session"]:l&&l.ancestorType?w.parentPath:w.parentPath.concat(w.id);var A,I=[],x=[],P=(0,r.default)(a);try{var L=function(){var e=A.value;e.metadata=Object.assign(Object.assign({},e.metadata),{state:c.AnnotationState.Sent}),k(c.AnnotationState.Sent);var n=e.id,o=n?null===(t=i.getContextAnnotations(s,h.AnnotationSource.LocalWorkflow,g,C.id))||void 0===t?void 0:t.filter((function(e){var t;return(null===(t=e.body)||void 0===t?void 0:t.id)==n})):void 0;1==(null==o?void 0:o.length)?1==o.length?x.push({id:o[0].id,source:C.id,revId:M,body:e,contextId:_}):f.Log.error(545837260,f.LogCategory.CoreDefault,"Assert: Multiple existing context annotations with body id ".concat(n," found for ").concat(s," and local workflow ").concat(C.id,").")):I.push({id:u.getNextClientAnnotationId(),source:C.id,revId:M,body:e,contextId:_})};for(P.s();!(A=P.n()).done;)L()}catch(m){P.e(m)}finally{P.f()}var E=[];return I.length>0&&E.push(new c.AddOperation({parentPath:g,items:I,parentRevId:M})),x.length>0&&E.push(new c.UpdateOperation({parentPath:g,items:x,parentRevId:M})),new p.AnnotationResultsMessage({annotationType:s,ops:E})}();x?(l&&l.immediate?i.onAnnotationResults(x,h.AnnotationSource.LocalWorkflow,(function(){})):b.push(x),(I==c.UserContextHolder.getTypeName()||I==c.TenantContextHolder.getTypeName()||c.SchemaObject.matchesTypesFor(w.body,[c.Document.getTypeName(),c.SubDocument.getTypeName()]))&&i.submitOperationsToSession(x.ops),f.Log.info(509644822,f.LogCategory.CoreDefault,y.stop())):f.Log.info(509644823,f.LogCategory.CoreDefault,y.stop())},submitSignals:function(t){var n,o=new f.Operation({operationName:"submitSignalsAction",resourceId:C.id,success:!0}).setClientMetadata(i.getClientMetadata()),s=(0,r.default)(t);try{for(s.s();!(n=s.n()).done;){var a=n.value,l=c.SchemaObject.getTypeNameFor(a);c.SchemaObject.matchesTypesFor(a,[c.Signal.getTypeName()])||(o.resultDescription="Workflow produced an output that is not an signal (".concat(c.SchemaObject.getTypeNameFor(a),")"),f.Log.info(521413954,f.LogCategory.CoreDefault,o)),C.outputTypes&&-1!==C.outputTypes.indexOf(l)||(o.resultDescription="Workflow said it would output one of [".concat(C.outputTypes,"] but instead output ").concat(l),f.Log.info(521413953,f.LogCategory.CoreDefault,o)),a.timestamp&&(e.logTimestampUsageByWorkflowId.has(C.id)||(e.logTimestampUsageByWorkflowId.add(C.id),o.resultDescription='Workflow "'.concat(C.id,'" sets signal.timeStamp'),f.Log.info(509212803,f.LogCategory.CoreDefault,o)))}}catch(e){s.e(e)}finally{s.f()}var d=t.map((function(e){return{id:u.getNextClientSignalId(),source:C.id,revId:M,body:e,contextId:_}})),p=new c.SignalOperation({parentPath:["session"],parentRevId:M,items:d});i.submitOperations([p])},done:x,overrideWorkflowDefinition:function(e,t,o){var r;switch(o){case d.WorkflowDefinitionScope.JoinContext:if(!n.contextId){var s="ContextId is not defined for this scope item.";throw f.Log.error(527472289,f.LogCategory.CoreDefault,s),new Error(s)}r=n.contextId;break;case d.WorkflowDefinitionScope.Session:r=void 0;break;default:var a="Defined scope is not supported. "+o;throw f.Log.error(527472290,f.LogCategory.CoreDefault,a),new Error(a)}var u=new g.WorkflowDefinitionOverrideMessage({definition:t,contextId:r,sourceWorkflowId:C.id,targetWorkflowId:e});i.onWorkflowDefinitionOverrideMessage(u)},getDynamicAnnotations:void 0,setBillingDomain:void 0,sendClientRequest:void 0,sendClientRequestStreaming:void 0},L=t.workflowLambda;if(C.kind===d.WorkflowKind.SingleItem){1!==o.length&&x(new Error("Single item workflows expect a single input")),I.delta=o[0].delta,I.deltas=o[0].deltas;try{var E=L;t.initPromise||(t.initPromise=E.init(u.site,I)),t.initPromise.then((function(){E.execute(o[0].body,I,P)})).catch((function(e){O(e)}))}catch(e){O(e)}}else if(C.kind===d.WorkflowKind.Join){0===o.length&&x(new Error("Join workflows expect an inputs array")),I.delta=n.delta,I.deltas=n.deltas;try{var D=L;t.initPromise||(t.initPromise=D.init(u.site,I)),t.initPromise.then((function(){D.execute(n.body,o.map((function(e){return e.body})),I,P)})).catch((function(e){O(e)}))}catch(e){O(e)}}else O("Workflow kind ".concat(C.kind," not supported"))}))}},{key:"ensureSweepTimer",value:function(e){if(!this.sweepTimers.get(e)){var t=setInterval(this.onSweep.bind(this),this.sweepIntervalMs);this.sweepTimers.set(e,t)}}},{key:"cancelSweepTimer",value:function(e){var t=this.sweepTimers.get(e);this.sweepTimers.get(e)&&(clearInterval(t),this.sweepTimers.delete(e))}},{key:"onSweep",value:function(){this.sweepScopeExecutionNotifications()}},{key:"setScopeExecutionNotification",value:function(e,t,n){var o,r,i=Date.now(),s={session:e,workflowImplementation:t,scopeItem:n,startTime:i,minTime:i+(0,v.getSafeNumber)(t.workflow.minDelayMs,1e3),maxTime:i+(0,v.getSafeNumber)(t.workflow.maxDelayMs,5e3)},a=t.workflow.kind===d.WorkflowKind.Join?n.contextId:s.scopeItem.parentPath.concat(n.id).join("\\");if(this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id)||this.pendingScopeExecutionNotificationsByWorkflow.set(t.workflow.id,new Map),this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).get(a)){var u=new f.Operation({resultDescription:"Duplicated pending scope execution for ".concat(t.workflow.id," at ").concat(a),operationName:"LocalScopeExecutionNotification",resourceId:t.workflow.id,joinContextId:null!==(r=null==n?void 0:n.contextId)&&void 0!==r?r:"",success:!0}).setClientMetadata(e.getClientMetadata()).start();f.Log.info(509727899,f.LogCategory.CoreDefault,u.stop())}else{var l=new f.Operation({resultDescription:"New pending scope execution for ".concat(t.workflow.id," at ").concat(a),operationName:"LocalScopeExecutionNotification",resourceId:t.workflow.id,joinContextId:null!==(o=null==n?void 0:n.contextId)&&void 0!==o?o:"",success:!0}).setClientMetadata(e.getClientMetadata()).start();f.Log.info(539883075,f.LogCategory.CoreDefault,l.stop()),this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).set(a,s)}this.ensureSweepTimer(e)}},{key:"sweepScopeExecutionNotifications",value:function(){for(var e,t,n=this,o=new Set(Array.from(this.sweepTimers.keys())),r=0,i=Array.from(this.pendingScopeExecutionNotificationsByWorkflow.entries());r<i.length;r++)for(var a=(0,s.default)(i[r],2),u=a[0],c=a[1],p=function(){var r=(0,s.default)(h[g],2),i=r[0],a=r[1],c=a.session,p=a.workflowImplementation.workflow,y=c.getWorkflowItemStorage(),v=new f.Operation({operationName:"LocalScopeExecutionNotification",resourceId:p.id,joinContextId:null!==(t=null===(e=a.scopeItem)||void 0===e?void 0:e.contextId)&&void 0!==t?t:"",success:!0}).setClientMetadata(c.getClientMetadata()).start();!function(){var e=function(){var e;if(p.kind===d.WorkflowKind.Join){var t=Date.now(),o=a.workflowImplementation.workflow,r=a.scopeItem.contextId,i=c.getWorkflowDefinition(o,r).maxDelayMs;return y.isWorkflowReady(r,o)?(v.resultDescription="Join Workflow: ".concat(o.id," queuing by maxAnnotation, contextId: ").concat(r),f.Log.info(528048978,f.LogCategory.CoreDefault,v.stop()),{isValid:!0,triggerReason:l.JoinMaxAnnnotation}):a.startTime+i<t?(v.resultDescription="Join Workflow: ".concat(o.id," queuing by maxTimeout, contextId: ").concat(r),f.Log.info(528048979,f.LogCategory.CoreDefault,v.stop()),{isValid:!0,triggerReason:l.JoinMaxTimeout}):n.isReadyToEarlyJoin(null===(e=n.executionTrackersByWorkflowNameBySession.get(c))||void 0===e?void 0:e.get(o.id),r,c.getClientMetadata())?(f.Log.info(512550856,f.LogCategory.CoreDefault,"Workflow: ".concat(o.id," queuing by early completion, contextId: ").concat(r,", timeout: ").concat(i)),{isValid:!0,triggerReason:l.JoinEarlyCompletion}):{isValid:!1,triggerReason:l.Unknown}}return{isValid:!0,triggerReason:l.Unknown}}(),t=e.isValid,o=e.triggerReason;if(!t)return!1;var r=c.resolveRequestedContexts(p),i=(0,s.default)(r,2),u=i[0],g=i[1];if(!u)return!1;try{if(p.kind===d.WorkflowKind.Join){var h=a.scopeItem.contextId,m=y.getScopeItem(h,p);if(m){var k=y.getItemsToExecute(m.contextId,p);if(0===k.length)return v.resultDescription="Failed to retrieve items for workflow: ".concat(p.id,", contextId: ").concat(h,", skipping execution"),f.Log.info(527472291,f.LogCategory.CoreDefault,v.stop()),n.onWorkflowExecuted(m,p,c),!0;n.queueWorkflow({workflowInfo:a.workflowImplementation,scopeItem:m,inputItems:k,requestedContexts:g,session:c,triggerReason:o,onCompleteCallback:n.onWorkflowExecuted.bind(n,m,p,c)}).catch((function(e){v.success=!1,v.resultDescription=e.message,f.Log.error(509092189,f.LogCategory.CoreDefault,v.stop())}))}else v.resultDescription="ContextId no longer exists, skipping workflow execution",f.Log.info(539883076,f.LogCategory.CoreDefault,v.stop())}else v.resultDescription="Workflow in type ".concat(p.kind," is not supported"),f.Log.error(539883077,f.LogCategory.CoreDefault,v.stop())}catch(e){v.resultDescription="Trying to execute ".concat(p.id," caused an exception: ").concat(e),f.Log.warn(539883078,f.LogCategory.CoreDefault,v.stop())}return!0}()?o.delete(c):(n.pendingScopeExecutionNotificationsByWorkflow.get(u).delete(i),0===n.pendingScopeExecutionNotificationsByWorkflow.get(u).size&&n.pendingScopeExecutionNotificationsByWorkflow.delete(u))},g=0,h=Array.from(c.entries());g<h.length;g++)p();if(0!==o.size)for(var y=0,v=Array.from(o);y<v.length;y++){var m=v[y],k=new f.Operation({resultDescription:"No pending scope notifications left, cancelling sweep timer",operationName:"LocalScopeExecutionNotification",success:!0}).start();f.Log.debug(539883079,f.LogCategory.CoreDefault,k.stop()),this.cancelSweepTimer(m)}}},{key:"onExternalWorkflowExecuted",value:function(e,t,n){var o={id:"",parentPath:[],contextId:e},r={id:t};this.onWorkflowExecuted(o,r,n,!1)}},{key:"onWorkflowExecuted",value:function(e,t,n){var o,r,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];null===(r=null===(o=this.executionTrackersByWorkflowNameBySession.get(n))||void 0===o?void 0:o.get(t.id))||void 0===r||r.afterWorkflowExecution(e.contextId),i&&t.kind===d.WorkflowKind.Join&&n.getWorkflowItemStorage().onWorkflowExecuted(e,t)}}])}();n.LocalWorkflowExecutionManager=w},{105:105,114:114,162:162,164:164,183:183,185:185,188:188,197:197,200:200,204:204,22:22,227:227,24:24,240:240,25:25,252:252,30:30,48:48,51:51,86:86}],164:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(48)),i=o(e(25)),s=o(e(22)),a=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowExecutionTracker=void 0;var u=e(105),l=e(114),c=function(){return(0,a.default)((function e(t,n,o){(0,s.default)(this,e),this.itemsContextId=new Set,this.executionState=new Map,this.graphNode=t,this.onContextIdWorkflowExecutionComplete=n,o&&(this.itemsContextId=o.itemsContextId,this.executionState=o.executionState)}),[{key:"addInputItemToProcess",value:function(e){this.itemsContextId.add(e)}},{key:"removeProcessedInputItem",value:function(e){this.itemsContextId.delete(e)}},{key:"countItemsToProcess",value:function(e){var t,n=0,o=(0,i.default)(this.itemsContextId);try{for(o.s();!(t=o.n()).done;){0===t.value.indexOf(e)&&(n+=1)}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"getExecutionState",value:function(){return this.executionState}},{key:"setExecutionState",value:function(e,t){return this.graphNode.isActivated?e?(this.executionState.set(e,t),!0):(u.Log.info(520217546,u.LogCategory.CoreDefault,new u.Operation({operationName:"WorkflowExecutionTracker",resourceId:this.graphNode.workflow.id,joinContextId:e,resultDescription:"Trying to set state ".concat(t," for a undefined contextId (setExecutionState)")})),!1):(u.Log.info(508883415,u.LogCategory.CoreDefault,new u.Operation({operationName:"WorkflowExecutionTracker",resourceId:this.graphNode.workflow.id,joinContextId:e,resultDescription:"Trying to set state ".concat(t," for a not activated workflow")})),!1)}},{key:"beforeWorkflowExecution",value:function(e){this.setExecutionState(e,l.ExecutionState.Pending)}},{key:"afterWorkflowExecution",value:function(e){this.setExecutionState(e,l.ExecutionState.Executed)&&this.tryToCompleteWorkflowExecution(e)}},{key:"clearWorkflowExecutions",value:function(){var e=this;this.executionState.forEach((function(t,n){return e.afterWorkflowExecution(n)}))}},{key:"tryToCompleteWorkflowExecution",value:function(e){if(this.executionState.get(e)===l.ExecutionState.Executed&&this.canCompleteExecution(e)){this.executionState.delete(e),this.onContextIdWorkflowExecutionComplete&&this.onContextIdWorkflowExecutionComplete(this.graphNode.workflow.id,e);var t,n=(0,i.default)(this.downstreamWorkflowExecutionTrackers);try{for(n.s();!(t=n.n()).done;){var o,s=t.value,a=(0,i.default)(s.getExecutionState());try{for(a.s();!(o=a.n()).done;){var u=(0,r.default)(o.value,2),c=u[0];u[1]===l.ExecutionState.Executed&&l.ContextIdManager.isParentContextId(e,c)&&s.tryToCompleteWorkflowExecution(c)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"canCompleteExecution",value:function(e){var t,n=(0,i.default)(this.upstreamWorkflowExecutionTrackers);try{for(n.s();!(t=n.n()).done;){var o,r=t.value,s=(0,i.default)(r.getExecutionState().keys());try{for(s.s();!(o=s.n()).done;){var a=o.value;if(l.ContextIdManager.isParentContextId(a,e))return!1}}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}return!0}}])}();n.WorkflowExecutionTracker=c},{105:105,114:114,22:22,24:24,25:25,30:30,48:48}],165:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24)),s=o(e(21)),a=o(e(29));Object.defineProperty(n,"__esModule",{value:!0}),n.EmptySessionManager=void 0;var u=e(105),l=function(e){function t(){return(0,r.default)(this,t),(0,s.default)(this,t,arguments)}return(0,a.default)(t,e),(0,i.default)(t,[{key:"init",value:function(){return Promise.resolve()}},{key:"sendMessage",value:function(e,t,n){}},{key:"onMessage",value:function(e,t){}},{key:"forceReconnect",value:function(){return Promise.resolve()}},{key:"closeSession",value:function(){}},{key:"sendBytes",value:function(e){}},{key:"getCorrelationVector",value:function(){return new u.CorrelationVector}},{key:"getNetworkWorkerManager",value:function(){}},{key:"setState",value:function(e){}}])}(e(59).EventEmitter);n.EmptySessionManager=l},{105:105,21:21,22:22,24:24,29:29,30:30,59:59}],166:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.HttpReliabilityManager=void 0;var s=e(105),a=e(204),u=function(){return(0,i.default)((function e(t,n,o){(0,r.default)(this,e),this.remainingRetryAttempts=4,this.isAsleep=!1,this.isLongPollSuccessful=!1,this.isActiveLongPoll=!1,this.isResponseReceived=!1,this.lastEgressTime=0,this.longPollLogOp=new s.Operation({operationName:"OnLongPollMessage",success:!0}),this.clientMetadata=n,this.sessionCorrelationVector=o,this.longPollLogOp.setClientMetadata(this.clientMetadata,!0),this.worker=t}),[{key:"start",value:function(){var e=new s.Operation({operationName:"StartHttpReliabilityManager",success:!0}).start();e.setClientMetadata(this.clientMetadata,!0),s.Log.info(508163399,s.LogCategory.CoreDefault,e.stop()),this.trySendLongPoll(a.SessionLongPollMessageType.Start,!0),this.isLongPollSuccessful=!0}},{key:"onResponse",value:function(e){if(!e||this.isResponseReceived){var t=new s.Operation({operationName:"HttpReliabilityManagerFailure",success:!1}).start();return t.setClientMetadata(this.clientMetadata,!0),void s.Log.info(508162497,s.LogCategory.CoreDefault,t.stop())}this.isResponseReceived=!0,this.isActiveLongPoll=!1;var n=e;if(n.error)if(this.isLongPollSuccessful=!1,--this.remainingRetryAttempts,this.remainingRetryAttempts>0){this.longPollLogOp.success=!1,this.longPollLogOp.resultDescription="Retry attempts left : ".concat(this.remainingRetryAttempts),this.longPollLogOp.resultSignature=n.error,s.Log.info(508163398,s.LogCategory.CoreDefault,this.longPollLogOp.stop());var o="Request timed out"===n.error?a.SessionLongPollMessageType.TimeoutResend:a.SessionLongPollMessageType.FailResend;"Request timed out"===n.error||3===this.remainingRetryAttempts?this.trySendLongPoll(o,!0):this.enqueueSendLongPoll(o)}else this.longPollLogOp.success=!1,this.longPollLogOp.resultDescription="Long poll still not received after all retry attempts",s.Log.info(508163397,s.LogCategory.CoreDefault,this.longPollLogOp.stop()),this.worker&&this.worker.close();else this.longPollLogOp.success=!0,this.longPollLogOp.resultDescription="Long poll received",s.Log.info(508163401,s.LogCategory.CoreDefault,this.longPollLogOp.stop()),this.remainingRetryAttempts=4,this.isLongPollSuccessful=!0,this.trySendLongPoll(a.SessionLongPollMessageType.Regular)}},{key:"close",value:function(){var e=new s.Operation({operationName:"CloseHttpReliabilityManager",success:!0}).start();e.setClientMetadata(this.clientMetadata,!0),s.Log.info(508162467,s.LogCategory.CoreDefault,e.stop()),this.sendLongPollTimer&&(clearTimeout(this.sendLongPollTimer),this.sendLongPollTimer=void 0),this.isActiveLongPoll=!1,this.isLongPollSuccessful=!1,this.worker=void 0}},{key:"checkConnection",value:function(){if(this.isAsleep){this.isAsleep=!1;var e=new s.Operation({operationName:"AwakenHttpReliabilityManager",success:!0}).start();e.setClientMetadata(this.clientMetadata,!0),s.Log.info(508162496,s.LogCategory.CoreDefault,e.stop()),this.trySendLongPoll(a.SessionLongPollMessageType.CheckConnection,!0)}return this.isLongPollSuccessful}},{key:"isReliabilityResponse",value:function(e){return"string"!=typeof e&&a.SessionLongPollResponse.typeGuard(e)}},{key:"postEgress",value:function(){this.lastEgressTime=Date.now(),this.trySendLongPoll(a.SessionLongPollMessageType.PostEgress)}},{key:"needsParsedResponses",value:function(){return!0}},{key:"enqueueSendLongPoll",value:function(e){var t=this;this.sendLongPollTimer=setTimeout((function(){t.trySendLongPoll(e,!0)}),2e4)}},{key:"trySendLongPoll",value:function(e,t){if(!this.worker){var n=new s.Operation({operationName:"LongPollNoOp",success:!0}).start();return n.setClientMetadata(this.clientMetadata,!0),n.resultDescription="Worker is undefined",void s.Log.info(507281438,s.LogCategory.CoreDefault,n.stop())}if(!0===this.isActiveLongPoll){var o=new s.Operation({operationName:"LongPollNoOp",success:!0}).start();return o.setClientMetadata(this.clientMetadata,!0),o.resultDescription="Already active long poll",void s.Log.info(508163396,s.LogCategory.CoreDefault,o.stop())}if(this.isActiveLongPoll=!0,Date.now()-this.lastEgressTime>6e4&&!t){this.isActiveLongPoll=!1,this.isAsleep=!0;var r=new s.Operation({operationName:"LongPollSleep",success:!0}).start();return r.setClientMetadata(this.clientMetadata),r.resultDescription="isAsleep: ".concat(this.isAsleep,", isActiveLongPoll: ").concat(this.isActiveLongPoll),void s.Log.info(507278739,s.LogCategory.CoreDefault,r.stop())}this.longPollLogOp.start(),this.isResponseReceived=!1,this.worker.egress({obj:this.getLongPollMessageString(e),isHttpSessionLongPollMessage:!0,isHttpSessionInitMessage:!1})}},{key:"getLongPollMessageString",value:function(e){var t=new a.SessionLongPollMessage({longPollTimeoutHint:15e3,type:e});return this.sessionCorrelationVector&&(t.cv=this.sessionCorrelationVector().newChild().toString()),JSON.stringify(t)}}])}();n.HttpReliabilityManager=u},{105:105,204:204,22:22,24:24,30:30}],167:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.HttpWorker=void 0;var s=e(204),a=e(185),u=e(157),l=e(57),c=e(105),d=JSON.stringify(new s.SessionLongPollResponse({error:u.timeoutErrorString})),f=function(){return(0,i.default)((function e(t){(0,r.default)(this,e),this.networkOverrideOptions=t,this.isClosed=!1,this.pendingEgress=[]}),[{key:"init",value:function(e,t,n,o){var r=new c.Operation({operationName:"HttpWorkerInit",success:!0}).start(),i=e.split("/?x-origin=");2===i.length?(this.url=a.Utils.convertWebSocketUrlToHttp(i[0]),this.origin=i[1]):(this.url=a.Utils.convertWebSocketUrlToHttp(e),this.origin=void 0),this.ingress=t,this.onOpen=n,this.onClose=o,c.Log.info(507839180,c.LogCategory.CoreDefault,r.stop())}},{key:"egress",value:function(e){var t=this,n=new c.Operation({operationName:"HttpEgress",success:!0}).start();if(!this.isConnectedToSession()&&!e.isHttpSessionInitMessage)return this.pendingEgress.push(e),n.success=!1,n.resultDescription="NotConnected, pendingQueueSize:  "+this.pendingEgress.length.toString(),void c.Log.info(508163394,c.LogCategory.CoreDefault,n.stop());var o=this.getRequestInfo(e,n);if(!o.url)return n.success=!1,n.resultDescription="Could not generate HTTP request",void c.Log.error(508163393,c.LogCategory.CoreDefault,n.stop());e.isHttpSessionLongPollMessage?this.egressLongPoll(o,n):(0,u.internalFetch)(o.url,o.request,(function(e,o){e?t.onEgressError(n,"OnEgressError:"+(null==e?void 0:e.message)):o&&o.ok?o.text().then((function(e){n.success=!0,c.Log.info(508163362,c.LogCategory.CoreDefault,n.stop()),t.ingressInternal(e)})).catch((function(e){t.onEgressError(n,"OnEgressParseError: "+(null==e?void 0:e.message))})):t.onEgressError(n,"OnEgressResponseError: "+(null==e?void 0:e.message)+", Status ".concat(null==o?void 0:o.status,": ").concat(null==o?void 0:o.statusText))}))}},{key:"close",value:function(){var e=new c.Operation({operationName:"HttpWorkerClose",success:!0}).start();if(this.isClosed)return e.resultDescription="AlreadyClosed",void c.Log.info(508163360,c.LogCategory.CoreDefault,e.stop());c.Log.info(508163359,c.LogCategory.CoreDefault,e.stop()),this.isClosed=!0,this.sessionSettings=void 0,this.onClose&&(this.onClose(void 0),this.onClose=void 0)}},{key:"onEgressError",value:function(e,t){e.success=!1,e.resultDescription=t,c.Log.error(508163358,c.LogCategory.CoreDefault,e.stop()),this.isClosed||this.close()}},{key:"ingressInternal",value:function(e,t){var n=this,o=e;t||(o=this.formatServerInput(e));o&&(this.logIngressCount(o),this.ingress(o,(function(e){s.SessionInitResponse.typeGuard(e)&&n.onSessionInitResponse(e)})))}},{key:"onSessionInitResponse",value:function(e){var t=this,n=new c.Operation({operationName:"HttpWorkerOpen",success:!0}).start();if(!(e.sessionKey&&e.origin&&e.anonymousToken&&e.sessionUrlBase))return n.success=!1,n.resultDescription="SessionInitResponse missing information",void c.Log.error(507809949,c.LogCategory.CoreDefault,n.stop());c.Log.info(508163357,c.LogCategory.CoreDefault,n.stop()),this.setSessionSettings(e.sessionKey,e.origin,e.anonymousToken,e.sessionUrlBase),this.onOpen(),this.pendingEgress.forEach((function(e){t.egress(e)})),this.pendingEgress=[]}},{key:"egressLongPoll",value:function(e,t){var n=this;(0,u.asyncFetchWithTimeout)(e.url,2e4,e.request).then((function(e){e&&e.ok?e.text().then((function(e){t.success=!0,t.resourceId="LongPoll",c.Log.info(508163355,c.LogCategory.CoreDefault,t.stop()),n.ingressInternal(e)})).catch((function(e){n.onEgressError(t,"LongPollFetchParseError: "+(null==e?void 0:e.message))})):n.onEgressError(t,"LongPollFetchStatusFailure: "+(null==e?void 0:e.statusText))})).catch((function(e){e.message===u.timeoutErrorString?(t.success=!1,t.resultDescription="LongPollFetchResponseTimeout:"+(null==e?void 0:e.message),c.Log.error(508163353,c.LogCategory.CoreDefault,t.stop()),n.ingressInternal(d,!0)):n.onEgressError(t,"LongPollFetchResponseError: "+(null==e?void 0:e.message))}))}},{key:"getRequestInfo",value:function(e,t){var n=this.getUrl(null==e?void 0:e.isHttpSessionInitMessage),o=this.getHeader(e,t);return t.resultSignature=n,{url:n,request:{method:"POST",headers:o,body:e.obj}}}},{key:"getUrl",value:function(e){var t=this.sessionSettings&&this.sessionSettings.sliceUrl?this.sessionSettings.sliceUrl:this.url;return e?t+"/sessioninit":this.isConnectedToSession()?t+"/session/"+this.sessionSettings.sessionKey:""}},{key:"getHeader",value:function(e,t){var n,o=new l.Headers;return(null==e?void 0:e.isHttpSessionInitMessage)?(o.set("Content-Type","application/json"),this.origin&&o.set("x-origin",this.origin)):this.isConnectedToSession()&&(e.obj instanceof Uint8Array||e.obj instanceof ArrayBuffer?(o.set("Content-Type","application/jsond2"),t.dimension0=e.obj.byteLength.toString().length.toString()):o.set("Content-Type","application/json"),o.append("Authorization","Bearer ".concat(this.sessionSettings.anonymousToken)),o.set("x-origin",this.sessionSettings.origin)),(null===(n=this.networkOverrideOptions)||void 0===n?void 0:n.hostHeader)&&o.set("host",this.networkOverrideOptions.hostHeader),o}},{key:"setSessionSettings",value:function(e,t,n,o){var r=o.replace("/session","");this.sessionSettings={sessionKey:e,origin:t,anonymousToken:n,sliceUrl:r}}},{key:"isConnectedToSession",value:function(){return this.sessionSettings&&this.sessionSettings.sessionKey.length>0&&this.sessionSettings.anonymousToken.length>0&&this.sessionSettings.origin.length>0&&this.sessionSettings.sliceUrl.length>0&&!this.isClosed}},{key:"formatServerInput",value:function(e){return e.length>1?e.substring(1,e.length-1):""}},{key:"logIngressCount",value:function(e){var t=e.length;if(t>1e5){var n=new c.Operation({operationName:"HttpIngressByteOrderOfMagnitude",success:!0}).start();n.dimension2=t.toString().length.toString(),c.Log.info(508409622,c.LogCategory.CoreDefault,n.stop())}}}])}();n.HttpWorker=f},{105:105,157:157,185:185,204:204,22:22,24:24,30:30,57:57}],168:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createConnectionReliabilityManager=void 0;var o=e(178),r=e(166),i=e(167);n.createConnectionReliabilityManager=function(e,t,n,s,a){return e instanceof i.HttpWorker?new r.HttpReliabilityManager(e,n,s):new o.WebSocketReliabilityManager(e,t,n,a)}},{166:166,167:167,178:178}],169:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],170:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(24)),i=o(e(22));Object.defineProperty(n,"__esModule",{value:!0}),n.SessionStats=void 0;var s=(0,r.default)((function e(){(0,i.default)(this,e)}));n.SessionStats=s},{22:22,24:24,30:30}],171:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24)),s=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.MessageQueue=n.ClientSendMessageErrorReason=void 0;var a,u=e(204),l=e(227),c=s.__importDefault(e(58)),d=e(105),f=e(185);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue",e.DroppedBecauseClientDisconnected="Message is dropped because client is disconnected from server"}(a||(n.ClientSendMessageErrorReason=a={}));var p=function(){return(0,i.default)((function e(t){(0,r.default)(this,e),this.logOp=new d.Operation({operationName:"MessageQueue",success:!0}),this.queue=new c.default(1e3),this.callbacks=t}),[{key:"clear",value:function(){this.queue.clear()}},{key:"size",value:function(){return this.queue.length}},{key:"push",value:function(e,t,n){this.logOp.start();var o=this.queue;if(1e3===o.length){this.logOp.resourceId="QueueFull",this.logOp.success=!1,d.Log.warn(508843746,d.LogCategory.CoreDefault,this.logOp.stop());var r=o.shift();r.onResponse&&r.onResponse(new u.ErrorResponse({error:a.DroppedAsOldestInQueue}))}o.push({message:e,onResponse:t,timeQueued:f.Utils.getCurrentTimeMs(),attemptNumber:n})}},{key:"sendOnSessionInitialized",value:function(e){this.logOp.start();var t=this.queue.length,n=0;if(t>0){for(var o=f.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var r=this.queue.shift();e&&this.containSequencedSyncMessage(r)?(n++,r.onResponse&&r.onResponse(new u.ErrorResponse({error:a.ArrivedBeforeReseeding}))):r.message instanceof Uint8Array?this.callbacks.sendBytes(r.message):this.callbacks.sendMessage(r.message,r.onResponse,r.attemptNumber)}this.logOp.resourceId="SendOnSessionInitialized",this.logOp.resultDescription="Queue size before: ".concat(t,", after: ").concat(this.queue.length,". droppedSyncMessages: ").concat(n),this.logOp.setDataField("OldestMessageInQueueTimeWaitingMs",o),this.logOp.success=!0,d.Log.warn(508843745,d.LogCategory.CoreDefault,this.logOp.stop())}}},{key:"containSequencedSyncMessage",value:function(e){return e.message instanceof u.SyncMessage&&l.SchemaObject.matchesTypesFor(e.message,[u.SyncMessage.getTypeName()])&&e.message.seq>=0||e.message instanceof u.BatchedMessage&&l.SchemaObject.matchesTypesFor(e.message,[u.BatchedMessage.getTypeName()])}}])}();n.MessageQueue=p},{105:105,185:185,204:204,22:22,227:227,24:24,30:30,58:58}],172:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkRateController=void 0;var u=e(105),l=e(204),c=e(200),d=e(168),f=a.__importDefault(e(58)),p=e(180),g=function(){return(0,s.default)((function e(t){var n,o=this;(0,i.default)(this,e),this.emptyMessageId=0,this.egressMessageCount=0,this.egressByteCount=0,this.prevSeq=-1,this.rpsThreshold=150,this.bpsThreshold=5e8,this.isClosing=!1,this.messageQueue=void 0,this.egressRateLogOp=new u.Operation({operationName:"NetworkEgressRate",success:!0}),this.egressedCache=new Map,this.initPromise=new Promise((function(e){o.resolveInitPromise=e})),this.messageQueue=new f.default,this.reducedPingPongRetryEnabled=null!==(n=null==t?void 0:t.reducedPingPongRetryEnabled)&&void 0!==n&&n}),[{key:"init",value:function(e,t,n,o,r){var i=this;this.worker=e,this.ingress=t,this.clientMetadata=o,this.networkMode=n,this.reliabilityManager=(0,d.createConnectionReliabilityManager)(this.worker,this.close.bind(this),void 0,r,this.reducedPingPongRetryEnabled),this.egressRateLogOp.setClientMetadata(this.clientMetadata,!0),this.resetRateLimiter(),this.onCloseController=new Promise((function(e){i.resolveCloseControllerPromise=e})),this.queueProcessingCompletePromise=new Promise((function(e){i.resolveQueueProcessingCompletePromise=e})),this.resolveInitPromise()}},{key:"open",value:function(){var e=this,t=new u.Operation({operationName:"NetworkRateControllerOpen",success:!0,dimension3:"networkMode: ".concat(this.networkMode)}).start();t.setClientMetadata(this.clientMetadata,!0),this.initPromise.then((function(){if(!e.reliabilityManager)return t.success=!1,void(t.resultDescription="Reliability Manager is undefined");e.egressRateControlIntervalStart=Date.now(),e.reliabilityManager.start(),e.processQueue()})).catch((function(e){var n;t.success=!1,t.resultDescription="Catch: "+(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"")})).finally((function(){u.Log.info(507834384,u.LogCategory.CoreDefault,t.stop())}))}},{key:"ingressFromWorker",value:function(e,t){var n=this;this.reliabilityManager?this.reliabilityManager.needsParsedResponses()||!this.reliabilityManager.isReliabilityResponse(e)?this.ingress(e,(function(e){null==t||t(e),n.reliabilityManager.needsParsedResponses()&&n.reliabilityManager.isReliabilityResponse(e)&&n.reliabilityManager.onResponse(e)})):this.reliabilityManager.onResponse():this.ingress(e,t)}},{key:"onRateLimitErrorResponse",value:function(e){var t=new u.Operation({operationName:"NetworkRateControllerOnRateLimitResponse",success:!0}).start();t.setClientMetadata(this.clientMetadata,!0),t.resultSignature="rateLimitAlreadyStarted: ".concat(void 0!==this.rateLimitTimeout),t.setDataField("RetryAfterMs",e.retryAfterMs),t.setDataField("QueueSize",this.messageQueue.length),this.startRateLimiting(e.retryAfterMs),u.Log.info(507388684,u.LogCategory.CoreDefault,t.stop())}},{key:"setRpsBps",value:function(e,t){var n=new u.Operation({operationName:"NetworkRateControllerRateLimitsSet",success:!0}).start();n.setClientMetadata(this.clientMetadata,!0),e&&(this.rpsThreshold=.8*e,n.resultDescription+="maxRPS: ".concat(e,", rpsThreshold: ").concat(this.rpsThreshold,"; ")),t&&(this.bpsThreshold=.8*t,n.resultDescription+="maxRPS: ".concat(t,", rpsThreshold: ").concat(this.bpsThreshold,"; ")),u.Log.info(507388683,u.LogCategory.CoreDefault,n.stop())}},{key:"close",value:function(){var e,t;return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function n(){var o,i;return(0,r.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((o=new u.Operation({operationName:"NetworkRateControllerClose",success:!0,dimension3:"networkMode: ".concat(this.networkMode)}).start()).setClientMetadata(this.clientMetadata,!0),this.isClosing=!0,null===(e=this.resolveCloseControllerPromise)||void 0===e||e.call(this),i=null===(t=this.reliabilityManager)||void 0===t?void 0:t.checkConnection(),o.setDataField("QueueSizeBeforeFlush",this.messageQueue.length),0==this.messageQueue.length||!i){n.next=9;break}return n.next=9,this.queueProcessingCompletePromise;case 9:o.setDataField("QueueSizeAfterFlush",this.messageQueue.length),o.setDataField("IsConnected",i),this.reliabilityManager?this.reliabilityManager.close():o.resultDescription="Reliability Manager is undefined",this.worker=void 0,this.prevSeq=-1,this.clearEgressControlTimeout(),this.reliabilityManager=void 0,u.Log.info(507834381,u.LogCategory.CoreDefault,o.stop());case 17:case"end":return n.stop()}}),n,this)})))}},{key:"clearMessageQueues",value:function(){this.egressedCache.clear(),this.messageQueue=void 0}},{key:"egress",value:function(e){var t,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.reliabilityManager){var r=this.getMessageSize(e);if(r>=3e6)this.logEgressActivity(!1,"Message size exceeded ".concat(3e6),"Message size: ".concat(r));else{if((e.obj instanceof ArrayBuffer||e.isHttpSessionInitMessage)&&this.worker)return this.logEgressActivity(!0,"isArrayBuffer: ".concat(e.obj instanceof ArrayBuffer,", isHttpSessionInitMessage: ").concat(e.isHttpSessionInitMessage),""),void this.worker.egress(e);this.validateSyncMessage(e.messageId,e.seqId);var i=null!==(t=e.messageId)&&void 0!==t?t:"id".concat(this.emptyMessageId++),s={obj:e.obj,seqId:null==e?void 0:e.seqId,messageId:i,isHttpSessionInitMessage:null==e?void 0:e.isHttpSessionInitMessage},a=o>0,l=new u.Operation({operationName:"NetworkRateControllerQueueItem",success:!0,dimension3:"isRetry: ".concat(a)}).start();l.setClientMetadata(this.clientMetadata,!0);var c={message:s,logOp:l};if(a?this.messageQueue.unshift(c):this.messageQueue.push(c),this.messageQueue.length>1e4){var d=this.messageQueue.shift(),f="NetworkRateControllerQueue max size reached. Dropping messageId: ".concat(d.message.messageId);throw d.logOp.resultDescription=f,d.logOp.success=!1,u.Log.info(506001225,u.LogCategory.CoreDefault,d.logOp.stop()),new Error(f)}null===(n=this.resolveQueueNotEmptyPromise)||void 0===n||n.call(this)}}else this.logEgressActivity(!1,"Reliability Manager is undefined","")}},{key:"getMessageSize",value:function(e){return e.obj instanceof ArrayBuffer?e.obj.byteLength:e.obj.length}},{key:"sendToNetworkWorker",value:function(e){var t;try{if(!this.worker)return void this.logEgressActivity(!1,"NetworkWorker is undefined","SendToNetworkWorkerFailure");if(!this.reliabilityManager)return void this.logEgressActivity(!1,"Reliability Manager is undefined","SendToNetworkWorkerFailure");this.worker.egress(e),this.onSendToNetworkWorker(e),null===(t=this.reliabilityManager)||void 0===t||t.postEgress();var n=this.getMessageSize(e);this.logEgressCount(n)}catch(e){this.logEgressActivity(!1,"SendToNetworkWorkerFailure",e?e.message:"")}}},{key:"onSendToNetworkWorker",value:function(e){if("string"==typeof e.obj)try{var t=JSON.parse(e.obj);if(l.SyncMessage.typeGuard(t)){var n=t;(0,p.logTelemetryForSignalSyncMessage)(n,Date.now(),"SendToNetwork",new u.Operation({operationName:"AugloopClientPerfTracker",success:!0}).setClientMetadata(this.clientMetadata).start())}else if(c.GetAnnotationsRequestMessage.typeGuard(t)){var o=t;(0,p.logTelemetryForGetAnnotationsRequest)(o,"GetAnnotationsSendToNetwork",new u.Operation({operationName:"AugloopClientPerfTracker",success:!0}).setClientMetadata(this.clientMetadata).start())}}catch(e){}}},{key:"processQueue",value:function(){var e,t,n;return a.__awaiter(this,void 0,void 0,(0,r.default)().mark((function o(){var i,s,a,l,c,d;return(0,r.default)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(this.reliabilityManager){o.next=6;break}return(i=new u.Operation({operationName:"NetworkRateControllerProcessQueueFailure",success:!1,dimension3:"networkMode: ".concat(this.networkMode)}).start()).setClientMetadata(this.clientMetadata,!0),i.resultDescription="Reliability Manager is undefined",u.Log.info(507573643,u.LogCategory.CoreDefault,i.stop()),o.abrupt("return");case 6:s=new u.Operation({operationName:"NetworkRateControllerProcessQueue",success:!0}).start();case 7:if(0!==this.messageQueue.length){o.next=14;break}if(!this.isClosing){o.next=12;break}return s.setDataField("ExitReason","Stage#1 Closing"),o.abrupt("break",69);case 12:return o.next=14,Promise.race([this.queueNotEmpty(),this.onCloseController]);case 14:if(!this.rateLimitTimeout){o.next=26;break}return(a=new u.Operation({operationName:"NetworkRateControllerRateLimitBackoff",dimension3:"networkMode: ".concat(this.networkMode)}).start()).setClientMetadata(this.clientMetadata,!0),a.setDataField("QueueLengthBeforeBackoff",this.messageQueue.length),o.next=20,Promise.race([this.rateLimitTimeout,this.onCloseController]);case 20:a.setDataField("QueueLengthAfterBackoff",this.messageQueue.length),a.setDataField("IsClosing",this.isClosing),a.success=!0,this.rateLimitTimeout=void 0,this.resetRateLimiter(),u.Log.info(507281410,u.LogCategory.CoreDefault,a.stop());case 26:if(null===(e=this.reliabilityManager)||void 0===e?void 0:e.checkConnection()){o.next=33;break}if(!this.isClosing){o.next=30;break}return s.setDataField("ExitReason","Stage#2 Closing"),o.abrupt("break",69);case 30:return o.next=32,this.checkConnectionPromise();case 32:this.connectionPromise=void 0;case 33:if(this.reliabilityManager){o.next=36;break}return s.setDataField("ExitReason","Stage#2 ReliabilityManager null"),o.abrupt("break",69);case 36:if(!(this.messageQueue.length>0&&this.reliabilityManager.checkConnection())){o.next=65;break}if(!(Date.now()-this.egressRateControlIntervalStart>=1e3)){o.next=42;break}this.resetRateLimiter(),o.next=60;break;case 42:if(!(this.egressMessageCount>=this.rpsThreshold||this.egressByteCount>=this.bpsThreshold)){o.next=60;break}return 1100,l="",this.egressMessageCount>=this.rpsThreshold&&(l+="RPS exceeded."),this.egressByteCount>=this.bpsThreshold&&(l+="BPS exceeded."),"rateLimitHit",(c=new u.Operation({operationName:"NetworkRateControllerEgress",dimension3:"networkMode: ".concat(this.networkMode)}).start()).setClientMetadata(this.clientMetadata,!0),c.success=!0,c.resultDescription="rateLimitHit",c.resultSignature=l,c.dimension0=this.messageQueue.length.toString().length.toString(),c.dimension1="rateLimitHit",c.setDataField("QueueLength",this.messageQueue.length),c.setDataField("RateLimitDelayMs",1100),u.Log.info(507281409,u.LogCategory.CoreDefault,c.stop()),this.startRateLimiting(1100),o.abrupt("break",65);case 60:d=this.messageQueue.shift(),this.sendToNetworkWorker(d.message),u.Log.info(507388682,u.LogCategory.CoreDefault,d.logOp.stop()),o.next=36;break;case 65:this.onQueueNotEmpty=void 0,this.resolveQueueNotEmptyPromise=void 0,o.next=7;break;case 69:null===(t=this.resolveQueueProcessingCompletePromise)||void 0===t||t.call(this),this.resolveQueueProcessingCompletePromise=void 0,s.setClientMetadata(this.clientMetadata,!0),s.setDataField("QueueSize",this.messageQueue.length),s.setDataField("IsConnected",null===(n=this.reliabilityManager)||void 0===n?void 0:n.checkConnection()),s.setDataField("IsClosing",this.isClosing),u.Log.info(507368671,u.LogCategory.CoreDefault,s.stop());case 76:case"end":return o.stop()}}),o,this)})))}},{key:"queueNotEmpty",value:function(){var e=this;return this.onQueueNotEmpty||(this.onQueueNotEmpty=new Promise((function(t){e.resolveQueueNotEmptyPromise=t}))),this.onQueueNotEmpty}},{key:"checkConnectionPromise",value:function(){return this.connectionPromise||(this.connectionPromise=new Promise((function(e){setTimeout(e,1e3)}))),this.connectionPromise}},{key:"startRateLimiting",value:function(e){this.rateLimitTimeout||(this.rateLimitTimeout=new Promise((function(t){setTimeout(t,e)})))}},{key:"resetRateLimiter",value:function(){this.egressRateControlIntervalStart=Date.now(),this.egressMessageCount=0,this.egressByteCount=0}},{key:"clearEgressControlTimeout",value:function(){this.egressRateControlTimer&&(clearInterval(this.egressRateControlTimer),this.egressRateControlTimer=void 0)}},{key:"validateSyncMessage",value:function(e,t){if(!(void 0===t||void 0===e||t<=this.prevSeq)){if(t&&t!==this.prevSeq+1){var n=new u.Operation({operationName:"NetworkRateControllerAbandonedSyncMessage",success:!0,dimension3:"networkMode: ".concat(this.networkMode)}).start();n.setClientMetadata(this.clientMetadata,!0),n.resultDescription="Gap in sync message",n.dimension0="".concat(this.prevSeq),n.dimension1="".concat(t),n.dimension2="".concat(t-this.prevSeq),u.Log.info(507834370,u.LogCategory.CoreDefault,n.stop())}this.prevSeq=t}}},{key:"logEgressActivity",value:function(e,t,n,o){var r,i,s,a,l=new u.Operation({operationName:"NetworkRateControllerEgress",dimension3:"networkMode: ".concat(this.networkMode)}).start();l.setClientMetadata(this.clientMetadata,!0),l.success=e,l.resultDescription=t,l.resultSignature=n,o&&(l.dimension0=null!==(r=o[0])&&void 0!==r?r:"",l.dimension1=null!==(i=o[1])&&void 0!==i?i:"",l.dimension2=null!==(s=o[2])&&void 0!==s?s:"",l.dimension3=null!==(a=o[3])&&void 0!==a?a:""),u.Log.info(507626007,u.LogCategory.CoreDefault,l.stop())}},{key:"logEgressCount",value:function(e){var t=Date.now();t-this.egressRateControlIntervalStart>1e3&&((this.egressMessageCount>50||this.egressByteCount>1e5)&&(this.egressRateLogOp.start(),this.egressRateLogOp.resultDescription=this.egressMessageCount>50?"rps logging threshold exceeded":"",this.egressRateLogOp.resultDescription=this.egressByteCount>1e5?"bps logging threshold exceeded":"",this.egressRateLogOp.dimension0=(t-this.egressRateControlIntervalStart).toString(),this.egressRateLogOp.dimension1="".concat(this.egressMessageCount),this.egressRateLogOp.dimension2="".concat(this.egressByteCount),this.egressRateLogOp.dimension3="networkMode: ".concat(this.networkMode),u.Log.info(508843792,u.LogCategory.CoreDefault,this.egressRateLogOp.stop())),this.egressRateControlIntervalStart=t,this.egressMessageCount=0,this.egressByteCount=0),this.egressMessageCount++,this.egressByteCount+=null!=e?e:0}}])}();n.NetworkRateController=g},{105:105,168:168,180:180,200:200,204:204,22:22,24:24,30:30,45:45,58:58}],173:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(26)),s=o(e(22)),a=o(e(24)),u=o(e(21)),l=o(e(29));Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkSessionManager=void 0;var c=e(105),d=e(204),f=e(227),p=e(59),g=e(185),h=e(171),y=e(176),v=e(174),m=e(200),k=function(e){function t(e,n,o,r,a,l,f,p,m){var k;return(0,s.default)(this,t),(k=(0,u.default)(this,t)).cvParent=new c.CorrelationVector,k.logOp=new c.Operation({operationName:"SessionState",success:!0}).start(),k.sessionStateChangeLogCountLimiter=new g.LogCountLimiter("SessionState"),k.stats=n,k.allStates=(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},y.SessionState.Initing,new y.InitingState(k)),y.SessionState.Running,new y.RunningState(k)),y.SessionState.Disconnected,new y.DisconnectedState(k)),y.SessionState.Closed,new y.ClosedState(k)),k.setState(y.SessionState.Initing),k.messageEndpoint=new d.MessageEndpoint({messageIdPrefix:"c",responseTimeoutMs:3e4,resendPendingMessagesOnReconnect:!1}),k.messageEndpoint.setClientMetadata(a),k.messageEndpoint.setEgress(k.egress.bind(k)),k.messageEndpoint.onMessage(d.SessionCloseMessage.getTypeName(),(function(e,t){k.onSessionCloseMessage(e,t)})),k.networkWorkerManager=new v.NetworkWorkerManager(e,a,o,r,k.ingress.bind(k),k.onConnectionClose.bind(k),k.getCorrelationVector.bind(k),f,m),k.messageQueue=new h.MessageQueue({sendMessage:function(e,t,n,o){return k.state.sendMessage(e,t,n,o)},sendBytes:k.sendBytes.bind(k),canSendMessage:function(){return k.state.canSendMessage()}}),r.on("connect",(function(e,t,n,o,r,i,s,a,u){k.setState(y.SessionState.Running,"",{isSessionReseedingStarted:e&&t}),k.emit("connect",e,n,o,r,i,s,a,u)})),r.on("reconnect",(function(){return k.emit("reconnect")})),r.on("serverAuthenticationStateChange",(function(e){return k.emit("serverAuthenticationStateChange",e)})),k.resetNextSyncSequenceId=function(){return k.emit("resetNextSyncSequenceId")},k.tokenRefreshManager=l,k.gateUtils=p,k}return(0,l.default)(t,e),(0,a.default)(t,[{key:"setState",value:function(e,t,n){var o=this;if(!this.state||e!==this.state.stateName){var r=this.state?y.SessionState[this.state.stateName]:"undefined",i=this.state?this.state.possibleNextStates.indexOf(e)>=0:e===y.SessionState.Initing;this.sessionStateChangeLogCountLimiter.log((function(){o.logOp.stop(),o.logOp.resourceId="New state: ".concat(i?y.SessionState[e]:r),o.logOp.resultDescription="Previous state: ".concat(r),o.logOp.dimension0="Attempted state: ".concat(y.SessionState[e]||"undefined"),o.logOp.resultSignature=t+(o.state&&!i?"Unexpected state change":""),o.logOp.success=i,c.Log.info(508843791,c.LogCategory.CoreDefault,o.logOp)})),i&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(n))}}},{key:"init",value:function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.networkWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)}},{key:"sendMessage",value:function(e,n,o){this.retrySendMessage(e,n,t.maxRetries,o)}},{key:"sendBytes",value:function(e){this.state.sendBytes(e)}},{key:"onMessage",value:function(e,t){this.messageEndpoint.onMessage(e,t)}},{key:"getCorrelationVector",value:function(){return this.cvParent}},{key:"getNetworkWorkerManager",value:function(){return this.networkWorkerManager}},{key:"forceReconnect",value:function(e){var t=this;return this.extensionConfigs=e||this.extensionConfigs,this.networkWorkerManager.close(!1),new Promise((function(e){return setTimeout((function(){e(t.networkWorkerManager.init(t.extensionConfigs))}),100)}))}},{key:"closeSession",value:function(e){this.sendMessage(new d.SessionCloseMessage),this.networkWorkerManager.close(!0);var t=e||new d.SessionCloseReason({reasonDescription:"ClientRequested"});this.onSessionClose(new d.SessionCloseMessage({reconnectAllowed:!1,reason:t}),"ClientRequested")}},{key:"ingress",value:function(e,t){var n,o=this;try{n=JSON.parse(e)}catch(e){c.Log.error(508843790,c.LogCategory.CoreDefault,new c.Operation({operationName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0}))}if(n){if(t&&d.Response.typeGuard(n)&&t(n),this.networkWorkerManager.getNetworkMode()===m.NetworkMode.HttpFallback&&d.SessionLongPollResponse.typeGuard(n)){var i=n;if(i.batch){var s,a=(0,r.default)(i.batch);try{for(a.s();!(s=a.n()).done;){var u=s.value;this.messageEndpoint.ingress(u,(function(e,t){return o.egress(e||t,(function(){}))}))}}catch(e){a.e(e)}finally{a.f()}}return}this.messageEndpoint.ingress(n,(function(e,t){return o.egress(e||t,(function(){}))}))}}},{key:"egress",value:function(e,t,n){e&&this.networkWorkerManager.egress(e,n).then((function(){return t()})).catch((function(e){return t(e)}))}},{key:"onSessionCloseMessage",value:function(e,t){e.reconnectAllowed?this.networkWorkerManager.close():this.onSessionClose(e,"CloseMessageReceived"),t()}},{key:"onSessionClose",value:function(e,t){this.setState(y.SessionState.Closed,t),this.tokenRefreshManager.clearAllTimeouts(),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e)}},{key:"onConnectionClose",value:function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=g.Utils.getCurrentTimeMs(),this.emit("disconnect",e)}},{key:"retrySendMessage",value:function(e,n,o,r,i){var s=this,a=t.maxRetries-o;this.state.sendMessage(e,(function(t,u){var l,p,g,h,y,v;i&&(t&&0==o?(i.dimension0=(a+1).toString(),i.success=!1,c.Log.info(507025311,c.LogCategory.CoreDefault,i.stop())):t&&o>0?(i.dimension0=(a+1).toString(),i.dimension1=null!==(p=null===(l=t.code)||void 0===l?void 0:l.toString())&&void 0!==p?p:"NoErrorCode",i.resultSignature=null!==(g=t.error)&&void 0!==g?g:"NoErrorMessage"):(i.success=!0,c.Log.info(507025310,c.LogCategory.CoreDefault,i.stop()))),t&&o>0&&s.canBeRetried(e)&&s.isTransientError(t)?(i||((i=new c.Operation({operationName:"RetrySendMessage",success:!0,dimension0:(a+1).toString()}).start()).resourceId=f.SchemaObject.getTypeNameFor(e),i.dimension1=null!==(y=null===(h=t.code)||void 0===h?void 0:h.toString())&&void 0!==y?y:"NoErrorCode",i.resultSignature=null!==(v=t.error)&&void 0!==v?v:"NoErrorMessage",i.resultDescription="Retrying message with messageId: ".concat(e.messageId).concat(d.SyncMessage.typeGuard(e)?", seq: ".concat(e.seq):"")),f.SchemaObject.matchesTypesFor(t,[d.RateLimitErrorResponse.getTypeName()])&&s.networkWorkerManager.onRateLimitErrorResponse(t),s.retrySendMessage(e,n,o-1,r,i)):n&&n(t,u)}),a,r)}},{key:"canBeRetried",value:function(e){return!f.SchemaObject.matchesTypesFor(e,[d.SessionInitMessage.getTypeName(),d.MicroSyncMessage.getTypeName(),m.GetAnnotationsRequestMessage.getTypeName()])}},{key:"isTransientError",value:function(e){var t=e.error,n=e.code;return n!==d.ErrorResponseCode.TokenValidationError&&n!==d.ErrorResponseCode.TokenDecryptError&&n!==d.ErrorResponseCode.SyncMessageTooLateOrDuplicate&&n!==d.ErrorResponseCode.Gone&&(t!==d.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==d.SendMessageErrorReason.UnexpectedSeedMessage&&t!==d.SendMessageErrorReason.UnsupportedSyncMessage&&t!==d.SendMessageErrorReason.AnnotationTokenNotFound&&t!==h.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==h.ClientSendMessageErrorReason.DroppedAsOldestInQueue&&t!==h.ClientSendMessageErrorReason.DroppedBecauseClientDisconnected)}}])}(p.EventEmitter);n.NetworkSessionManager=k,k.maxRetries=2},{105:105,171:171,174:174,176:176,185:185,200:200,204:204,21:21,22:22,227:227,24:24,25:25,26:26,29:29,30:30,59:59}],174:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(54)),i=o(e(25)),s=o(e(22)),a=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkWorkerManager=n.calculateTimeToWaitForNextTry=void 0;var u=e(227),l=e(204),c=e(105),d=e(185),f=e(102),p=e(157),g=e(172),h=e(200),y=e(184);n.calculateTimeToWaitForNextTry=function(e,t,n){var o=0,r=d.Utils.getCurrentTimeMs()?d.Utils.getCurrentTimeMs()-t:0,i=[1e3,2e3,5e3,1e4,6e4];return o=i[Math.max(0,Math.min(i.length-1,e-1))],o=Math.max(o-r,1e3),o=n&&n>0?Math.min(5e3,o):o};var v=function(){function e(t,n,o,r,i,a,u,l,f){var g=this;(0,s.default)(this,e),this.logCountLimiter=new d.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.offlineInterval=void 0,this.alreadyLoggedReconnectAttempt=!1,this.httpTestsLeft=5,this.httpTestsSuccessCount=0,this.workerOpenCount=0,this.testHttpConnection=function(e){var t=d.Utils.convertWebSocketUrlToHttp(g.globalUrl),n=!e,o=null!=e?e:new c.Operation({operationName:"HttpsTest",resourceId:(0,y.scrubEuiiInUrl)(t),success:!1,resultDescription:"",resultSignature:"HttpResponse:"}).start(),r={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":o.cv},body:JSON.stringify(d.Utils.createHealthCheckRequest(g.clientMetadata))};(0,p.internalFetch)(t,r,(function(e,t){e?(o.dimension1="HttpErr",o.resultDescription+="HttpErr: ".concat(e.message)):t&&t.ok?(o.dimension1="HttpOK",g.leaveOfflineMode(),g.httpTestsSuccessCount++,n&&(o.success=!0)):(o.dimension1="HttpNoResp",o.resultDescription+="HttpStatus: ".concat(null==t?void 0:t.status)),n&&o.stop(),g.logCountLimiter.log((function(){c.Log.info(508843780,c.LogCategory.CoreDefault,o)}))}))},this.globalUrl=t,this.clientMetadata=n,this.workerFactory=o,this.sessionInitializer=r,this.ingress=i,this.onConnectionClose=a,this.sessionCorrelationVector=u,this.reducedPingPongRetryEnabled=l.reducedPingPongRetryEnabled,this.networkWorkerLogOp=new c.Operation({operationName:"CreateNetworkWorker",success:!0}),this.networkMode=f||h.NetworkMode.JSWebSockets,this.initNetworkMode=this.networkMode}return(0,a.default)(e,[{key:"init",value:function(t,n){var o=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.permanentlyClosed)return Promise.reject(new Error("permanentlyClosed"));if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=t||this.extensionConfigs;var i=function(){if(r||!o.alreadyLoggedReconnectAttempt){var t=r?e.initialAttemptTimeout:e.reconnectAttemptTimeout;o.connTimeout=setTimeout((function(){var e=new c.Operation({operationName:"ConnectionFailingOrSlow",dimension0:r?"Initial":"Reconnect",dimension1:t.toString(),dimension2:o.currentReconnectAttempt.toString()});c.Log.info(508843787,c.LogCategory.CoreDefault,e),o.alreadyLoggedReconnectAttempt=!r,o.connTimeout=void 0}),t)}};return n?this.pendingInitPromise=n().catch((function(e){var t=new c.Operation({operationName:"WorkerManagerCustomInit",success:!1,resultDescription:"".concat(e)});c.Log.error(508843786,c.LogCategory.CoreDefault,t)})).then((function(){i(),o.initInternal()})):(this.pendingInitPromise=Promise.resolve(),i(),this.initInternal()),this.pendingInitPromise}},{key:"egress",value:function(e,t){var n=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){n.egressInternal(e,t)})):(this.egressInternal(e,t),Promise.resolve())}},{key:"egressBytes",value:function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())}},{key:"getNetworkMode",value:function(){return this.networkMode}},{key:"getInitNetworkMode",value:function(){return this.initNetworkMode}},{key:"onRateLimitErrorResponse",value:function(e){this.getNetworkRateController().onRateLimitErrorResponse(e)}},{key:"close",value:function(e){this.isWorkerReady=!1,this.networkRateController&&this.getNetworkRateController().close(),this.worker&&(this.worker.close(),this.worker=null),this.networkRateController=null,this.permanentlyClosed=e||this.permanentlyClosed,this.permanentlyClosed&&(this.leaveOfflineMode(),clearTimeout(this.connTimeout))}},{key:"initInternal",value:function(){var e=this;if(this.isWorkerReady=!1,this.permanentlyClosed||this.isOffline()){var t=new c.Operation({operationName:"WorkerManagerInitOffline",success:!0,resultSignature:this.permanentlyClosed?"PermanentlyClosed":"Offline"});c.Log.info(508843785,c.LogCategory.CoreDefault,t)}else this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),(0,n.calculateTimeToWaitForNextTry)(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs,this.httpTestsSuccessCount)):this.getNetworkMode()===h.NetworkMode.HttpFallback?setTimeout((function(){e.tryToConnectAndInitializeSession()}),100):this.tryToConnectAndInitializeSession()}},{key:"egressInternal",value:function(e,t){var n,o;if(this.isWorkerReady||u.SchemaObject.matchesTypesFor(e,[l.SessionInitMessage.getTypeName()]))if(u.SchemaObject.matchesTypesFor(e,[l.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),n=f.JSOND.serialize(e)):n=JSON.stringify(e),l.SyncMessage.typeGuard(e)&&(o=e.seq),this.bypassRateController(e))this.worker.egress({obj:n});else{var r=l.SessionInitMessage.typeGuard(e)&&this.getNetworkMode()===h.NetworkMode.HttpFallback;this.getNetworkRateController().egress({obj:n,isHttpSessionInitMessage:r,messageId:e.messageId,seqId:o},t)}else u.SchemaObject.matchesTypesFor(e,[l.Response.getTypeName()])||c.Log.error(508843784,c.LogCategory.CoreDefault,new c.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: ".concat(this.isWorkerReady)}))}},{key:"bypassRateController",value:function(e){return l.SessionCloseMessage.typeGuard(e)}},{key:"egressBytesInternal",value:function(e){this.isWorkerReady?this.getNetworkRateController().egress({obj:e}):c.Log.error(508843783,c.LogCategory.CoreDefault,new c.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: ".concat(this.isWorkerReady)}))}},{key:"tryToConnectAndInitializeSession",value:function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=d.Utils.getCurrentTimeMs();!function t(n){if(!e.permanentlyClosed&&!e.isOffline()){var o=e.sliceUrl?e.sliceUrl:e.globalUrl;n.setDataField("connectionUrl",(0,y.scrubEuiiInUrl)(o)),e.connect(o),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(o,r){if(n.success=!o,n.resourceId=r?(0,y.scrubEuiiInUrl)(r.sliceUrl):"",n.dimension2=e.getNetworkModeLogString(),e.getNetworkMode()===h.NetworkMode.HttpFallback?(n.resultDescription=o?"HTTP Error: ".concat(o.error):"",n.dimension0=n.success?"HTTPOK":"HTTPFail"):(n.resultDescription=o?"WS Error: ".concat(o.error):"",n.dimension0=n.success?"WSOK":"WSFail"),o||!e.worker)return e.sliceUrl=void 0,e.close(),e.httpTestsLeft>0?(e.httpTestsLeft--,e.testHttpConnection(n.stop())):(e.getNetworkMode()===h.NetworkMode.JSWebSockets?0===e.workerOpenCount&&e.httpTestsSuccessCount>=5?(n.dimension1="WSBlocked",n.dimension3="HTTP Fallback",e.networkMode=h.NetworkMode.HttpFallback,e.currentReconnectAttempt=0,e.resetHttpTestsCounter()):0===e.httpTestsSuccessCount&&(e.startOfflineMode(),n.dimension1="WSOffline"):0===e.httpTestsSuccessCount&&(e.startOfflineMode(),n.dimension1="HTTPOffline"),e.logCountLimiter.log((function(){c.Log.info(508843782,c.LogCategory.CoreDefault,n.stop())}))),void e.initInternal();if(e.logCountLimiter.log((function(){c.Log.info(508843781,c.LogCategory.CoreDefault,n.stop())})),r.forceReconnect){e.close();var i=new c.Operation({operationName:"ForcedReconnect"}).start();i.resultSignature="globalUrl: ".concat(e.globalUrl,". sliceUrl: ").concat(e.sliceUrl),e.sliceUrl=void 0,setTimeout((function(){t(i)}),1e3)}else clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.getNetworkRateController().setRpsBps(r.maxRPS,r.maxBPS),e.ready();e.resetHttpTestsCounter()}})}}(new c.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #".concat(this.currentReconnectAttempt)}).start())}},{key:"getNetworkRateController",value:function(){return this.networkRateController||(this.networkRateController=new g.NetworkRateController({reducedPingPongRetryEnabled:this.reducedPingPongRetryEnabled})),this.networkRateController}},{key:"connect",value:function(e){var t=this,n=this.getNetworkMode();this.networkWorkerLogOp.start(),this.networkWorkerLogOp.resultDescription=this.getNetworkModeLogString(),this.networkWorkerLogOp.dimension0=n.toString(),this.logCountLimiter.log((function(){return c.Log.info(508372418,c.LogCategory.CoreDefault,t.networkWorkerLogOp.stop())})),this.worker=this.workerFactory(n),this.worker.init(e,this.getNetworkRateController().ingressFromWorker.bind(this.networkRateController),(function(){t.workerOpenCount++,t.getNetworkRateController().open(),t.leaveOfflineMode()}),(function(e){t.close(),t.onConnectionClose(e)}),this.clientMetadata),this.getNetworkRateController().init(this.worker,this.ingress,n,this.clientMetadata,this.sessionCorrelationVector)}},{key:"ready",value:function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0}},{key:"castBinaryData",value:function(e){if(e){if(Array.isArray(e.__binaryMembers__)){var t,n=(0,i.default)(e.__binaryMembers__);try{for(n.s();!(t=n.n()).done;){var o=t.value;ArrayBuffer.isView(e[o])||(e[o]=new Uint8Array(e[o]))}}catch(e){n.e(e)}finally{n.f()}}for(var s=0,a=Object.keys(e);s<a.length;s++){var u=a[s];"object"===(0,r.default)(e[u])&&null!==e[u]&&this.castBinaryData(e[u])}}}},{key:"isOffline",value:function(){return!!this.offlineInterval}},{key:"startOfflineMode",value:function(){var e=this;this.offlineInterval=setInterval((function(){e.testHttpConnection()}),6e4)}},{key:"leaveOfflineMode",value:function(){this.isOffline()&&(clearInterval(this.offlineInterval),this.offlineInterval=void 0,this.resetHttpTestsCounter(),this.tryToConnectAndInitializeSession())}},{key:"resetHttpTestsCounter",value:function(){this.httpTestsLeft=5,this.httpTestsSuccessCount=0}},{key:"getNetworkModeLogString",value:function(){return"NetworkMode: "+(this.getNetworkMode()===h.NetworkMode.JSWebSockets?"WebSocket":"HTTP")}}])}();n.NetworkWorkerManager=v,v.initialAttemptTimeout=1e5,v.reconnectAttemptTimeout=2e4,v.className="NetworkWorkerManager"},{102:102,105:105,157:157,172:172,184:184,185:185,200:200,204:204,22:22,227:227,24:24,25:25,30:30,54:54}],175:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=o(e(21)),u=o(e(29)),l=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.SessionInitializer=void 0;var c=e(105),d=e(204),f=e(86),p=e(185),g=e(190),h=e(177),y=e(59),v=e(184),m=function(e){function t(e,n,o,r,s){var u;if((0,i.default)(this,t),(u=(0,a.default)(this,t)).getSessionStats=e,u.clientMetadata=n,u.tokenRefreshManager=o,u.sendMessage=r,u.options=s||{},u.options.overrideSessionInitMessage=u.options.overrideSessionInitMessage||function(e){return e},u.clientMetadata&&!u.clientMetadata.userSystemTimezone)try{u.clientMetadata.userSystemTimezone=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}return u}return(0,u.default)(t,e),(0,s.default)(t,[{key:"initSession",value:function(e){var t=this;e.onResponse=e.onResponse||function(){};var n=p.Utils.getCurrentTimeMs(),o=this.getSessionStats().lastConnectionClose&&n-this.getSessionStats().lastConnectionClose,r=this.getSessionStats().lastSyncMessage&&n-this.getSessionStats().lastSyncMessage,i=new c.Operation({operationName:"SessionInit"}).start(),s={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:o,timeSinceLastSyncMessage:r,isTokenRefresh:e.isTokenRefresh,enableRemoteExecutionNotification:this.options.enableRemoteExecutionNotification,error:void 0,isSeedingRequired:void 0,enableCreateBlobStorageContainer:this.options.createBlobStorageContainerEnabled},a=void 0;a=this.options.createCopyOfClientMetadataInSessionInit?Object.assign({},this.clientMetadata):this.clientMetadata;var u=this.options.overrideSessionInitMessage(new d.SessionInitMessage({protocolVersion:d.currentProtocolVersion,clientMetadata:a,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs,returnWorkflowInputTypes:!0,enableRemoteExecutionNotification:this.options.enableRemoteExecutionNotification,createBlobStorageContainer:this.options.createBlobStorageContainerEnabled}));this.sendMessage(u,(function(n,o){if(i.success=!n,i.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",i.resourceId=(0,v.scrubEuiiInUrl)(null==o?void 0:o.sliceUrl),i.setClientMetadata(t.clientMetadata),(null==o?void 0:o.sessionKey)&&s.sessionKey!==o.sessionKey&&(s.sessionKey=o.sessionKey),n&&(s.error=n.error),s.isSeedingRequired=t.sessionKey!==(null==o?void 0:o.sessionKey),i.resultDescription=JSON.stringify(s),c.Log.info(508843779,c.LogCategory.CoreDefault,i.stop()),e.onResponse(n,o),n)t.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.NotAuthenticated);else if(e.isReconnectOnSameSlice&&o.forceReconnect)t.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.NotAuthenticated);else{if(!o.anonymousToken||!o.tokenExpirationSeconds)return t.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.NotAuthenticated),void c.Log.error(508843778,c.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session");t.anonymousToken=o.anonymousToken,t.onSuccessfulSessionInitOnServerSide(o)}}))}},{key:"onSuccessfulSessionInitOnServerSide",value:function(e){var t,n,o=this;this.tokenRefreshManager.scheduleRefresh(h.TokenType.Anonymous,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0}),(function(){o.anonymousToken=void 0})),this.connectParams={isSeedingRequired:this.sessionKey!==e.sessionKey,sessionUrl:"".concat(e.sessionUrlBase,"/").concat(e.sessionKey),origin:e.origin,authToken:this.anonymousToken},(null===(t=this.options)||void 0===t?void 0:t.dontSendTokenOnReconnectChangeGate)&&e.existingTokenProvisionResponse&&(null===(n=e.existingTokenProvisionResponse)||void 0===n?void 0:n.tokenType)===f.AuthTokenType.AugLoopLowPrivilege||(this.options.sendTokenFailureMessageChangeGate?this.initHostAuthTokenNew().catch((function(){})):this.initHostAuthToken());var r=!!this.sessionKey;this.sessionKey=e.sessionKey,this.origin=e.origin,this.emit("connect",this.connectParams.isSeedingRequired,r,this.connectParams.sessionUrl,this.connectParams.origin,this.connectParams.authToken,e.workflowInputTypes,e.downstreamRuntimeWorkflows,e.routingSessionKey,e.blobFileId),r&&this.emit("reconnect")}},{key:"getAuthToken",value:function(){var e={Tickets:[],DocSessionId:this.clientMetadata.docSessionId,TokenType:g.AuthTokenType.Augloop,ConnectParams:this.connectParams};return this.options.requestAuthToken(e).then((function(e){return e})).catch((function(){}))}},{key:"getAuthTokenNew",value:function(){var e={Tickets:[],DocSessionId:this.clientMetadata.docSessionId,TokenType:g.AuthTokenType.Augloop,ConnectParams:this.connectParams};return this.options.requestAuthToken(e).then((function(e){return e}))}},{key:"getAuthTokenTimeoutPromise",value:function(){var e=this.options.authTokenTimeoutMs;return new Promise((function(t,n){setTimeout((function(){n(new Error("Host auth token provision took longer than ".concat(e," ms")))}),e)}))}},{key:"initHostAuthToken",value:function(){var e=this,t=this.getAuthToken.bind(this);if(this.options.requestAuthToken&&t){var n=new c.Operation({operationName:"RefreshAuthToken",success:!0}).setClientMetadata(this.clientMetadata).start();t().then((function(t){if(t){if(!t.Token)return t.TokenError==g.AuthTokenResponseError.TokenMissingInteractionRequired?(e.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.TokenMissingInteractionRequired),n.resultDescription="Host auth token provision failed interaction required"):(e.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.NotAuthenticated),n.resultDescription="Host auth token provision failed"),n.success=!1,void c.Log.info(508843777,c.LogCategory.CoreDefault,n.stop());c.Log.info(508843776,c.LogCategory.CoreDefault,n.stop()),e.sendTokenProvisionMessage(t.Token)}else n.resultDescription="TokenResponse is not set"})).catch((function(t){e.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.NotAuthenticated),n.success=!1,n.resultDescription="Error happened while attempting to fetch host token: ".concat(t),c.Log.error(508843747,c.LogCategory.CoreDefault,n.stop())}))}}},{key:"initHostAuthTokenNew",value:function(){return l.__awaiter(this,void 0,void 0,(0,r.default)().mark((function e(){var n,o,i,s,a;return(0,r.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getAuthTokenNew.bind(this),!this.options.requestAuthToken||!n){e.next=32;break}if(o=new c.Operation({operationName:"RefreshAuthToken",success:!0}).setClientMetadata(this.clientMetadata).start(),a=d.ServerAuthenticationState.NotAuthenticated,e.prev=4,!(this.options.authTokenTimeoutMs>0)){e.next=11;break}return e.next=8,Promise.race([n(),this.getAuthTokenTimeoutPromise()]);case 8:i=e.sent,e.next=14;break;case 11:return e.next=13,n();case 13:i=e.sent;case 14:if(i){e.next=16;break}throw new Error("TokenResponse is not set");case 16:if(i.Token){e.next=23;break}if(i.TokenError!=g.AuthTokenResponseError.TokenMissingInteractionRequired){e.next=22;break}throw a=d.ServerAuthenticationState.TokenMissingInteractionRequired,new Error("Host auth token provision failed interaction required");case 22:throw new Error("Host auth token provision failed");case 23:e.next=31;break;case 25:e.prev=25,e.t0=e.catch(4),s=e.t0.message,this.emit("serverAuthenticationStateChange",a),o.success=!1,o.resultDescription="Error happened while attempting to fetch host token: ".concat(e.t0);case 31:try{s?this.sendMessage(new d.TokenFailureMessage({reason:s,version:t.initialTokenVersion,clientHandlesResponse:!0})):this.sendTokenProvisionMessage(i.Token)}catch(e){s||(s=e.message,this.emit("serverAuthenticationStateChange",a),o.success=!1,o.resultDescription="Error happened while attempting to send host token: ".concat(e))}finally{s?c.Log.error(506074845,c.LogCategory.CoreDefault,o.stop()):c.Log.info(506074846,c.LogCategory.CoreDefault,o.stop())}case 32:case"end":return e.stop()}}),e,this,[[4,25]])})))}},{key:"sendTokenProvisionMessage",value:function(e){var n=new d.TokenProvisionMessage({authToken:e,version:t.initialTokenVersion});this.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.Pending),this.sendMessage(n,this.onTokenProvisionResponse.bind(this),!0)}},{key:"onTokenProvisionResponse",value:function(e,t){!e&&t&&t.tokenExpirationSeconds?(this.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.Authenticated),this.tokenRefreshManager.scheduleRefresh(h.TokenType.Host,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))):this.emit("serverAuthenticationStateChange",d.ServerAuthenticationState.NotAuthenticated)}}])}(y.EventEmitter);n.SessionInitializer=m,m.initialTokenVersion=1},{105:105,177:177,184:184,185:185,190:190,204:204,21:21,22:22,24:24,29:29,30:30,45:45,59:59,86:86}],176:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(21)),i=o(e(29)),s=o(e(22)),a=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ClosedState=n.DisconnectedState=n.RunningState=n.InitingState=n.BaseState=n.queueBytes=n.queueMessage=n.sendMessageNow=n.SessionState=void 0;var u,l=e(204),c=e(105),d=e(227),f=e(171);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(u||(n.SessionState=u={}));n.sendMessageNow=function(e,t,n,o){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,o){t||d.SchemaObject.getTypeNameFor(o)!==l.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),n&&n(t,o)}),void 0,o))};n.queueMessage=function(e,t,n,o){t&&(e.messageQueue.push(t,n,o),e.networkWorkerManager.init(void 0,e.customInitPromise).catch((function(e){var t=new c.Operation({operationName:"WorkerManagerInit",success:!1,resultDescription:"".concat(e)});c.Log.error(508843789,c.LogCategory.CoreDefault,t)})))};n.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.networkWorkerManager.init(void 0,e.customInitPromise).catch((function(e){c.Log.error(508843788,c.LogCategory.CoreDefault,"Init failed: ".concat(e))})))};var p=function(){return(0,a.default)((function e(t){(0,s.default)(this,e),this.context=t}),[{key:"onEnter",value:function(e){}},{key:"sendMessage",value:function(e,t,n,o){}},{key:"sendBytes",value:function(e){}},{key:"canSendMessage",value:function(){return!1}},{key:"onConnectionClose",value:function(){}}])}();n.BaseState=p;var g=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,r.default)(this,t,arguments)).stateName=u.Initing,e.possibleNextStates=[u.Running,u.Disconnected,u.Closed],e}return(0,i.default)(t,e),(0,a.default)(t,[{key:"sendMessage",value:function(e,t,o){d.SchemaObject.matchesTypesFor(e,[l.SessionInitMessage.getTypeName()])?(0,n.sendMessageNow)(this.context,e,t,o):(0,n.queueMessage)(this.context,e,t)}},{key:"sendBytes",value:function(e){(0,n.queueBytes)(this.context,e)}},{key:"onConnectionClose",value:function(){this.context.setState(u.Disconnected)}}])}(p);n.InitingState=g;var h=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,r.default)(this,t,arguments)).stateName=u.Running,e.possibleNextStates=[u.Disconnected,u.Closed],e}return(0,i.default)(t,e),(0,a.default)(t,[{key:"onEnter",value:function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)}},{key:"sendMessage",value:function(e,t,o,r){(0,n.sendMessageNow)(this.context,e,t,o)}},{key:"sendBytes",value:function(e){e&&this.context.networkWorkerManager.egressBytes(e)}},{key:"canSendMessage",value:function(){return!0}},{key:"onConnectionClose",value:function(){this.context.setState(u.Disconnected)}}])}(p);n.RunningState=h;var y=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,r.default)(this,t,arguments)).stateName=u.Disconnected,e.possibleNextStates=[u.Initing,u.Closed],e}return(0,i.default)(t,e),(0,a.default)(t,[{key:"onEnter",value:function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks(l.SendMessageErrorReason.ClientDisconnected)}},{key:"sendMessage",value:function(e,t,o,r){if(d.SchemaObject.matchesTypesFor(e,[l.SessionInitMessage.getTypeName()]))this.context.setState(u.Initing),(0,n.sendMessageNow)(this.context,e,t,o);else if(d.SchemaObject.matchesTypesFor(e,[l.SessionCloseMessage.getTypeName()]))this.context.setState(u.Closed);else{if(!r)return void(0,n.queueMessage)(this.context,e,t,o);t&&t(new l.ErrorResponse({messageId:e.messageId,error:f.ClientSendMessageErrorReason.DroppedBecauseClientDisconnected}))}}},{key:"sendBytes",value:function(e){(0,n.queueBytes)(this.context,e)}}])}(p);n.DisconnectedState=y;var v=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,r.default)(this,t,arguments)).stateName=u.Closed,e.possibleNextStates=[],e}return(0,i.default)(t,e),(0,a.default)(t,[{key:"onEnter",value:function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks(l.SendMessageErrorReason.ClientClosed)}}])}(p);n.ClosedState=v},{105:105,171:171,204:204,21:21,22:22,227:227,24:24,29:29,30:30}],177:[function(e,t,n){"use strict";var o,r=e(30).default,i=r(e(22)),s=r(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRefreshManager=n.TokenType=void 0,function(e){e[e.Anonymous=0]="Anonymous",e[e.Host=1]="Host"}(o||(n.TokenType=o={}));var a=function(){function e(){(0,i.default)(this,e),this.timers=new Map}return(0,s.default)(e,[{key:"scheduleRefresh",value:function(t,n,o,r){var i=this.timers.get(t);i||(i={numberOfAttempts:0},this.timers.set(t,i)),i.refreshTimeoutId&&(clearTimeout(i.refreshTimeoutId),i.refreshTimeoutId=void 0),i.expiredTimeoutId&&(clearTimeout(i.expiredTimeoutId),i.expiredTimeoutId=void 0);var s=1e3*n-e.tokenRefreshBufferMs,a=1e3*n-e.tokenExpirationBufferMs;s>0?i.numberOfAttempts=0:(++i.numberOfAttempts,s=e.tokenRefreshBackoffIntervalMs,a=e.tokenExpirationBufferMs),i.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(i.refreshTimeoutId=setTimeout((function(){o()}),s)),r&&(i.expiredTimeoutId=setTimeout((function(){r()}),a))}},{key:"clearRefreshTimeouts",value:function(){this.clearTimeouts(!1)}},{key:"clearAllTimeouts",value:function(){this.clearTimeouts(!0)}},{key:"clearTimeouts",value:function(e){var t=this;this.timers.forEach((function(n,o){n.refreshTimeoutId&&(clearTimeout(n.refreshTimeoutId),n.refreshTimeoutId=void 0),e&&n.expiredTimeoutId&&(clearTimeout(n.expiredTimeoutId),n.expiredTimeoutId=void 0),n.expiredTimeoutId||t.timers.delete(o)}))}}])}();n.TokenRefreshManager=a,a.tokenRefreshBufferMs=24e4,a.tokenExpirationBufferMs=12e4,a.tokenRefreshBackoffIntervalMs=3e4,a.tokenRefreshMaximumAttempts=3},{22:22,24:24,30:30}],178:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketReliabilityManager=void 0;var s=e(105),a=function(){function e(t,n,o,i){(0,r.default)(this,e),this.lastPingTime=0,this.lastPongTime=0,this.lastEgressTime=0,this.remainingPingFailures=3,this.isPingPongSuccessful=!1,this.reducedPingPongRetryEnabled=i,this.pingPongLogOp=new s.Operation({operationName:"WebSocketReliabilityManager",success:!0,resourceId:this.reducedPingPongRetryEnabled?"reducedPingPongRetryEnabled":""}).start(),this.pingPongLogOp.setClientMetadata(o,!0),this.worker=t,this.rateControllerClose=n}return(0,i.default)(e,[{key:"start",value:function(){this.reducedPingPongRetryEnabled?(this.pingPongLogOp.start(),this.pingPongLogOp.resultSignature="initial ping"):this.logOperation(!0,"ping","initial ping"),this.ping(),this.isPingPongSuccessful=!0,this.startInterval()}},{key:"onResponse",value:function(){this.lastPongTime=Date.now(),this.reducedPingPongRetryEnabled&&(this.pingPongLogOp.success=!0,s.Log.info(506795283,s.LogCategory.CoreDefault,this.pingPongLogOp.stop()))}},{key:"isReliabilityResponse",value:function(t){return"string"==typeof t&&1===t.length&&t===e.pingPongMessage}},{key:"close",value:function(){this.reducedPingPongRetryEnabled?(this.pingPongLogOp.start(),this.pingPongLogOp.success=!0,this.pingPongLogOp.resultSignature="close",s.Log.info(506795282,s.LogCategory.CoreDefault,this.pingPongLogOp.stop())):this.logOperation(!0,"ping","close"),this.lastPingTime=0,this.lastPongTime=0,this.isPingPongSuccessful=!1,this.clearPingInterval(),this.worker=void 0}},{key:"checkConnection",value:function(){return this.isPingPongSuccessful}},{key:"postEgress",value:function(){this.lastEgressTime=Date.now()}},{key:"needsParsedResponses",value:function(){return!1}},{key:"ping",value:function(){this.reducedPingPongRetryEnabled?this.worker||(this.pingPongLogOp.success=!1,this.pingPongLogOp.resultDescription="websocket worker undefined",this.rateControllerClose(),s.Log.info(506795281,s.LogCategory.CoreDefault,this.pingPongLogOp.stop())):this.lastPingTime=Date.now(),this.worker&&(this.reducedPingPongRetryEnabled&&(this.lastPingTime=Date.now()),this.worker.egress({obj:e.pingPongMessage}))}},{key:"startInterval",value:function(){var e=this;this.pingInterval=setInterval((function(){if(e.reducedPingPongRetryEnabled){if(e.lastPongTime<e.lastPingTime&&Date.now()-e.lastPingTime<3e4)return;e.isPingPongSuccessful=e.lastPongTime>=e.lastPingTime,e.pingPongLogOp.start(),e.isPingPongSuccessful?(e.pingPongLogOp.resultSignature="ping",e.ping()):(e.pingPongLogOp.success=!1,e.pingPongLogOp.resultDescription="Pong not received",s.Log.info(506795280,s.LogCategory.CoreDefault,e.pingPongLogOp.stop()),e.worker?e.worker.close():e.rateControllerClose())}else{if(e.isPingPongSuccessful=e.lastPongTime>=e.lastPingTime&&e.lastPongTime-e.lastPingTime<=3e4,e.lastPongTime>e.lastEgressTime)return;var t=e.lastPongTime-e.lastPingTime;e.isPingPongSuccessful?(e.remainingPingFailures=3,e.ping()):e.remainingPingFailures>0?(--e.remainingPingFailures,e.ping()):(e.logOperation(!1,"ping","Pong still not received after all retry attempts",["".concat(t),"".concat(e.remainingPingFailures)]),e.worker?e.worker.close():e.rateControllerClose())}}),3e4)}},{key:"clearPingInterval",value:function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0)}},{key:"logOperation",value:function(e,t,n,o){var r,i,a,u;this.pingPongLogOp.start(),this.pingPongLogOp.success=e,this.pingPongLogOp.resultSignature=t,this.pingPongLogOp.resultDescription=n,o&&(this.pingPongLogOp.dimension0=null!==(r=o[0])&&void 0!==r?r:"",this.pingPongLogOp.dimension1=null!==(i=o[1])&&void 0!==i?i:"",this.pingPongLogOp.dimension2=null!==(a=o[2])&&void 0!==a?a:"",this.pingPongLogOp.dimension3=null!==(u=o[3])&&void 0!==u?u:""),s.Log.info(507320073,s.LogCategory.CoreDefault,this.pingPongLogOp.stop())}}])}();n.WebSocketReliabilityManager=a,a.pingPongMessage="~"},{105:105,22:22,24:24,30:30}],179:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24)),s=o(e(54)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorker=n.largeMessageThreshold=void 0;var u=a.__importDefault(e(64)),l=e(105),c="object"===("undefined"==typeof process?"undefined":(0,s.default)(process))&&"object"===(0,s.default)(process.versions)&&void 0!==process.versions.node;n.largeMessageThreshold=1e5;var d=function(){function e(t,n){(0,r.default)(this,e),this.networkOverrideOptions=t,this.settings=n,this.hadEgressError=!1,this.isClosing=!1,this.pendingEgress=[]}return(0,i.default)(e,[{key:"egressByteCountOp",get:function(){return this._egressByteCountOp||(this._egressByteCountOp=new l.Operation({operationName:"WSEgressByteOrderOfMagnitude",success:!0}),this._egressByteCountOp.setClientMetadata(this.clientMetadata,!0)),this._egressByteCountOp}},{key:"init",value:function(t,n,o,r,i){var s,a,d=this;if(this.clientMetadata=i,c&&this.networkOverrideOptions){var f={servername:null===(s=this.networkOverrideOptions)||void 0===s?void 0:s.hostHeader,headers:(null===(a=this.networkOverrideOptions)||void 0===a?void 0:a.hostHeader)?{host:this.networkOverrideOptions.hostHeader}:void 0};this.ws=new u.default(t,f)}else this.ws=new u.default(t);this.logOp=new l.Operation({operationName:e.className,success:!0}).start(),this.logOp.setClientMetadata(i,!0),this.ingressByteCountOp=new l.Operation({operationName:"WSIngressByteOrderOfMagnitude",success:!0}),this.ingressByteCountOp.setClientMetadata(i,!0),this.ws.addEventListener("open",(function(e){o(),d.logOp.resourceId="OnOpen",d.logOp.resultDescription="",d.logOp.success=!0,d.logOp.dimension0=d.pendingEgress.length.toString(),l.Log.info(508843801,l.LogCategory.CoreDefault,d.logOp.stop())})),this.ws.addEventListener("message",(function(e){d.logIngressCount(e.data),n(e.data)})),this.ws.addEventListener("error",(function(e){d.errorMessage=e.message,d.logOp.resourceId="OnError",d.logOp.resultDescription=d.errorMessage,d.logOp.success=!1,l.Log.info(508843800,l.LogCategory.CoreDefault,d.logOp.stop()),d.ws?d.ws.close():d.logWsUndefinedError("error event handler")})),this.ws.addEventListener("close",(function(e){d.logOp.resourceId="OnClose",d.logOp.resultDescription=e?"code: ".concat(e.code,". reason: ").concat(e.reason):"",d.logOp.success=!0,l.Log.info(508843799,l.LogCategory.CoreDefault,d.logOp.stop()),r(d.errorMessage),d.isClosing=!1}))}},{key:"egress",value:function(e){var t,n=this,o=e.obj;(null===(t=this.settings)||void 0===t?void 0:t.webSocketWorkerShouldLogEgressCount)&&this.logEgressCount(o),this.ws.send(o,(function(e){e&&!n.hadEgressError&&(n.hadEgressError=!0,n.logOp.resourceId="OnEgressError",n.logOp.resultDescription=e.message,n.logOp.success=!1,l.Log.info(508843797,l.LogCategory.CoreDefault,n.logOp.stop()))}))}},{key:"close",value:function(){this.isClosing||(this.isClosing=!0,this.ws?this.ws.close():this.logWsUndefinedError("close"))}},{key:"logIngressCount",value:function(e){var t=e.length;t>n.largeMessageThreshold&&(this.ingressByteCountOp.start(),this.ingressByteCountOp.dimension2=t.toString().length.toString(),l.Log.info(508843794,l.LogCategory.CoreDefault,this.ingressByteCountOp.stop()))}},{key:"logEgressCount",value:function(e){var t="string"==typeof e?e.length:e.byteLength;t>n.largeMessageThreshold&&(this.egressByteCountOp.start(),this.egressByteCountOp.dimension2=t.toString().length.toString(),l.Log.info(505710625,l.LogCategory.CoreDefault,this.egressByteCountOp.stop()))}},{key:"logWsUndefinedError",value:function(t){var n=new l.Operation({operationName:e.className,success:!1}).start();n.setClientMetadata(this.clientMetadata,!0),n.resourceId="webSocketUndefined",n.resultDescription=t+": this.ws null or undefined",l.Log.info(506566722,l.LogCategory.CoreDefault,n.stop())}}])}();n.WebSocketWorker=d,d.className="WebSocketWorker"},{105:105,22:22,24:24,30:30,54:54,64:64}],180:[function(e,t,n){"use strict";var o=(0,e(30).default)(e(25));Object.defineProperty(n,"__esModule",{value:!0}),n.logTelemetryForAnnotation=n.logTelemetryForSignalSyncMessage=n.logTelemetryForSignalOperations=n.logTelemetryForGetAnnotationsRequest=n.checkFirstUserPerceivedResponse=void 0;var r=e(204),i=e(227),s=e(105),a=e(200);n.checkFirstUserPerceivedResponse=function(e){var t,n;if(r.AnnotationResultsMessage.typeGuard(e)){var s,u=e.ops.filter((function(e){return i.SchemaObject.matchesTypesFor(e,["AugLoop_Core_AddOperation"])})),l=(0,o.default)(u);try{for(l.s();!(s=l.n()).done;){var c,d=s.value,f=(0,o.default)(d.items);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(p.body&&(null===(t=p.body)||void 0===t?void 0:t.isFirstUserPerceivedResponse))return!0}}catch(e){f.e(e)}finally{f.f()}}}catch(e){l.e(e)}finally{l.f()}}else if(a.GetAnnotationsResponseMessage.typeGuard(e))return null===(n=e.content)||void 0===n?void 0:n.some((function(e){var t;return null===(t=e.body)||void 0===t?void 0:t.isFirstUserPerceivedResponse}));return!1};n.logTelemetryForGetAnnotationsRequest=function(e,t,n){var o,r,i,a;n.resultSignature=t,n.resourceId="".concat(null===(o=e.sourceInfo)||void 0===o?void 0:o.featureId,"-").concat(null===(r=e.sourceInfo)||void 0===r?void 0:r.entryPoint),n.cv=e.cv,n.setDataFields({AnnotationTypes:null===(i=e.annotationTypes)||void 0===i?void 0:i.toString(),MaxDelayMs:null===(a=e.maxDelayMs)||void 0===a?void 0:a.toString()}),s.Log.info(505455200,s.LogCategory.CoreDefault,n.stop())};n.logTelemetryForSignalOperations=function(e,t,n,r,a){var u=function(e){var t,n=e.filter((function(e){return i.SchemaObject.matchesTypesFor(e,["AugLoop_Signals_SignalOperation"])})),r=(0,o.default)(n);try{for(r.s();!(t=r.n()).done;){var s,a=t.value,u=(0,o.default)(a.items);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(l.body&&i.SchemaObject.matchesTypesFor(l.body,["AugLoop_CopilotChatHistory_CopilotChatHistorySignal","AugLoop_Copilot_CopilotInputSignal"]))return l}}catch(e){u.e(e)}finally{u.f()}}}catch(e){r.e(e)}finally{r.f()}}(e);u&&(a.setDataField("CurrentTimestamp",n),a.cv=t||"",a.resultSignature=r,a.resourceId=i.SchemaObject.getTypeNameFor(u.body),u.contextId&&a.setDataField("ContextId",u.contextId),u.sourceTimestamp&&a.setDataField("SourceTimestamp",u.sourceTimestamp),s.Log.info(505983429,s.LogCategory.CoreDefault,a.stop()))};n.logTelemetryForSignalSyncMessage=function(e,t,o,r){(0,n.logTelemetryForSignalOperations)(e.ops,e.cv,t,o,r)};n.logTelemetryForAnnotation=function(e,t,o,r,i){r&&!(0,n.checkFirstUserPerceivedResponse)(e)||(i.setDataField("CurrentTimestamp",t),i.cv=e.cv,i.resultSignature=o,i.resourceId=e.annotationType,i.dimension1="AreApologies: ".concat(e.areApologies),s.Log.info(505983428,s.LogCategory.CoreDefault,i.stop()))}},{105:105,200:200,204:204,227:227,25:25,30:30}],181:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(45)),i=o(e(22)),s=o(e(24)),a=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.createRuntime=n.runtime=n.ClientRuntime=n.getSupportedClientFeaturesFlightsString=n.getVersion=n.logExpiredTimeoutTasksInBatchManager=n.fixIncorrectInvocationOfClaimsCallbackString=n.dontSendNewTokenOnReconnectString=void 0;var u=e(86),l=e(105),c=e(114),d=e(200),f=e(245),p=e(250),g=e(139),h=e(158),y=e(163),v=e(165),m=e(167),k=e(170),T=e(173),S=e(175),b=e(177),C=e(179),w=e(183),_=e(184),M=e(185);n.dontSendNewTokenOnReconnectString="DontSendNewTokenOnReconnect";n.fixIncorrectInvocationOfClaimsCallbackString="FixIncorrectInvocationOfClaimsCallbacks",n.logExpiredTimeoutTasksInBatchManager="LogExpiredTimeoutTasksInBatchManager";n.getVersion=function(){return e(186).version};n.getSupportedClientFeaturesFlightsString=function(){return[c.acceptsClaimsChallengeMessages,c.acceptsSeedingStatusChangeMessages].join(";")};var A=function(){function e(t,o,r,s){var a=this;(0,i.default)(this,e),this.sessionsByDocSessionId=new Map,this.isDeltaGeneratorEnabled=!1,this.disableSyncDeltaSending=!1,this.hasBeenInitialized=!1,this.telemetryLogger=null,this.changeGateList=new Map([["SkipCheckingCachedClaimsChallenge",!0],["CloseSessionsOnRuntimeUninit",!0],["ShouldAppendClientFeatureFlights",!0],[n.dontSendNewTokenOnReconnectString,!0],["WebSocketWorkerShouldLogEgressCount",!0],[n.fixIncorrectInvocationOfClaimsCallbackString,!0],[n.logExpiredTimeoutTasksInBatchManager,!0]]),this.settings={annotationsOrderingEnabled:!0,deltaOperationsEnabled:!1,defaultBatchingEnabled:!0,batchingWith20msIntervalEnabled:!0,onAnnotationsSubmittedEnabled:!1,reduceBatchOperationsEnabled:!1,batchMessagesEnabled:!1,removeDuplicateFlights:!0,annotationDoesNotExistOnService:!0,reducedPingPongRetryEnabled:!1,maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled:!1,sendTokenFailureMessage:!0,closeSessionsOnRuntimeUninit:!1,shouldAppendClientFeatureFlights:!0,authTokenTimeoutMs:0,doNotSendNewTokenOnReconnect:!1,webSocketWorkerShouldLogEgressCount:!0,createBlobStorageContainerEnabled:!1,createCopyOfClientMetadataInSessionInit:!0,doNotAddCustomLogger:!1},this.settingToChangeGateName={closeSessionsOnRuntimeUninit:"CloseSessionsOnRuntimeUninit",shouldAppendClientFeatureFlights:"ShouldAppendClientFeatureFlights",doNotSendNewTokenOnReconnect:n.dontSendNewTokenOnReconnectString,webSocketWorkerShouldLogEgressCount:"WebSocketWorkerShouldLogEgressCount"},this.isDownloaderCompatible=function(){return"undefined"!=typeof Array&&void 0!==Array.from&&"undefined"!=typeof URL&&void 0!==URL.createObjectURL},s&&(this.settings=s),this.workerFactory=t||function(e){return e&&e===d.NetworkMode.HttpFallback?new m.HttpWorker:new C.WebSocketWorker(void 0,a.settings)};var u=this.createDefaultSessionManagerFactory();this.sessionManagerFactory=function(){return(null==o?void 0:o.apply(void 0,arguments))||u.apply(void 0,arguments)},this.sessionFactory=r||function(e){return new w.SessionProxy(e)}}return(0,s.default)(e,[{key:"init",value:function(t,o,i,s){var c,f,m,k,T,S,b,C,w,A,O=this,I=new l.Operation({operationName:"InitRuntime",resourceId:(0,_.scrubEuiiInUrl)(t),dimension1:this.hasBeenInitialized.toString()});I.start(),this.hasBeenInitialized=!0,this.hostCallbacks=i,this.gateUtils=new h.GateUtils(this.hostCallbacks,this.changeGateList),this.clientMetadata=o,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,n.getVersion)()),this.telemetryLogger=new _.TelemetryLogger(this.hostCallbacks),this.settings.doNotAddCustomLogger=this.settings.doNotAddCustomLogger||!!s.doNotAddCustomLogger,this.settings.doNotAddCustomLogger||(this.shouldAddLogger(I)?(l.Log.addLogger(this.telemetryLogger),this.addLoggingAggregator(s)):(l.Log.clearLoggers(),l.Log.addLogger(this.telemetryLogger))),e.haveCalledInit=!0,this.annotationResultsProcessor=new g.RoutingAnnotationResultsProcessor((function(){return O.settings.annotationsOrderingEnabled})),this.inferenceServiceFactory=s.inferenceServiceFactory,I.dimension2=(0,l.getNumLoggers)(u.LoggingLevel.info).toString();var x=[];t&&(this.defaultServiceUrl=M.Utils.convertServiceUrlToWebSocket(t),this.serviceProtocol=this.defaultServiceUrl.split(":")[0].toLowerCase()),x.push(this.gateUtils.init().then((function(){return a.__awaiter(O,void 0,void 0,(0,r.default)().mark((function e(){var t=this;return(0,r.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.keys(this.settingToChangeGateName).map((function(e){return a.__awaiter(t,void 0,void 0,(0,r.default)().mark((function t(){var n;return(0,r.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.gateUtils.isChangeGateEnabled(this.settingToChangeGateName[e]);case 3:n=t.sent,this.settings[e]=n,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this.settings[e]=!1;case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))})));case 2:case"end":return e.stop()}}),e,this)})))}))),x.push(this.isFeatureEnabled("AnnotationsOrderingEnabled",!0).then((function(e){O.settings.annotationsOrderingEnabled=e}))),x.push(this.isFeatureEnabled("DefaultBatchingDisabled").then((function(e){var t;(t=O.settings).defaultBatchingEnabled&&(t.defaultBatchingEnabled=!e)}))),x.push(this.isFeatureEnabled("BatchingWith20msIntervalDisabled").then((function(e){var t;(t=O.settings).batchingWith20msIntervalEnabled&&(t.batchingWith20msIntervalEnabled=!e)}))),x.push(this.isFeatureEnabled("OnAnnotationsSubmittedDisabled").then((function(e){var t;(t=O.settings).onAnnotationsSubmittedEnabled&&(t.onAnnotationsSubmittedEnabled=!e)}))),x.push(this.isFeatureEnabled("ReduceBatchOperationsEnabled").then((function(e){var t;(t=O.settings).reduceBatchOperationsEnabled||(t.reduceBatchOperationsEnabled=e)}))),x.push(this.isFeatureEnabled("BatchMessagesEnabled").then((function(e){var t;(t=O.settings).batchMessagesEnabled||(t.batchMessagesEnabled=e)}))),x.push(M.Utils.isChangeGateEnabled(this.hostCallbacks,"AnnotationDoesNotExistOnService").then((function(e){O.settings.annotationDoesNotExistOnService=e}))),x.push(M.Utils.isFeatureEnabled(this.hostCallbacks,"ReducedPingPongRetryEnabled").then((function(e){var t;(t=O.settings).reducedPingPongRetryEnabled||(t.reducedPingPongRetryEnabled=e)}))),x.push(this.isFeatureEnabled("MaxNumberOfDeltaUpdateOpsPerItemPerBatch").then((function(e){var t;(t=O.settings).maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled||(t.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled=e)}))),x.push(M.Utils.isChangeGateEnabled(this.hostCallbacks,"SendTokenFailureMessage").then((function(e){O.settings.sendTokenFailureMessage=e}))),x.push(this.isFeatureEnabled("CreateBlobStorageContainerEnabled").then((function(e){var t;(t=O.settings).createBlobStorageContainerEnabled||(t.createBlobStorageContainerEnabled=e)}))),x.push(M.Utils.isChangeGateEnabled(this.hostCallbacks,"CreateCopyOfClientMetadataInSessionInit").then((function(e){var t;(t=O.settings).createCopyOfClientMetadataInSessionInit||(t.createCopyOfClientMetadataInSessionInit=e)})));var P={enableDeltas:!1,enableEarlyJoin:!1};x.push(Promise.all([this.isFeatureEnabled("DeltaOperationsEnabled").then((function(e){return P.enableDeltas=e})).catch((function(){return P.enableDeltas=!1})),this.isFeatureEnabled("EarlyJoinCompletionEnabled").then((function(e){return P.enableEarlyJoin=e})).catch((function(){return P.enableEarlyJoin=!1}))]).then((function(){O.localWorkflowManager=new y.LocalWorkflowExecutionManager(s.modelDownloader&&O.isDownloaderCompatible()?s.modelDownloader:void 0,O.inferenceServiceFactory,P)})));var L=(0,p.parseFlights)(null!==(c=o.flights)&&void 0!==c?c:"");return this.isDeltaGeneratorEnabled=L.getBooleanValue("Microsoft.Office.WordOnline.AugloopDeltas",null!==(f=s.isDeltaGeneratorEnabled)&&void 0!==f&&f),this.disableSyncDeltaSending=L.getBooleanValue("Microsoft.Office.WordOnline.DisableSyncDeltaSending",null!==(m=s.disableSyncDeltaSending)&&void 0!==m&&m),this.syncDeltaTimeout=L.getIntValue("Microsoft.Office.WordOnline.SyncDeltaTimeout",s.syncDeltaTimeout),(k=this.settings).defaultBatchingEnabled&&(k.defaultBatchingEnabled=!L.getBooleanValue("DefaultBatchingDisabled",!1)),(T=this.settings).batchingWith20msIntervalEnabled&&(T.batchingWith20msIntervalEnabled=!L.getBooleanValue("BatchingWith20msIntervalDisabled",!1)),(S=this.settings).reduceBatchOperationsEnabled||(S.reduceBatchOperationsEnabled=L.getBooleanValue("ReduceBatchOperationsEnabled",!1)),(b=this.settings).batchMessagesEnabled||(b.batchMessagesEnabled=L.getBooleanValue("BatchMessagesEnabled",!1)),(C=this.settings).removeDuplicateFlights&&(C.removeDuplicateFlights=L.getBooleanValue("RemoveDuplicateFlights",!0)),(w=this.settings).reducedPingPongRetryEnabled||(w.reducedPingPongRetryEnabled=L.getBooleanValue("ReducedPingPongRetryEnabled",!1)),(A=this.settings).maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled||(A.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled=L.getBooleanValue("maxNumberOfDeltaUpdateOpsPerItemPerBatch",!1)),this.settings.authTokenTimeoutMs=L.getIntValue("AuthTokenTimeoutMs",0),I.setDataField("Flights",JSON.stringify(this.settings)),s&&s.loggableUrls&&(0,_.setLoggableUrls)(s.loggableUrls),Promise.all(x).then((function(){O.batchOptions=s.batchOptions,!O.batchOptions&&O.settings.defaultBatchingEnabled&&(O.batchOptions={delayMs:1,maxInputSize:1e6,delayMsMax:50},O.settings.batchingWith20msIntervalEnabled&&(O.batchOptions.delayMs=20)),O.batchOptions&&!O.batchOptions.delayMsMax&&(O.batchOptions.delayMsMax=50),s&&s.networkMode&&(O.networkMode=s.networkMode,s.networkMode===d.NetworkMode.LocalWorkflowsOnly&&(O.sessionManagerFactory=function(){return new v.EmptySessionManager})),I.dimension0=JSON.stringify(O.batchOptions),O.logOperation(I,!0)})).catch((function(e){O.logOperation(I,!1,"Error",e?e.message:"(no error)")}))}},{key:"getServiceProtocol",value:function(){return this.serviceProtocol}},{key:"registerLocalWorkflow",value:function(e){this.localWorkflowManager.registerLocalWorkflow(e)}},{key:"flushTelemetry",value:function(e){l.Log.flushAggregators(e)}},{key:"createSession",value:function(e){var t,o=e&&e.docSessionId?e.docSessionId:(0,f.v4)(),r=e&&e.documentId?e.documentId:void 0,i=this.sessionsByDocSessionId.get(o),s=new l.Operation({operationName:"CreateSession",resourceId:o,dimension1:this.hasBeenInitialized.toString()});if(s.start(),i&&!1===i.isClosed)throw this.logOperation(s,!1,"Error","docSessionId already exists"),new Error("docSessionId already exists");var a=e&&null!==(t=e.serviceUrl)&&void 0!==t?t:this.defaultServiceUrl;(a=M.Utils.convertServiceUrlToWebSocket(a))||((e=e||{}).networkMode=d.NetworkMode.LocalWorkflowsOnly),!this.networkMode||void 0!==(null==e?void 0:e.networkMode)&&null!==(null==e?void 0:e.networkMode)||((e=e||{}).networkMode=this.networkMode),void 0!==(null==e?void 0:e.networkMode)&&null!==(null==e?void 0:e.networkMode)&&(null==e?void 0:e.networkMode)!==d.NetworkMode.JSWebSockets||!this.hasHttpFallbackSession()||((e=e||{}).networkMode=d.NetworkMode.HttpFallback);var u=Object.assign({},this.clientMetadata);if(u.docSessionId=o,r&&(u.documentId=r),e&&e.tid3pHost&&(u.tid3pHost=e.tid3pHost),e&&e.flights&&(u.flights=u.flights?u.flights+";"+e.flights:e.flights),this.settings.shouldAppendClientFeatureFlights){var c=(0,n.getSupportedClientFeaturesFlightsString)();u.flights=u.flights?"".concat(u.flights,";").concat(c):c}this.settings.removeDuplicateFlights&&u.flights&&(u.flights=(0,p.removeDuplicateFlights)(u.flights)),s.setDataField("Flights",u.flights||"");var g=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(u,a,e),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:u,userContext:e?e.userContext:void 0,localWorkflowManager:this.localWorkflowManager,annotationResultsProcessor:this.annotationResultsProcessor,localRegisteredWorkflows:(null==e?void 0:e.localRegisteredWorkflows)||[],enableRemoteExecutionNotification:(null==e?void 0:e.enableRemoteExecutionNotification)||!1,networkMode:null==e?void 0:e.networkMode,egress:e?e.egress:void 0,isDeltaGeneratorEnabled:this.isDeltaGeneratorEnabled,onAnnotationsSubmittedEnabled:this.settings.onAnnotationsSubmittedEnabled,disableSyncDeltaSending:this.disableSyncDeltaSending,syncDeltaTimeout:this.syncDeltaTimeout,reduceBatchOperationsEnabled:this.settings.reduceBatchOperationsEnabled,batchMessagesEnabled:this.settings.batchMessagesEnabled,annotationDoesNotExistOnServiceEnabled:this.settings.annotationDoesNotExistOnService,maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled:this.settings.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled,gateUtils:this.gateUtils});return this.sessionsByDocSessionId.set(o,g),e&&(e.onSessionConnect&&g.setConnectCallback(e.onSessionConnect),e.onSessionDisconnect&&g.setDisconnectCallback(e.onSessionDisconnect),e.onSessionReconnect&&g.setReconnectCallback(e.onSessionReconnect),e.onSessionClose&&g.setSessionCloseCallback(e.onSessionClose),e.onServerAuthenticationStateChangeCallback&&g.setServerAuthenticationStateChangeCallback(e.onServerAuthenticationStateChangeCallback),e.onClaimsChallengeCallback&&g.setClaimsChallengeCallback(e.onClaimsChallengeCallback),e.onSeedingStatusChangeCallback&&g.setSeedingStatusChangeCallback(e.onSeedingStatusChangeCallback)),this.logOperation(s,!0),g.initialize?g.initialize():Promise.resolve(g)}},{key:"getSession",value:function(e){return this.sessionsByDocSessionId.get(e)}},{key:"getSessionManagerFactory",value:function(){return this.sessionManagerFactory}},{key:"shouldAddLogger",value:function(t){if(e.haveCalledInit){var n=new Error("Runtime already initialized");return t.dimension3=n.stack,t.dimension2=(0,l.getNumLoggers)(u.LoggingLevel.info).toString(),this.logOperation(t,!1,"Error",n.message),!1}return!0}},{key:"createDefaultSessionManagerFactory",value:function(){var e=this;return function(t,n,o){if(o&&o.networkMode==d.NetworkMode.LocalWorkflowsOnly)return new v.EmptySessionManager;var r=new b.TokenRefreshManager,i=new k.SessionStats,s=function(){l.Log.error(573321615,l.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},a=new S.SessionInitializer((function(){return i}),t,r,(function(e,t,n){s(e,t,n)}),{requestAuthToken:e.hostCallbacks.requestAuthToken,overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage,enableRemoteExecutionNotification:(null==o?void 0:o.enableRemoteExecutionNotification)||!1,sendTokenFailureMessageChangeGate:e.settings.sendTokenFailureMessage,authTokenTimeoutMs:e.settings.authTokenTimeoutMs,dontSendTokenOnReconnectChangeGate:e.settings.doNotSendNewTokenOnReconnect,createBlobStorageContainerEnabled:e.settings.createBlobStorageContainerEnabled,createCopyOfClientMetadataInSessionInit:e.settings.createCopyOfClientMetadataInSessionInit}),u=new T.NetworkSessionManager(M.Utils.convertServiceUrlToWebSocket(n),i,e.workerFactory,a,t,r,e.settings,e.gateUtils,null==o?void 0:o.networkMode);return s=u.sendMessage.bind(u),u.on("disconnect",(function(){return r.clearRefreshTimeouts()})),u.on("connect",(function(t,n,o,r){t&&e.hostCallbacks.setSessionData&&e.hostCallbacks.setSessionData(n,o,r);var i=n.substring(n.lastIndexOf("/")+1);e.telemetryLogger.setServerSessionKey(i)})),u}}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"None";return M.Utils.isFeatureEnabled(this.hostCallbacks,e,t,n)}},{key:"hasHttpFallbackSession",value:function(){var e=!1;return this.sessionsByDocSessionId.forEach((function(t){t.isHttpFallback()&&(e=!0)})),e}},{key:"logOperation",value:function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,l.Log.info(573321622,l.LogCategory.CoreDefault,e)}},{key:"addLoggingAggregator",value:function(e){var t,n,o,r;"Dogfood"!==this.clientMetadata.releaseAudienceGroup&&"Automation"!==this.clientMetadata.releaseAudienceGroup&&(l.Log.addAggregator((0,_.createOperationLoggingAggregator)("Operation","operationName",["ExecuteBatch","ReduceBatchOperations","ProcessResponse","LocalDeltaUpdate","ApplyFormattedTextTileDeltaForLocalWorkflows","ApplyTextTileDeltaForLocalWorkflows","FindRangeForDelta","RunModelForInferencing","GetResource","CreateTextTileDeltaFromItem","NetworkEgressControl","HttpEgress","LongPollNoOp","NetworkRateControllerAbandonedSyncMessage","NetworkRateControllerEgress","NetworkRateControllerQueueItem","NetworkRateControllerOnRateLimitResponse","NetworkRateControllerOnRateLimitError","NetworkRateControllerRateLimitsSet"],null!==(t=e.telemetryAggregationIntervalSec)&&void 0!==t?t:30)),l.Log.addAggregator((0,_.createOperationLoggingAggregator)("Operation","operationName",["ExecuteWorkflow","ExecuteLambda","EarlyJoinCompletion","OnLongPollMessage","OnAnnotationResultsEgress"],null!==(n=e.telemetryAggregationIntervalSec)&&void 0!==n?n:60)),l.Log.addAggregator((0,_.createOperationLoggingAggregator)("Operation","operationName",["LocalScopeExecutionNotification","RunLocalWorkflows","EarlyJoinCompletion","SetAnnotations","WIS.addItemOnContextIdList","WIS.setScopeItem"],null!==(o=e.telemetryAggregationIntervalSec)&&void 0!==o?o:120)),l.Log.addAggregator((0,_.createOperationLoggingAggregator)("SessionHealth","sessionHealthEventName",["SendMessage","ProcessMessage"],null!==(r=e.telemetryAggregationIntervalSec)&&void 0!==r?r:60)))}},{key:"uninitialize",value:function(){this.settings.closeSessionsOnRuntimeUninit&&(this.sessionsByDocSessionId.forEach((function(e){e.close()})),this.sessionsByDocSessionId.clear()),this.flushTelemetry(!0),this.hostCallbacks=null,this.hasBeenInitialized=!1,this.telemetryLogger=null,e.haveCalledInit=!1,this.settings.doNotAddCustomLogger||(l.Log.clearAggregators(),l.Log.clearLoggers())}}])}();n.ClientRuntime=A,n.runtime=new A;n.createRuntime=function(){return new A}},{105:105,114:114,139:139,158:158,163:163,165:165,167:167,170:170,173:173,175:175,177:177,179:179,183:183,184:184,185:185,186:186,200:200,22:22,24:24,245:245,250:250,30:30,45:45,86:86}],182:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(48)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialFetchQueue=void 0;var a=function(){return(0,s.default)((function e(t,n,o){if((0,i.default)(this,e),this.requestInProgress=!1,this.queuedRequests=[],null==t)throw new Error("No request.");this.fetch=t,this.fetchTimeout=n,this.queueTimeout=o}),[{key:"tryProcessNextRequest",value:function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=(0,r.default)(e,3),n=t[0],o=t[1],i=t[2];clearTimeout(i),this.add(n,o)}}},{key:"add",value:function(e,t){var n=this;if(this.requestInProgress){var o=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),n.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,o])}else{this.requestInProgress=!0,new Promise((function(t,o){var r=!1,i=setTimeout((function(){r=!0,o(new Error("Fetch timed out"))}),n.fetchTimeout);n.fetch(e).then((function(e){r||(clearTimeout(i),t(e))})).catch((function(e){r||(clearTimeout(i),o(e))}))})).then((function(e){t(null,e),n.tryProcessNextRequest()})).catch((function(e){t(e,null),n.tryProcessNextRequest()}))}}}])}();n.SequentialFetchQueue=a},{22:22,24:24,30:30,48:48}],183:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(26)),i=o(e(51)),s=o(e(48)),a=o(e(25)),u=o(e(45)),l=o(e(22)),c=o(e(24)),d=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.SessionProxy=n.AnnotationSource=n.graphInitDelayMs=void 0;var f=e(80),p=e(86),g=e(105),h=e(114),y=e(190),v=e(197),m=e(204),k=e(200),T=e(227),S=e(240),b=e(245),C=e(252),w=e(135),_=e(152),M=e(153),A=e(165),O=e(180),I=e(181),x=e(185);n.graphInitDelayMs=10;var P;!function(e){e[e.LocalWorkflow=0]="LocalWorkflow",e[e.ServerWorkflow=1]="ServerWorkflow",e[e.Submitted=2]="Submitted"}(P||(n.AnnotationSource=P={}));var L=function(e,t){t?(e.resultDescription=t,e.success=!1,g.Log.error(509203144,g.LogCategory.CoreDefault,e.stop())):g.Log.info(509203143,g.LogCategory.CoreDefault,e.stop())},E=function(e){return!e.items.some((function(e){return e.source&&0===e.source.indexOf("ThirdParty")}))},D=function(){function e(t){var n,o;(0,l.default)(this,e),this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.apologyCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.registeredContextTypes=new Set,this.availableContexts=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.batchedSeedMessageGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.serverAuthenticationState=m.ServerAuthenticationState.NotAuthenticated,this.sessionCloseCallbacks=new Map,this.connectCallbacks=new Map,this.reconnectCallbacks=new Map,this.disconnectCallbacks=new Map,this.sessionStateCallbackToken=0,this.workflowGraph=new h.WorkflowGraph,this.workflowDefinitionManager=new h.DynamicWorkflowDefinitionManager,this.contextIdManager=new h.ContextIdManager(h.RuntimeKind.JsClient,this.workflowGraph),this.workflowItemStorage=new h.WorkflowItemStorage(this.workflowDefinitionManager),this.pendingConnectCallbacks=[],this.onAnnotationsSubmittedEnabled=!1,this.reduceBatchOperationsEnabled=!1,this.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled=!1,this.batchMessagesEnabled=!1,this.seedingStatus=m.SeedingProgressCode.NotStarted,this.onConnectTelemetryCG=void 0,this.cachedClaimsChallenge={claimsVersion:0,actionRequired:!1},this.tokenMessageVersion=1,this.hostCallbacks=t.hostCallbacks,this.sessionManager=t.sessionManager,this.batchMessagesEnabled=t.batchMessagesEnabled||!1,this.reduceBatchOperationsEnabled=t.reduceBatchOperationsEnabled||!1,this.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled=t.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled||!1,this.operationBatchConfig=t.batchOptions?this.getOperationBatchConfig(t.batchOptions):void 0,this.extensionConfigs=t.extensionConfigs,this.clientMetadata=t.clientMetadata,this.userContext=t.userContext,this.localWorkflowManager=t.localWorkflowManager,this.annotationResultsProcessor=t.annotationResultsProcessor,this.gateUtils=t.gateUtils,this.localRegisteredWorkflows=t.localRegisteredWorkflows||[],this.enableRemoteExecutionNotification=t.enableRemoteExecutionNotification||!1,this.networkMode=t.networkMode,this.egress=t.egress,this.serverAuthenticationStateChangeCallback=[],this.claimsChallengeCallback=[],this.seedingStatusChangeCallbacks=[],this.onAnnotationsSubmittedEnabled=t.onAnnotationsSubmittedEnabled||!1,this.annotationDoesNotExistOnServiceEnabled=t.annotationDoesNotExistOnServiceEnabled||!1,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.on("serverAuthenticationStateChange",this.onServerAuthenticationStateChange.bind(this)),this.sessionManager.onMessage(m.AnnotationResultsMessage.getTypeName(),this.onAnnotationResultsFromServer.bind(this)),this.sessionManager.onMessage(m.AnnotationResultStateMessage.getTypeName(),this.onAnnotationResultStateMessage.bind(this)),this.sessionManager.onMessage(m.WorkflowExecutionCompleteMessage.getTypeName(),this.onWorkflowExecutionCompleteMessage.bind(this)),this.sessionManager.onMessage(m.ClaimsChallengeMessage.getTypeName(),this.onClaimsChallengeMessage.bind(this)),this.sessionManager.onMessage(m.SeedingStatusChangeMessage.getTypeName(),this.onSeedingStatusChangeMessage.bind(this)),t.isDeltaGeneratorEnabled&&(this.enableSyncDeltaSending=!t.disableSyncDeltaSending,this.syncDeltaTimeout=null!==(n=t.syncDeltaTimeout)&&void 0!==n?n:700,this.enableDeltaGenerator()),this.setServerAuthenticationStateChangeCallback(this.updateGraphOnAuthStateChange.bind(this)),(null===(o=this.gateUtils)||void 0===o?void 0:o.isChangeGateEnabledSync(I.fixIncorrectInvocationOfClaimsCallbackString))||this.setClaimsChallengeCallback(this.requestAuthTokenWithClaims.bind(this))}return(0,c.default)(e,[{key:"enabledRemoteExecutionNotification",value:function(){return this.enableRemoteExecutionNotification}},{key:"getSessionReconnectParams",value:function(){if(!this.connectParams)throw new Error("Session has not been established yet.");return{sessionUrl:this.connectParams.sessionUrl,origin:this.connectParams.origin,authToken:this.connectParams.authToken,nextSyncSequenceId:this.nextSyncSequenceId}}},{key:"setNextSequenceId",value:function(e){this.nextSyncSequenceId=e}},{key:"tryGetDocSessionId",value:function(){if(this.clientMetadata&&this.clientMetadata.docSessionId)return this.clientMetadata.docSessionId}},{key:"getSessionStateCallbackToken",value:function(e){var t;return e+"-callback-"+(null!==(t=this.tryGetDocSessionId())&&void 0!==t?t:"unknown")+"-"+this.sessionStateCallbackToken++}},{key:"updateGraphOnAuthStateChange",value:function(e){this.tryActivateWorkflows()}},{key:"tryActivateWorkflows",value:function(){var e=this;if(this.enableRemoteExecutionNotification){var t=new g.Operation({operationName:"GraphServerWorkflowActivation",success:!0}).setClientMetadata(this.clientMetadata).start(),n=[];this.workflowGraph.getWorkflowNodes().filter((function(e){return e.location===h.Location.External})).forEach((function(t){e.localWorkflowManager.canActivateWorkflow(t,e)?t.isActivated=!0:(e.localWorkflowManager.deactivateServerWorkflow(t,e),n.push(t.workflow.id))})),t.resultDescription="deactivated workflows: [".concat(n.join(),"]"),g.Log.info(508879493,g.LogCategory.CoreDefault,t.stop())}}},{key:"initialize",value:function(){return d.__awaiter(this,void 0,void 0,(0,u.default)().mark((function e(){return(0,u.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localWorkflowManager&&this.localWorkflowManager.addSession(this),this.registerLocalWorkflowsWithoutGraphInit(this.localRegisteredWorkflows),!this.gateUtils||this.onConnectTelemetryCG){e.next=6;break}return e.next=5,this.gateUtils.isChangeGateEnabled("OnConnectTelemetry");case 5:this.onConnectTelemetryCG=e.sent;case 6:return e.next=8,this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0,this.egress);case 8:return this.localWorkflowManager&&this.localWorkflowManager.setTokenCallback(this.getAuthToken.bind(this)),e.abrupt("return",this);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"isLocalWorkflowRegistered",value:function(e){return this.getLocalRegisteredWorkflows().some((function(t){return e===t.id}))}},{key:"isConnected",get:function(){return!!this.connectParams}},{key:"hasConnected",get:function(){return this.hasSessionConnected}},{key:"isClosed",get:function(){return this.isSessionClosed}},{key:"getServerAuthenticationState",value:function(){return this.serverAuthenticationState}},{key:"getContextIdManager",value:function(){return this.contextIdManager}},{key:"getWorkflowItemStorage",value:function(){return this.workflowItemStorage}},{key:"getWorkflowDefinition",value:function(e,t){return this.workflowDefinitionManager.getWorkflowDefinition(e,t)}},{key:"registerLocalWorkflows",value:function(e){this.registerLocalWorkflowsWithoutGraphInit(e),this.trySendWorkflowGraphInitMessage()}},{key:"registerLocalWorkflowsWithoutGraphInit",value:function(e){if(e.length&&this.localWorkflowManager){var t,n=(0,a.default)(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.localWorkflowManager.registerLocalWorkflow(o,this)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"registerLocalWorkflow",value:function(e){this.registerLocalWorkflows([e]);var t=new g.Operation({operationName:"SessionRegisterLocalWorkflow",resourceId:e.id,success:!0}).setClientMetadata(this.clientMetadata).start();L(t)}},{key:"activateAnnotation",value:function(e,t,n){var o,r=new w.AnnotationActivationTracker(this.sendMessageToSession.bind(this),e,t,this.annotationDoesNotExistOnServiceEnabled),i=function(t,n){var o=t.get(e);o||(o=new Map,t.set(e,o)),o.set(r.token,n)};(null==t?void 0:t.callback)&&i(this.annotationCallbacks,null==t?void 0:t.callback),(null==t?void 0:t.apologyCallback)&&i(this.apologyCallbacks,null==t?void 0:t.apologyCallback);var s=null!==(o=this.tokensByAnnotationType.get(e))&&void 0!==o?o:[];return-1===s.indexOf(r.token)&&s.push(r.token),this.tokensByAnnotationType.set(e,s),this.annotationActivationTrackers.set(r.token,r),this.activateAnnotationForTracker(r,{ignoreExistingAnnotations:!1,sendOnlyIfConnected:!1,sendApologies:void 0!==(null==t?void 0:t.apologyCallback)})}},{key:"activateServerRequestResponse",value:function(e,t,n){return d.__awaiter(this,void 0,void 0,(0,u.default)().mark((function o(){var r,i=this;return(0,u.default)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r=function(e,n){var o,r=(0,a.default)(e.items);try{var s=function(){var e=o.value,n=new g.Operation({operationName:"ServerRequestResponseAnnotationReceived",success:!0}).setClientMetadata(i.clientMetadata).start(),r=e.body;if(!(null==r?void 0:r.workflowExecutionCorrelation)){var s="Received annotation without workflowExecutionCorrelation";throw L(n,s),new Error(s)}var a=!1;null==t||t.onAnnotationCallback(r,(function(e,t){if(a){var o="Final response has already been sent for this annotation";throw L(n,o),new Error(o)}a=void 0===t||t;var s=new m.ExecutionCorrelatedClientResponse({workflowExecutionCorrelation:r.workflowExecutionCorrelation,finalResponse:a,content:e}),u=i.submitCustomMessage(s).catch((function(e){throw L(n,"Error submitting response: ".concat(e.message)),e}));return t&&L(n),u})).catch((function(e){L(n,"Error in onAnnotationCallback: ".concat(e.message))}))};for(r.s();!(o=r.n()).done;)s()}catch(e){r.e(e)}finally{r.f()}},o.next=3,this.activateAnnotation(e,{callback:r},n);case 3:case"end":return o.stop()}}),o,this)})))}},{key:"activateAnnotationForTracker",value:function(e,t){var n=new g.Operation({operationName:"ActivateAnnotation",resourceId:e.annotationType,success:!0}).setClientMetadata(this.clientMetadata).start();return n.setDataField("StartTimestamp",Date.now()),e.activate(t.ignoreExistingAnnotations,t.sendOnlyIfConnected,t.sendApologies).then((function(o){return n.resultSignature="Ok",n.resultDescription="Activated annotation ".concat(e.annotationType," with token ").concat(e.token,"; sendOnlyIfConnected: ").concat(t.sendOnlyIfConnected),L(n),o})).catch((function(o){throw L(n,"error on activate annotation type ".concat(e.annotationType,": ").concat(o,"; sendOnlyIfConnected: ").concat(t.sendOnlyIfConnected)),o}))}},{key:"updateAnnotationConfig",value:function(e,t){var n=new m.AnnotationConfigUpdateMessage({token:e,config:t});this.sendMessageToSession(n);var o=this.annotationActivationTrackers.get(e);o&&o.options&&(o.options.config=t)}},{key:"releaseAnnotation",value:function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var n=function(n){var o=n.get(t.annotationType);o&&(o.delete(e),0==o.size&&n.delete(t.annotationType))};return n(this.annotationCallbacks),n(this.apologyCallbacks),t.release()}return Promise.resolve(!1)}},{key:"setAnnotationState",value:function(e,t,n){var o={state:n};this.submitOperation(new T.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:o}))}},{key:"setAnnotationMetadata",value:function(e,t,n){this.submitOperation(new T.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:n}))}},{key:"submitOperation",value:function(e,t){this.submitOperations([e],t)}},{key:"submitOperations",value:function(e,t){var n,o;if(t||(t=this.generateCorrelationId()),(0,O.logTelemetryForSignalOperations)(e,t,Date.now(),"SubmitInRuntimeClient",new g.Operation({operationName:"AugloopClientPerfTracker",success:!0}).setClientMetadata(this.clientMetadata).start()),this.contextIdManager.applyContextIdOnOperations(e),this.updateWorkflowExecutionStates(e),!this.onAnnotationsSubmittedEnabled){var r=this.partitionAnnotationOperations(e),u=(0,s.default)(r,2),l=u[0];u[1];this.executeCallbacksOnAnnotationSubmitted(l,t)}var c=e.filter(this.filterOperationsForSession.bind(this)).filter(E),d=[];if(this.deltaGenerator){var f,p=new g.Operation({operationName:"ExecuteDeltaGenerator",success:!0}).setClientMetadata(this.clientMetadata).start(),h=(0,a.default)(c);try{for(h.s();!(f=h.n()).done;){var y=f.value;if(T.UpdateOperation.typeGuard(y))d.push.apply(d,(0,i.default)(this.createDeltasFromUpdateOperation(y)));else{var v,m=y,k=(0,a.default)(m.items);try{for(k.s();!(v=k.n()).done;){var S=v.value;T.AddOperation.typeGuard(y)?this.deltaGenerator.addItemToLocalMap(S,m.parentPath):T.DeleteOperation.typeGuard(y)?this.deltaGenerator.deleteItemFromLocalMap(S,m.parentPath):T.MoveOperation.typeGuard(y)&&this.deltaGenerator.moveItemsInLocalMap(y.parentPath,y.prevParentPath,null!==(o=null===(n=y.items)||void 0===n?void 0:n.map((function(e){return e.id})))&&void 0!==o?o:[])}}catch(e){k.e(e)}finally{k.f()}d.push(y)}}}catch(e){h.e(e)}finally{h.f()}L(p)}if(this.onAnnotationsSubmittedEnabled){var b=this.partitionAnnotationOperations(d.length?d:c),C=(0,s.default)(b,2),w=C[0],_=C[1];this.onAnnotationsSubmitted(w,t),this.submitOperationsToSession(_,t)}else this.submitOperationsToSession(d.length?d:c,t);this.localWorkflowManager&&this.localWorkflowManager.runLocalWorkflows(e,this,!0)}},{key:"submitSeedOperations",value:function(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");if(this.networkMode===k.NetworkMode.LocalWorkflowsOnly&&this.localWorkflowManager)this.localWorkflowManager.runLocalWorkflows(e,this);else{t||(t=this.generateCorrelationId()),this.allowSeed=!1,this.allowGroupSeed=!1;var n=this.partitionAnnotationOperations(e),o=(0,s.default)(n,2),r=o[0],i=o[1];this.onAnnotationsSubmittedEnabled?this.onAnnotationsSubmitted(r,t):this.executeCallbacksOnAnnotationSubmitted(r,t),this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(this.onAnnotationsSubmittedEnabled?i:e,!0,t):this.sendMessageToSession(new m.SyncMessage({cv:t,seq:0,ops:this.onAnnotationsSubmittedEnabled?i:e}))}}},{key:"submitSeedGroupOperations",value:function(e,t,n){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");if(this.networkMode===k.NetworkMode.LocalWorkflowsOnly&&this.localWorkflowManager)this.localWorkflowManager.runLocalWorkflows(e,this);else{n||(n=this.generateCorrelationId()),t&&(this.allowGroupSeed=!1),this.allowSeed=!1;var o=this.partitionAnnotationOperations(e),r=(0,s.default)(o,2),i=r[0],a=r[1];this.executeCallbacksOnAnnotationSubmitted(i,n),this.onAnnotationsSubmittedEnabled?this.onAnnotationsSubmitted(i,n):this.executeCallbacksOnAnnotationSubmitted(i,n),this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(this.onAnnotationsSubmittedEnabled?a:e,!!t,n):(this.seedGroupSize++,this.sendMessageToSession(new m.SyncMessage({cv:n,seq:0,ops:this.onAnnotationsSubmittedEnabled?a:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))}}},{key:"submitCustomMessage",value:function(e){var t=this;return new Promise((function(n,o){t.sendMessageToSession(e,(function(t,r){t?o(new Error("".concat(t.error,"; for message type: ").concat(T.SchemaObject.getTypeNameFor(e)))):n(r)}))}))}},{key:"submitLargeBinaryDataMessage",value:function(e){var t=this;return new Promise((function(n,o){t.sendMessageToSessionPostEndpoint(e,(function(e,t){e?o(new Error(e.error)):n(t)}))}))}},{key:"submitBinaryStreamUploadMessage",value:function(e){var t=this;return new Promise((function(n,o){var r=new g.Operation({operationName:"sendBinaryStreamUploadMessage",success:!0}).setClientMetadata(t.clientMetadata).start();if(t.connectParams)(0,M.sendBinaryStreamUploadMessage)(t.connectParams,e,r,(function(e,t){e?o(new Error(e.error)):n(t)}));else{var i=function(t){return(0,M.sendBinaryStreamUploadMessage)(t,e,r,(function(e,t){e?o(new Error(e.error)):n(t)}))}.bind(t);t.pendingConnectCallbacks.push(i)}}))}},{key:"requestBinaryDataForBlob",value:function(e){var t=this;return e.data?Promise.resolve(e.data):e.dataPointer&&e.dataPointer.refType!==T.BlobRefType.None?new Promise((function(n,o){t.requestBinaryDataFromSessionBlobEndpoint(e.dataPointer,(function(e,t){e?o(e):n(t)}))})):Promise.reject(new Error("Blob does not have a data pointer"))}},{key:"requestCacheDump",value:function(e){if(e)throw new Error("NYI");return this.submitCustomMessage(new m.CacheDumpRequestMessage)}},{key:"forceReconnect",value:function(e){return this.extensionConfigs=e,this.sessionManager.forceReconnect(e)}},{key:"close",value:function(e){var t;this.isSessionClosed=!0,this.sessionManager.closeSession(e),this.localWorkflowManager&&this.localWorkflowManager.closeSession(this),this.graphInitMessageTimer&&(clearTimeout(this.graphInitMessageTimer),this.graphInitMessageTimer=void 0),(null===(t=this.gateUtils)||void 0===t?void 0:t.isChangeGateEnabledSync(I.logExpiredTimeoutTasksInBatchManager))||this.batchedOperationsManager&&this.batchedOperationsManager.close()}},{key:"authenticateInteractive",value:function(e){return d.__awaiter(this,void 0,void 0,(0,u.default)().mark((function t(){var n;return(0,u.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&e.forceUserPrompt||!(this.cachedClaimsChallenge.claimsVersion>0)||this.cachedClaimsChallenge.actionRequired){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.requestAuthTokenInteractive(this.cachedClaimsChallenge,{interactive:!0});case 5:if(n=t.sent,!m.TokenFailureMessage.typeGuard(n)){t.next=8;break}throw new Error(n.reason);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getClientMetadata",value:function(){return this.clientMetadata}},{key:"getUserContext",value:function(){return this.userContext}},{key:"setSessionCloseCallback",value:function(e){var t=this.getSessionStateCallbackToken("close");return e&&this.sessionCloseCallbacks.set(t,e),t}},{key:"setConnectCallback",value:function(e){var t=this.getSessionStateCallbackToken("connect");return e&&this.connectCallbacks.set(t,e),t}},{key:"setDisconnectCallback",value:function(e){var t=this.getSessionStateCallbackToken("disconnect");return e&&this.disconnectCallbacks.set(t,e),t}},{key:"setReconnectCallback",value:function(e){var t=this.getSessionStateCallbackToken("reconnect");return e&&this.reconnectCallbacks.set(t,e),t}},{key:"removeSessionStateCallback",value:function(e){function t(t){return!!t.has(e)&&(t.delete(e),!0)}return t(this.sessionCloseCallbacks)||t(this.reconnectCallbacks)||t(this.disconnectCallbacks)||t(this.connectCallbacks)}},{key:"setServerAuthenticationStateChangeCallback",value:function(e){this.serverAuthenticationStateChangeCallback.push(e),e(this.serverAuthenticationState)}},{key:"setClaimsChallengeCallback",value:function(e){this.cachedClaimsChallenge.actionRequired&&e(this.cachedClaimsChallenge),this.claimsChallengeCallback.push(e)}},{key:"setSeedingStatusChangeCallback",value:function(e){e(new m.SeedingStatusChangeMessage({newStatus:this.seedingStatus})),this.seedingStatusChangeCallbacks.push(e)}},{key:"getConnectParams",value:function(){return this.connectParams}},{key:"setOfflineMode",value:function(){this.sessionManager=new A.EmptySessionManager}},{key:"onAnnotationResults",value:function(e,t,n){var o=this;g.Log.info(508916486,g.LogCategory.CoreDefault,new g.Operation({operationName:"OnAnnotationResultsEgress",dimension0:null==e?void 0:e.annotationType,success:!0,cv:e.cv})),n(void 0,new m.Response),t===P.LocalWorkflow&&this.contextIdManager.applyContextIdOnOperations(e.ops),this.updateWorkflowExecutionStates(e.ops),this.egress&&this.egress(e,(function(){})),this.annotationResultsProcessor.process(e,(function(e,n){o.applyOperationForContext(e,n,t)}),(function(n,r){var i=Date.now();o.triggerRegisteredAnnotationCallbacks(n,e.annotationType,r,e.areApologies),t===P.ServerWorkflow&&(0,O.logTelemetryForAnnotation)(e,i,"CallbackInRuntimeClient",!0,new g.Operation({operationName:"AugloopClientPerfTracker",success:!0}).setClientMetadata(o.clientMetadata).start())}),(function(e){if(t!==P.ServerWorkflow){var n=e.ops.filter(o.filterOperationsForSession.bind(o)).filter(E);o.submitOperationsToSession(n,e.cv)}o.localWorkflowManager&&o.localWorkflowManager.runLocalWorkflows(e.ops,o)}))}},{key:"onAnnotationResultStateMessage",value:function(e,t){var n;t(void 0,new m.Response);var o,r=(0,a.default)(e.updates);try{for(r.s();!(o=r.n()).done;){var i=o.value,s=i.annotationType,u=i.state;if(this.tokensByAnnotationType.has(s)){var l=void 0;l=this.annotationResultStates.has(s)?this.annotationResultStates.get(s):u===m.AnnotationResultState.Idle?m.AnnotationResultState.Pending:m.AnnotationResultState.Idle;var c,d=(0,a.default)(this.tokensByAnnotationType.get(s));try{for(d.s();!(c=d.n()).done;){var f=c.value,p=this.annotationActivationTrackers.get(f);(null===(n=p.options)||void 0===n?void 0:n.stateUpdateCallback)&&p.options.stateUpdateCallback(l,u)}}catch(e){d.e(e)}finally{d.f()}}}}catch(e){r.e(e)}finally{r.f()}}},{key:"submitOperationsToSession",value:function(e,t){var n=this;t||(t=this.generateCorrelationId());var o=e.filter((function(e){return T.SignalOperation.typeGuard(e)})),r=e.filter((function(e){return!T.SignalOperation.typeGuard(e)}));if(o.length>0&&this.sendMessageToSession(new m.SyncMessage({cv:t,ops:o})),r.length>0)if(this.operationBatchConfig){if(!this.batchedOperationsManager){var i=void 0;i=this.batchMessagesEnabled?function(e,t,o){if(e.length){var r=new m.BatchedMessage;r.messages=[],e.forEach((function(e){r.messages.push(new m.SyncMessage({cv:e.cv,seq:n.nextSyncSequenceId++,ops:e.input}))})),n.sendMessageToSession(r,(function(e){o(e?new Error(e.error):void 0)}))}}:function(e,t,o){n.sendMessageToSession(new m.SyncMessage({cv:t.cv,seq:n.nextSyncSequenceId++,ops:e}),(function(e){o(e?new Error(e.error):void 0)}))},this.batchedOperationsManager=new _.BatchManager(i,this.reduceBatchOperationsEnabled,this.batchMessagesEnabled,void 0,this.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled)}this.batchedOperationsManager.addBatchItem(r,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.sendMessageToSession(new m.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:r}))}},{key:"sendMessageToSession",value:function(e,t){this.sessionManager.sendMessage(e,t),m.SessionCloseMessage.typeGuard(e)&&this.close()}},{key:"sendMessageToSessionPostEndpoint",value:function(e,t){var n=new g.Operation({operationName:"SendLargeBinaryDataMessage",success:!0,cv:e.cv}).setClientMetadata(this.clientMetadata).start();if(this.connectParams)(0,M.sendLargeBinaryDataMessage)(this.connectParams,e,n,t);else{var o=function(o){return(0,M.sendLargeBinaryDataMessage)(o,e,n,t)}.bind(this);this.pendingConnectCallbacks.push(o)}}},{key:"requestBinaryDataFromSessionBlobEndpoint",value:function(e,t){var n=new g.Operation({operationName:"RequestBinaryData",success:!0,cv:(new g.CorrelationVector).toString()}).setClientMetadata(this.clientMetadata).start();if(this.connectParams)(0,M.fetchBlobFromRef)(this.connectParams,e,t,n);else{var o=function(o){return(0,M.fetchBlobFromRef)(o,e,t,n)}.bind(this);this.pendingConnectCallbacks.push(o)}}},{key:"registerContextTypes",value:function(e){var t,n=(0,a.default)(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.activateAnnotation(o),this.registeredContextTypes.add(o)}}catch(e){n.e(e)}finally{n.f()}}},{key:"applyOperationForContext",value:function(e,t,n){var o=this,r=T.SchemaObject.getTypeNameFor(e);if(r==T.AddOperation.getTypeName()||r==T.Operation.getTypeName()||r==T.UpdateOperation.getTypeName()||r==T.DeleteOperation.getTypeName()){r==T.Operation.getTypeName()&&(r=T.AddOperation.getTypeName());var i=(0,v.shallowCloneItemWithPath)(this.resolvePlaceholdersInOperationParentPath(e.parentPath),t),s=(0,v.makeItemPathKey)(i.parentPath);if(r==T.AddOperation.getTypeName()||r==T.UpdateOperation.getTypeName()){if(!i.body)return;var a=T.SchemaObject.getTypeNameFor(i.body);if(!this.registeredContextTypes.has(a))return;var u=this.availableContexts.get(a);u||(u=new Map,this.availableContexts.set(a,u));var l=u.get(n);if(l||(l=[],u.set(n,l)),i.id||this.localWorkflowManager&&(i.id=this.localWorkflowManager.getNextClientAnnotationId()),r==T.AddOperation.getTypeName())0==l.filter((function(e){return(0,v.makeItemPathKey)(e.parentPath)==s&&e.id==i.id})).length?l.push(i):g.Log.info(540848911,g.LogCategory.CoreDefault,"AddOperation for (".concat(n,", ").concat(i.id,", ").concat(i.source,") can't be applied as the context item with matching path and ID already exists. Use UpdateOperation instead."));else for(var c=0;c<l.length;c++)if(l[c].id==i.id&&(0,v.makeItemPathKey)(l[c].parentPath)==s){if(l[c].source==i.source){l[c]=i;break}g.Log.warn(540848912,g.LogCategory.CoreDefault,"UpdateOperation for (".concat(n,", ").concat(i.id,", ").concat(i.source,") can't be applied as the context item with provided path and ID has different source: ").concat(l[c].source))}else g.Log.warn(540848913,g.LogCategory.CoreDefault,"UpdateOperation for (".concat(n,", ").concat(i.id,", ").concat(i.source,") can't be applied as the context item with matching path and ID was not found. AddOperation should be used instead"))}else if(r==T.DeleteOperation.getTypeName()){if(!i.id)return;this.availableContexts.forEach((function(e,t){var r=e.get(n);r&&(0==(r=r.filter((function(e){return!((0,v.makeItemPathKey)(e.parentPath)==s&&e.id==i.id)}))).length?e.delete(n):e.set(n,r),0==e.size?o.availableContexts.delete(t):o.availableContexts.set(t,e))}))}}}},{key:"updateWorkflowExecutionStates",value:function(e){if(this.localWorkflowManager){var t,n=this.enableRemoteExecutionNotification?this.workflowGraph.getWorkflowNodes().map((function(e){return e.workflow})):this.localWorkflowManager.getAllRegisteredWorkflowsFromSession(this),o=(0,a.default)(e);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(h.supportedOperationSet.has(T.SchemaObject.getTypeNameFor(r))){var i,s=(0,a.default)(r.items);try{for(s.s();!(i=s.n()).done;){var u,l=i.value,c=(0,a.default)(n||[]);try{for(c.s();!(u=c.n()).done;){var d=u.value;this.localWorkflowManager.preProcessItemToWorkflow(d,l,this)}}catch(e){c.e(e)}finally{c.f()}}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){o.e(e)}finally{o.f()}}}},{key:"resolveRequestedContexts",value:function(e){var t,n=[],o=(0,a.default)((0,C.getContextTypes)(e.requestedContextTypesRules));try{for(o.s();!(t=o.n()).done;){var r=(0,s.default)(t.value,3),u=r[0],l=r[1];r[2];if(this.availableContexts.has(u)){var c=Array.from(this.availableContexts.get(u).values()).reduce((function(e,t){return e.concat(t)}),[]);if(0==c.length)throw new Error("Assert: availableContexts have the entry for ".concat(u," which does not contain any context annotation."));n.push.apply(n,(0,i.default)(c))}else if(l==p.RequestedContextCardinality.Required)return[!1,[]]}}catch(e){o.e(e)}finally{o.f()}return[!0,this.removeDuplicatedContextItems(n)]}},{key:"removeDuplicatedContextItems",value:function(e){return e.filter((function(e,t,n){return n.findIndex((function(t){return x.Utils.deepEquals(t,e)}))===t}))}},{key:"getContextAnnotations",value:function(e,t,n,o){var r,i,s=n?(0,v.makeItemPathKey)(n):void 0;return null===(i=null===(r=this.availableContexts.get(e))||void 0===r?void 0:r.get(t))||void 0===i?void 0:i.filter((function(e){return!(s&&(0,v.makeItemPathKey)(e.parentPath)!=s||o&&e.source!=o)}))}},{key:"onWorkflowDefinitionOverrideMessage",value:function(e){var t=new g.Operation({operationName:"WorkflowDefinitionOverride",success:!0}).setClientMetadata(this.clientMetadata).start(),n=function(e){throw L(t,e),Error("WorkflowDefinitionOverride: ".concat(e))};if(this.localWorkflowManager){var o=this.localWorkflowManager.getWorkflowDefinitionsByName(this),r=o.get(e.sourceWorkflowId);if(r){t.resourceId=r.id;var i=o.get(e.targetWorkflowId);i&&(i.allowDefinitionOverride?r.definitionOverrideTargetWorkflows&&-1!==r.definitionOverrideTargetWorkflows.indexOf(i.id)?(this.workflowDefinitionManager.mergeWorkflowDefinition(i,e.definition,e.contextId),t.resultDescription="Updated config for workflow: ".concat(e.targetWorkflowId,", context id: ").concat(e.contextId),L(t)):n("Workflow '".concat(r.id,"' does not allow workflow definition for workflow '").concat(i.id,"'.")):n("Workflow '".concat(i.id,"' does not allow workflow definition override.")))}else n("Workflow registration for source workflow '".concat(e.targetWorkflowId,"' was not found."))}else n("Not supported by this local SessionProxy instance.")}},{key:"applyContextIdOnOperations",value:function(e){this.contextIdManager.applyContextIdOnOperations(e)}},{key:"attachToWorkflowGraph",value:function(e){this.addToWorkflowGraph(e),this.attachExecutionTrackerToEachWorkflow()}},{key:"triggerRegisteredAnnotationCallbacks",value:function(e,t,n,o){if(this.callAnnotationCallbacks(e,t,n,o),this.hostCallbacks.onAnnotationResult)try{o?this.hostCallbacks.onApologyResult&&this.hostCallbacks.onApologyResult(e,n):this.hostCallbacks.onAnnotationResult(e,n)}catch(e){g.Log.error(540301151,g.LogCategory.CoreDefault,new g.Operation({operationName:"HostCallbackOnAnnotationResultError",dimension0:t,resultDescription:"onAnnotationResult error: ".concat(e)}))}}},{key:"attachExecutionTrackerToEachWorkflow",value:function(){this.localWorkflowManager&&this.localWorkflowManager.attachExecutionTrackerToEachWorkflow(this.workflowGraph,this,this.onWorkflowExecutionComplete.bind(this))}},{key:"onWorkflowExecutionCompleteMessage",value:function(e,t){t(void 0,new m.Response),this.localWorkflowManager&&this.localWorkflowManager.onExternalWorkflowExecuted(e.contextId,e.workflowId,this)}},{key:"onWorkflowExecutionComplete",value:function(e,t){}},{key:"enableDeltaGenerator",value:function(){var e,t;this.deltaGenerator=null!==(e=this.deltaGenerator)&&void 0!==e?e:new f.DeltaGenerator,this.syncDeltaTimers=null!==(t=this.syncDeltaTimers)&&void 0!==t?t:new Map}},{key:"createDeltasFromUpdateOperation",value:function(e){var t,n,o=[];g.Log.info(523776396,g.LogCategory.CoreDefault,"Calling delta create for UpdateOperation under parent path [".concat(e.parentPath,"] (").concat(null===(t=e.items)||void 0===t?void 0:t.length," item(s), first item id: ").concat((null===(n=e.items)||void 0===n?void 0:n.length)>0?e.items[0].id:"(no items)",")"));var r,s=(0,i.default)(e.parentPath),u=(0,a.default)(e.items);try{for(u.s();!(r=u.n()).done;){var l=r.value,c=[],d=this.deltaGenerator.createTextTileDeltasFromItem(l,e.parentPath);if(null==d?void 0:d.length){var f,p=(0,a.default)(d);try{for(p.s();!(f=p.n()).done;){var h=f.value,y=(0,b.v4)();s=[].concat((0,i.default)(e.parentPath),[l.id]);var v={id:y,revId:l.revId,body:h,contextId:l.contextId,source:l.source};c.push(v)}}catch(e){p.e(e)}finally{p.f()}c.length>0&&(o.push(new T.DeltaUpdateOperation({parentPath:s,items:c})),this.enableSyncDeltaSending&&this.setupSyncDeltaAfterDelay(l,s,c))}else g.Log.info(523329632,g.LogCategory.CoreDefault,"Failed to create delta on item ".concat(l.id))}}catch(e){u.e(e)}finally{u.f()}return o}},{key:"setupSyncDeltaAfterDelay",value:function(e,t,n){var o,r,i,s=this,a=this.syncDeltaTimers.get(e.id);a&&(clearTimeout(a),this.syncDeltaTimers.delete(e.id));var u=n.find((function(e){var t;return(null===(t=e.body)||void 0===t?void 0:t.unit)===S.TextTileDeltaUnit.Chars}));if(u){var l=u.body,c={content:"",deltaType:S.TextTileDeltaType.Update,length:0,position:(null!==(o=null==l?void 0:l.position)&&void 0!==o?o:0)+(null!==(i=null===(r=null==l?void 0:l.content)||void 0===r?void 0:r.length)&&void 0!==i?i:0),unit:S.TextTileDeltaUnit.Sentence},d=S.FormattedTextTile.typeGuard(e.body)?new S.FormattedTextTileDelta(c):new S.TextTileDelta(c),f={id:(0,b.v4)(),revId:e.revId,body:d,contextId:e.contextId,source:e.source},p=new T.DeltaUpdateOperation({parentPath:t,items:[f]}),g=setTimeout((function(e,t){s.submitOperation(e),s.syncDeltaTimers.delete(t)}),this.syncDeltaTimeout,p,e.id);this.syncDeltaTimers.set(e.id,g)}}},{key:"addToWorkflowGraph",value:function(e){this.workflowGraph.addWorkflow((0,h.getWorkflowDefinitionBase)(e))}},{key:"getAnnotations",value:function(t,n){var o,i,s,a=null!==(o=t.cv)&&void 0!==o?o:this.sessionManager.getCorrelationVector().newChild().toString(),l=new g.Operation({operationName:"GetAnnotations",success:!0,resultSignature:"GetAnnotationsEntry",resourceId:"".concat(t.sourceInfo.featureId,"-").concat(t.sourceInfo.entryPoint),cv:a}).setClientMetadata(this.clientMetadata).start();l.setDataFields({AnnotationType:null===(i=t.annotationType)||void 0===i?void 0:i.toString(),MaxDelayMs:null===(s=t.maxDelayMs)||void 0===s?void 0:s.toString()});var c,f=new k.GetAnnotationsRequestMessage({annotationTypes:t.annotationType,transientItems:t.transientItems,configs:t.configs,maxDelayMs:t.maxDelayMs,sourceInfo:t.sourceInfo,caller:k.AnnotationsRequestCaller.Client,tryResolveUpstreamDependencies:t.tryResolveUpstreamDependencies,correlationInfo:{cvString:a},cv:a}),p=[];L(l),this.sendMessageToSession(f,(function(e,t){(null==n?void 0:n.IsCancellationRequested)||(p.push({error:e,response:t}),null==c||c(!0))}));var h=this,y=!1,v=new Promise((function(t,o){null==n||n.onCancel((function(n){y?t():o(new Error(e.requestCancelledError))}))}));return(0,r.default)({},Symbol.asyncIterator,(function(){var t,o,r,i,s,a,f;return d.__asyncGenerator(this,arguments,(0,u.default)().mark((function g(){var k,T,S,b,C,w,_,M,A;return(0,u.default)().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(y){u.next=38;break}if(u.prev=1,0!==p.length){u.next=5;break}return u.next=5,d.__await(Promise.race([new Promise((function(e){return c=e})),v]));case 5:if(l.resultSignature="AnnotationReceived",k=p.shift(),!(null==n?void 0:n.IsCancellationRequested)){u.next=9;break}throw new Error(e.requestCancelledError);case 9:return y=(null===(t=k.response)||void 0===t?void 0:t.finalResponse)||void 0!==k.error,l.setDataField("FinalResponse",y),T=(0,O.checkFirstUserPerceivedResponse)(k.response),l.setDataField("FirstUserPerceivedResponse",T),S=void 0,b=void 0,C=void 0,k.error?(w="ErrorCode: ".concat(k.error.code,", Error: ").concat(k.error.error,", Retryable: ").concat(k.error.retryable),l.setDataField("ServerError",w),C=k.error.error,S={serviceError:[{code:m.ExecutionErrorCode.ServerError,error:k.error.error,retryable:null==h?void 0:h.canBeRetried(k.error)}]}):(null===(r=null===(o=k.response)||void 0===o?void 0:o.errorInfo)||void 0===r?void 0:r.length)>0?(_=k.response.errorInfo.map((function(e){return"ErrorCode: ".concat(e.code,", Error: ").concat(e.error,", Retryable: ").concat(e.retryable,", ResourceId: ").concat(e.resourceId)})).join("\n"),l.setDataField("WorkflowErrors",_),C="Workflow execution error",S={serviceError:k.response.errorInfo}):l.resultDescription="OK",(null===(s=null===(i=k.response)||void 0===i?void 0:i.warningInfo)||void 0===s?void 0:s.length)>0&&(b={serviceError:k.response.warningInfo},M=k.response.warningInfo.map((function(e){return"ErrorCode: ".concat(e.code,", Error: ").concat(e.error,", Retryable: ").concat(e.retryable,", ResourceId: ").concat(e.resourceId)})).join("\n"),l.setDataField("WorkflowWarnings",M)),L(l,C),u.next=21,d.__await({content:null===(a=k.response)||void 0===a?void 0:a.content,error:null!=S?S:void 0,warning:null!=b?b:void 0,finalResponse:null===(f=k.response)||void 0===f?void 0:f.finalResponse});case 21:return u.next=23,u.sent;case 23:u.next=36;break;case 25:return u.prev=25,u.t0=u.catch(1),A=u.t0.message===e.requestCancelledError?m.GetAnnotationsClientErrorCode.RequestCancelled:m.GetAnnotationsClientErrorCode.Unknown,l.setDataField("ClientError","ErrorCode: ".concat(A,", Error: ").concat(u.t0.message)),L(l,null===u.t0||void 0===u.t0?void 0:u.t0.message),u.next=32,d.__await({content:void 0,error:{clientError:{code:A,error:null===u.t0||void 0===u.t0?void 0:u.t0.message}}});case 32:return u.next=34,u.sent;case 34:return y=!0,u.abrupt("break",38);case 36:u.next=0;break;case 38:case"end":return u.stop()}}),g,null,[[1,25]])})))}))}},{key:"isHttpFallback",value:function(){var e=this.sessionManager.getNetworkWorkerManager();return!(!e||e.getInitNetworkMode()!==k.NetworkMode.JSWebSockets||e.getNetworkMode()!==k.NetworkMode.HttpFallback)}},{key:"canBeRetried",value:function(e){return(null==e?void 0:e.code)===m.ErrorResponseCode.TooManyRequests||(null==e?void 0:e.code)===m.ErrorResponseCode.RequestTimeout||e.error.indexOf(m.SendMessageErrorReason.ClientDisconnected)>=0}},{key:"getAuthToken",value:function(e,t){var n={Tickets:[]};this.clientMetadata.docSessionId&&(n.DocSessionId=this.clientMetadata.docSessionId);var o=function(e){if(e===p.AuthTokenType.Substrate)return y.AuthTokenType.Substrate}(e);o&&(n.TokenType=o),this.hostCallbacks.requestAuthToken(n).then((function(n){var o;if(!n)throw new Error("Missing AuthTokenResponse from requestAuthToken");if(!n.Token)throw new Error("Missing Token from requestAuthToken");t(void 0,n.Token,{returnedTokenType:e,timeToLiveSec:null===(o=n.TokenProperties)||void 0===o?void 0:o.timeToLiveSec})})).catch((function(e){t(e)}))}},{key:"resetNextSyncSequenceId",value:function(){this.nextSyncSequenceId=1}},{key:"onReconnect",value:function(){var e=this;if(this.annotationActivationTrackers.forEach((function(t){var n;e.activateAnnotationForTracker(t,{ignoreExistingAnnotations:!0,sendOnlyIfConnected:!0,sendApologies:void 0!==(null===(n=t.options)||void 0===n?void 0:n.apologyCallback)}).catch((function(){}))})),this.reconnectCallbacks.forEach((function(e,t){e()})),!this.connectParams)throw new Error("Expected onConnect before onReconnect")}},{key:"onSessionClose",value:function(e){this.isSessionClosed=!0,this.connectParams=void 0,this.sessionCloseCallbacks.forEach((function(t,n){t(e)}))}},{key:"onConnect",value:function(e,t,n,o,r,i,s,u){var l=new g.Operation({operationName:"OnConnect",success:!0}).setClientMetadata(this.clientMetadata).start();l.setDataField("HasSessionConnected",this.hasSessionConnected),l.setDataField("IsSeedingRequired",e),l.setDataField("SeedingStatus",this.seedingStatus);var c=!1;e&&(this.hasSessionConnected&&(this.allowSeed=!0,this.allowGroupSeed=!0,c=this.changeSeedingStatus(m.SeedingProgressCode.NotStarted,"ReconnectReset",!1),this.seedGroupSize=0,this.batchedSeedMessageGroupSize=0,this.seedBatchedOperationsManager&&(this.seedBatchedOperationsManager.removeAllBatchedItems(),this.seedBatchedOperationsManager=void 0),this.batchedOperationsManager&&(this.batchedOperationsManager.removeAllBatchedItems(),this.batchedOperationsManager=void 0)),this.cachedClaimsChallenge=Object.assign(Object.assign({},this.cachedClaimsChallenge),{claimsVersion:0})),this.enableRemoteExecutionNotification&&!this.hasSessionConnected&&this.addDownstreamWorkflowsIntoClientGraph(i),this.connectParams={isSeedingRequired:e,sessionUrl:t,origin:n,authToken:o,routingSessionKey:s,blobFileId:u},this.hasSessionConnected=!0,this.tryActivateWorkflows();var d,f=(0,a.default)(this.pendingConnectCallbacks);try{for(f.s();!(d=f.n()).done;){(0,d.value)(this.connectParams)}}catch(e){f.e(e)}finally{f.f()}this.connectCallbacks.forEach((function(r,i){r(e,t,n,o,s,u)})),c&&this.triggerSeedingStatusChangeCallbacks(),this.serverInputTypes=r,this.onConnectTelemetryCG&&L(l)}},{key:"onDisconnect",value:function(e){this.connectParams=void 0,this.disconnectCallbacks.forEach((function(t,n){t(e)}))}},{key:"onSeedingStatusChangeMessage",value:function(e,t){t(void 0,new m.Response),this.changeSeedingStatus(e.newStatus,"SeedingStatusChangeMessage")}},{key:"changeSeedingStatus",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=new g.Operation({operationName:"SeedingStatusChange",success:!0}).setClientMetadata(this.clientMetadata).start();return o.setDataField("Status",m.SeedingProgressCode[e]),o.setDataField("Reason",t),L(o),this.seedingStatus!=e&&(this.seedingStatus=e,n&&this.triggerSeedingStatusChangeCallbacks(),!0)}},{key:"triggerSeedingStatusChangeCallbacks",value:function(){var e=this;this.seedingStatusChangeCallbacks.forEach((function(t){t(new m.SeedingStatusChangeMessage({newStatus:e.seedingStatus}))}))}},{key:"onServerAuthenticationStateChange",value:function(e){if(e!=this.serverAuthenticationState){if(this.serverAuthenticationState==m.ServerAuthenticationState.Authenticated&&e==m.ServerAuthenticationState.Pending)return;var t=new g.Operation({operationName:"ServerAuthStateChange",dimension0:m.ServerAuthenticationState[e],dimension1:m.ServerAuthenticationState[this.serverAuthenticationState],success:!0}).setClientMetadata(this.clientMetadata).start();t.resultDescription="Changing Server Authentication State newState: ".concat(m.ServerAuthenticationState[e],", previousState: ").concat(m.ServerAuthenticationState[this.serverAuthenticationState]),L(t),this.serverAuthenticationState=e;var n,o=(0,a.default)(this.serverAuthenticationStateChangeCallback);try{for(o.s();!(n=o.n()).done;){(0,n.value)(this.serverAuthenticationState)}}catch(e){o.e(e)}finally{o.f()}}}},{key:"callAnnotationCallbacks",value:function(e,t,n,o){if(0!==this.annotationCallbacks.size||0!==this.apologyCallbacks.size){var r=o?this.apologyCallbacks.get(t):this.annotationCallbacks.get(t);r&&r.forEach((function(t){t(e,n)}))}}},{key:"getOperationBatchConfig",value:function(e){var t=void 0;t=this.batchMessagesEnabled?function(e){return{input:e,demultiplex:function(){return[[]]}}}:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}};return{delayMs:e.delayMs,delayMsMax:e.delayMsMax,maxInputSize:e.maxInputSize,estimateSize:b.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:t,split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}}},{key:"sendSeedMessagesViaBatchManager",value:function(e,t,n){var o=this;if(!this.seedBatchedOperationsManager){var r=void 0;r=this.batchMessagesEnabled?function(e,t,n){if(o.batchedSeedMessageGroupSize+=e.length,e.length){var r=new m.BatchedMessage;r.messages=[],e.forEach((function(e){r.messages.push(new m.SyncMessage({cv:e.cv,seq:0,ops:e.input,groupId:"Seed",groupSize:t.groupComplete?o.batchedSeedMessageGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}))})),o.sendMessageToSession(r,(function(e){n(e?new Error(e.error):void 0)}))}}:function(e,t,n){o.seedGroupSize++,o.sendMessageToSession(new m.SyncMessage({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:t.groupComplete?o.seedGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}),(function(e){n(e?new Error(e.error):void 0)}))},this.seedBatchedOperationsManager=new _.BatchManager(r,this.reduceBatchOperationsEnabled,this.batchMessagesEnabled,void 0,this.maxNumberOfDeltaUpdateOpsPerItemPerBatchEnabled)}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},n,t)}},{key:"onAnnotationResultsFromServer",value:function(e,t){(0,O.logTelemetryForAnnotation)(e,Date.now(),"ReceiveFromNetwork",!0,new g.Operation({operationName:"AugloopClientPerfTracker",success:!0}).setClientMetadata(this.clientMetadata).start()),this.onAnnotationResults(e,P.ServerWorkflow,t)}},{key:"getLocalRegisteredWorkflows",value:function(){return this.localWorkflowManager?this.localWorkflowManager.getAllRegisteredWorkflowsFromSession(this).map((function(e){return(0,h.getWorkflowDefinitionBase)(e)})):[]}},{key:"sendWorkflowGraphInitMessage",value:function(){var e=this,t=this.getLocalRegisteredWorkflows(),n=new g.Operation({operationName:"WorkflowGraphInit",success:!0}).setClientMetadata(this.clientMetadata).start(),o=new m.WorkflowGraphInitMessage({upstreamRuntimeWorkflows:t});this.sendMessageToSession(o,(function(o,r){o?L(n,o.error):(n.resultDescription="local workflows: ".concat(t.map((function(e){return e.id})),", remote workflows: ").concat(r.downstreamRuntimeWorkflows.map((function(e){return e.id}))),L(n),e.onWorkflowGraphInitResponse(r))}))}},{key:"trySendWorkflowGraphInitMessage",value:function(){var e=this;!this.graphInitMessageTimer&&this.enableRemoteExecutionNotification&&(this.graphInitMessageTimer=setTimeout((function(){e.graphInitMessageTimer=void 0,e.sendWorkflowGraphInitMessage()}),n.graphInitDelayMs))}},{key:"onWorkflowGraphInitResponse",value:function(e){this.addDownstreamWorkflowsIntoClientGraph(e.downstreamRuntimeWorkflows),this.tryActivateWorkflows()}},{key:"addDownstreamWorkflowsIntoClientGraph",value:function(e){this.workflowGraph.removeWorkflows(!0);var t,n=(0,a.default)(e||[]);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.workflowGraph.addWorkflow(o,!0)}}catch(e){n.e(e)}finally{n.f()}this.attachExecutionTrackerToEachWorkflow()}},{key:"resolvePlaceholdersInOperationParentPath",value:function(e){var t=e;return 3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("user_")&&(g.Log.info(540848914,g.LogCategory.CoreDefault,"Replacing user context placeholder for: ".concat((0,v.makeItemPathKey)(e),".")),t=["session","#userContext#"]),3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("tenant_")&&(g.Log.info(540848915,g.LogCategory.CoreDefault,"Replacing tenant context placeholder for: ".concat((0,v.makeItemPathKey)(e),".")),t=["session","#tenantContext#"]),t}},{key:"filterOperationsForSession",value:function(e){return(0,x.isServerOp)(e,this.serverInputTypes)}},{key:"executeCallbacksOnAnnotationSubmitted",value:function(e,t){var n=this,o=this.getAnnotationOperationsByType(e),r=o.annotationOpsMap,i=o.apologyOpsMap;r.forEach((function(e,o){Array.from(e).forEach((function(e){return n.triggerRegisteredAnnotationCallbacks(e,o,t,!1)}))})),i.forEach((function(e,o){Array.from(e).forEach((function(e){return n.triggerRegisteredAnnotationCallbacks(e,o,t,!0)}))}))}},{key:"partitionAnnotationOperations",value:function(e){return e.reduce((function(e,t){var n=(0,s.default)(e,2),o=n[0],r=n[1];return t.items.some((function(e){return e.body&&T.Annotation.typeGuard(e.body)}))?[[].concat((0,i.default)(o),[t]),r]:[o,[].concat((0,i.default)(r),[t])]}),[[],[]])}},{key:"onAnnotationsSubmitted",value:function(e,t){var n=this,o=this.getAnnotationOperationsByType(e),r=o.annotationOpsMap,i=o.apologyOpsMap;r.forEach((function(e,o){var r=Array.from(e);n.onAnnotationResults(new m.AnnotationResultsMessage({annotationType:o,ops:r,cv:t,areApologies:!1}),P.Submitted,(function(){}))})),i.forEach((function(e,o){var r=Array.from(e);n.onAnnotationResults(new m.AnnotationResultsMessage({annotationType:o,ops:r,cv:t,areApologies:!0}),P.Submitted,(function(){}))}))}},{key:"getAnnotationOperationsByType",value:function(e){var t,n=new Map,o=new Map,r=(0,a.default)(e);try{var i=function(){var e,r=t.value,i=(0,a.default)(r.items);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(s.body&&T.Annotation.typeGuard(s.body)){var u=function(e,t){var n=e.get(t)||new Set;n.add(r),e.set(t,n)};T.Apology.typeGuard(s.body)?u(o,s.body.annotationTypeName):u(n,T.SchemaObject.getTypeNameFor(s.body))}}}catch(e){i.e(e)}finally{i.f()}};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}return{annotationOpsMap:n,apologyOpsMap:o}}},{key:"onClaimsChallengeMessage",value:function(e,t){var n,o=this,r=new g.Operation({operationName:"OnClaimsChallengeMessage",dimension0:e.claimsVersion.toString(),dimension1:e.error,success:!0}).setClientMetadata(this.clientMetadata).start(),i=e.claims&&e.claims.length>0;r.resultSignature="HasClaims: ".concat(i),r.resultDescription="Received Claims Challenge Message from Server",L(r),e.claimsVersion>this.cachedClaimsChallenge.claimsVersion&&(this.cachedClaimsChallenge=Object.assign(Object.assign({},e),{actionRequired:!0})),(null===(n=this.gateUtils)||void 0===n?void 0:n.isChangeGateEnabledSync(I.fixIncorrectInvocationOfClaimsCallbackString))?this.requestAuthTokenInteractive(e).then((function(e){m.TokenFailureMessage.typeGuard(e)&&o.invokeClaimsChallengeCallbacks()})).catch((function(){})):this.invokeClaimsChallengeCallbacks(),t(void 0,new m.Response)}},{key:"generateCorrelationId",value:function(){return this.sessionManager.getCorrelationVector().newChild().toString()}},{key:"onTokenProvisionResponse",value:function(e){e&&this.onServerAuthenticationStateChange(m.ServerAuthenticationState.Authenticated)}},{key:"invokeClaimsChallengeCallbacks",value:function(){var e,t=(0,a.default)(this.claimsChallengeCallback);try{for(t.s();!(e=t.n()).done;){(0,e.value)(this.cachedClaimsChallenge)}}catch(e){t.e(e)}finally{t.f()}}},{key:"requestAuthTokenWithClaims",value:function(e){this.requestAuthTokenInteractive(e).catch((function(){}))}},{key:"requestAuthTokenInteractive",value:function(e,t){var n,o=this,r=new g.Operation({operationName:"RequestAuthTokenInteractive",success:!0,dimension0:"isInteractive: ".concat(null!==(n=null==t?void 0:t.interactive)&&void 0!==n&&n)}).start();r.dimension1="HasClaims: ".concat(!!e.claims&&e.claims.length>0);var i={Tickets:[],DocSessionId:this.clientMetadata.docSessionId,TokenType:y.AuthTokenType.Augloop,ConnectParams:this.connectParams,Claims:e.claims,Interactive:null==t?void 0:t.interactive};return this.hostCallbacks.requestAuthToken(i).then((function(t){if(!t)throw new Error("Missing AuthTokenResponse from requestAuthToken claims");if(!t.Token)throw new Error("Missing Token from requestAuthToken claims");return r.resultSignature="Token",new m.TokenProvisionMessage({authToken:t.Token,version:++o.tokenMessageVersion,claimsVersion:e.claimsVersion})})).catch((function(t){return r.resultSignature="NoToken",r.dimension2=t.message,new m.TokenFailureMessage({reason:t.message,version:++o.tokenMessageVersion,claimsVersion:e.claimsVersion,clientHandlesResponse:!0})})).then((function(e){return new Promise((function(t,n){o.sendMessageToSession(e,(function(i,s){L(r,null==i?void 0:i.error),i?n(new Error(i.error)):(m.TokenProvisionMessage.typeGuard(e)&&(o.cachedClaimsChallenge.actionRequired=!1,o.onTokenProvisionResponse(s)),t(e))}))}))}))}},{key:"ensureConnection",value:function(){return Promise.resolve()}},{key:"keepAlive",value:function(){}}])}();n.SessionProxy=D,D.requestCancelledError="Request cancelled"},{105:105,114:114,135:135,152:152,153:153,165:165,180:180,181:181,185:185,190:190,197:197,200:200,204:204,22:22,227:227,24:24,240:240,245:245,25:25,252:252,26:26,30:30,45:45,48:48,51:51,80:80,86:86}],184:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24)),s=o(e(51));Object.defineProperty(n,"__esModule",{value:!0}),n.TelemetryLogger=n.scrubEuiiInUrl=n.setLoggableUrls=n.createOperationLoggingAggregator=void 0;var a=e(86),u=e(105),l=["cloud.dev.microsoft","officeppe.com","cloud.microsoft","office.com","office365.us","ic.gov","microsoft.scloud","microsoftonline.cn"];n.createOperationLoggingAggregator=function(e,t,n,o){return new u.LoggingAggregator(e,(function(e){return e.success&&n.indexOf(e[t])>=0}),[t,"ariaNamespace","resourceId","success","resultSignature","clientDocSessionId","dimension0","dimension1","dimension2","dimension3"],["durationMs"],o)};n.setLoggableUrls=function(e){l.push.apply(l,(0,s.default)(e))};n.scrubEuiiInUrl=function(e){if(!e)return e;for(var t=0,n=l;t<n.length;t++){var o=n[t];if(e.indexOf(o)>=0)return e}return"**redacted**"};var c=function(){function e(t){(0,r.default)(this,e),this.level=a.LoggingLevel.info,this.hostCallbacks=t}return(0,i.default)(e,[{key:"log",value:function(t){var n=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var o,r,i,s=function(t,o,r,i,s){var u=o.charAt(0).toUpperCase()+o.slice(1),l={DocSessionId:t.clientDocSessionId,ResourceId:t.resourceId,ResultDescription:t.resultDescription,ResultSignature:t.resultSignature,Dimension0:t.dimension0,Dimension1:t.dimension1,Dimension2:t.dimension2,Dimension3:t.dimension3,JoinContextId:t.joinContextId,ServerSessionKey:n.serverSessionKey};r&&(l=Object.assign(Object.assign({},l),JSON.parse(r)));var c=i||e.augLoopAriaTenantToken,d=s||c!=e.augLoopAriaTenantToken?s:e.augLoopAriaNamespace;u=u||e.operationNamePlaceholder;var f={CV:t.cv,Duration:1e3*(t.durationMs||0),Count:t.count,AggMode:2,Success:t.success};n.hostCallbacks.sendTelemetryEvent(c,d?"".concat(d,"_").concat(u):u,l,"Office.System.Activity",f,!1,a.DataCategories.ProductServiceUsage|a.DataCategories.ProductServicePerformance,a.DiagnosticLevel.RequiredServiceDataEvent)};if("Workflow.MetricsOnly"==t.category);else if("Operation"===t.eventName){var u=t;s(u,u.operationName,u.dataFields,void 0,u.ariaNamespace)}else if("SessionHealth"===t.eventName){s(t,t.sessionHealthEventName)}else if("WorkflowOperation"===t.eventName){var l=t;s(l,l.operationName,l.dataFields,l.ariaTenant,l.ariaNamespace)}else"Log"===t.eventName&&(o=t.tagId,r=t.traceLevel,i=t.message,n.hostCallbacks.sendDiagnosticTrace&&n.hostCallbacks.sendDiagnosticTrace(o,r,i))}}},{key:"setServerSessionKey",value:function(e){this.serverSessionKey=e}}])}();n.TelemetryLogger=c,c.augLoopAriaTenantToken="3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",c.augLoopAriaNamespace="Office_AugLoop_Client",c.operationNamePlaceholder="OperationNameNotProvided"},{105:105,22:22,24:24,30:30,51:51,86:86}],185:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(51)),i=o(e(25)),s=o(e(22)),a=o(e(24)),u=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.isServerOp=n.getSafeNumber=n.buildArrayOfTypes=n.LogCountLimiter=n.Utils=void 0;var l=e(105),c=e(190),d=e(227),f=u.__importDefault(e(60)),p=function(){return(0,a.default)((function e(){(0,s.default)(this,e)}),null,[{key:"createHealthCheckRequest",value:function(e){return{payload:{},payloadSchema:{category:c.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:c.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:Object.assign(Object.assign({},e),{flights:""})}}},{key:"isFeatureEnabled",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"None";return e&&e.isFeatureEnabled?e.isFeatureEnabled("Microsoft.Office.AugLoop."+t,o).catch((function(){return Promise.resolve(n)})):Promise.resolve(n)}},{key:"isChangeGateEnabled",value:function(e,t){return e&&e.isChangeGateEnabled?e.isChangeGateEnabled(t):Promise.resolve(!1)}},{key:"convertWebSocketUrlToHttp",value:function(e){return this.convertUrl(e,!1)}},{key:"convertServiceUrlToWebSocket",value:function(e){return this.convertUrl(e,!0)}},{key:"convertUrl",value:function(e,t){if(!e)return e;var n=e.split(":"),o=n[0].toLowerCase();return 0==o.indexOf(t?"http":"ws")?(o=t?o.replace("http","ws"):o.replace("ws","http"),n[0]=o,n.join(":")):e}},{key:"deepEquals",value:function(e,t){return(0,f.default)(e,t)}},{key:"collectTelemetry",value:function(e,t,n,o,r,i){var s,a,u,c;e.start(),e.resultSignature=null!=o?o:"",e.resultDescription=null!=r?r:"",e.success=n,i?(e.dimension0=null!==(s=i[0])&&void 0!==s?s:"",e.dimension1=null!==(a=i[1])&&void 0!==a?a:"",e.dimension2=null!==(u=i[2])&&void 0!==u?u:"",e.dimension3=null!==(c=i[3])&&void 0!==c?c:""):(e.dimension0="",e.dimension1="",e.dimension2="",e.dimension3=""),t.log((function(){return l.Log.info(508367457,l.LogCategory.CoreDefault,e.stop())}))}}])}();n.Utils=p,p.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()};var g=function(){return(0,a.default)((function e(t){(0,s.default)(this,e),this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=t}),[{key:"log",value:function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new l.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: ".concat(this.id," reached - all next logs will be dropped")});l.Log.warn(572838107,l.LogCategory.CoreDefault,t)}}}])}();n.LogCountLimiter=g;var h=[d.SchemaObject.getTypeName(),d.Annotation.getTypeName(),d.Signal.getTypeName()];n.buildArrayOfTypes=function(e){var t,n=new Set,o=(0,i.default)(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;if("string"==typeof s)-1===h.indexOf(s)&&n.add(s);else for(var a=0,u=[s.getTypeName()].concat((0,r.default)(s.getBaseTypes()));a<u.length;a++){var l=u[a];-1===h.indexOf(l)&&n.add(l)}}}catch(e){o.e(e)}finally{o.f()}return Array.from(n)};n.getSafeNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number.isFinite(e)?e:t};n.isServerOp=function(e,t){if(!Array.isArray(t)||0===t.length)return!0;if(d.DeltaUpdateOperation.typeGuard(e)||d.UpdateAnnotationMetaDataOperation.typeGuard(e))return!0;var n,o=(0,i.default)(e.items);try{for(o.s();!(n=o.n()).done;){var r=n.value;if(!r.body||d.SchemaObject.matchesTypesFor(r.body,t))return!0}}catch(e){o.e(e)}finally{o.f()}return!1}},{105:105,190:190,22:22,227:227,24:24,25:25,30:30,51:51,60:60}],186:[function(e,t,n){t.exports={version:"DEV"}},{}],187:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.SingleItemWorkflow=void 0;var s=e(86),a=e(185),u=function(){function e(t,n){var o,i,a,u,l,c;(0,r.default)(this,e),this.kind=s.WorkflowKind.SingleItem,this.isStateful=!1,this.id=t,n&&(this.inputTypes=null!==(o=n.inputTypes)&&void 0!==o?o:this.inputTypes,this.outputTypes=null!==(i=n.outputTypes)&&void 0!==i?i:this.outputTypes,this.isStateful=null!==(a=n.isStateful)&&void 0!==a?a:this.isStateful,this.requestedContextTypesRules=null!==(u=n.requestedContextTypesRules)&&void 0!==u?u:this.requestedContextTypesRules,this.definitionOverrideTargetWorkflows=null!==(l=n.definitionOverrideTargetWorkflows)&&void 0!==l?l:this.definitionOverrideTargetWorkflows,this.correlatedSignals=0!==(null===(c=n.correlatedSignals)||void 0===c?void 0:c.length)?n.correlatedSignals:this.correlatedSignals)}return(0,i.default)(e,[{key:"setInputTypes",value:function(e){return this.inputTypes=(0,a.buildArrayOfTypes)(e),this}},{key:"setOutputTypes",value:function(e){return this.outputTypes=(0,a.buildArrayOfTypes)(e),this}},{key:"setStateful",value:function(){return this.isStateful=!0,this}},{key:"setRequestedContexts",value:function(e){var t;return this.requestedContextTypesRules=(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).concat(e),this}},{key:"setLambdaType",value:function(e){return this.factory=e,this}},{key:"setDefinitionOverrideTargetWorkflows",value:function(e){return this.definitionOverrideTargetWorkflows=e,this}},{key:"setCorrelatedSignals",value:function(e){return 0!==e.length&&(this.correlatedSignals=e),this}},{key:"setLambda",value:function(e,t){return this.factory=function(){return{init:t||function(e){return Promise.resolve()},execute:e,dispose:function(){}}},this}},{key:"validateOptions",value:function(){return{isValid:!0}}}],[{key:"create",value:function(t){return new e(t)}}])}();n.SingleItemWorkflow=u},{185:185,22:22,24:24,30:30,86:86}],188:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(51)),i=o(e(22)),s=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowModel=void 0;var a=e(197),u=e(227),l=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.item=t,this.operation=t.op,this.delta=t.delta,this.deltas=t.deltas,this.id=(0,a.makeItemPathKey)(this.itemPath),this.revId=t.revId}),[{key:"itemPath",get:function(){return[].concat((0,r.default)(this.item.parentPath),[this.item.id])}},{key:"getModelIterator",value:function(){throw new Error("Method not implemented.")}},{key:"getBody",value:function(){return this.item.body}},{key:"getItemReference",value:function(){throw new Error("Method not implemented.")}},{key:"getParentItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getParentItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getPrevItem",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getPrevItemBody",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getNextItem",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getNextItemBody",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getChildItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getChildItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getChildItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getChildItemBodies",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItemBodies",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItemBodies",value:function(e){throw new Error("Method not implemented.")}},{key:"addAnnotation",value:function(e,t){throw new Error("Method not implemented.")}},{key:"updateAnnotation",value:function(e,t){throw new Error("Method not implemented.")}},{key:"deleteAnnotation",value:function(e){throw new Error("Method not implemented.")}},{key:"loadSubtree",value:function(e){throw new Error("Method not implemented.")}},{key:"getSourceTimestamp",value:function(){return this.item.sourceTimestamp}},{key:"getContextId",value:function(){return this.item.contextId}}])}(),c=function(){return(0,s.default)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,i.default)(this,e),this.scopeItem=void 0,this.rootItem=void 0,this.normalizeFilter=function(e){if(!e)return function(e){return void 0!==e};if("function"==typeof e)throw new Error("Not implemented yet");if((e.id?1:0)+(e.ids?1:0)+(e.itemType?1:0)+(e.itemTypes?1:0)!=1)throw new Error("Exactly one condition expected on IItemFilter");if(e.itemType)return function(t){return t&&u.SchemaObject.matchesTypesFor(t.body,[e.itemType])};if(e.itemTypes)return function(t){return t&&u.SchemaObject.matchesTypesFor(t.body,e.itemTypes)};throw new Error("Not implemented yet")},this.items=[].concat((0,r.default)(n),[t]),this.scopeItem=new l(t)}),[{key:"getItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getItemBody",value:function(e){return this.getItemBodies(e)[0]}},{key:"getItemBodies",value:function(e){var t=this.normalizeFilter(e);return this.items.filter(t).map((function(e){return e.body}))}},{key:"getItemByReference",value:function(e){throw new Error("Method not implemented.")}},{key:"getItemBodyByReference",value:function(e){throw new Error("Method not implemented.")}}])}();n.WorkflowModel=c},{197:197,22:22,227:227,24:24,30:30,51:51}],189:[function(e,t,n){"use strict";var o,r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.AuthTokenResponseError=n.AuthTokenType=n.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(o||(n.IdentityProvider=o={})),function(e){e[e.Augloop=0]="Augloop",e[e.Substrate=1]="Substrate"}(r||(n.AuthTokenType=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.TokenMissingInteractionRequired=1]="TokenMissingInteractionRequired"}(i||(n.AuthTokenResponseError=i={}))},{}],190:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(189),n),o.__exportStar(e(191),n),o.__exportStar(e(192),n),o.__exportStar(e(193),n),o.__exportStar(e(194),n),o.__exportStar(e(195),n),o.__exportStar(e(196),n)},{189:189,191:191,192:192,193:193,194:194,195:195,196:196}],191:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],192:[function(e,t,n){"use strict";var o,r;Object.defineProperty(n,"__esModule",{value:!0}),n.ExceptionType=n.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(o||(n.MessageType=o={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(r||(n.ExceptionType=r={}))},{}],193:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(o||(n.Ppt=o={}))},{}],194:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],195:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.TextTileEventType||(e.TextTileEventType={}))}(o||(n.Tiling=o={}))},{}],196:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(o||(n.TypeCategory=o={}))},{}],197:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(198),n),o.__exportStar(e(199),n)},{198:198,199:199}],198:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(24)),i=o(e(22)),s=o(e(21)),a=o(e(29)),u=o(e(56));Object.defineProperty(n,"__esModule",{value:!0}),n.NotFoundError=void 0;var l=function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,s.default)(this,t,[e])).__proto__=t.prototype,n}return(0,a.default)(t,e),(0,r.default)(t)}((0,u.default)(Error));n.NotFoundError=l},{21:21,22:22,24:24,29:29,30:30,56:56}],199:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isAncestorOrEqualTo=n.getSafeNumber=n.isValidItemId=n.splitItemPathKey=n.areItemPathsEqual=n.makeItemPathKey=n.shallowCloneItemWithPath=void 0;n.shallowCloneItemWithPath=function(e,t){return Object.assign(Object.assign({},t),{parentPath:e})};n.makeItemPathKey=function(e){return Array.isArray(e)?5===e.length?"".concat(e[0]).concat("\\").concat(e[1]).concat("\\").concat(e[2]).concat("\\").concat(e[3]).concat("\\").concat(e[4]):4===e.length?"".concat(e[0]).concat("\\").concat(e[1]).concat("\\").concat(e[2]).concat("\\").concat(e[3]):3===e.length?"".concat(e[0]).concat("\\").concat(e[1]).concat("\\").concat(e[2]):2===e.length?"".concat(e[0]).concat("\\").concat(e[1]):1===e.length?e[0]:e.join("\\"):"(malformed path)"};n.areItemPathsEqual=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};n.splitItemPathKey=function(e){return e.split("\\")};n.isValidItemId=function(e){return e&&e.length>0&&e.length<100&&e.indexOf("\\")<0};n.getSafeNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number.isFinite(e)?e:t};n.isAncestorOrEqualTo=function(e,t){if(e.length>t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},{}],200:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(201),n),o.__exportStar(e(202),n)},{201:201,202:202}],201:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.GetAnnotationsResponseMessage=n.GetAnnotationsRequestMessage=n.WorkflowDefinitionOverrideMessage=n.SessionCloseResponse=n.TelemetryFlushMessage=n.TelemetryMessage=n.DiagnosticTraceMessage=n.RuntimeInitMessage=n.WorkflowExecutionResponse=n.WorkflowCancellationRequest=n.WorkflowExecutionRequest=n.WorkflowRegistrationMessage=void 0;var s=e(227),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_WorkflowRegistrationMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowRegistrationMessage=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowExecutionRequest"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowExecutionRequest=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowCancellationRequest"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowCancellationRequest=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowExecutionResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowExecutionResponse=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_RuntimeInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.RuntimeInitMessage=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_DiagnosticTraceMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DiagnosticTraceMessage=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_TelemetryMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TelemetryMessage=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_TelemetryFlushMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TelemetryFlushMessage=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_SessionCloseResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionCloseResponse=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_WorkflowDefinitionOverrideMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowDefinitionOverrideMessage=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var v=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_GetAnnotationsRequestMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_StreamingRequest","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetAnnotationsRequestMessage=v,v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_GetAnnotationsResponseMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_StreamingResponse","AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetAnnotationsResponseMessage=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()}},{22:22,227:227,24:24,30:30}],202:[function(e,t,n){"use strict";var o,r;Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationsRequestCaller=n.NetworkMode=n.EXTENSIBLE_WORKFLOW_CONTEXT=void 0,n.EXTENSIBLE_WORKFLOW_CONTEXT="sessionWorkflowContext",function(e){e[e.JSWebSockets=0]="JSWebSockets",e[e.LocalWorkflowsOnly=1]="LocalWorkflowsOnly",e[e.HostWebSockets=2]="HostWebSockets",e[e.HttpFallback=3]="HttpFallback"}(o||(n.NetworkMode=o={})),function(e){e.Workflow="Workflow",e.Client="Client",e.HttpEndpoint="HttpEndpoint"}(r||(n.AnnotationsRequestCaller=r={}))},{}],203:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.ServerAuthenticationState=void 0,function(e){e[e.NotAuthenticated=0]="NotAuthenticated",e[e.Pending=1]="Pending",e[e.Authenticated=2]="Authenticated",e[e.WacUserInfoAuthenticated=3]="WacUserInfoAuthenticated",e[e.TokenMissingInteractionRequired=4]="TokenMissingInteractionRequired"}(o||(n.ServerAuthenticationState=o={}))},{}],204:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(203),n),o.__exportStar(e(205),n),o.__exportStar(e(206),n),o.__exportStar(e(207),n),o.__exportStar(e(208),n),o.__exportStar(e(209),n)},{203:203,205:205,206:206,207:207,208:208,209:209}],205:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.GetHostBridgeSessionResponse=n.GetHostBridgeSessionRequestMessage=n.GetAnnotationsResponseBridgeMessage=n.InteractiveAuthMessage=n.FireSeedingStatusChangeCallbackResponse=n.SetSeedingStatusChangeCallbackMessage=n.FireClaimsChallengeCallbackResponse=n.SetClaimsChallengeCallbackMessage=void 0;var s=e(227),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SetClaimsChallengeCallbackMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SetClaimsChallengeCallbackMessage=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_FireClaimsChallengeCallbackResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.FireClaimsChallengeCallbackResponse=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SetSeedingStatusChangeCallbackMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SetSeedingStatusChangeCallbackMessage=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_FireSeedingStatusChangeCallbackResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.FireSeedingStatusChangeCallbackResponse=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_InteractiveAuthMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.InteractiveAuthMessage=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_GetAnnotationsResponseBridgeMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetAnnotationsResponseBridgeMessage=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_GetHostBridgeSessionRequestMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetHostBridgeSessionRequestMessage=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_GetHostBridgeSessionResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetHostBridgeSessionResponse=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()}},{22:22,227:227,24:24,30:30}],206:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.SubmittedCustomMessage=n.SessionReconnectMessage=n.SessionDisconnectMessage=n.SessionConnectMessage=n.BridgeMessage=n.OAuth2CallbackMessage=n.OAuth2InitResponse=n.OAuth2InitMessage=n.OAuth2InitV2Response=n.OAuth2InitV2Message=n.SeedingStatusChangeMessage=n.WorkflowExecutionCompleteMessage=n.WorkflowGraphInitResponse=n.WorkflowGraphInitMessage=n.KeepAlive=n.TokenProvisionResponse=n.TokenFailureMessage=n.TokenProvisionMessage=n.AnnotationResultsMessage=n.SessionDeleteMessage=n.SyncResponse=n.MicroSyncMessage=n.SyncMessage=n.BatchedMessage=n.AnnotationConfigUpdateResponse=n.AnnotationConfigUpdateMessage=n.AnnotationReleaseResponse=n.AnnotationReleaseMessage=n.AnnotationResultStateMessage=n.AnnotationActivationResponse=n.AnnotationActivationMessage=n.CacheDumpRequestResponse=n.CacheDumpRequestMessage=n.SessionCloseMessage=n.SessionSwapOnClose=n.SessionCloseReason=n.SessionLongPollResponse=n.SessionLongPollMessage=n.SessionInitResponse=n.SessionInitMessage=n.RateLimitErrorResponse=n.TimeoutErrorResponse=n.ErrorResponse=n.GetAnnotationsErrorInfo=n.GetAnnotationsClientError=n.ExecutionError=n.StreamingRequest=n.StreamingResponse=n.Response=n.Message=void 0,n.ExecutionCorrelatedClientResponse=n.GetPluginsMetadataResponse=n.GetPluginsMetadataMessage=n.BlobUploadResponse=n.ClaimsChallengeMessage=n.ServerAuthenticationStateChangeMessage=void 0;var s=e(227),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Message"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Message=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Response"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Response=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_StreamingResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.StreamingResponse=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_StreamingRequest"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.StreamingRequest=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_ExecutionError"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ExecutionError=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_GetAnnotationsClientError"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetAnnotationsClientError=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_GetAnnotationsErrorInfo"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetAnnotationsErrorInfo=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_ErrorResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ErrorResponse=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TimeoutErrorResponse=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_RateLimitErrorResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.RateLimitErrorResponse=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var v=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionInitMessage=v,v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionInitResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionInitResponse=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};var k=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionLongPollMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionLongPollMessage=k,k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};var T=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionLongPollResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionLongPollResponse=T,T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};var S=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionCloseReason"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionCloseReason=S,S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};var b=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionSwapOnClose"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SessionCloseReason"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionSwapOnClose=b,b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()};var C=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionCloseMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionCloseMessage=C,C.H_={T_:C.getTypeName(),B_:C.getBaseTypes()};var w=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.CacheDumpRequestMessage=w,w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};var _=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.CacheDumpRequestResponse=_,_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};var M=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationActivationMessage=M,M.H_={T_:M.getTypeName(),B_:M.getBaseTypes()};var A=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationActivationResponse=A,A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};var O=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationResultStateMessage=O,O.H_={T_:O.getTypeName(),B_:O.getBaseTypes()};var I=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationReleaseMessage=I,I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};var x=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationReleaseResponse=x,x.H_={T_:x.getTypeName(),B_:x.getBaseTypes()};var P=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationConfigUpdateMessage=P,P.H_={T_:P.getTypeName(),B_:P.getBaseTypes()};var L=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationConfigUpdateResponse=L,L.H_={T_:L.getTypeName(),B_:L.getBaseTypes()};var E=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_BatchedMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.BatchedMessage=E,E.H_={T_:E.getTypeName(),B_:E.getBaseTypes()};var D=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SyncMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SyncMessage=D,D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};var R=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_MicroSyncMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.MicroSyncMessage=R,R.H_={T_:R.getTypeName(),B_:R.getBaseTypes()};var N=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SyncResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SyncResponse=N,N.H_={T_:N.getTypeName(),B_:N.getBaseTypes()};var B=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionDeleteMessage=B,B.H_={T_:B.getTypeName(),B_:B.getBaseTypes()};var W=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AnnotationResultsMessage=W,W.H_={T_:W.getTypeName(),B_:W.getBaseTypes()};var j=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TokenProvisionMessage=j,j.H_={T_:j.getTypeName(),B_:j.getBaseTypes()};var F=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_TokenFailureMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TokenFailureMessage=F,F.H_={T_:F.getTypeName(),B_:F.getBaseTypes()};var U=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TokenProvisionResponse=U,U.H_={T_:U.getTypeName(),B_:U.getBaseTypes()};var G=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_KeepAlive"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.KeepAlive=G,G.H_={T_:G.getTypeName(),B_:G.getBaseTypes()};var q=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowGraphInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowGraphInitMessage=q,q.H_={T_:q.getTypeName(),B_:q.getBaseTypes()};var H=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowGraphInitResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowGraphInitResponse=H,H.H_={T_:H.getTypeName(),B_:H.getBaseTypes()};var V=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowExecutionCompleteMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowExecutionCompleteMessage=V,V.H_={T_:V.getTypeName(),B_:V.getBaseTypes()};var z=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SeedingStatusChangeMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SeedingStatusChangeMessage=z,z.H_={T_:z.getTypeName(),B_:z.getBaseTypes()};var K=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitV2Message"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.OAuth2InitV2Message=K,K.H_={T_:K.getTypeName(),B_:K.getBaseTypes()};var J=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitV2Response"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.OAuth2InitV2Response=J,J.H_={T_:J.getTypeName(),B_:J.getBaseTypes()};var Q=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.OAuth2InitMessage=Q,Q.H_={T_:Q.getTypeName(),B_:Q.getBaseTypes()};var Y=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.OAuth2InitResponse=Y,Y.H_={T_:Y.getTypeName(),B_:Y.getBaseTypes()};var X=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2CallbackMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.OAuth2CallbackMessage=X,X.H_={T_:X.getTypeName(),B_:X.getBaseTypes()};var Z=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_BridgeMessage"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.BridgeMessage=Z,Z.H_={T_:Z.getTypeName(),B_:Z.getBaseTypes()};var $=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionConnectMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionConnectMessage=$,$.H_={T_:$.getTypeName(),B_:$.getBaseTypes()};var ee=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionDisconnectMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionDisconnectMessage=ee,ee.H_={T_:ee.getTypeName(),B_:ee.getBaseTypes()};var te=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionReconnectMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SessionReconnectMessage=te,te.H_={T_:te.getTypeName(),B_:te.getBaseTypes()};var ne=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SubmittedCustomMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SubmittedCustomMessage=ne,ne.H_={T_:ne.getTypeName(),B_:ne.getBaseTypes()};var oe=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_ServerAuthenticationStateChangeMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ServerAuthenticationStateChangeMessage=oe,oe.H_={T_:oe.getTypeName(),B_:oe.getBaseTypes()};var re=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_ClaimsChallengeMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ClaimsChallengeMessage=re,re.H_={T_:re.getTypeName(),B_:re.getBaseTypes()};var ie=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_BlobUploadResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.BlobUploadResponse=ie,ie.H_={T_:ie.getTypeName(),B_:ie.getBaseTypes()};var se=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_GetPluginsMetadataMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetPluginsMetadataMessage=se,se.H_={T_:se.getTypeName(),B_:se.getBaseTypes()};var ae=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_GetPluginsMetadataResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GetPluginsMetadataResponse=ae,ae.H_={T_:ae.getTypeName(),B_:ae.getBaseTypes()};var ue=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_ExecutionCorrelatedClientResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ExecutionCorrelatedClientResponse=ue,ue.H_={T_:ue.getTypeName(),B_:ue.getBaseTypes()}},{22:22,227:227,24:24,30:30}],207:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],208:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(45)),s=o(e(51)),a=o(e(22)),u=o(e(24)),l=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.MessageEndpoint=n.extractMessageNameFromTypeName=n.ProcessMessageErrorReason=n.SendMessageErrorReason=void 0;var c,d,f=e(105),p=e(211),g=e(227),h=e(209),y=e(206),v=e(216),m=e(248),k=new p.SettingInstance("processAndRejectMessageEndpointValidation",!1),T=new p.SettingInstance("messageValidationAllowList",[{code:m.ValidationIssueCode.Required,className:"",path:[],message:""},{code:m.ValidationIssueCode.InvalidType,className:"SchemaObjectHeader",path:["config"],message:"SchemaObjectHeader: Expected object, got undefined object for SchemaObjectHeaderValidator"},{code:m.ValidationIssueCode.InvalidType,className:"Item",path:["item","id"],message:'Required field "id" is wrong type'},{code:m.ValidationIssueCode.InvalidType,className:"Item",path:["ops","*","items","0","id"],message:'Required field "id" is wrong type'}]);function S(e){for(var t,n=0,o=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];n<o.length;n++){var r=o[n];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var i=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,i?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.ClientClosed="Client closed",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found",e.TooManyDeltaOperations="SyncMessage with too many delta operations",e.UnsupportedSyncMessageSeq0NonSeeding="SyncMessages with seq 0 are not supported in non seeding sequencer (SenderId)."}(c||(n.SendMessageErrorReason=c={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation.",e.ProvisionTokenDecryptAndTransformError="Token provision message didn't pass token decrypt and transform."}(d||(n.ProcessMessageErrorReason=d={})),n.extractMessageNameFromTypeName=S;var b=function(){return(0,u.default)((function e(t){(0,a.default)(this,e),this.config=t,this.nextMessageId=1,this.pendingResponseCallbacks=new v.Cache({sweepInterval:5e3}),this.messageCallbacks=new Map,this.messageValidators=new Map,this.messageIdPrefix=t.messageIdPrefix,this.source="c"===t.messageIdPrefix?f.SessionHealthSource.ClientRuntime:f.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0};var n=function(e){return e.map((function(e){return{code:(null==e?void 0:e.code)||"",className:(null==e?void 0:e.className)||"",path:(null==e?void 0:e.path)||[]}}))},o=n(T.getDefaultValue()),r=n(T.getValue());T.getDefaultValue()===T.getValue()?this.messageValidationAllowListFull=o:this.messageValidationAllowListFull=[].concat((0,s.default)(o),(0,s.default)(r.filter((function(e){return e.code}))))}),[{key:"setClientMetadata",value:function(e){this.clientMetadata=e}},{key:"setEgress",value:function(e){var t=this;this.egress=e,this.config.resendPendingMessagesOnReconnect&&this.egress&&this.pendingResponseCallbacks.forEach((function(e,n){e.logOp.dimension1=(e.sendCount++).toString(),t.egress(e.message,(function(n){return t.onEgressError(n,e)}))}))}},{key:"ingress",value:function(e,t){y.Response.typeGuard(e)?(this.processResponse(e),t()):this.processMessage(e,t),y.SessionCloseMessage.typeGuard(e)&&!e.reconnectAllowed&&this.clearAllPendingResponses()}},{key:"sendMessage",value:function(e,t,n){var o,r,i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=new f.SessionHealthEvent({sessionHealthEventName:"SendMessage",source:this.source,reason:f.SessionHealthReason.Client,impact:this.source===f.SessionHealthSource.ClientRuntime?f.SessionHealthImpact.MissingInput:f.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:S(g.SchemaObject.getTypeNameFor(e)),dimension0:s.toString()}).start().enableAggregation(),u=function(){if(a.setClientMetadata(i.clientMetadata,!(0,p.ChangeGate)("SendMessageFlights")),a.success)f.Log.info(572836e3,f.LogCategory.CoreDefault,a.stop());else{var e="ErrorWithoutPendingResponse"===a.resultSignature||"ResponseCallbackException"===a.resultSignature||"We called into done callback"!==a.message;a.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),f.Log.error(572836001,f.LogCategory.CoreDefault,a.stop())}};(0,p.ChangeGate)("PersistMessageId")?e.messageId=null!==(o=e.messageId)&&void 0!==o?o:"".concat(this.messageIdPrefix).concat(this.nextMessageId++):e.messageId="".concat(this.messageIdPrefix).concat(this.nextMessageId++),y.BatchedMessage.typeGuard(e)&&e.messages.forEach((function(t,n){return t.messageId=e.messageId+"."+n}));var l=g.SchemaObject.getTypeNameFor(e)===y.SessionCloseMessage.getTypeName(),c=!n&&!l,d={message:e,logOp:a,logEvent:u,callback:void 0,sendCount:1};if(c){d.callback=function(n,o){var r;if(n?(0,p.ChangeGate)("IgnoreUnsupportedMessageErrorForOldClientVersion")&&n.code===h.ErrorResponseCode.UnsupportedMessage?(a.resultSignature="Success",a.resultDescription="Ignore error for ".concat(g.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId).concat(y.SyncMessage.typeGuard(e)?", seq ".concat(e.seq):"",": ").concat(n.error)):(a.success=!1,a.resultSignature=n.error,a.resultDescription="Error for ".concat(g.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId).concat(y.SyncMessage.typeGuard(e)?", seq ".concat(e.seq):"",": ").concat(n.error)):a.resultSignature="Success",t)try{a.message="We called into done callback",t(n,o)}catch(e){a.success=!1,a.resultSignature="ResponseCallbackException",a.resultDescription="Web"===(null===(r=i.clientMetadata)||void 0===r?void 0:r.appPlatform)?JSON.stringify({message:e.message,stack:e.stack}):JSON.stringify({message:e.message})}u(),i.updateSendMessageStats(a.success,a.durationMs,n?new Error(n.error):void 0)};var v=function(){d.callback(new y.TimeoutErrorResponse({code:h.ErrorResponseCode.RequestTimeout,error:"Timeout waiting for response"}),void 0)},m=this.config.responseTimeoutMs;if(y.SessionLongPollMessage.typeGuard(e)){var k=e;m=k.longPollTimeoutHint>=15e3&&k.longPollTimeoutHint<=3e5?k.longPollTimeoutHint+5e3:12e4}else y.StreamingRequest.typeGuard(e)&&(m=null!==(r=e.maxDelayMs)&&void 0!==r?r:12e4);this.pendingResponseCallbacks.put(e.messageId,d,m,v)}this.egress&&this.egress(e,(function(e){return i.onEgressError(e,d)}),s)}},{key:"onEgressError",value:function(e,t){var n,o;if(e){var r=t.message,i=this.pendingResponseCallbacks.get(t.message.messageId);i?(this.pendingResponseCallbacks.del(r.messageId),i.callback(new y.ErrorResponse({messageId:r.messageId,code:h.ErrorResponseCode.EgressError,error:e.message}))):y.SessionCloseMessage.typeGuard(r)?(t.logOp.success=null!==(o=null===(n=e.message)||void 0===n?void 0:n.endsWith("Client disconnected."))&&void 0!==o&&o,t.logOp.resultSignature="ErrorSendingSessionCloseMessage",t.logOp.resultDescription="Error for ".concat(g.SchemaObject.getTypeNameFor(r)," message ").concat(r.messageId,": ").concat(e.message),t.logEvent()):(t.logOp.success=!1,t.logOp.resultSignature="ErrorWithoutPendingResponse",t.logOp.resultDescription="Error for ".concat(g.SchemaObject.getTypeNameFor(r)," message ").concat(r.messageId,": ").concat(e.message),t.logEvent())}}},{key:"queryEgressCacheSize",value:function(){return this.pendingResponseCallbacks.size()}},{key:"onMessage",value:function(e,t,n){this.messageCallbacks.set(e,t),n&&this.messageValidators.set(e,n)}},{key:"onMessageAsync",value:function(e,t,n){var o=this;this.messageCallbacks.set(e,(function(e,n){return l.__awaiter(o,void 0,void 0,(0,i.default)().mark((function o(){var r;return(0,i.default)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,t(e);case 3:r=o.sent,y.ErrorResponse.typeGuard(r)?n(r,void 0):n(void 0,r),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),n(o.t0);case 10:case"end":return o.stop()}}),o,null,[[0,7]])})))})),n&&this.messageValidators.set(e,n)}},{key:"getStats",value:function(){return this.stats}},{key:"hasMessageCallback",value:function(e){return this.messageCallbacks.has(e)}},{key:"cancelPendingResponseCallbacks",value:function(e){var t=this;this.pendingResponseCallbacks.forEach((function(n,o){n&&(t.pendingResponseCallbacks.del(o),n.callback(new y.ErrorResponse({messageId:o,code:h.ErrorResponseCode.Cancelled,error:"Cancelled. Reason: ".concat(e)})))}))}},{key:"clearAllPendingResponses",value:function(){if(0!=this.pendingResponseCallbacks.size()){var e=new f.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size().toString(),success:!0});f.Log.info(572836002,f.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}}},{key:"processMessage",value:function(e,t){var n,o,i,s,a,u=this,l=new f.SessionHealthEvent({sessionHealthEventName:"ProcessMessage",source:this.source,reason:f.SessionHealthReason.Client,impact:this.source===f.SessionHealthSource.ClientRuntime?f.SessionHealthImpact.MissingOutput:f.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start().enableAggregation(),c=function(){if(l.setClientMetadata(u.clientMetadata,!(0,p.ChangeGate)("ProcessMessageFlights")),l.success)f.Log.info(572836003,f.LogCategory.CoreDefault,l.stop());else{var e="UnsupportedMessage"===l.resourceId||"Timeout"===l.resultSignature||"OnResponseInvokedMoreThanOnce"===l.resultSignature||"MessageCallbackException"===l.resultSignature||"We called into messageCallback"!==l.message;l.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),f.Log.error(572836032,f.LogCategory.CoreDefault,l.stop())}},d=this.messageValidators.get(g.SchemaObject.getTypeNameFor(e)),v=(null===(o=null===(n=this.clientMetadata)||void 0===n?void 0:n.userAgent)||void 0===o?void 0:o.startsWith("test-suite"))||(null===(s=null===(i=this.clientMetadata)||void 0===i?void 0:i.userAgent)||void 0===s?void 0:s.startsWith("e2e-test"));if((0,p.ChangeGate)("enableMessageValidation")&&d&&!v){var m=new f.Operation({operationName:"MessageValidationFailure",resourceId:S(g.SchemaObject.getTypeNameFor(e)),success:!1,resultDescription:""},{metricDuration:!0}).start(),T=d.validate(e);if(m.success=T.success,!T.success){var b,C=T.errors,w=!0,_=(0,r.default)(C);try{for(_.s();!(b=_.n()).done;){var M,A=b.value,O=!1,I=(0,r.default)(this.messageValidationAllowListFull);try{var x=function(){var e=M.value;if(A.code!==e.code||e.className||0!==e.path.length){if(A.code===e.code&&A.className===e.className&&A.path.length===e.path.length&&A.path.every((function(t,n){return t===e.path[n]||"*"===e.path[n]})))return O=!0,1}else O=!0};for(I.s();!(M=I.n()).done&&!x(););}catch(e){I.e(e)}finally{I.f()}w=w&&O}}catch(e){_.e(e)}finally{_.f()}w?m.dimension0="ValidationErrorAllowed":(m.dimension0="ValidationErrorNotAllowed",a="Message type ".concat(g.SchemaObject.getTypeNameFor(e)," had a type validation error")),T.errors?(T.errors.length>0&&(m.dimension1=T.errors[0].code),m.setDataFields({errors:JSON.stringify(T.errors)}),m.resultDescription="List of error messages: "+T.errors.map((function(e){return e.message})).join(", ")):(m.setDataFields({errors:"No validation errors provided"}),m.resultDescription="Validation failed with no specific errors"),f.Log.info(504971855,f.LogCategory.CoreDefault,m.stop())}}var P=this.messageCallbacks.get(g.SchemaObject.getTypeNameFor(e));P?(l.resourceId=S(g.SchemaObject.getTypeNameFor(e)),k.getValue()&&a&&(f.Log.error(504729920,f.LogCategory.CoreDefault,"Rejecting message ".concat(e.messageId," due to validation error")),P=function(e,t){t(new y.ErrorResponse({messageId:e.messageId,code:h.ErrorResponseCode.MessageValidationError,error:a}))})):P=function(e,t){l.resourceId=S(g.SchemaObject.getTypeNameFor(e)),"MalformedMessageName"!==l.resourceId&&(l.resourceId="UnsupportedMessage"),t(new y.ErrorResponse({messageId:e.messageId,code:h.ErrorResponseCode.UnsupportedMessage,error:"Message type ".concat(g.SchemaObject.getTypeNameFor(e)," is not supported")}))};var L=function(e,t){return void 0!==t?JSON.stringify({message:e,stack:t}):e},E=!1;try{l.message="We called into messageCallback",P(e,(function(n,o){if(E){l.success=!1,l.resultSignature="OnResponseInvokedMoreThanOnce";var r="Invoked onResponse for ".concat(g.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId," more than once");l.resultDescription=L(r)}else if(n){l.success=!1,l.resultSignature=n.error,void 0!==n.code&&(l.dimension0=h.ErrorResponseCode[n.code]);var i="Error for ".concat(g.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId,": ").concat(n.error);l.resultDescription=L(i)}else l.resultSignature="Success",l.resultDescription=L("");E=!0,c(),n&&!g.SchemaObject.matchesTypesFor(n,[y.ErrorResponse.getTypeName()])&&(n=new y.ErrorResponse({error:"Internal Server Error"})),u.updateProcessMessageStats(l.success,l.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):o?(o.messageId=e.messageId,t(void 0,o)):t()}))}catch(e){l.success=!1,l.resultSignature="MessageCallbackException",l.resultDescription=L(e.message,e.stack),c(),this.updateProcessMessageStats(!1,l.durationMs,e),t()}}},{key:"processResponse",value:function(e){var t,n=new f.Operation({operationName:"ProcessResponse"});if(n.success=!0,n.setClientMetadata(this.clientMetadata),n.start(),e.messageId){var o=this.pendingResponseCallbacks.get(e.messageId),r=null==o?void 0:o.callback;if(r){if(y.StreamingResponse.typeGuard(e)&&!e.finalResponse){var i=o.message.maxDelayMs;this.pendingResponseCallbacks.updateExpireTime(e.messageId,i)}else this.pendingResponseCallbacks.del(e.messageId);g.SchemaObject.matchesTypesFor(e,[y.ErrorResponse.getTypeName()])?r(e):r(void 0,e)}else n.resultSignature="NoPendingMessage",n.resultDescription="".concat(e.messageId),n.success=!1}else n.resultSignature="NoMessageIdSetInResponse",y.ErrorResponse.typeGuard(e)?n.resultDescription=e.error:n.resultDescription="MessageId is not available",n.success=!1;"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&(n.resourceId=S(g.SchemaObject.getTypeNameFor(e)),f.Log.info(572836034,f.LogCategory.CoreDefault,n.stop()))}},{key:"updateSendMessageStats",value:function(e,t,n){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||n?e&&n&&f.Log.warn(572836036,f.LogCategory.CoreDefault,"Succeeded send message provided error object."):f.Log.warn(572836035,f.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(n&&n.message===c.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)}},{key:"updateProcessMessageStats",value:function(e,t,n){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||n?e&&n&&f.Log.warn(572836038,f.LogCategory.CoreDefault,"Succeeded process message provided error object."):f.Log.warn(572836037,f.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(n&&n.message===d.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)}}])}();n.MessageEndpoint=b},{105:105,206:206,209:209,211:211,216:216,22:22,227:227,24:24,248:248,25:25,30:30,45:45,51:51}],209:[function(e,t,n){"use strict";var o,r,i,s,a,u,l;Object.defineProperty(n,"__esModule",{value:!0}),n.SeedingProgressCode=n.AnnotationResultState=n.SessionSwapReason=n.SessionLongPollMessageType=n.ErrorResponseCode=n.GetAnnotationsClientErrorCode=n.ExecutionErrorCode=n.currentProtocolVersion=void 0,n.currentProtocolVersion=2,function(e){e[e.ServerError=0]="ServerError",e[e.WorkflowDisabled=100]="WorkflowDisabled",e[e.TokenNotReady=101]="TokenNotReady",e[e.FlightNotReady=102]="FlightNotReady",e[e.ContextNotReady=103]="ContextNotReady",e[e.WorkflowExcluded=104]="WorkflowExcluded",e[e.WorkflowExecutionTimeout=105]="WorkflowExecutionTimeout",e[e.LambdaExecutionError=106]="LambdaExecutionError",e[e.UnexpectedOutput=107]="UnexpectedOutput",e[e.FailedToFetchInputs=108]="FailedToFetchInputs",e[e.FailedToFetchRequestedContexts=109]="FailedToFetchRequestedContexts"}(o||(n.ExecutionErrorCode=o={})),function(e){e[e.Unknown=0]="Unknown",e[e.InvalidRequest=1]="InvalidRequest",e[e.InvalidResponse=2]="InvalidResponse",e[e.RuntimeNotInitialized=3]="RuntimeNotInitialized",e[e.RequestCancelled=4]="RequestCancelled",e[e.ResponseReceivedAfterFinalResponse=5]="ResponseReceivedAfterFinalResponse"}(r||(n.GetAnnotationsClientErrorCode=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.Found=302]="Found",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.UnprocessableContent=422]="UnprocessableContent",e[e.TooManyRequests=429]="TooManyRequests",e[e.SocketDisconnect=499]="SocketDisconnect",e[e.InternalServerError=500]="InternalServerError",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.UnsupportedMessage=1e3]="UnsupportedMessage",e[e.Cancelled=1001]="Cancelled",e[e.EgressError=1002]="EgressError",e[e.MessageValidationError=1003]="MessageValidationError",e[e.SyncMessageException=2e3]="SyncMessageException",e[e.SyncMessageUnsupported=2001]="SyncMessageUnsupported",e[e.SyncMessageUnexpectedSeed=2002]="SyncMessageUnexpectedSeed",e[e.SyncMessageUnsupportedBatch=2003]="SyncMessageUnsupportedBatch",e[e.SyncMessageQueueFull=2004]="SyncMessageQueueFull",e[e.SyncMessageTooLateOrDuplicate=2005]="SyncMessageTooLateOrDuplicate",e[e.SyncMessageGroupIdMismatch=2006]="SyncMessageGroupIdMismatch",e[e.SyncMessageGroupStop=2007]="SyncMessageGroupStop",e[e.SyncMessageLost=2008]="SyncMessageLost",e[e.SyncMessageUnprocessedDuplicate=2009]="SyncMessageUnprocessedDuplicate",e[e.SyncMessageSessionClosed=2010]="SyncMessageSessionClosed",e[e.SyncMessageAbandoned=2011]="SyncMessageAbandoned",e[e.SyncMessageTooManyDeltaOperations=2012]="SyncMessageTooManyDeltaOperations",e[e.SyncMessageSessionSizeLimitExceeded=2013]="SyncMessageSessionSizeLimitExceeded",e[e.TokenValidationError=2100]="TokenValidationError",e[e.TokenDecryptError=2101]="TokenDecryptError",e[e.TokenTypeError=2102]="TokenTypeError",e[e.TokenUserBlocked=2103]="TokenUserBlocked",e[e.AnnotationActivationInvalidType=2200]="AnnotationActivationInvalidType",e[e.AnnotationReleaseTokenNotFound=2300]="AnnotationReleaseTokenNotFound"}(i||(n.ErrorResponseCode=i={})),function(e){e[e.UnKnown=0]="UnKnown",e[e.Start=1]="Start",e[e.Regular=2]="Regular",e[e.CheckConnection=3]="CheckConnection",e[e.PostEgress=4]="PostEgress",e[e.TimeoutResend=5]="TimeoutResend",e[e.FailResend=6]="FailResend"}(s||(n.SessionLongPollMessageType=s={})),function(e){e[e.IdentityChange=0]="IdentityChange"}(a||(n.SessionSwapReason=a={})),function(e){e[e.Idle=0]="Idle",e[e.Pending=1]="Pending"}(u||(n.AnnotationResultState=u={})),function(e){e[e.NotStarted=0]="NotStarted",e[e.Started=1]="Started",e[e.Incomplete=2]="Incomplete",e[e.Finished=3]="Finished"}(l||(n.SeedingProgressCode=l={}))},{}],210:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChangeGateInternal=n.ChangeGate=void 0;var o=new(e(214).SettingInstance)("disabledChangeGates",[]);n.ChangeGate=function(e,t){for(var r=-1===o.getValue().indexOf(e),i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];return n.ChangeGateInternal.apply(void 0,[r,t].concat(s))};n.ChangeGateInternal=function(e,t){if(!t)return e;if(e){for(var n=arguments.length,o=new Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];return t.apply(void 0,o)}}},{214:214}],211:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(210),n),o.__exportStar(e(214),n)},{210:210,214:214}],212:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.DataListener=void 0;var s=function(){return(0,i.default)((function e(){(0,r.default)(this,e),this.listeners=new Map,this.lastId=0}),[{key:"addListener",value:function(e){if(!e)throw new Error("No callback provided for data listener");return this.listeners.set(this.lastId,e),this.lastId++}},{key:"removeListener",value:function(e){this.listeners.delete(e)}},{key:"notifyListeners",value:function(e){this.listeners.forEach((function(t){t(e)}))}}])}();n.DataListener=s},{22:22,24:24,30:30}],213:[function(e,t,n){"use strict";var o,r=e(30).default,i=r(e(54)),s=r(e(22)),a=r(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigPatchOperationHelper=n.ConfigPatchOperationType=void 0;var u,l=e(105);!function(e){e.Add="Add",e.Remove="Remove",e.Set="Set",e.Delete="Delete"}(u||(n.ConfigPatchOperationType=u={}));var c=function(){function e(){(0,s.default)(this,e)}return(0,a.default)(e,null,[{key:"applyECSPatchOperation",value:function(t,n){var o=!1;if("object"===(0,i.default)(n)||Array.isArray(n))switch(t.operation){case u.Add:case u.Remove:o=e.applyAddOrRemoveOperation(t.path,n,t.value,t.operation);break;case u.Set:o=e.applySetOperation(t.path,n,t.value);break;case u.Delete:o=e.applyDeleteOperation(t.path,n,t.value)}return o?l.Log.verbose(505956121,l.LogCategory.CoreDefault,"PATCH operation succeeded for ".concat(t.operation," on ").concat(t.settingName," with path: ").concat(t.path,".")):l.Log.error(505956122,l.LogCategory.CoreDefault,"PATCH operation failed for ".concat(t.operation," on ").concat(t.settingName," with path: ").concat(t.path)),o}},{key:"applyAddOrRemoveOperation",value:function(e,t,n,o){var r=!1;try{var s=[];if("object"!==(0,i.default)(t)||Array.isArray(t)?Array.isArray(t)&&(s=t):s=e.reduce((function(e,t){return e&&e[t]}),t),Array.isArray(s))if(o===u.Add)s.push(n),r=!0;else if(o===u.Remove){var a=s.indexOf(n);a>=0&&(s.splice(a,1),r=!0)}}catch(e){l.Log.info(505968832,l.LogCategory.CoreDefault,"Exception thrown while applying operation type: ".concat(o," for an array. Error: ").concat(e)),r=!1}return r}},{key:"applySetOperation",value:function(e,t,n){var o=!1;try{var r=e.slice(0,-1),s=e[e.length-1],a={};"object"!==(0,i.default)(t)||Array.isArray(t)||(a=r.reduce((function(e,t){return e&&e[t]}),t),"object"!==(0,i.default)(a)||Array.isArray(a)||(a[s]=n,o=!0))}catch(e){l.Log.info(505968802,l.LogCategory.CoreDefault,"Exception thrown while applying set operation. Error: ".concat(e)),o=!1}return o}},{key:"applyDeleteOperation",value:function(e,t,n){var o=!1;try{var r={};"object"!==(0,i.default)(t)||Array.isArray(t)||(r=e.reduce((function(e,t){return e&&e[t]}),t),"object"!==(0,i.default)(r)||Array.isArray(r)||"string"!=typeof n||r.hasOwnProperty(n)&&(delete r[n],o=!0))}catch(e){l.Log.info(505968801,l.LogCategory.CoreDefault,"Exception thrown while applying delete operation. Error: ".concat(e)),o=!1}return o}}])}();n.ConfigPatchOperationHelper=c,o=c,c.parseECSOperation=function(e,t){if(!t.hasOwnProperty("operationType")||!t.hasOwnProperty("path")||!t.hasOwnProperty("value"))throw new Error("Invalid format for PATCH operation on setting: ".concat(e));var n=t.operationType.toLowerCase(),r=o.convertToConfigPatchOperationType(n);return{settingName:e,path:t.path?t.path.split("."):[],operation:r,value:t.value}},c.convertToConfigPatchOperationType=function(e){switch(e){case"add":return u.Add;case"remove":return u.Remove;case"set":return u.Set;case"delete":return u.Delete;default:throw new Error("Invalid operation type: ".concat(e))}}},{105:105,22:22,24:24,30:30,54:54}],214:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(27)),i=o(e(28)),s=o(e(48)),a=o(e(25)),u=o(e(45)),l=o(e(22)),c=o(e(24)),d=o(e(21)),f=o(e(29)),p=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),n.SettingPatternInstance=n.SettingInstance=n.Setting=n.isValidateCorrectUsageOfGetValue=void 0;var g=e(105),h=p.__importDefault(e(60)),y=e(212),v=e(213);function m(){var e;return void 0!==globalThis.process&&"true"===(null===(e=globalThis.process.env)||void 0===e?void 0:e.VALIDATE_CORRECT_USAGE_OF_GET_VALUE)}n.isValidateCorrectUsageOfGetValue=m;var k=function(e){function t(e){var n;return(0,l.default)(this,t),(n=(0,d.default)(this,t)).name=e,n}return(0,f.default)(t,e),(0,c.default)(t,[{key:"getName",value:function(){return this.name}},{key:"getValue",value:function(){if(m()&&0===this.listeners.size){var e=new Error("SettingInstance or ChangeGate is being used incorrectly. Make sure .getValue() or ChangeGate is called during runtime or there is a listener set up on the setting. For more info visit: ".concat(t.troubleshootUrl));throw e.name="Incorrect usage of getValue()",e}return this.value}},{key:"getValueAdvancedAsync",value:function(e){return p.__awaiter(this,void 0,void 0,(0,u.default)().mark((function n(){var o,r,i,s,a,l;return(0,u.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=new g.Operation({operationName:"ECSGetValueAsync"},{metricDuration:!0}).start(),n.prev=1,n.next=4,t.ecsSettingsProvider.getSettingValue(this.name,e);case 4:return i=n.sent,o.dimension0=i.userAuthenticated?"Authenticated":"Anonymous",o.success=!0,s=i.value,a=i.ecsSection,s||(s=t.tryGetConfigProperty(t.localConfig,this.name).value)&&i.patchValue&&(s=t.applyPatchOperationOnSetting(this.name,s,i.patchValue),a=i.ecsPatchSection),r="Setting value for ".concat(this.name," is ").concat(JSON.stringify(s),".\n Config IDs: ").concat(JSON.stringify(a),"."),n.abrupt("return",s);case 14:return n.prev=14,n.t0=n.catch(1),g.Log.error(505226379,g.LogCategory.CoreDefault,"Exception thrown while getting setting value for ".concat(this.name,". Error: ").concat(n.t0,"\n Error stack trace: ").concat(n.t0.stack)),o.success=!1,l=t.tryGetConfigProperty(t.localConfig,this.name).value,r="Setting value for ".concat(this.name," is ").concat(JSON.stringify(l),"."),n.abrupt("return",l);case 21:return n.prev=21,g.Log.info(506053839,g.LogCategory.CoreDefault,o.stop()),g.Log.info(505821320,g.LogCategory.CoreDefault,r),n.finish(21);case 25:case"end":return n.stop()}}),n,this,[[1,14,21,25]])})))}},{key:"updateValue",value:function(e){return!(0,h.default)(this.value,e)&&(g.Log.info(572837968,g.LogCategory.CoreDefault,"Received new property value for ".concat(this.getName(),":"),e),this.value=e,!0)}}],[{key:"initEcsSettingsProvider",value:function(e){g.Log.info(505999498,g.LogCategory.CoreDefault,"Initializing ECS settings provider."),t.ecsSettingsProvider=e}},{key:"enableEcsPatchConfig",value:function(e){t.ecsPatchConfigEnabled=e}},{key:"getInstance",value:function(e){var n=this.allSettings.get(e);if(!n){n=new t(e);var o=t.tryGetConfigProperty(t.currentConfig,e);o.success&&n.updateValue(o.value),this.allSettings.set(e,n)}return n}},{key:"getPatternInstance",value:function(e){var n=this.allPatternSettings.get(e);if(!n){n={regex:new RegExp(e),setting:new t(e)};var o=t.tryGetConfigPropertyByPattern(t.currentConfig,n.regex);n.setting.updateValue(o),this.allPatternSettings.set(e,n)}return n.setting}},{key:"setNewConfig",value:function(e){t.currentConfig=e,g.Log.info(572837966,g.LogCategory.CoreDefault,"New config: ".concat(JSON.stringify(e))),t.allSettings.forEach((function(e,n){var o=t.tryGetConfigProperty(t.currentConfig,n).value;e.updateValue(o)&&(g.Log.info(572837967,g.LogCategory.CoreDefault,"Setting new value for ".concat(n,": ").concat(o instanceof Object?JSON.stringify(o):o)),e.notifyListeners(o))})),t.allPatternSettings.forEach((function(n,o){var r=t.tryGetConfigPropertyByPattern(e,n.regex);n.setting.updateValue(r)&&(g.Log.info(508432774,g.LogCategory.CoreDefault,"Setting new value for pattern ".concat(o,": ").concat(JSON.stringify(r))),n.setting.notifyListeners(r))}))}},{key:"tryGetConfigProperty",value:function(e,n){return e&&e.hasOwnProperty(n)?{success:!0,value:t.selectApplicableValue(e[n])}:{success:!1,value:void 0}}},{key:"tryGetConfigPropertyByPattern",value:function(e,n){var o=[];if(e){var r,i=Object.getOwnPropertyNames(e).filter((function(e){return n.test(e)})),s=(0,a.default)(i);try{for(s.s();!(r=s.n()).done;){var u=r.value;o.push({name:u,value:t.selectApplicableValue(e[u])})}}catch(e){s.e(e)}finally{s.f()}}return o}},{key:"setGlobalFilter",value:function(e){t.globalFilter=e}},{key:"setLocalConfig",value:function(e){t.localConfig=e,g.Log.info(506053841,g.LogCategory.CoreDefault,"Setting localConfig field in Setting class: ".concat(JSON.stringify(t.localConfig)))}},{key:"clear",value:function(){t.currentConfig=void 0,t.localConfig=void 0,t.allSettings.clear(),t.allPatternSettings.clear(),t.ecsSettingsProvider=void 0}},{key:"selectApplicableValue",value:function(e){var n;if(e){var o=e.find((function(e){return!t.globalFilter||t.globalFilter(e)}));o&&(n=o.value)}return n}},{key:"applyPatchOperationsOnConfig",value:function(e){try{if(!t.ecsPatchConfigEnabled)return e;var n=this.tryGetConfigProperty(e,"patchOperations").value;if(!n||0===n.length)return e;for(var o=[],r=0,i=Object.entries(n);r<i.length;r++){var a=(0,s.default)(i[r],2),u=a[0],l=a[1];try{o.push(v.ConfigPatchOperationHelper.parseECSOperation(u,l))}catch(e){g.Log.error(505734922,g.LogCategory.CoreDefault,"Exception thrown while parsing ECS PATCH operation for setting: ".concat(u,". Error: ").concat(e));continue}}for(var c=new Map,d=0,f=o;d<f.length;d++){var p=f[d];if(null==e?void 0:e.hasOwnProperty(p.settingName)){var h=JSON.parse(JSON.stringify(e[p.settingName])),y=t.selectApplicableValue(h);v.ConfigPatchOperationHelper.applyECSPatchOperation(p,y)&&(c.set(p.settingName,y),e[p.settingName]=h)}}if(c.size>0){var m={};c.forEach((function(e,t){m[t]=e})),g.Log.info(505788322,g.LogCategory.CoreDefault,"Resulting settings after PATCHes were applied: ".concat(JSON.stringify(m)))}return e}catch(t){return g.Log.error(505788321,g.LogCategory.CoreDefault,"Exception thrown while applying ECS PATCH operations. Error: ".concat(t)),e}}},{key:"applyPatchOperationOnSetting",value:function(e,n,o){try{if(!t.ecsPatchConfigEnabled)return n;var r=JSON.parse(JSON.stringify(n)),i=o,s=v.ConfigPatchOperationHelper.parseECSOperation(e,i);return v.ConfigPatchOperationHelper.applyECSPatchOperation(s,r),r}catch(e){return g.Log.error(505788323,g.LogCategory.CoreDefault,"Exception thrown while applying ECS PATCH operation on setting. Error: ".concat(e)),n}}}])}(y.DataListener);n.Setting=k,k.allSettings=new Map,k.allPatternSettings=new Map,k.ecsPatchConfigEnabled=!1,k.troubleshootUrl="https://eng.ms/docs/experiences-devices/opg/office-ai/augloop-ai-platform/augmentation-loop/documentation/server-workflow-tutorials/settings/troubleshoot";var T=function(e){function t(e,n){var o;return(0,l.default)(this,t),(o=(0,d.default)(this,t)).listenerId=NaN,o.defaultValue=n,o.setting=k.getInstance(e),o}return(0,f.default)(t,e),(0,c.default)(t,[{key:"getDefaultValue",value:function(){return this.defaultValue}},{key:"addListener",value:function(e){var n=this;return Number.isNaN(this.listenerId)&&(this.listenerId=this.setting.addListener((function(){n.notifyListeners(n.getValue())}))),(0,r.default)((0,i.default)(t.prototype),"addListener",this).call(this,e)}},{key:"removeListener",value:function(e){(0,r.default)((0,i.default)(t.prototype),"removeListener",this).call(this,e),0!==this.listeners.size||Number.isNaN(this.listenerId)||(this.setting.removeListener(this.listenerId),this.listenerId=NaN)}},{key:"getValue",value:function(){var e=this.setting.getValue();return void 0===e?this.defaultValue:e}},{key:"getValueAdvancedAsync",value:function(e){return p.__awaiter(this,void 0,void 0,(0,u.default)().mark((function t(){var n;return(0,u.default)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.setting.getValueAdvancedAsync(e);case 2:return n=t.sent,t.abrupt("return",void 0===n?this.defaultValue:n);case 4:case"end":return t.stop()}}),t,this)})))}}])}(y.DataListener);n.SettingInstance=T;var S=function(e){function t(e){var n;return(0,l.default)(this,t),(n=(0,d.default)(this,t)).listenerId=NaN,n.setting=k.getPatternInstance(e),n}return(0,f.default)(t,e),(0,c.default)(t,[{key:"addListener",value:function(e){var n=this;return Number.isNaN(this.listenerId)&&(this.listenerId=this.setting.addListener((function(){n.notifyListeners(n.getValue())}))),(0,r.default)((0,i.default)(t.prototype),"addListener",this).call(this,e)}},{key:"removeListener",value:function(e){(0,r.default)((0,i.default)(t.prototype),"removeListener",this).call(this,e),0!==this.listeners.size||Number.isNaN(this.listenerId)||(this.setting.removeListener(this.listenerId),this.listenerId=NaN)}},{key:"getValue",value:function(){var e=this.setting.getValue();return void 0===e?[]:e}}])}(y.DataListener);n.SettingPatternInstance=S},{105:105,21:21,212:212,213:213,22:22,24:24,25:25,27:27,28:28,29:29,30:30,45:45,48:48,60:60}],215:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var s=function(){function e(t){if((0,r.default)(this,e),this.cache=new Map,this.options=t||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return(0,i.default)(e,[{key:"put",value:function(e,t,n,o,r,i,s){if(null==n||n<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var a={value:t,lastUsed:r?Date.now():void 0,expire:n+Date.now(),idleDurationMs:r,expireCallback:o,expiringTriggerTime:i+Date.now(),expiringCallback:s};return this.cache.set(e,a),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t}},{key:"del",value:function(e){if(this.options.delCallback){var t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}var n=this.cache.delete(e);return 0===this.size()&&this.clear(),n}},{key:"clear",value:function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()}},{key:"get",value:function(e){var t=this.cache.get(e);if(t){if(this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.expire<Date.now()&&(this.del(e),t.expireCallback&&t.expireCallback(e,t.value),!(t=this.cache.get(e))))return;return t.value}}},{key:"keys",value:function(){return this.cache.keys()}},{key:"forEach",value:function(e){this.cache.forEach((function(t,n){e(t.value,n)}))}},{key:"size",value:function(){return this.cache.size}},{key:"updateExpireTime",value:function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)}},{key:"onInterval",value:function(){var t=this,n=Date.now();this.cache.forEach((function(o,r){try{if(o.idleDurationMs&&o.lastUsed<n-o.idleDurationMs)return t.del(r),void(t.options.idleCallback&&t.options.idleCallback(r,o.value));o.expire<n&&(t.del(r),o.expireCallback&&o.expireCallback(r,o.value)),o.expiringTriggerTime<n&&o.expiringCallback&&(o.expiringCallback(r,o.value),o.expiringCallback=void 0)}catch(t){e.logIntervalError&&e.logIntervalError(t)}}))}}],[{key:"setLogIntervalError",value:function(t){e.logIntervalError=t}}])}();n.Cache=s},{22:22,24:24,30:30}],216:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(215),n)},{215:215}],217:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.AnnotationMetaDataChangeEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.sessionKey="",e.prototype.annotationType="",e.prototype.annotationState=0,e.prototype.workflowId="",e.prototype.traceId="",e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/AnnotationMetaDataChangeEvent"},e}(),t.exports=r},{}],218:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(217),n),o.__exportStar(e(219),n),o.__exportStar(e(220),n),o.__exportStar(e(221),n)},{217:217,219:219,220:220,221:221}],219:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.OperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.traceId="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultJSON="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.userTenantId="",e.prototype.joinContextId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e.prototype.dataFields="",e.prototype.userDataBoundaryType="",e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/OperationEvent"},e}(),t.exports=r},{}],220:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.SessionHealthEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.traceId="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.userTenantId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.subReason="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.joinContextId="",e.prototype.userDataBoundaryType="",e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionHealthEvent"},e}(),t.exports=r},{}],221:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.WorkflowOperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.traceId="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.userTenantId="",e.prototype.workflow="",e.prototype.joinContextId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e.prototype.dataFields="",e.prototype.userDataBoundaryType="",e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/WorkflowOperationEvent"},e}(),t.exports=r},{}],222:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],223:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(222),n),o.__exportStar(e(224),n),o.__exportStar(e(225),n)},{222:222,224:224,225:225}],224:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.TextChatMessage=n.ChatMessage=n.MessagesHolder=n.Chat=n.ChatsHolder=void 0;var s=e(227),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_ChatsHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ChatsHolder=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_Chat"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Chat=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_MessagesHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.MessagesHolder=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_ChatMessage"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ChatMessage=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_TextChatMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Chat_ChatMessage"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TextChatMessage=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()}},{22:22,227:227,24:24,30:30}],225:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],226:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(o||(n.AnnotationState=o={}))},{}],227:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(226),n),o.__exportStar(e(228),n),o.__exportStar(e(229),n),o.__exportStar(e(230),n),o.__exportStar(e(231),n),o.__exportStar(e(232),n),o.__exportStar(e(233),n),o.__exportStar(e(234),n),o.__exportStar(e(236),n),o.__exportStar(e(235),n),o.__exportStar(e(237),n),o.__exportStar(e(238),n)},{226:226,228:228,229:229,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238}],228:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsChallengeAnnotation=n.ExecutionCorrelatedAnnotation=n.StreamAnnotation=n.BinaryClassificationAnnotation=n.Annotation=void 0;var s=e(231),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_Annotation"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Annotation=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_BinaryClassificationAnnotation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.BinaryClassificationAnnotation=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_StreamAnnotation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.StreamAnnotation=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_ExecutionCorrelatedAnnotation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ExecutionCorrelatedAnnotation=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_ClaimsChallengeAnnotation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ClaimsChallengeAnnotation=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()}},{22:22,231:231,24:24,30:30}],229:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.NotActivatedWorkflowApology=n.AuthTokenIsMissingDetails=n.WorkflowActivationFailureDetails=n.SecondaryApology=n.Apology=void 0;var s=e(231),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_Apology"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Apology=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_SecondaryApology"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Apology","AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SecondaryApology=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_WorkflowActivationFailureDetails"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.WorkflowActivationFailureDetails=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_AuthTokenIsMissingDetails"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_WorkflowActivationFailureDetails"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AuthTokenIsMissingDetails=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_NotActivatedWorkflowApology"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Apology","AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.NotActivatedWorkflowApology=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()}},{22:22,231:231,24:24,30:30}],230:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.CancelSignalTriggeredWorkflowExecutionOperation=n.SignalOperation=n.MicroSyncOperation=n.DeltaUpdateOperation=n.VisibilityOperation=n.FocusOperation=n.PurgeByTypesOperation=n.PurgeSubtreeExceptTypesOperation=n.PurgeOperation=n.DeleteOperation=n.UpdateOperation=n.UpdateAnnotationMetaDataOperation=n.MoveOperation=n.AddOperation=n.OperationWithSiblingContext=n.Operation=n.ItemChangesDelta=n.ItemDelta=void 0;var s=e(231),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ItemDelta"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ItemDelta=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ItemChangesDelta"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ItemDelta"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ItemChangesDelta=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Operation"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Operation=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_OperationWithSiblingContext"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.OperationWithSiblingContext=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_AddOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.AddOperation=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_MoveOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.MoveOperation=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.UpdateAnnotationMetaDataOperation=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UpdateOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.UpdateOperation=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DeleteOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DeleteOperation=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_PurgeOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.PurgeOperation=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var v=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_PurgeSubtreeExceptTypesOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.PurgeSubtreeExceptTypesOperation=v,v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_PurgeByTypesOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.PurgeByTypesOperation=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};var k=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_FocusOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.FocusOperation=k,k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};var T=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_VisibilityOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.VisibilityOperation=T,T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};var S=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DeltaUpdateOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DeltaUpdateOperation=S,S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};var b=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_MicroSyncOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.MicroSyncOperation=b,b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()};var C=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Signals_SignalOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SignalOperation=C,C.H_={T_:C.getTypeName(),B_:C.getBaseTypes()};var w=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_CancelSignalTriggeredWorkflowExecutionOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.CancelSignalTriggeredWorkflowExecutionOperation=w,w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()}},{22:22,231:231,24:24,30:30}],231:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(25)),i=o(e(51)),s=o(e(22)),a=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.SchemaObject=void 0;var u=function(){function e(t){(0,s.default)(this,e),e.assign(e,this,t)}return(0,a.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_SchemaObject"}},{key:"getBaseTypes",value:function(){return[]}},{key:"getTypeNameFor",value:function(e){return e&&e.H_?e.H_.T_:void 0}},{key:"getBaseTypesFor",value:function(e){return e&&e.H_&&e.H_.B_&&Array.isArray(e.H_.B_)?e.H_.B_:[]}},{key:"getAllTypesFor",value:function(t){var n=e.getTypeNameFor(t);return n?[n].concat((0,i.default)(e.getBaseTypesFor(t))):[]}},{key:"matchesTypesFor",value:function(t,n){if(!Array.isArray(n)||0===n.length)return!0;var o,i=e.getTypeNameFor(t),s=e.getBaseTypesFor(t),a=(0,r.default)(n);try{for(a.s();!(o=a.n()).done;){var u=o.value;if(u===i)return!0;if(s.indexOf(u)>=0)return!0}}catch(e){a.e(e)}finally{a.f()}return!1}},{key:"assign",value:function(e,t,n){if(n)for(var o=0,r=Object.keys(n);o<r.length;o++){var i=r[o];t[i]=n[i]}return t.H_=e.H_,t}}])}();n.SchemaObject=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},{22:22,24:24,25:25,30:30,51:51}],232:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.DirtyDocumentSignal=n.DirtyAreaSignal=n.Signal=void 0;var s=e(231),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Signals_Signal"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Signal=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DirtyAreaSignal"}},{key:"getBaseTypes",value:function(){return["AugLoop_Signals_Signal"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DirtyAreaSignal=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DirtyDocumentSignal"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_DirtyAreaSignal","AugLoop_Signals_Signal"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DirtyDocumentSignal=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()}},{22:22,231:231,24:24,30:30}],233:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.UserCommandsHolder=n.EventsHolder=n.TenantContextHolder=n.UserContextHolder=n.ContextHolder=n.DynamicContext=n.ItemFilter=n.GridNeighborhoodContext=n.GridCell=n.SubDocument=n.Document=n.Session=n.TileGroup=n.Binary=n.Blob=n.BlobContainer=void 0;var s=e(231),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_BlobContainer"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.BlobContainer=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Blob"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Blob=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Binary"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Binary=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_TileGroup"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TileGroup=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Session"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Session=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Document"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.Document=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_SubDocument"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.SubDocument=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_GridCell"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GridCell=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_GridNeighborhoodContext"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.GridNeighborhoodContext=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ItemFilter"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ItemFilter=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var v=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DynamicContext"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DynamicContext=v,v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ContextHolder"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.ContextHolder=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};var k=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UserContextHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ContextHolder"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.UserContextHolder=k,k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};var T=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_TenantContextHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ContextHolder"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TenantContextHolder=T,T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};var S=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_EventsHolder"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.EventsHolder=S,S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};var b=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UserCommandsHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_EventsHolder"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.UserCommandsHolder=b,b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()}},{22:22,231:231,24:24,30:30}],234:[function(e,t,n){"use strict";var o,r,i,s;Object.defineProperty(n,"__esModule",{value:!0}),n.OperationErrorCode=n.ItemChanges=n.ItemOperation=n.EntryPoint=void 0,function(e){e.Unknown="Unknown",e.Canvas="Canvas",e.CopilotChat="CopilotChat",e.Test="Test"}(o||(n.EntryPoint=o={})),function(e){e[e.None=0]="None",e[e.Added=1]="Added",e[e.Updated=2]="Updated",e[e.Deleted=3]="Deleted"}(r||(n.ItemOperation=r={})),function(e){e[e.ContentChanged=0]="ContentChanged",e[e.ContentWasEmpty=1]="ContentWasEmpty",e[e.FormattingChanged=2]="FormattingChanged",e[e.ContentWasInsideOfTheTable=3]="ContentWasInsideOfTheTable"}(i||(n.ItemChanges=i={})),function(e){e[e.AddOfZeroElements=0]="AddOfZeroElements",e[e.AddOfItemsWithExtraOrMissingIds=1]="AddOfItemsWithExtraOrMissingIds",e[e.AddOfItemWithUndefinedId=2]="AddOfItemWithUndefinedId",e[e.AddOfUndefinedItem=3]="AddOfUndefinedItem",e[e.AddOfItemsWithDuplicateIds=4]="AddOfItemsWithDuplicateIds",e[e.SetHeadToNonExistingItem=5]="SetHeadToNonExistingItem",e[e.DeleteOfNonExistingItem=6]="DeleteOfNonExistingItem",e[e.UpdateOfNonExistentItem=7]="UpdateOfNonExistentItem",e[e.UpdateOfStubbedItem=8]="UpdateOfStubbedItem",e[e.MoveOfNonExistentItem=9]="MoveOfNonExistentItem",e[e.UpdateMetaDataOfNonAnnotationType=10]="UpdateMetaDataOfNonAnnotationType",e[e.SequentialyInvertedUpdate=11]="SequentialyInvertedUpdate",e[e.MoveToTheSamePath=12]="MoveToTheSamePath",e[e.UnknownOperation=13]="UnknownOperation",e[e.DeltaOfNonExistingItem=100]="DeltaOfNonExistingItem"}(s||(n.OperationErrorCode=s={}))},{}],235:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],236:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],237:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],238:[function(e,t,n){"use strict";var o,r,i=e(30).default,s=i(e(24)),a=i(e(22));Object.defineProperty(n,"__esModule",{value:!0}),n.GridConstants=n.OpenType=n.BlobRefType=n.ecsMetadataBlockWidth=n.ecsMetadataBlockHeight=void 0,n.ecsMetadataBlockHeight=512,n.ecsMetadataBlockWidth=32,function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl",e[e.AlCodedLocation=2]="AlCodedLocation",e[e.Token=3]="Token",e[e.SpeAlCodedLocation=4]="SpeAlCodedLocation"}(o||(n.BlobRefType=o={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(r||(n.OpenType=r={}));var u=(0,s.default)((function e(){(0,a.default)(this,e)}));n.GridConstants=u,u.lowerIndexBound=1,u.maxNumberOfRows=1048576,u.maxNumberOfColumns=16384,u.firstColumnName="A",u.lastColumnName="XFD"},{22:22,24:24,30:30}],239:[function(e,t,n){"use strict";var o,r,i,s;Object.defineProperty(n,"__esModule",{value:!0}),n.CritiqueCategory=n.SuggestionAction=n.CritiqueAction=n.Priority=void 0,function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low",e[e.Informational=3]="Informational"}(o||(n.Priority=o={})),function(e){e[e.NotificationOnly=0]="NotificationOnly",e[e.Delete=1]="Delete",e[e.Ignore=2]="Ignore",e[e.IgnoreAll=4]="IgnoreAll",e[e.IgnoreCritiqueType=8]="IgnoreCritiqueType",e[e.AddToDictionary=16]="AddToDictionary",e[e.ShowDetails=32]="ShowDetails"}(r||(n.CritiqueAction=r={})),function(e){e[e.None=0]="None",e[e.ChangeOnce=1]="ChangeOnce",e[e.ChangeAll=2]="ChangeAll",e[e.AutoCorrect=4]="AutoCorrect",e[e.ReadAloud=8]="ReadAloud",e[e.PersonalizedAutoCorrect=16]="PersonalizedAutoCorrect"}(i||(n.SuggestionAction=i={})),function(e){e[e.None=0]="None",e[e.CAT_Spelling=1]="CAT_Spelling",e[e.CAT_Grammar=2]="CAT_Grammar",e[e.CAT_Clarity=3]="CAT_Clarity",e[e.CAT_Conciseness=4]="CAT_Conciseness",e[e.CAT_Formality=5]="CAT_Formality",e[e.CAT_Inclusiveness=6]="CAT_Inclusiveness",e[e.CAT_PunctuationConventions=7]="CAT_PunctuationConventions",e[e.CAT_Resume=8]="CAT_Resume",e[e.CAT_SensitiveGeopoliticalReferences=9]="CAT_SensitiveGeopoliticalReferences",e[e.CAT_Vocabulary=10]="CAT_Vocabulary",e[e.CAT_ConsistentWrittenForms=11]="CAT_ConsistentWrittenForms",e[e.CAT_ErrorCorrections=12]="CAT_ErrorCorrections",e[e.CAT_WritingConventions=13]="CAT_WritingConventions",e[e.CAT_Acronyms=14]="CAT_Acronyms",e[e.CAT_Perspectives=15]="CAT_Perspectives",e[e.CAT_UncommonWords=16]="CAT_UncommonWords",e[e.CAT_TypingErrors=17]="CAT_TypingErrors",e[e.CAT_Rewrite=18]="CAT_Rewrite"}(s||(n.CritiqueCategory=s={}))},{}],240:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(239),n),o.__exportStar(e(241),n),o.__exportStar(e(242),n),o.__exportStar(e(243),n),o.__exportStar(e(244),n)},{239:239,241:241,242:242,243:243,244:244}],241:[function(e,t,n){"use strict";var o,r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.TextTileChangeSource=n.TextTileDeltaUnit=n.TextTileDeltaType=void 0,function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete",e[e.Update=2]="Update",e[e.CursorUpdate=3]="CursorUpdate",e[e.FormattingUpdate=4]="FormattingUpdate",e[e.OtherNonContentUpdate=5]="OtherNonContentUpdate",e[e.AttributionUpdate=6]="AttributionUpdate"}(o||(n.TextTileDeltaType=o={})),function(e){e[e.Chars=0]="Chars",e[e.Word=1]="Word",e[e.PartialSentence=2]="PartialSentence",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(r||(n.TextTileDeltaUnit=r={})),function(e){e[e.SessionUser=0]="SessionUser",e[e.Programmatic=1]="Programmatic",e[e.Collaborator=2]="Collaborator"}(i||(n.TextTileChangeSource=i={}))},{}],242:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.FormattedTextTileDelta=n.TextTileDelta=void 0;var s=e(227),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_TextTileDelta"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ItemDelta"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TextTileDelta=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_FormattedTextTileDelta"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTileDelta","AugLoop_Core_ItemDelta"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.FormattedTextTileDelta=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},{22:22,227:227,24:24,30:30}],243:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24));Object.defineProperty(n,"__esModule",{value:!0}),n.CommentTile=n.LinkTile=n.DateTile=n.PersonTile=n.TaskTile=n.DynamicTextContext=n.InlineTile=n.FormattedTextTile=n.TextTile=void 0;var s=e(227),a=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_TextTile"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TextTile=a,a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_FormattedTextTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.FormattedTextTile=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_InlineTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.InlineTile=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_DynamicTextContext"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_DynamicContext"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DynamicTextContext=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_TaskTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_FormattedTextTile","AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.TaskTile=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_PersonTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_InlineTile","AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.PersonTile=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_DateTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_InlineTile","AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.DateTile=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_LinkTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_InlineTile","AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.LinkTile=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),s.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_CommentTile"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return s.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}])}();n.CommentTile=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()}},{22:22,227:227,24:24,30:30}],244:[function(e,t,n){"use strict";var o,r,i,s,a,u,l,c,d,f,p;Object.defineProperty(n,"__esModule",{value:!0}),n.ParagraphReadingDirection=n.SpecialIndentType=n.ObjectType=n.Alignment=n.UnderlineType=n.CapsType=n.FontWeight=n.ListType=n.CommentStatus=n.CommentReaction=n.AnchorMode=void 0,function(e){e[e.Unspecified=0]="Unspecified",e[e.Inline=1]="Inline",e[e.Floating=2]="Floating"}(o||(n.AnchorMode=o={})),function(e){e[e.ThumbsUp=0]="ThumbsUp"}(r||(n.CommentReaction=r={})),function(e){e[e.Active=0]="Active",e[e.Resolved=1]="Resolved",e[e.Closed=2]="Closed"}(i||(n.CommentStatus=i={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered",e[e.Lim=3]="Lim",e[e.Nil=4]="Nil",e[e.Any=5]="Any",e[e.NoList=6]="NoList",e[e.Invalid=7]="Invalid"}(s||(n.ListType=s={})),function(e){e[e.DontCare=1]="DontCare",e[e.Thin=2]="Thin",e[e.ExtraLight=3]="ExtraLight",e[e.Light=4]="Light",e[e.Normal=5]="Normal",e[e.Medium=6]="Medium",e[e.SemiBold=7]="SemiBold",e[e.Bold=8]="Bold",e[e.ExtraBold=9]="ExtraBold",e[e.Heavy=10]="Heavy"}(a||(n.FontWeight=a={})),function(e){e[e.NoCaps=0]="NoCaps",e[e.SmallCaps=1]="SmallCaps",e[e.AllCaps=2]="AllCaps",e[e.AllPetiteCaps=3]="AllPetiteCaps",e[e.PetiteCaps=4]="PetiteCaps",e[e.Unicase=5]="Unicase",e[e.Titling=6]="Titling",e[e.Other=7]="Other"}(u||(n.CapsType=u={})),function(e){e[e.None=0]="None",e[e.Words=1]="Words",e[e.SingleLine=2]="SingleLine",e[e.DoubleLine=3]="DoubleLine",e[e.HeavyLine=4]="HeavyLine",e[e.DottedLine=5]="DottedLine",e[e.DottedHeavyLine=6]="DottedHeavyLine",e[e.DashLine=7]="DashLine",e[e.DashHeavyLine=8]="DashHeavyLine",e[e.DashLongLine=9]="DashLongLine",e[e.DashLongHeavyLine=10]="DashLongHeavyLine",e[e.DotDashLine=11]="DotDashLine",e[e.DotDashHeavyLine=12]="DotDashHeavyLine",e[e.DotDotDashLine=13]="DotDotDashLine",e[e.DotDotDashHeavyLine=14]="DotDotDashHeavyLine",e[e.WavyLine=15]="WavyLine",e[e.WavyHeavyLine=16]="WavyHeavyLine",e[e.WavyDoubleLine=17]="WavyDoubleLine"}(l||(n.UnderlineType=l={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justified=3]="Justified",e[e.Other=4]="Other",e[e.None=5]="None",e[e.JustifyLow=6]="JustifyLow",e[e.Distributed=7]="Distributed",e[e.ThaiDistributed=8]="ThaiDistributed"}(c||(n.Alignment=c={})),function(e){e[e.Image=0]="Image",e[e.TextBox=1]="TextBox",e[e.Chart=2]="Chart",e[e.SmartArt=3]="SmartArt",e[e.Drawing=4]="Drawing",e[e.EquationObject=5]="EquationObject",e[e.Ink=6]="Ink",e[e.InkSpace=7]="InkSpace",e[e.InkEndOfLine=8]="InkEndOfLine",e[e.LineBreak=9]="LineBreak",e[e.PageBreak=10]="PageBreak",e[e.PageNumbers=11]="PageNumbers",e[e.FootnoteEndnote=12]="FootnoteEndnote",e[e.FootnoteEndnoteReferenceMark=13]="FootnoteEndnoteReferenceMark",e[e.Tab=14]="Tab",e[e.UnsupportedObject=15]="UnsupportedObject",e[e.Other=16]="Other",e[e.Person=17]="Person",e[e.Date=18]="Date"}(d||(n.ObjectType=d={})),function(e){e[e.Initial=0]="Initial",e[e.FirstLine=1]="FirstLine",e[e.Hanging=2]="Hanging"}(f||(n.SpecialIndentType=f={})),function(e){e[e.LeftToRight=0]="LeftToRight",e[e.RightToLeft=1]="RightToLeft"}(p||(n.ParagraphReadingDirection=p={}))},{}],245:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(246),n),o.__exportStar(e(247),n)},{246:246,247:247}],246:[function(e,t,n){"use strict";var o=(0,e(30).default)(e(54));Object.defineProperty(n,"__esModule",{value:!0}),n.isLargerThan=n.estimateSize=void 0;n.estimateSize=function(e){return r(e,Number.POSITIVE_INFINITY)};n.isLargerThan=function(e,t){return r(e,t)>t};var r=function(e,t){for(var n=0,r=[],i=[e];i.length>0;){var s=i.pop(),a=(0,o.default)(s);if("boolean"===a)n+=4;else if("string"===a)n+=2*s.length;else if("number"===a)n+=8;else if("object"===a&&s&&-1===r.indexOf(s))if(s instanceof Uint8Array)n+=s.length;else for(var u in r.push(s),s)i.push(s[u]);if(n>t)return n}return n}},{30:30,54:54}],247:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.v4=void 0,n.v4=function(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},{}],248:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(249),n)},{249:249}],249:[function(e,t,n){"use strict";var o,r=e(30).default,i=r(e(51)),s=r(e(54));Object.defineProperty(n,"__esModule",{value:!0}),n.validateDictionary=n.validateArray=n.ValidationIssueCode=void 0,function(e){e.InvalidType="invalid_type",e.InvalidEnum="invalid_enum",e.NumberMax="number_max",e.NumberMin="number_min",e.LengthMin="length_min",e.LengthMax="length_max",e.ItemsMax="items_max",e.ItemsMin="items_min",e.ItemsUnique="items_unique",e.PropertiesMax="properties_max",e.PropertiesMin="properties_min",e.Required="required",e.Custom="custom"}(o||(n.ValidationIssueCode=o={})),n.validateArray=function e(t,n,r,a,u){if(!Array.isArray(n))return{success:!1,errors:[{code:o.InvalidType,className:t,expected:"array",actual:(0,s.default)(n),path:[],message:"Expected array, got non-array"}]};for(var l,c=function(l){var c=n[l];if(Array.isArray(c)){if(!(r>1))return{v:{success:!1,errors:[{code:o.InvalidType,expected:u||"non-array",className:t,actual:"array",path:[l.toString()],message:"Array element is array when it should be "+(u||"non-array")}]}};var d=e(t,c,r-1,a,u);if(!d.success)return{v:{success:!1,errors:d.errors.map((function(e){return Object.assign(Object.assign({},e),{path:[l.toString()].concat((0,i.default)(e.path))})}))}}}else{if(1!==r)return{v:{success:!1,errors:[{code:o.InvalidType,className:t,expected:"array",actual:(0,s.default)(c),path:[l.toString()],message:"Array element is not array when it should be"}]}};if(void 0!==a){var f=a.validate(c);if(!f.success)return{v:{success:!1,errors:f.errors.map((function(e){return Object.assign(Object.assign({},e),{path:[l.toString()].concat((0,i.default)(e.path))})}))}}}else if((0,s.default)(c)!==u)return{v:{success:!1,errors:[{code:o.InvalidType,expected:u,className:t,actual:(0,s.default)(c),path:[l.toString()],message:"Array element is wrong type"}]}}}},d=0;d<n.length;d++)if(l=c(d))return l.v;return{success:!0,errors:[]}},n.validateDictionary=function e(t,n,r,a,u){if(!n)return{success:!1,errors:[{code:o.InvalidType,className:t,expected:"object",actual:(0,s.default)(n),path:[],message:"Expected dictionary, got undefined object"}]};if("object"!==(0,s.default)(n))return{success:!1,errors:[{code:o.InvalidType,className:t,expected:"object",actual:(0,s.default)(n),path:[],message:"Expected dictionary, got non-object"}]};var l,c=function(l){if(r>1){if("object"!==(0,s.default)(n[l]))return{v:{success:!1,errors:[{code:o.InvalidType,className:t,expected:"object",actual:(0,s.default)(n[l]),path:[l],message:"Dictionary element is not dictionary when it should be"}]}};var c=e(t,n[l],r-1,a,u);if(!c.success)return{v:{success:!1,errors:c.errors.map((function(e){return Object.assign(Object.assign({},e),{path:[l].concat((0,i.default)(e.path))})}))}}}else{if(1!==r)return{v:{success:!1,errors:[{code:o.InvalidType,className:t,expected:"object",actual:(0,s.default)(n[l]),path:[l],message:"Dictionary element is not dictionary when it should be"}]}};if(void 0!==a){var d=a.validate(n[l]);if(!d.success)return{v:{success:!1,errors:d.errors.map((function(e){return Object.assign(Object.assign({},e),{path:[l].concat((0,i.default)(e.path))})}))}}}else if((0,s.default)(n[l])!==u)return{v:{success:!1,errors:[{code:o.InvalidType,className:t,expected:u,actual:(0,s.default)(n[l]),path:[l],message:"Dictionary element is wrong type"}]}}}};for(var d in n)if(l=c(d))return l.v;return{success:!0,errors:[]}}},{30:30,51:51,54:54}],250:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(251),n)},{251:251}],251:[function(e,t,n){"use strict";var o=e(30).default,r=o(e(22)),i=o(e(24)),s=o(e(50)),a=o(e(25));Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowFlights=n.removeDuplicateFlights=n.parseFlights=void 0;n.parseFlights=function(e){if(!e)return new u([],new Set,new Map,new Map);var t,n=e.split(";"),o=new Set,r=new Map,i=new Map,l=(0,a.default)(n);try{for(l.s();!(t=l.n()).done;){var c=t.value.trim();if(""!==c){o.add(u.normalizeName(c));var d=c.split(":"),f=(0,s.default)(d),p=f[0],g=f.slice(1).join(":"),h=u.normalizeName(p);if(h){r.set(h,g);var y=u.parseName(h);y&&y!==h&&i.set(y,h)}}}}catch(e){l.e(e)}finally{l.f()}return new u(n,o,r,i)},n.removeDuplicateFlights=function(e){if(!e)return"";var t,n=new Set,o=[],r=(0,a.default)(e.split(";").reverse());try{for(r.s();!(t=r.n()).done;){var i=t.value,s=i.split(":")[0],l=u.normalizeName(s);n.has(l)||(n.add(l),o.push(i))}}catch(e){r.e(e)}finally{r.f()}return o.reverse().join(";")};var u=function(){function e(t,n,o,i){(0,r.default)(this,e),this.originalFlights=t,this.normalizedFlights=n,this.keyValueFlightsMap=o,this.parsedFlightsMap=i}return(0,i.default)(e,[{key:"hasFlight",value:function(t){var n=e.normalizeName(t),o=this.normalizedFlights.has(n),r=this.keyValueFlightsMap.has(n),i=this.parsedFlightsMap.has(n);return o||r||i}},{key:"getBooleanValue",value:function(t,n){var o,r,i=null===(o=this.getStringValue(t))||void 0===o?void 0:o.toLowerCase(),s=null===(r=this.getStringValue(this.parsedFlightsMap.get(e.normalizeName(t))))||void 0===r?void 0:r.toLowerCase();return"true"===i||"true"===s||"false"!==i&&"false"!==s&&n}},{key:"getIntValue",value:function(e,t){var n=this.getStringValue(e),o=Number.parseInt(n,10);return Number.isNaN(o)?t:o}},{key:"getStringValue",value:function(t,n){var o;return null!==(o=this.keyValueFlightsMap.get(e.normalizeName(t)))&&void 0!==o?o:n}},{key:"getAll",value:function(){return this.originalFlights}},{key:"getAllParsed",value:function(){var e=[];return this.keyValueFlightsMap.forEach((function(t,n){var o=null==t?void 0:t.toLowerCase();switch(o){case"true":e.push({name:n,value:!0});break;case"false":e.push({name:n,value:!1});break;default:var r=Number.parseInt(o,10);Number.isNaN(r)?e.push({name:n,value:t}):e.push({name:n,value:r})}})),e}}],[{key:"normalizeName",value:function(e){return null==e?void 0:e.toLowerCase()}},{key:"parseName",value:function(e){var t=null==e?void 0:e.split(".");return t?t[t.length-1]:void 0}}])}();n.WorkflowFlights=u},{22:22,24:24,25:25,30:30,50:50}],252:[function(e,t,n){"use strict";var o=e("ts-helpers");Object.defineProperty(n,"__esModule",{value:!0}),o.__exportStar(e(253),n)},{253:253}],253:[function(e,t,n){"use strict";var o=(0,e(30).default)(e(25));Object.defineProperty(n,"__esModule",{value:!0}),n.getWaitedContextTypes=n.getContextTypes=void 0;var r=e(86);n.getContextTypes=function(e,t){var n,r=[],i=(0,o.default)(null!=e?e:[]);try{for(i.s();!(n=i.n()).done;){var s=n.value;if(void 0===t||t===s.cardinality){var a,u=(0,o.default)(s.contextTypes);try{for(u.s();!(a=u.n()).done;){var l=a.value;r.push([l,s.cardinality,s.producerWaitPolicy])}}catch(e){u.e(e)}finally{u.f()}}}}catch(e){i.e(e)}finally{i.f()}return r};n.getWaitedContextTypes=function(e){var t,n=[],i=(0,o.default)(null!=e?e:[]);try{for(i.s();!(t=i.n()).done;){var s=t.value;s.cardinality!==r.RequestedContextCardinality.Required&&s.producerWaitPolicy!==r.ProducerWaitPolicy.Always||(n=n.concat(s.contextTypes))}}catch(e){i.e(e)}finally{i.f()}return n}},{25:25,30:30,86:86}],"ts-helpers":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.__setModuleDefault=n.__importStar=n.__importDefault=n.__exportStar=n.__createBinding=n.__awaiter=n.__await=n.__asyncValues=n.__asyncGenerator=void 0;var o=n.__createBinding=Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]},r=(n.__exportStar=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)},n.__awaiter=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},n.__await=function(e){return this instanceof r?(this.v=e,this):new r(e)}),i=(n.__asyncGenerator=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=n.apply(e,t||[]),s=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(e){i[e]&&(o[e]=function(t){return new Promise((function(n,o){s.push([e,t,n,o])>1||u(e,t)}))})}function u(e,t){try{(n=i[e](t)).value instanceof r?Promise.resolve(n.value.v).then(l,c):d(s[0][2],n)}catch(e){d(s[0][3],e)}var n}function l(e){u("next",e)}function c(e){u("throw",e)}function d(e,t){e(t),s.shift(),s.length&&u(s[0][0],s[0][1])}},n.__importDefault=function(e){return e&&e.__esModule?e:{default:e}},n.__asyncValues=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,r){(function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)})(o,r,(t=e[n](t)).done,t.value)}))}}},n.__setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t});n.__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t}},{}]},{},[124])(124)}));
//# sourceMappingURL=al.min.js.map
